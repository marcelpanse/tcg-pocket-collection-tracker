import{e as R,a2 as D,j as e,f as U,as as z,B as A,u as C,t as W,a1 as L,ar as O,r as l,U as H,C as K,a3 as G,at as J,s as Q,J as I}from"./index-5-MxkejW.js";import{N as S,M,C as P}from"./NumberFilter-BvnjM79j.js";import"./index-BvlOrllZ.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Y=R("copy",V),$=({friendId:r,className:c="",showCopyButton:i=!0})=>{const{toast:n}=D(),d=async()=>{try{await navigator.clipboard.writeText(r),n({title:"Friend ID copied to clipboard!",variant:"default",duration:2e3})}catch(x){console.error("Failed to copy friend ID:",x),n({title:"Failed to copy friend ID",variant:"destructive",duration:3e3})}};return r?e.jsxs("span",{className:U("inline-flex items-center gap-1",c),children:[e.jsx("span",{className:"font-mono",children:z(r)}),i&&e.jsx(A,{variant:"ghost",size:"icon",onClick:d,className:"h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200","aria-label":"Copy friend ID",children:e.jsx(Y,{className:"h-2.5 w-2.5"})})]}):null},E=({cards:r,ownedCards:c,selected:i,setSelected:n})=>{const{i18n:d}=C();function x(s){function j(){i?.card_id===s.card_id?n(null):n(s)}return e.jsxs("li",{className:`flex rounded px-2 ${i?.card_id===s.card_id&&"bg-green-900"} hover:bg-gray-500`,onClick:j,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[s.card_id," "]}),e.jsx("span",{children:W(s,d.language)}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",c.find(m=>m.card_id===s.card_id)?.amount_owned||0]})})]},s.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:r.map(x)})})},q=({yourId:r,friendId:c,yourCard:i,friendCard:n,setYourCard:d,setFriendCard:x})=>{const{t:s,i18n:j}=C("trade-matches"),{toast:m}=D();function N(u){return u?e.jsxs("span",{className:"flex w-1/2",children:[e.jsxs("span",{className:"min-w-10",children:[u.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[u.card_id," "]}),e.jsx("span",{children:W(u,j.language)})]}):e.jsx("span",{className:"w-1/2 text-center",children:"–"})}const f=i&&n&&i.rarity===n.rarity;async function g(){if(!f)return;const u={offering_friend_id:r,receiving_friend_id:c,offer_card_id:i.card_id,receiver_card_id:n.card_id,status:"offered"},{error:_}=await L.from("trades").insert(u);_?(console.log(_),m({title:s("tradeFailed"),variant:"default"})):(d(null),x(null),m({title:s("tradeOffered"),variant:"default"}))}return e.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 text-center",children:[e.jsxs("div",{className:"flex justify-between mx-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:s("youGive")}),e.jsx("h4",{className:"text-lg font-medium",children:s("youReceive")})]}),e.jsx("div",{className:"flex justify-between rounded bg-zinc-800 px-1 mt-2",children:i||n?e.jsxs(e.Fragment,{children:[N(i),N(n)]}):e.jsx("span",{className:"w-full text-center",children:s("selectCardsToTrade")})}),e.jsx(A,{className:"text-center mt-4",type:"button",variant:"outline",onClick:g,disabled:!f,children:s("offerTrades")})]})},b=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],se=()=>{const{t:r}=C("trade-matches"),{friendId:c}=O(),{account:i}=l.useContext(H),{ownedCards:n}=l.useContext(K),[d,x]=l.useState(null),[s,j]=l.useState(null),[m,N]=l.useState((i?.max_number_of_cards_wanted||1)-1),[f,g]=l.useState((i?.min_number_of_cards_to_keep||1)+1),[u,_]=l.useState(null),[F,T]=l.useState(null);l.useEffect(()=>{!d&&c&&G(c).then(x),c&&!s&&J(c).then(j)});const k=l.useMemo(()=>Q.filter(a=>a.tradeable).map(a=>a.id),[]),h=l.useMemo(()=>{if(!s)return null;const a={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},y=s.filter(t=>t.amount_owned>(d?.min_number_of_cards_to_keep||1)),w=new Set(n.filter(t=>t.amount_owned>m).map(t=>t.card_id)),v=y.filter(t=>!w.has(t.card_id));for(const t of v){const o=I(t.card_id);o&&b.includes(o.rarity)&&k.includes(o.expansion)&&a[o.rarity].push({...o,amount_owned:t.amount_owned})}return a},[n,s,m,f]),p=l.useMemo(()=>{if(!s)return null;const a={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},y=n.filter(t=>t.amount_owned>=f),w=new Set(s.filter(t=>t.amount_owned>=(d?.max_number_of_cards_wanted||1)).map(t=>t.card_id)),v=y.filter(t=>!w.has(t.card_id));for(const t of v){const o=I(t.card_id);o&&b.includes(o.rarity)&&k.includes(o.expansion)&&a[o.rarity].push({...o,amount_owned:t.amount_owned})}return a},[n,s,m,f]),B=l.useMemo(()=>b.some(a=>h&&h[a].length>0&&p&&p[a].length>0),[h,p]);return c?!i||!d||h===null||p===null?null:d.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-light",children:r("tradingWith")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",d.username," "]}),e.jsx("span",{className:"text-sm",children:e.jsx($,{friendId:d.friend_id})})]}),e.jsxs("div",{className:"flex gap-4 mb-2 mt-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{numberFilter:m,setNumberFilter:N,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(M,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(P,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":r("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(P,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":r("maxFilterTooltip")}),e.jsx(S,{numberFilter:f,setNumberFilter:g,options:[2,3,4,5],labelKey:"minNum"})]})]}),e.jsx(q,{yourId:i.friend_id,friendId:d.friend_id,yourCard:u,friendCard:F,setYourCard:_,setFriendCard:T}),!B&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("noPossibleTradesDescription")})]}),b.map(a=>h[a].length>0&&p[a].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-6",children:a}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("youHave")}),e.jsx(E,{cards:p[a],ownedCards:n,selected:u,setSelected:_})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("friendHas")}),e.jsx(E,{cards:h[a],ownedCards:n,selected:F,setSelected:T})]})]})]},a))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("inActiveTradePage",{username:d?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("inActiveTradeDescription")})]}):"Wrong friend id"};export{se as default};
