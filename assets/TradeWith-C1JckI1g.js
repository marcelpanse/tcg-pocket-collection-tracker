import{u as y,j as e,m as A,Y as B,B as R,X as U,I as K,r as l,U as L,C as O,K as z,L as D,l as H,z as M}from"./index-DYADB5K6.js";import{N as k,M as E,C as P}from"./NumberFilter-Cua9W1Be.js";import"./index-CSQCj1AE.js";const I=({cards:r,ownedCards:u,selected:i,setSelected:a})=>{const{i18n:d}=y();function p(s){function j(){i?.card_id===s.card_id?a(null):a(s)}return e.jsxs("li",{className:`flex rounded px-2 ${i?.card_id===s.card_id&&"bg-green-900"} hover:bg-gray-500`,onClick:j,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[s.card_id," "]}),e.jsx("span",{children:A(s,d.language)}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",u.find(o=>o.card_id===s.card_id)?.amount_owned||0]})})]},s.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:r.map(p)})})},Y=({yourId:r,friendId:u,yourCard:i,friendCard:a,setYourCard:d,setFriendCard:p})=>{const{t:s,i18n:j}=y("trade-matches"),{toast:o}=B();function N(m){return m?e.jsxs("span",{className:"flex w-1/2",children:[e.jsxs("span",{className:"min-w-10",children:[m.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[m.card_id," "]}),e.jsx("span",{children:A(m,j.language)})]}):e.jsx("span",{className:"w-1/2 text-center",children:"–"})}const x=i&&a&&i.rarity===a.rarity;async function g(){if(!x)return;const m={offering_friend_id:r,receiving_friend_id:u,offer_card_id:i.card_id,receiver_card_id:a.card_id,status:"offered"},{error:_}=await U.from("trades").insert(m);_?(console.log(_),o({title:s("tradeFailed"),variant:"default"})):(d(null),p(null),o({title:s("tradeOffered"),variant:"default"}))}return e.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 text-center",children:[e.jsxs("div",{className:"flex justify-between mx-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:s("youGive")}),e.jsx("h4",{className:"text-lg font-medium",children:s("youReceive")})]}),e.jsx("div",{className:"flex justify-between rounded bg-zinc-800 px-1 mt-2",children:i||a?e.jsxs(e.Fragment,{children:[N(i),N(a)]}):e.jsx("span",{className:"w-full text-center",children:s("selectCardsToTrade")})}),e.jsx(R,{className:"text-center mt-4",type:"button",variant:"outline",onClick:g,disabled:!x,children:s("offerTrades")})]})},b=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],$=()=>{const{t:r}=y("trade-matches"),{friendId:u}=K(),{account:i}=l.useContext(L),{ownedCards:a}=l.useContext(O),[d,p]=l.useState(null),[s,j]=l.useState(null),[o,N]=l.useState((i?.max_number_of_cards_wanted||1)-1),[x,g]=l.useState((i?.min_number_of_cards_to_keep||1)+1),[m,_]=l.useState(null),[F,T]=l.useState(null);l.useEffect(()=>{!d&&u&&z(u).then(p),s||D(void 0,u).then(j)});const S=l.useMemo(()=>H.filter(n=>n.tradeable).map(n=>n.id),[]),f=l.useMemo(()=>{if(!s)return null;const n={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},w=s.filter(t=>t.amount_owned>(d?.min_number_of_cards_to_keep||1)),v=new Set(a.filter(t=>t.amount_owned>o).map(t=>t.card_id)),C=w.filter(t=>!v.has(t.card_id));for(const t of C){const c=M(t.card_id);c&&b.includes(c.rarity)&&S.includes(c.expansion)&&n[c.rarity].push({...c,amount_owned:t.amount_owned})}return n},[a,s,o,x]),h=l.useMemo(()=>{if(!s)return null;const n={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},w=a.filter(t=>t.amount_owned>=x),v=new Set(s.filter(t=>t.amount_owned>=(d?.max_number_of_cards_wanted||1)).map(t=>t.card_id)),C=w.filter(t=>!v.has(t.card_id));for(const t of C){const c=M(t.card_id);c&&b.includes(c.rarity)&&S.includes(c.expansion)&&n[c.rarity].push({...c,amount_owned:t.amount_owned})}return n},[a,s,o,x]),W=l.useMemo(()=>b.some(n=>f&&f[n].length>0&&h&&h[n].length>0),[f,h]);return u?!i||!d||f===null||h===null?null:d.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-likht",children:r("tradingWith")}),e.jsxs("span",{className:"text-4xl font-bold",children:[" ",d.username," "]}),e.jsx("span",{children:e.jsxs("span",{className:"text-md",children:["(",d.friend_id,")"]})})]}),e.jsxs("div",{className:"flex gap-4 mb-2 mt-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{numberFilter:o,setNumberFilter:N,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(E,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(P,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":r("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(P,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":r("maxFilterTooltip")}),e.jsx(k,{numberFilter:x,setNumberFilter:g,options:[2,3,4,5],labelKey:"minNum"})]})]}),e.jsx(Y,{yourId:i.friend_id,friendId:d.friend_id,yourCard:m,friendCard:F,setYourCard:_,setFriendCard:T}),!W&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("noPossibleTradesDescription")})]}),b.map(n=>f[n].length>0&&h[n].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-6",children:n}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("youHave")}),e.jsx(I,{cards:h[n],ownedCards:a,selected:m,setSelected:_})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("friendHas")}),e.jsx(I,{cards:f[n],ownedCards:a,selected:F,setSelected:T})]})]})]},n))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("inActiveTradePage",{username:d?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("inActiveTradeDescription")})]}):"Wrong friend id"};export{$ as default};
