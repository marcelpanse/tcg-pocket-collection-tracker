import{j as s,d as ye}from"./query-vendor-DpGHCXpY.js";import{h as q,c as P,gX as H,gQ as ee,g$ as Ne,h0 as J,B as $,j as U,h1 as Ce,h2 as we,u as me,h3 as Te,h4 as Se,h5 as ke,C as ue,D as $e,h6 as Ie,h7 as Ae,h8 as xe,I as R,S as V,h9 as re,ha as ie,hb as W,E as O,R as he,hc as Fe,z as Le,hd as Ee,Q as Pe,he as Me,hf as ze,o as ae,s as He,p as Re,_ as Oe,x as Ue,A as Be,gW as ne,t as le}from"./index-3wbD5lp1.js";import{r as A,e as De,j as _e,L as te,f as pe,u as Ve,k as z,N as We,l as qe}from"./react-vendor-DjlsVz29.js";import{T as K,a as Ke,b as Qe}from"./tabs-Ch3hiDv2.js";import{F as ge}from"./friend-id-display-DF47LPvs.js";import{S as se,a as Ye}from"./SocialShareButtons-BQ6WJ_cB.js";import{u as F,i as Xe}from"./i18n-vendor-DDmeScd6.js";import{p as Ge}from"./ui-vendor-9yhwxkpr.js";import{M as D,C as Q}from"./react-tooltip.min-G8RHWyzs.js";import{A as Je,U as Ze}from"./user-plus-BZTizQr7.js";import{C as je}from"./chevron-first-DQBilOEk.js";import{S as et}from"./SearchInput-8hSdxxud.js";import{g as tt}from"./filters-BMi9ZeP0.js";import{u as st,a as rt,b as it,F as Y,c as X,e as G,d as at}from"./form-pQZ4LpHo.js";import{n as de}from"./coerce-pm5gbQo6.js";import"./charts-vendor-D-Ae2kUX.js";import"./supabase-vendor-CP3OYKhD.js";import"./xlsx-vendor-De4COjWB.js";import"./index-5ziEWJdO.js";const nt=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],lt=q("arrow-left",nt);const dt=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ct=q("arrow-right-left",dt);const ot=[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]],be=q("chevrons-down",ot);const ft=[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]],ve=q("chevrons-up",ft),ce=t=>{const e=P.c(15),{cards:r,selected:a,setSelected:i}=t;let o,n,g;if(e[0]!==r||e[1]!==a?.card_id||e[2]!==i){const u=[...r].sort(ut);let l;e[6]!==a?.card_id||e[7]!==i?(l=function(p){const j=function(){a?.card_id===p.card_id?i(null):i(p)};return s.jsx("li",{className:"rounded cursor-pointer",onClick:j,children:s.jsx(H,{className:`w-full ${a?.card_id===p.card_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:p.card_id,rarity:"hidden"})},p.card_id)},e[6]=a?.card_id,e[7]=i,e[8]=l):l=e[8];const f=l;g="rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",o="space-y-1",n=u.map(f),e[0]=r,e[1]=a?.card_id,e[2]=i,e[3]=o,e[4]=n,e[5]=g}else o=e[3],n=e[4],g=e[5];let d;e[9]!==o||e[10]!==n?(d=s.jsx("ul",{className:o,children:n}),e[9]=o,e[10]=n,e[11]=d):d=e[11];let _;return e[12]!==g||e[13]!==d?(_=s.jsx("div",{className:g,children:d}),e[12]=g,e[13]=d,e[14]=_):_=e[14],_};function mt(t){const e=t.split("-"),r=e[0]||"",a=e.length>1?parseInt(e[1],10):0;return{setName:r,cardNumber:a}}function ut(t,e){const r=mt,a=r(t.card_id),i=r(e.card_id);return a.setName!==i.setName?a.setName.localeCompare(i.setName):a.cardNumber-i.cardNumber}function oe(t){return t===null?s.jsx("span",{className:"inline-block mx-auto",children:"—"}):s.jsx(H,{className:"flex-1",card_id:t.card_id,details:"hidden"})}const xt=t=>{const e=P.c(37),{yourId:r,friendId:a,yourCard:i,friendCard:o,setYourCard:n,setFriendCard:g}=t,{t:d}=F("trade-matches"),{toast:_}=ee(),u=Ne(),l=i&&o&&i.rarity===o.rarity;let f;e[0]!==l||e[1]!==o||e[2]!==a||e[3]!==u||e[4]!==g||e[5]!==n||e[6]!==d||e[7]!==_||e[8]!==i||e[9]!==r?(f=async function(){if(!l)return;const k={offering_friend_id:r,receiving_friend_id:a,offer_card_id:i.card_id,receiver_card_id:o.card_id,status:"offered"};try{u.mutate(k)}catch(I){console.log("TradeOffer: Error inserting trade",I),_({title:d("tradeFailed"),variant:"default"})}n(null),g(null),_({title:d("tradeOffered"),variant:"default"}),J("Offer trade")},e[0]=l,e[1]=o,e[2]=a,e[3]=u,e[4]=g,e[5]=n,e[6]=d,e[7]=_,e[8]=i,e[9]=r,e[10]=f):f=e[10];const c=f;if(!i&&!o){let C;e[11]!==d?(C=d("selectCardsToTrade"),e[11]=d,e[12]=C):C=e[12];let k;return e[13]!==C?(k=s.jsx("div",{className:"sticky top-0 z-10 flex rounded-lg border-1 bg-neutral-900 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[110px] sm:h-[82px]",children:s.jsx("h4",{className:"text-lg font-medium text-neutral-400",children:C})}),e[13]=C,e[14]=k):k=e[14],k}let p;e[15]===Symbol.for("react.memo_cache_sentinel")?(p=s.jsx(ve,{}),e[15]=p):p=e[15];let j;e[16]!==i?(j=oe(i),e[16]=i,e[17]=j):j=e[17];let v;e[18]!==j?(v=s.jsxs("div",{className:"flex w-full sm:w-1/2",children:[p,j]}),e[18]=j,e[19]=v):v=e[19];let T;e[20]===Symbol.for("react.memo_cache_sentinel")?(T=s.jsx(be,{}),e[20]=T):T=e[20];let y;e[21]!==o?(y=oe(o),e[21]=o,e[22]=y):y=e[22];let N;e[23]!==y?(N=s.jsxs("div",{className:"flex w-full sm:w-1/2",children:[T,y]}),e[23]=y,e[24]=N):N=e[24];let S;e[25]!==v||e[26]!==N?(S=s.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-x-4 gap-y-1 p-1",children:[v,N]}),e[25]=v,e[26]=N,e[27]=S):S=e[27];const m=!l;let h;e[28]!==d?(h=d("offerTrades"),e[28]=d,e[29]=h):h=e[29];let x;e[30]!==c||e[31]!==h||e[32]!==m?(x=s.jsx($,{className:"block w-full sm:w-96 mx-auto mt-1 text-center",variant:"outline",onClick:c,disabled:m,children:h}),e[30]=c,e[31]=h,e[32]=m,e[33]=x):x=e[33];let b;return e[34]!==x||e[35]!==S?(b=s.jsxs("div",{className:"sticky top-0 z-10 bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-1",children:[S,x]}),e[34]=x,e[35]=S,e[36]=b):b=e[36],b},ht=t=>{const e=P.c(30),{row:r,selectedTradeId:a,setSelectedTradeId:i}=t,{t:o}=F("trade-matches"),{data:n,isLoading:g}=U();if(g)return null;if(!n){let x;e[0]!==o?(x=o("common:error"),e[0]=o,e[1]=x):x=e[1];let b;return e[2]!==x?(b=s.jsx("p",{className:"text-xl text-center py-8",children:x}),e[2]=x,e[3]=b):b=e[3],b}const d=r.offering_friend_id===n.friend_id?r.offer_card_id:r.receiver_card_id,_=r.offering_friend_id===n.friend_id?r.receiver_card_id:r.offer_card_id;let u;e[4]!==a||e[5]!==i?(u=function(b){a===b.id?i(void 0):i(b.id)},e[4]=a,e[5]=i,e[6]=u):u=e[6];const l=u;let f;e[7]!==n.friend_id||e[8]!==o?(f=x=>{const b={offered:x.offering_friend_id===n.friend_id?s.jsx(Je,{className:"bg-amber-600"}):s.jsx(lt,{className:"bg-amber-600"}),accepted:s.jsx(ct,{className:"bg-lime-600"}),declined:s.jsx(we,{className:"bg-stone-600"}),finished:s.jsx(Ce,{className:"bg-indigo-600"})};return s.jsxs(s.Fragment,{children:[s.jsx(D,{id:`status-${x.id}`}),s.jsx(Ge,{className:"rounded-full p-[3px] my-auto","data-tooltip-id":`status-${x.id}`,"data-tooltip-content":o(`status.${x.status}`),children:b[x.status]})]})},e[7]=n.friend_id,e[8]=o,e[9]=f):f=e[9];const c=f,p=`flex cursor-pointer rounded gap-1 md:gap-2 p-1 ${a===r.id&&"bg-green-900"} hover:bg-neutral-500`;let j;e[10]!==l||e[11]!==r?(j=()=>l(r),e[10]=l,e[11]=r,e[12]=j):j=e[12];let v;e[13]!==r||e[14]!==c?(v=c(r),e[13]=r,e[14]=c,e[15]=v):v=e[15];let T;e[16]===Symbol.for("react.memo_cache_sentinel")?(T=s.jsx(ve,{}),e[16]=T):T=e[16];let y;e[17]!==d?(y=s.jsxs("div",{className:"flex flex-1",children:[T,s.jsx(H,{className:"flex-1",card_id:d,increment:-1})]}),e[17]=d,e[18]=y):y=e[18];let N;e[19]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx(be,{}),e[19]=N):N=e[19];let S;e[20]!==_?(S=s.jsxs("div",{className:"flex flex-1",children:[N,s.jsx(H,{className:"flex-1",card_id:_,increment:1})]}),e[20]=_,e[21]=S):S=e[21];let m;e[22]!==y||e[23]!==S?(m=s.jsxs("div",{className:"flex flex-col-reverse md:flex-row grow-1 justify-between gap-1 md:gap-2",children:[y,S]}),e[22]=y,e[23]=S,e[24]=m):m=e[24];let h;return e[25]!==m||e[26]!==p||e[27]!==j||e[28]!==v?(h=s.jsxs("li",{className:p,onClick:j,children:[v,m]}),e[25]=m,e[26]=p,e[27]=j,e[28]=v,e[29]=h):h=e[29],h};function _t(t){const e=P.c(78),{trade:r,setSelected:a}=t,{t:i}=F("trade-matches"),{toast:o}=ee(),{data:n,isLoading:g}=U(),{data:d,isLoading:_}=me(),u=Te(),l=Se();if(g||_)return null;if(!n||!d)throw new Error("Cannot deduce trade actions: not logged in");let f;e[0]!==d?(f=(m,h)=>{const x=ke(m);return{card_id:m,internal_id:x,amount_owned:(d.get(x)?.amount_owned??0)+h}},e[0]=d,e[1]=f):f=e[1];const c=f;let p;e[2]!==n.friend_id||e[3]!==a||e[4]!==r.id||e[5]!==r.offering_friend_id||e[6]!==r.receiving_friend_id||e[7]!==l?(p=async()=>{const m=r.offering_friend_id===n.friend_id?{offerer_ended:!0}:r.receiving_friend_id===n.friend_id?{receiver_ended:!0}:null;if(m===null)throw new Error("Error hiding trade: cannot match your friend id");await l.mutateAsync({id:r.id,trade:m}),a(void 0),J("Updated trade: ended")},e[2]=n.friend_id,e[3]=a,e[4]=r.id,e[5]=r.offering_friend_id,e[6]=r.receiving_friend_id,e[7]=l,e[8]=p):p=e[8];const j=p;let v;e[9]!==n.friend_id||e[10]!==j||e[11]!==c||e[12]!==i||e[13]!==o||e[14]!==r.offer_card_id||e[15]!==r.offering_friend_id||e[16]!==r.receiver_card_id||e[17]!==r.receiving_friend_id||e[18]!==u?(v=async()=>{if(r.offer_card_id===r.receiver_card_id)return;const m=r.offering_friend_id===n.friend_id?[c(r.offer_card_id,-1),c(r.receiver_card_id,1)]:r.receiving_friend_id===n.friend_id?[c(r.offer_card_id,1),c(r.receiver_card_id,-1)]:null;if(m===null)throw new Error("Error updating collection: cannot match your friend id");await u.mutateAsync(m),await j(),o({title:i("collectionUpdated"),variant:"default"})},e[9]=n.friend_id,e[10]=j,e[11]=c,e[12]=i,e[13]=o,e[14]=r.offer_card_id,e[15]=r.offering_friend_id,e[16]=r.receiver_card_id,e[17]=r.receiving_friend_id,e[18]=u,e[19]=v):v=e[19];const T=v;let y;e[20]!==a||e[21]!==r.id||e[22]!==l?(y=async m=>{l.mutate({id:r.id,trade:{status:m}}),a(r.id),J(`Updated trade: ${m}`)},e[20]=a,e[21]=r.id,e[22]=l,e[23]=y):y=e[23];const N=y,S=r.offering_friend_id===n.friend_id&&r.offerer_ended||r.receiving_friend_id===n.friend_id&&r.receiver_ended;switch(r.status){case"offered":{let m;e[24]!==n.friend_id||e[25]!==i||e[26]!==r.receiving_friend_id||e[27]!==N?(m=r.receiving_friend_id===n.friend_id&&s.jsx($,{onClick:()=>N("accepted"),children:i("actionAccept")}),e[24]=n.friend_id,e[25]=i,e[26]=r.receiving_friend_id,e[27]=N,e[28]=m):m=e[28];let h;e[29]!==N?(h=()=>N("declined"),e[29]=N,e[30]=h):h=e[30];let x;e[31]!==n.friend_id||e[32]!==i||e[33]!==r.receiving_friend_id?(x=r.receiving_friend_id===n.friend_id?i("actionDecline"):i("actionCancel"),e[31]=n.friend_id,e[32]=i,e[33]=r.receiving_friend_id,e[34]=x):x=e[34];let b;e[35]!==h||e[36]!==x?(b=s.jsx($,{onClick:h,children:x}),e[35]=h,e[36]=x,e[37]=b):b=e[37];let C;return e[38]!==m||e[39]!==b?(C=s.jsxs(s.Fragment,{children:[m,b]}),e[38]=m,e[39]=b,e[40]=C):C=e[40],C}case"accepted":{let m;e[41]!==N?(m=()=>N("finished"),e[41]=N,e[42]=m):m=e[42];let h;e[43]!==i?(h=i("actionComplete"),e[43]=i,e[44]=h):h=e[44];let x;e[45]!==m||e[46]!==h?(x=s.jsx($,{onClick:m,children:h}),e[45]=m,e[46]=h,e[47]=x):x=e[47];let b;e[48]!==N?(b=()=>N("declined"),e[48]=N,e[49]=b):b=e[49];let C;e[50]!==i?(C=i("actionCancel"),e[50]=i,e[51]=C):C=e[51];let k;e[52]!==b||e[53]!==C?(k=s.jsx($,{onClick:b,children:C}),e[52]=b,e[53]=C,e[54]=k):k=e[54];let I;return e[55]!==k||e[56]!==x?(I=s.jsxs(s.Fragment,{children:[x,k]}),e[55]=k,e[56]=x,e[57]=I):I=e[57],I}case"declined":{if(S)return null;let m;e[58]!==i?(m=i("actionHide"),e[58]=i,e[59]=m):m=e[59];let h;return e[60]!==j||e[61]!==m?(h=s.jsx($,{onClick:j,children:m}),e[60]=j,e[61]=m,e[62]=h):h=e[62],h}case"finished":{if(S)return null;let m;e[63]!==T?(m=()=>T(),e[63]=T,e[64]=m):m=e[64];let h;e[65]!==i?(h=i("actionUpdate"),e[65]=i,e[66]=h):h=e[66];let x;e[67]!==m||e[68]!==h?(x=s.jsx($,{onClick:m,children:h}),e[67]=m,e[68]=h,e[69]=x):x=e[69];let b;e[70]!==i?(b=i("actionHide"),e[70]=i,e[71]=b):b=e[71];let C;e[72]!==j||e[73]!==b?(C=s.jsx($,{onClick:j,children:b}),e[72]=j,e[73]=b,e[74]=C):C=e[74];let k;return e[75]!==x||e[76]!==C?(k=s.jsxs(s.Fragment,{children:[x,C]}),e[75]=x,e[76]=C,e[77]=k):k=e[77],k}default:return console.log(`Unknown trade status ${r.status}`),null}}function Z(t){const e=P.c(18),{children:r,trades:a}=t,[i,o]=A.useState(void 0);let n;if(e[0]!==i||e[1]!==a){let f;e[3]!==i?(f=c=>c.id===i,e[3]=i,e[4]=f):f=e[4],n=a.find(f),e[0]=i,e[1]=a,e[2]=n}else n=e[2];const g=n;if(a.length===0)return null;let d;if(e[5]!==i||e[6]!==a){let f;e[8]!==i?(f=c=>s.jsx(ht,{row:c,selectedTradeId:i,setSelectedTradeId:o},c.id),e[8]=i,e[9]=f):f=e[9],d=a.toSorted(pt).map(f),e[5]=i,e[6]=a,e[7]=d}else d=e[7];let _;e[10]!==d?(_=s.jsx("ul",{className:"flex flex-col gap-2 md:gap-0",children:d}),e[10]=d,e[11]=_):_=e[11];let u;e[12]!==g?(u=g&&s.jsx("div",{className:"flex gap-2 text-center items-center mt-2",children:s.jsx(_t,{trade:g,setSelected:o})}),e[12]=g,e[13]=u):u=e[13];let l;return e[14]!==r||e[15]!==_||e[16]!==u?(l=s.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-1 md:p-2",children:[_,r,u]}),e[14]=r,e[15]=_,e[16]=u,e[17]=l):l=e[17],l}function pt(t,e){return t.created_at>e.created_at?-1:1}function fe(t,e){const r=new Set(e),a=t.filter(i=>r.has(i)).map(i=>R(i)).filter(i=>W.includes(i.rarity)&&Fe.includes(i.expansion));return Object.groupBy(a,i=>i.rarity)}function gt(){const{t}=F(["trade-matches","common"]),{friendId:e}=De(),[r]=_e(),{data:a,isLoading:i,isError:o}=ue(e),{data:n=new Map,isLoading:g,isError:d}=$e(e),{data:_}=U(),{data:u=new Map}=me(),{data:l=[]}=Ie(),f=Ae(),{toast:c}=ee(),[p,j]=A.useState(!1),[v,T]=A.useState(0),y=xe(a?.friend_id,p,v,!0),[N,S]=A.useState(null),[m,h]=A.useState(()=>{const w=r.get("friend_card");return w?R(Number(w))??null:null});if(A.useEffect(()=>{const w=r.get("friend_card");if(!w||!n||!u)return;const L=R(Number(w));if(!L)return;const E=document.getElementById(L.rarity);E&&E.scrollIntoView({behavior:"smooth"})},[r,n,u]),!_)return null;if(a===null)return s.jsx("p",{className:"text-xl text-center py-8",children:t("notFound")});if(o||d)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(i||g)return s.jsx(V,{size:"lg",overlay:!0});if(!a?.is_active_trading)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:a?.username})}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});const x=fe(ie(u,_.trade_rarity_settings||[]),re(n,a.trade_rarity_settings||[])),b=fe(ie(n,a.trade_rarity_settings||[]),re(u,_.trade_rarity_settings||[])),C=W.some(w=>(x[w]??[]).length>0&&(b[w]??[]).length>0),k=l.some(w=>w.friend_id===a.friend_id),I=()=>{f.mutate({friend_id:a.friend_id,action:"send_request"},{onSuccess:()=>c({title:"Friend request sent!"}),onError:w=>c({variant:"destructive",title:"Error",description:w.message})})};return s.jsxs("div",{className:"flex flex-col gap-4 w-full px-1 sm:px-2",children:[s.jsx("title",{children:`Trade with ${a.username} – TCG Pocket Collection Tracker`}),s.jsxs("div",{className:"mx-1 flex justify-between",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"text-2xl font-light",children:t("tradingWith")}),s.jsxs("span",{className:"text-2xl font-bold",children:[" ",a.username," "]}),s.jsx("span",{className:"block sm:inline text-sm",children:s.jsx(ge,{friendId:a.friend_id})})]}),s.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2",children:[s.jsxs("label",{htmlFor:`history-${e}`,className:"my-auto flex items-center",children:[t("viewHistory"),s.jsx(se,{id:`history-${e}`,className:"ml-2 my-auto",checked:p,onCheckedChange:w=>{j(w),T(0)}})]}),!k&&s.jsxs($,{onClick:I,disabled:f.isPending,children:[s.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Add Friend"]}),s.jsx(te,{to:`/collection/${e}`,children:s.jsxs($,{children:["Collection",s.jsx(O,{})]})})]})]}),y.isLoading?s.jsx(V,{size:"md"}):y.data&&s.jsx(Z,{trades:y.data.trades,children:s.jsxs("div",{className:"flex justify-between mt-2",children:[s.jsxs("span",{className:"text-neutral-400",children:[y.data.count," total offers"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{children:["Page ",v+1]}),s.jsx($,{variant:"outline",onClick:()=>T(()=>0),disabled:v<=0,children:s.jsx(je,{})}),s.jsx($,{variant:"outline",onClick:()=>T(w=>w-1),disabled:v<=0,children:s.jsx(he,{})}),s.jsx($,{variant:"outline",onClick:()=>T(w=>w+1),disabled:!y.data.hasNext,children:s.jsx(O,{})})]})]})}),s.jsx(xt,{yourId:_.friend_id,friendId:a.friend_id,yourCard:N,friendCard:m,setYourCard:S,setFriendCard:h}),!C&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}),W.map(w=>s.jsxs("div",{children:[s.jsxs("h3",{id:w,className:"text-xl font-semibold mb-2 text-center",children:["[ ",w," ]"]}),s.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-4",children:[s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2 text-neutral-400",children:t("youHave")}),x[w]?s.jsx(ce,{cards:x[w],selected:N,setSelected:S}):s.jsx("div",{className:"text-center text-neutral-500 rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]}),s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2 text-neutral-400",children:t("friendHas")}),b[w]?s.jsx(ce,{cards:b[w],selected:m,setSelected:h}):s.jsx("div",{className:"text-center text-neutral-500  rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]})]})]},w))]})}function jt(){const{t}=F(["trade-matches","common"]),e=pe(),r=A.useRef(null),[a,i]=A.useState(""),[o,n]=A.useState(),g=tt({search:a,rarity:[...W]},new Map),d=o&&R(o),_=ye({getScrollElement:()=>r.current,count:g.length,getItemKey:u=>g[u].card_id,estimateSize:()=>32});if(o&&!d)throw new Error("Selected card was not found in the database");return s.jsxs("div",{className:"sm:w-sm mx-auto",children:[s.jsx(et,{setValue:i}),s.jsx("div",{ref:r,className:"my-2 h-96 rounded border border-neutral-700 px-1 overflow-y-auto",children:s.jsx("ul",{style:{height:`${_.getTotalSize()}px`},className:"relative",children:_.getVirtualItems().map(u=>{const l=g[u.index];return s.jsx("button",{type:"button",className:"absolute top-0 left-0 w-full cursor-pointer",style:{height:`${u.size}px`,transform:`translateY(${u.start}px)`},onClick:()=>n(f=>f===l.internal_id?void 0:l.internal_id),children:s.jsx(H,{className:`w-full ${o===l.internal_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:l.card_id})},u.key)})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx($,{className:"w-1/2",disabled:!o,onClick:()=>e(`/trade/matches/results?card_id=${o}`),children:d?t("search.byCard",{cardName:Le(d,Xe.language)}):t("search.selectCard")}),s.jsx($,{className:"w-1/2",onClick:()=>e("/trade/matches/results"),children:t("search.allCards")})]})]})}function bt(){const t=P.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=F(e),[a]=_e();let i;t[1]!==a?(i=a.has("card_id")?Number(a.get("card_id")):void 0,t[1]=a,t[2]=i):i=t[2];const o=i,{data:n,isLoading:g}=Ee(o);if(o!==void 0&&R(o)===void 0)throw new Error("Requested card was not found in the database");if(g){let l;t[3]!==r?(l=r("common:loading"),t[3]=r,t[4]=l):l=t[4];let f;t[5]===Symbol.for("react.memo_cache_sentinel")?(f=s.jsx("br",{}),t[5]=f):f=t[5];let c;t[6]!==r?(c=r("longOperation"),t[6]=r,t[7]=c):c=t[7];let p;return t[8]!==l||t[9]!==c?(p=s.jsxs("p",{className:"text-xl text-center py-8",children:[l,f,c]}),t[8]=l,t[9]=c,t[10]=p):p=t[10],p}if(!n){let l;return t[11]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx(Pe,{}),t[11]=l):l=t[11],l}if(n.length===0){let l;t[12]!==r?(l=r("noTradePartners"),t[12]=r,t[13]=l):l=t[13];let f;return t[14]!==l?(f=s.jsx("p",{className:"text-xl text-center py-8",children:l}),t[14]=l,t[15]=f):f=t[15],f}const d=o?`?friend_card=${o}`:"";let _;if(t[16]!==n||t[17]!==d||t[18]!==r){let l;t[20]!==d||t[21]!==r?(l=f=>s.jsxs("div",{className:"max-w-md w-full flex justify-between items-center mx-auto px-4",children:[s.jsx("p",{className:"mr-2",children:f.username}),s.jsx(te,{to:`/trade/${f.friend_id}${d}`,children:s.jsxs($,{variant:"outline",className:"my-auto",children:[r("viewTradePartner",{tradeMatches:f.trade_matches}),s.jsx(O,{})]})})]},f.friend_id),t[20]=d,t[21]=r,t[22]=l):l=t[22],_=n.map(l),t[16]=n,t[17]=d,t[18]=r,t[19]=_}else _=t[19];let u;return t[23]!==_?(u=s.jsx("div",{className:"flex flex-col gap-4",children:_}),t[23]=_,t[24]=u):u=t[24],u}function vt(t){const e=P.c(44),{friendId:r,activeTrades:a}=t;let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=["trade-matches","common"],e[0]=i):i=e[0];const{t:o}=F(i),{data:n,isLoading:g}=ue(r),[d,_]=A.useState(!1),[u,l]=A.useState(0),f=xe(r,d,u,d);if(g)return null;let c;e[1]!==o?(c=o("tradingWith"),e[1]=o,e[2]=c):c=e[2];let p;e[3]!==c?(p=s.jsx("span",{className:"text-md",children:c}),e[3]=c,e[4]=p):p=e[4];const j=n?.username||"unknown";let v;e[5]!==j?(v=s.jsxs("span",{className:"text-md font-bold",children:[" ",j," "]}),e[5]=j,e[6]=v):v=e[6];let T;e[7]!==n?(T=n&&s.jsx(ge,{friendId:n.friend_id,showFriendId:!1,className:"ml-1"}),e[7]=n,e[8]=T):T=e[8];let y;e[9]!==p||e[10]!==v||e[11]!==T?(y=s.jsxs("p",{children:[p,v,T]}),e[9]=p,e[10]=v,e[11]=T,e[12]=y):y=e[12];const N=`history-${r}`;let S;e[13]!==o?(S=o("viewHistory"),e[13]=o,e[14]=S):S=e[14];const m=`history-${r}`;let h;e[15]!==m||e[16]!==d?(h=s.jsx(se,{id:m,className:"ml-2 my-auto",checked:d,onCheckedChange:_}),e[15]=m,e[16]=d,e[17]=h):h=e[17];let x;e[18]!==h||e[19]!==N||e[20]!==S?(x=s.jsxs("label",{htmlFor:N,className:"my-auto flex items-center",children:[S,h]}),e[18]=h,e[19]=N,e[20]=S,e[21]=x):x=e[21];const b=`/trade/${r}`;let C;e[22]!==o?(C=o("openTradeWith"),e[22]=o,e[23]=C):C=e[23];let k;e[24]===Symbol.for("react.memo_cache_sentinel")?(k=s.jsx(O,{}),e[24]=k):k=e[24];let I;e[25]!==C?(I=s.jsxs($,{variant:"outline",className:"my-auto",children:[C,k]}),e[25]=C,e[26]=I):I=e[26];let w;e[27]!==b||e[28]!==I?(w=s.jsx(te,{to:b,children:I}),e[27]=b,e[28]=I,e[29]=w):w=e[29];let L;e[30]!==x||e[31]!==w?(L=s.jsxs("span",{className:"flex gap-4",children:[x,w]}),e[30]=x,e[31]=w,e[32]=L):L=e[32];let E;e[33]!==L||e[34]!==y?(E=s.jsxs("div",{className:"flex justify-between items-center mb-1 mx-1",children:[y,L]}),e[33]=L,e[34]=y,e[35]=E):E=e[35];let M;e[36]!==a||e[37]!==f||e[38]!==u||e[39]!==d?(M=d?f.isLoading?s.jsx(V,{size:"md"}):f.data&&s.jsx(Z,{trades:f.data.trades,children:s.jsxs("p",{className:"flex justify-between mt-2",children:[s.jsxs("span",{className:"text-neutral-400",children:[f.data.count," total offers"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{children:["Page ",u+1]}),s.jsx($,{variant:"outline",onClick:()=>l(Ct),disabled:u<=0,children:s.jsx(je,{})}),s.jsx($,{variant:"outline",onClick:()=>l(Nt),disabled:u<=0,children:s.jsx(he,{})}),s.jsx($,{variant:"outline",onClick:()=>l(yt),disabled:!f.data.hasNext,children:s.jsx(O,{})})]})]})}):s.jsx(Z,{trades:a}),e[36]=a,e[37]=f,e[38]=u,e[39]=d,e[40]=M):M=e[40];let B;return e[41]!==E||e[42]!==M?(B=s.jsxs("div",{className:"w-full",children:[E,M]}),e[41]=E,e[42]=M,e[43]=B):B=e[43],B}function yt(t){return t+1}function Nt(t){return t-1}function Ct(){return 0}function wt(){const t=P.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=F(e),{data:a,isLoading:i}=U(),{data:o,isLoading:n}=Me();if(i||n){let c;return t[1]===Symbol.for("react.memo_cache_sentinel")?(c=s.jsx(V,{size:"lg",overlay:!0}),t[1]=c):c=t[1],c}if(!o||!a){let c;t[2]!==r?(c=r("common:error"),t[2]=r,t[3]=c):c=t[3];let p;return t[4]!==c?(p=s.jsx("p",{className:"text-xl text-center py-8",children:c}),t[4]=c,t[5]=p):p=t[5],p}if(o.length===0){let c;t[6]!==r?(c=r("noTradeOffers"),t[6]=r,t[7]=c):c=t[7];let p;return t[8]!==c?(p=s.jsx("p",{children:c}),t[8]=c,t[9]=p):p=t[9],p}let g,d;t[10]!==a.friend_id||t[11]!==o?(g=kt(o,a.friend_id),d=Object.fromEntries(Object.entries(g).map(Tt)),t[10]=a.friend_id,t[11]=o,t[12]=g,t[13]=d):(g=t[12],d=t[13]);const _=d;let u,l;if(t[14]!==g||t[15]!==_){let c;t[18]!==_?(c=(v,T)=>_[T]-_[v],t[18]=_,t[19]=c):c=t[19];const p=Object.keys(g).toSorted(c);u="flex flex-col items-center mx-auto gap-6 sm:px-4 mb-12 w-full";let j;t[20]!==g?(j=v=>s.jsx(vt,{friendId:v,activeTrades:g[v]},v),t[20]=g,t[21]=j):j=t[21],l=p.map(j),t[14]=g,t[15]=_,t[16]=u,t[17]=l}else u=t[16],l=t[17];let f;return t[22]!==u||t[23]!==l?(f=s.jsx("div",{className:u,children:l}),t[22]=u,t[23]=l,t[24]=f):f=t[24],f}function Tt(t){const[e,r]=t;return[e,Math.max(...r.map(St))]}function St(t){return new Date(t.updated_at).getTime()}function kt(t,e){return Object.groupBy(t,r=>r.offering_friend_id===e?r.receiving_friend_id:r.receiving_friend_id===e?r.offering_friend_id:(console.log("Fetched row does not match user friend_id",r),"undefined"))}function $t(){const{t}=F("trade-matches"),{data:e}=U(),r=ze(),a=ae({is_active_trading:Re(),trade_rarity_settings:He(ae({rarity:Oe(Ue),to_collect:de().min(0).max(100),to_keep:de().min(0).max(100)}))}),i=st({resolver:rt(a),values:{is_active_trading:e?.is_active_trading||!1,trade_rarity_settings:e?.trade_rarity_settings||[]}}),o=async n=>{r.mutate({username:e?.username,is_active_trading:n.is_active_trading,trade_rarity_settings:n.trade_rarity_settings},{onSuccess:()=>le({title:t("accountSaved"),variant:"default"}),onError:g=>{console.error("error saving account",g),le({title:t("errorSavingAccount"),variant:"destructive"})}})};return!e||!e.username?s.jsx(Be,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:t("noAccount")}):s.jsxs("div",{children:[s.jsx(it,{...i,children:s.jsxs("form",{onSubmit:i.handleSubmit(o),className:"rounded-md border-1 border-neutral-700 space-y-2 p-4 mx-auto max-w-xl",children:[s.jsx("h2",{className:"text-xl text-center mb-6",children:t("settingsTitle")}),s.jsx(Y,{control:i.control,name:"is_active_trading",render:({field:n})=>s.jsx(X,{className:"flex flex-col items-start",children:s.jsx(G,{children:s.jsxs(at,{className:"flex",children:[t("isActiveTrading"),s.jsx(se,{className:"ml-2",checked:n.value,onCheckedChange:n.onChange,disabled:!e?.is_public,"data-tooltip-id":"is-active-trading-disabled","data-tooltip-content":e?.is_public?void 0:t("isActiveTradingDisabledTooltip")}),!e?.is_public&&s.jsxs(s.Fragment,{children:[s.jsx(D,{id:"is-active-trading-disabled"}),s.jsx(Q,{className:"size-4 ml-1","data-tooltip-id":"is-active-trading-disabled","data-tooltip-content":t("isActiveTradingDisabledTooltip")})]})]})})})}),s.jsxs("div",{className:"grid grid-cols-3 gap-y-2 gap-x-8 w-fit mt-6",children:[s.jsx("span",{children:t("rarity")}),s.jsxs("span",{className:"flex items-center",children:[t("toCollect"),s.jsx(D,{id:"to-collect"}),s.jsx(Q,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toCollectTooltip")})]}),s.jsxs("span",{className:"flex items-center",children:[t("toKeep"),s.jsx(D,{id:"to-collect"}),s.jsx(Q,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toKeepTooltip")})]}),i.watch("trade_rarity_settings").map((n,g)=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex-1",children:n.rarity},`label-${n.rarity}`),s.jsx(Y,{control:i.control,name:`trade_rarity_settings.${g}.to_collect`,render:({field:d})=>s.jsx(X,{className:"flex-1",children:s.jsx(G,{children:s.jsx(ne,{className:"w-24",type:"number",...d})})})},`to-collect-${n.rarity}`),s.jsx(Y,{control:i.control,name:`trade_rarity_settings.${g}.to_keep`,render:({field:d})=>s.jsx(X,{className:"flex-1",children:s.jsx(G,{children:s.jsx(ne,{className:"w-24",type:"number",...d})})})},`to-keep-${n.rarity}`)]}))]}),s.jsx($,{type:"submit",className:"block ml-auto flex gap-2",disabled:r.isPending,isPending:r.isPending,children:t("save")})]})}),s.jsx(Ye,{className:"mt-4 mx-auto w-fit"})]})}function Yt(){const t=P.c(34),{t:e}=F("trade-matches"),r=Ve(),a=pe();let i;t[0]!==r.pathname?(i=r.pathname.split("/").pop()||"offers",t[0]=r.pathname,t[1]=i):i=t[1];const o=i;let n,g;t[2]!==r.pathname||t[3]!==a?(n=()=>{r.pathname==="/trade"&&a("/trade/offers")},g=[r.pathname,a],t[2]=r.pathname,t[3]=a,t[4]=n,t[5]=g):(n=t[4],g=t[5]),A.useEffect(n,g);let d;t[6]!==a?(d=x=>a(`/trade/${x}`),t[6]=a,t[7]=d):d=t[7];let _;t[8]!==e?(_=e("tabOffers"),t[8]=e,t[9]=_):_=t[9];let u;t[10]!==_?(u=s.jsx(K,{className:"text-md",value:"offers",children:_}),t[10]=_,t[11]=u):u=t[11];let l;t[12]!==e?(l=e("tabMatches"),t[12]=e,t[13]=l):l=t[13];let f;t[14]!==l?(f=s.jsx(K,{className:"text-md",value:"matches",children:l}),t[14]=l,t[15]=f):f=t[15];let c;t[16]!==e?(c=e("tabSettings"),t[16]=e,t[17]=c):c=t[17];let p;t[18]!==c?(p=s.jsx(K,{className:"text-md",value:"settings",children:c}),t[18]=c,t[19]=p):p=t[19];let j;t[20]!==u||t[21]!==f||t[22]!==p?(j=s.jsxs(Ke,{className:"gap-4 mb-6 rounded-lg border-b-1 border-neutral-700 border-solid dark:bg-transparent pb-2",children:[u,f,p]}),t[20]=u,t[21]=f,t[22]=p,t[23]=j):j=t[23];let v;t[24]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(z,{path:"/",element:s.jsx(We,{to:"/trade/offers",replace:!0})}),t[24]=v):v=t[24];let T;t[25]===Symbol.for("react.memo_cache_sentinel")?(T=s.jsx(z,{path:"offers",element:s.jsx(wt,{})}),t[25]=T):T=t[25];let y;t[26]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx(z,{path:"matches",element:s.jsx(jt,{})}),t[26]=y):y=t[26];let N;t[27]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx(z,{path:"matches/results",element:s.jsx(bt,{})}),t[27]=N):N=t[27];let S;t[28]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsx(z,{path:"settings",element:s.jsx($t,{})}),t[28]=S):S=t[28];let m;t[29]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsxs(qe,{children:[v,T,y,N,S,s.jsx(z,{path:":friendId",element:s.jsx(gt,{})})]}),t[29]=m):m=t[29];let h;return t[30]!==o||t[31]!==j||t[32]!==d?(h=s.jsxs(Qe,{className:"flex flex-col mx-auto max-w-[900px]",value:o,onValueChange:d,children:[j,m]}),t[30]=o,t[31]=j,t[32]=d,t[33]=h):h=t[33],h}export{Yt as default};
