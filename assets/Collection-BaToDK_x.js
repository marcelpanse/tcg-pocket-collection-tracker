import{e as $,v as z,q as k,x as U,y as G,u as b,j as a,r as w,t as T,B as j,z as H,m as F,L as B,A as Q,C as J,S as K,D as V,E as W,F as X,G as Y,H as Z,J as P,K as ee,M as ne}from"./index-B9qTgk5o.js";import{A as te,a as ae,b as oe}from"./alert-COZsru_g.js";import{R as se,D as ie,u as re}from"./index-C9KoPuoI.js";import{C as le}from"./CardsTable-CVu_7AST.js";import{e as N,c as ce,D as v,T as _,a as de,r as ue}from"./index-B2TWMapI.js";import{M as O,C as me}from"./react-tooltip.min-jzh1RfSn.js";import{S as xe}from"./SearchInput-DFGPtou2.js";import{T as pe}from"./Card-CL9Jzk-B.js";import{S as he}from"./siren-CsZalbir.js";import"./utils-jBBWVaZq.js";import"./index-BXTl64LS.js";import"./FancyCard-D27wMEg1.js";const ge=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],fe=$("circle-alert",ge);function we(e,n){if(e.length===0)return n.length;if(n.length===0)return e.length;let o=Array(e.length+1).fill(0).map((s,i)=>i),t=Array(e.length+1);for(let s=1;s<=n.length;s++){t[0]=s;for(let i=1;i<=e.length;i++){const l=e[i-1]===n[s-1]?0:1;t[i]=Math.min(o[i]+1,t[i-1]+1,o[i-1]+l)}[o,t]=[t,o]}return o[e.length]}const D=["all","missing","owned"],I=["all",...N],E=["default","recent","expansion-newest"],q=ce;function ye(e,n){let o=z;if(e.deckbuildingMode&&(o=o.filter(t=>t.internal_id===t.alternate_versions[0])),e.expansion!==void 0&&e.expansion!=="all"&&(o=o.filter(t=>t.expansion===e.expansion)),e.expansion!==void 0&&e.pack!==void 0&&e.pack!=="all"&&(o=o.filter(t=>t.pack===e.pack||t.pack==="everypack")),e.owned!==void 0&&e.owned!=="all"&&(e.owned==="owned"?o=o.filter(t=>t.collected):e.owned==="missing"&&(o=o.filter(t=>!t.collected))),e.sortBy!==void 0&&(e.sortBy==="recent"?o=o.toSorted((t,s)=>{const i=n.get(t.internal_id)?.updated_at,l=n.get(s.internal_id)?.updated_at;return i&&l?new Date(l).getTime()-new Date(i).getTime():i&&!l?-1:1}):e.sortBy==="expansion-newest"&&(o=[...o].sort((t,s)=>t.expansion!==s.expansion?N.indexOf(t.expansion)-N.indexOf(s.expansion):t.card_id.localeCompare(s.card_id,k.language||"en",{numeric:!0})))),o=o.filter(t=>e.rarity===void 0||e.rarity.length===0?!0:e.rarity.includes(t.rarity)),o=o.filter(t=>e.cardType===void 0||e.cardType.length===0?!0:t.card_type.toLowerCase()==="trainer"?e.cardType.includes("trainer"):e.cardType.includes(t.energy.toLowerCase())),e.search){const t=e.search.toLowerCase(),s=2;o=o.filter(i=>{const l=U(i,k.language).toLowerCase();let x=!1;e.allTextSearch&&(x=i.ability&&(i.ability.name.toLowerCase().includes(t)||i.ability.effect.toLowerCase().includes(t))||i.attacks.some(p=>p.name?.toLowerCase().includes(t)||p.effect?.toLowerCase()!=="no effect"&&p.effect?.toLowerCase()?.includes(t)));const h=l.includes(t),c=we(l,t)<=s,r=i.card_id.toLowerCase().includes(t);return x||h||c||r})}for(const t of o){e.deckbuildingMode?t.amount_owned=t.alternate_versions.reduce((i,l)=>{const x=G(l);return i+(n.get(x?.internal_id||0)?.amount_owned??0)},0):t.amount_owned=n.get(t.internal_id)?.amount_owned??0;const s=n.get(t.internal_id);t.collected=s?.collection.includes(t.card_id)??!1,t.updated_at=s?.updated_at}if(e.minNumber){const t=e.minNumber;o=o.filter(s=>(s.amount_owned??0)>=t)}if(e.maxNumber&&e.maxNumber!==100){const t=e.maxNumber;o=o.filter(s=>(s.amount_owned??0)<=t)}return o}const be=({allTextSearch:e,setAllTextSearch:n})=>{const{t:o}=b("search-input");return a.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[a.jsx("input",{type:"checkbox",id:"checkbox",checked:e,onChange:()=>n(!e),className:"w-4 h-4"}),a.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:o("allTextLabel")}),a.jsx(O,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),a.jsx(me,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":o("allTextTooltip")})]})},ve=({className:e,filters:n,setFilters:o,clearFilters:t})=>{const{t:s}=b(["pages/collection","common/sets","common/packs","filters"]),i=r=>p=>o({[r]:p}),l=w.useMemo(()=>{if(!(n.expansion===void 0||n.expansion==="all"))return["all",...T(n.expansion).packs.map(r=>r.name).filter(r=>r!=="everypack")]},[n.expansion]);function x(r){n.pack===void 0?o({expansion:r}):o({expansion:r,pack:"all"})}function h(r){return s(r==="all"?"all":T(r).name,{ns:"common/sets"})}function c(r){return r==="trainer"?"T":a.jsx("img",{src:`/images/energy/${r}.webp`,alt:r,className:"h-4"})}return a.jsxs("div",{className:e,children:[n.search!==void 0&&a.jsx(xe,{value:n.search,setValue:i("search")}),n.allTextSearch!==void 0&&a.jsx(be,{allTextSearch:n.allTextSearch,setAllTextSearch:i("allTextSearch")}),n.expansion!==void 0&&a.jsx(v,{label:s("expansion",{ns:"common/sets"}),options:I,value:n.expansion,onChange:x,show:h}),n.pack!==void 0&&l&&a.jsx(_,{className:"block",options:l,value:n.pack,onChange:i("pack"),show:r=>s(r,{ns:"common/packs"})}),n.rarity!==void 0&&a.jsx(se,{rarityFilter:n.rarity,setRarityFilter:i("rarity"),deckbuildingMode:n.deckbuildingMode}),n.cardType!==void 0&&a.jsx(de,{options:q,value:n.cardType,onChange:i("cardType"),show:c}),n.owned!==void 0&&a.jsx(_,{className:"block",options:D,value:n.owned,onChange:i("owned"),show:r=>s(r,{ns:"filters",keyPrefix:"f-owned"})}),n.sortBy!==void 0&&a.jsx(v,{label:s("f-sortBy.sortBy",{ns:"filters"}),options:E,value:n.sortBy,onChange:i("sortBy"),show:r=>s(`f-sortBy.${r}`,{ns:"filters"})}),n.minNumber!==void 0&&a.jsx(v,{label:s("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:n.minNumber,onChange:i("minNumber")}),n.maxNumber!==void 0&&a.jsx(v,{label:s("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:n.maxNumber,onChange:i("maxNumber")}),n.deckbuildingMode!==void 0&&a.jsx(ie,{deckbuildingMode:n.deckbuildingMode,setDeckbuildingMode:i("deckbuildingMode")}),a.jsx(j,{variant:"outline",className:"!text-red-700",onClick:t,children:s("filters.clear")})]})};function S({cards:e,filters:n,setFilters:o,clearFilters:t,share:s,missions:i}){const{t:l}=b("pages/collection"),{setIsProfileDialogOpen:x}=H(),{data:h=new Map}=F();async function c(){s?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),Q({title:"Copied to clipboard",variant:"default"})):x(!0)}const r=w.useMemo(()=>{let g=0;const y=new Set;for(const d of e)y.has(d.internal_id)||(g+=d.amount_owned||0,y.add(d.internal_id));return g},[e]),p=w.useMemo(()=>(h?.get(83654)?.amount_owned??0)>0,[e]);return a.jsxs("div",{className:"flex flex-col h-fit gap-2",children:[a.jsxs("small",{className:"flex gap-2",children:[l("stats.summary",{selected:e.length,uniquesOwned:e.filter(g=>!!g.collected).length,totalOwned:r}),p&&a.jsxs(a.Fragment,{children:[a.jsx(O,{id:"mewCardOwned",className:"text-start max-w-72",clickable:!0}),a.jsx(fe,{className:"h-5 w-5","data-tooltip-id":"mewCardOwned","data-tooltip-content":l("stats.mewCardOwned")})]})]}),a.jsx(ve,{className:"flex flex-col gap-y-3",filters:n,setFilters:o,clearFilters:t}),a.jsxs("div",{className:"flex flex-col mt-4 gap-2",children:[s!==void 0&&a.jsx(j,{variant:"outline",onClick:c,children:l("filters.share")}),i&&a.jsx(B,{className:"w-full",to:"/collection/missions",children:a.jsx(j,{className:"w-full",variant:"outline",children:l("goToMissions")})})]})]})}const M=e=>{const n=Number(e);return Number.isNaN(n)?void 0:n},L=e=>e==="true"?!0:e==="false"?!1:void 0,je={search:e=>e,expansion:e=>I.includes(e)?e:void 0,pack:e=>e,cardType:e=>e.split(",").filter(n=>q.includes(n)),rarity:e=>e.split(",").filter(n=>ue.includes(n)),owned:e=>D.includes(e)?e:void 0,sortBy:e=>E.includes(e)?e:void 0,minNumber:M,maxNumber:M,deckbuildingMode:L,allTextSearch:L},A={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1};function R({children:e,cards:n,isPublic:o,share:t}){const s=re({query:"(max-width: 767px)"}),[i,l]=w.useState(!1),[x,h]=J(),c=w.useMemo(()=>{const d={...A},f=(u,m)=>{const C=je[u](m);C!==void 0&&(d[u]=C)};for(const u in d){const m=x.get(u);m!=null&&f(u,m)}return d},[x]),r=d=>{const f=new URLSearchParams(x);for(const u in d){const m=d[u];m==null||m==="all"||Array.isArray(m)&&m.length===0||m===""?f.delete(u):Array.isArray(m)?f.set(u,m.join(",")):f.set(u,String(m)),h(f)}},p=()=>h(new URLSearchParams),g=w.useMemo(()=>{let d=0;for(const f in c){const u=f;c[u]!==A[u]&&d++}return d},[c]),y=w.useMemo(()=>ye(c,n),[c,n]);return a.jsxs("div",{className:"flex justify-center gap-2 xl:gap-8 px-1",children:[s?a.jsx(K,{open:i,onOpenChange:l,children:a.jsxs(V,{side:"left",className:"w-full",children:[a.jsx(W,{children:a.jsx(X,{children:"Filters"})}),a.jsx(S,{cards:y,filters:c,setFilters:r,clearFilters:p,share:t,missions:!o})]})}):a.jsx("div",{className:"w-80",children:a.jsx(S,{cards:y,filters:c,setFilters:r,clearFilters:p,share:t,missions:!o})}),a.jsxs("div",{className:"w-full max-w-[900px]",children:[s&&a.jsxs("div",{className:"h-9 flex overflow-hidden text-center rounded-md text-sm font-medium border shadow-sm border-neutral-700 divide-x divide-neutral-700 [&>*]:cursor-pointer [&>*]:hover:bg-neutral-600 [&>*]:hover:text-neutral-50",children:[a.jsxs("button",{type:"button",className:"flex-1",onClick:()=>l(!0),children:["Filters",g>0&&` (${g})`]}),g>0&&a.jsx("button",{type:"button",className:"group px-2",onClick:p,children:a.jsx(pe,{className:"stroke-neutral-200 group-hover:stroke-neutral-50"})})]}),a.jsx(le,{cards:y,editable:!c.deckbuildingMode&&!o,groupExpansions:c.sortBy!=="recent",children:e})]})]})}function Ne(){const{t:e}=b("common"),{data:n,isLoading:o}=P(),{data:t=new Map,isLoading:s}=F();return o&&s?a.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")}):a.jsx(R,{cards:t,isPublic:!1,share:n!==void 0&&n.friend_id!==""&&n.is_public})}function Ce({friendId:e}){const{t:n}=b(["pages/collection","common"]),{data:o,isLoading:t}=ee(e),{data:s,isLoading:i}=ne(e);return t||i?a.jsx("p",{className:"text-xl text-center py-8",children:n("common:loading")}):o===void 0||s===void 0?a.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):o===null?a.jsx("p",{className:"text-xl text-center py-8",children:n("common:noAccount")}):s===null?a.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):a.jsx("div",{className:"flex flex-col gap-y-1",children:a.jsx(R,{cards:s,isPublic:!0,children:a.jsxs(te,{className:"mb-1 border-1 border-neutral-700 shadow-none",children:[a.jsx(he,{className:"h-4 w-4"}),a.jsx(ae,{children:n("publicCollectionTitle",{username:o.username})}),a.jsx(oe,{children:a.jsxs("div",{className:"flex items-center",children:[n("publicCollectionDescription"),a.jsx(B,{to:`/trade/${e}`,children:a.jsx(j,{className:"mb-4",children:n("showPossibleTrades")})})]})})]})})})}function Ie(){const{t:e}=b(["pages/collection","common"]),n=Y(),{friendId:o}=Z(),{data:t,isLoading:s}=P();if(w.useEffect(()=>{!o&&!s&&t?.friend_id&&n(`/collection/${t.friend_id}`,{replace:!0})},[s,o,t?.friend_id,n]),s)return a.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")});const i=o??t?.friend_id;return i&&i!==t?.friend_id?a.jsx(Ce,{friendId:i}):a.jsx(Ne,{})}export{Ie as default};
