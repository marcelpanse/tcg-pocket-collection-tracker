import{y as se,z as ie,v as ce,t as M,A as le,B as de,u as j,j as t,r as u,C as B,D as ue,E as pe,m as xe,F as me,G as D,n as $,H as P,J as z,K as U,L as fe,M as he,N as ge,O as ve,Q as we,S as Ce,T as ye,U as be,V as Pe,f as je,W as Ne,X as ke,x as O,Y as C,Z as Te,_ as Ae,$ as _e,a0 as Re,a1 as Se,a2 as G,a3 as Me,a4 as Oe,a5 as Fe,a6 as H,a7 as Ee,a8 as Le,o as Ie}from"./index-Cwxahtcw.js";import{A as Be,a as De,b as $e}from"./alert-T2mdigTB.js";import{R as F,D as ze,u as Ue}from"./index-BGHoSP-M.js";import{C as Ge}from"./CardsTable-BrQn_QUY.js";import{S as E}from"./SearchInput-X3AA9jIY.js";import{e as He,c as Ve,D as b,T,a as Ke,r as Qe}from"./useWindowDimensionsHook-CxlwE2Xb.js";import{M as We,C as qe}from"./react-tooltip.min-BE17Yoyw.js";import{S as Ze}from"./siren-DEJ9giDS.js";import"./utils-CkC9kOud.js";import"./Card-B3XREt9F.js";import"./FancyCard-BZwktCXA.js";import"./index-CS_6l8fh.js";function Je(e,r){if(e.length===0)return r.length;if(r.length===0)return e.length;let n=Array(e.length+1).fill(0).map((a,s)=>s),o=Array(e.length+1);for(let a=1;a<=r.length;a++){o[0]=a;for(let s=1;s<=e.length;s++){const i=e[s-1]===r[a-1]?0:1;o[s]=Math.min(n[s]+1,o[s-1]+1,n[s-1]+i)}[n,o]=[o,n]}return n[e.length]}const _=["all","missing","owned"],R=["all",...He],V=["default","recent","expansion-newest"],K=Ve;function Xe(e,r){let n=se;if(e.deckbuildingMode&&(n=n.filter(o=>ie.includes(o.rarity)||o.rarity==="P")),e.expansion!=="all"&&(n=n.filter(o=>o.expansion===e.expansion)),e.pack!=="all"&&(n=n.filter(o=>o.pack===e.pack||o.pack==="everypack")),e.owned!=="all"&&(e.owned==="owned"?n=n.filter(o=>o.collected):e.owned==="missing"&&(n=n.filter(o=>!o.collected))),e.sortBy==="recent")n=[...n].sort((o,a)=>{const s=r.get(o.internal_id)?.updated_at,i=r.get(a.internal_id)?.updated_at;return s&&i?new Date(i).getTime()-new Date(s).getTime():s&&!i?-1:1});else if(e.sortBy==="expansion-newest"){const o=[...ce].reverse();n=[...n].sort((a,s)=>{const i=o.findIndex(l=>l.id===a.expansion),d=o.findIndex(l=>l.id===s.expansion);return i!==d?i-d:a.card_id.localeCompare(s.card_id,M.language||"en",{numeric:!0})})}n=n.filter(o=>e.rarity.length===0?!0:e.rarity.includes(o.rarity)),n=n.filter(o=>e.cardType.length===0?!0:o.card_type.toLowerCase()==="trainer"?e.cardType.includes("trainer"):e.cardType.includes(o.energy.toLowerCase())),e.search&&(n=n.filter(a=>{const s=le(a,M.language).toLowerCase(),i=e.search.toLowerCase();let d=!1;e.allTextSearch&&(d=a.ability&&(a.ability.name.toLowerCase().includes(i)||a.ability.effect.toLowerCase().includes(i))||a.attacks.some(x=>x.name?.toLowerCase().includes(i)||x.effect?.toLowerCase()!=="no effect"&&x.effect?.toLowerCase()?.includes(i)));const l=s.includes(i),g=Je(s,i)<=2,p=a.card_id.toLowerCase().includes(i);return d||l||g||p}));for(const o of n)e.deckbuildingMode?o.amount_owned=o.alternate_versions.reduce((a,s)=>{const i=de(s);return a+(r.get(i?.internal_id||0)?.amount_owned??0)},0):o.amount_owned=r.get(o.internal_id)?.amount_owned??0,o.collected=r.get(o.internal_id)?.collection.includes(o.card_id)??!1;return n=n.filter(o=>(o.amount_owned??0)>=e.minNumber),e.maxNumber!==100&&(n=n.filter(o=>(o.amount_owned??0)<=e.maxNumber)),n}const Ye=({allTextSearch:e,setAllTextSearch:r})=>{const{t:n}=j("search-input");return t.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[t.jsx("input",{type:"checkbox",id:"checkbox",checked:e,onChange:()=>r(!e),className:"w-4 h-4"}),t.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:n("allTextLabel")}),t.jsx(We,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),t.jsx(qe,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":n("allTextTooltip")})]})};var A="Popover",[Q]=xe(A,[B]),N=B(),[et,w]=Q(A),W=e=>{const{__scopePopover:r,children:n,open:o,defaultOpen:a,onOpenChange:s,modal:i=!1}=e,d=N(r),l=u.useRef(null),[g,p]=u.useState(!1),[x,f]=ue({prop:o,defaultProp:a??!1,onChange:s,caller:A});return t.jsx(pe,{...d,children:t.jsx(et,{scope:r,contentId:me(),triggerRef:l,open:x,onOpenChange:f,onOpenToggle:u.useCallback(()=>f(m=>!m),[f]),hasCustomAnchor:g,onCustomAnchorAdd:u.useCallback(()=>p(!0),[]),onCustomAnchorRemove:u.useCallback(()=>p(!1),[]),modal:i,children:n})})};W.displayName=A;var q="PopoverAnchor",tt=u.forwardRef((e,r)=>{const{__scopePopover:n,...o}=e,a=w(q,n),s=N(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:d}=a;return u.useEffect(()=>(i(),()=>d()),[i,d]),t.jsx(z,{...s,...o,ref:r})});tt.displayName=q;var Z="PopoverTrigger",J=u.forwardRef((e,r)=>{const{__scopePopover:n,...o}=e,a=w(Z,n),s=N(n),i=D(r,a.triggerRef),d=t.jsx($.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":oe(a.open),...o,ref:i,onClick:P(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?d:t.jsx(z,{asChild:!0,...s,children:d})});J.displayName=Z;var S="PopoverPortal",[ot,nt]=Q(S,{forceMount:void 0}),X=e=>{const{__scopePopover:r,forceMount:n,children:o,container:a}=e,s=w(S,r);return t.jsx(ot,{scope:r,forceMount:n,children:t.jsx(U,{present:n||s.open,children:t.jsx(fe,{asChild:!0,container:a,children:o})})})};X.displayName=S;var y="PopoverContent",Y=u.forwardRef((e,r)=>{const n=nt(y,e.__scopePopover),{forceMount:o=n.forceMount,...a}=e,s=w(y,e.__scopePopover);return t.jsx(U,{present:o||s.open,children:s.modal?t.jsx(rt,{...a,ref:r}):t.jsx(st,{...a,ref:r})})});Y.displayName=y;var at=ve("PopoverContent.RemoveScroll"),rt=u.forwardRef((e,r)=>{const n=w(y,e.__scopePopover),o=u.useRef(null),a=D(r,o),s=u.useRef(!1);return u.useEffect(()=>{const i=o.current;if(i)return he(i)},[]),t.jsx(ge,{as:at,allowPinchZoom:!0,children:t.jsx(ee,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:P(e.onCloseAutoFocus,i=>{i.preventDefault(),s.current||n.triggerRef.current?.focus()}),onPointerDownOutside:P(e.onPointerDownOutside,i=>{const d=i.detail.originalEvent,l=d.button===0&&d.ctrlKey===!0,g=d.button===2||l;s.current=g},{checkForDefaultPrevented:!1}),onFocusOutside:P(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),st=u.forwardRef((e,r)=>{const n=w(y,e.__scopePopover),o=u.useRef(!1),a=u.useRef(!1);return t.jsx(ee,{...e,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{e.onCloseAutoFocus?.(s),s.defaultPrevented||(o.current||n.triggerRef.current?.focus(),s.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:s=>{e.onInteractOutside?.(s),s.defaultPrevented||(o.current=!0,s.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&a.current&&s.preventDefault()}})}),ee=u.forwardRef((e,r)=>{const{__scopePopover:n,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:d,onPointerDownOutside:l,onFocusOutside:g,onInteractOutside:p,...x}=e,f=w(y,n),m=N(n);return we(),t.jsx(Ce,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:s,children:t.jsx(ye,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:p,onEscapeKeyDown:d,onPointerDownOutside:l,onFocusOutside:g,onDismiss:()=>f.onOpenChange(!1),children:t.jsx(be,{"data-state":oe(f.open),role:"dialog",id:f.contentId,...m,...x,ref:r,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),te="PopoverClose",it=u.forwardRef((e,r)=>{const{__scopePopover:n,...o}=e,a=w(te,n);return t.jsx($.button,{type:"button",...o,ref:r,onClick:P(e.onClick,()=>a.onOpenChange(!1))})});it.displayName=te;var ct="PopoverArrow",lt=u.forwardRef((e,r)=>{const{__scopePopover:n,...o}=e,a=N(n);return t.jsx(Pe,{...a,...o,ref:r})});lt.displayName=ct;function oe(e){return e?"open":"closed"}var dt=W,ut=J,pt=X,ne=Y;const xt=dt,mt=ut,ae=u.forwardRef(({className:e,align:r="center",sideOffset:n=4,...o},a)=>t.jsx(pt,{children:t.jsx(ne,{ref:a,align:r,sideOffset:n,className:je("z-50 w-72 rounded-md border border-neutral-200 bg-white p-4 text-neutral-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-50",e),...o})}));ae.displayName=ne.displayName;const ft=({filters:e,setFilters:r,clearFilters:n,visibleFilters:o,filtersDialog:a,share:s,missionsButton:i})=>{const{toast:d}=Ne(),{t:l}=j(["pages/collection","common/sets","common/packs","filters"]),{setIsProfileDialogOpen:g}=ke(),p=c=>k=>r({[c]:k}),x=u.useMemo(()=>{if(e.expansion!=="all")return["all",...O(e.expansion).packs.map(c=>c.name).filter(c=>c!=="everypack")]},[e.expansion]);function f(c){r({expansion:c,pack:"all"})}function m(c){return l(c==="all"?"all":O(c).name,{ns:"common/sets"})}function v(c){return c==="trainer"?"T":t.jsx("img",{src:`/images/energy/${c}.webp`,alt:c,className:"h-4"})}async function h(){s?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),d({title:"Copied to clipboard",variant:"default"})):g(!0)}return t.jsxs("div",{id:"filterbar",className:"flex flex-col gap-x-2 flex-wrap",children:[o?.expansions&&t.jsxs("div",{className:"flex gap-x-2 px-4 mb-2",children:[t.jsx(b,{label:l("expansion",{ns:"common/sets"}),options:R,value:e.expansion,onChange:f,show:m}),x&&t.jsx(T,{options:x,value:e.pack,onChange:p("pack"),show:c=>l(c,{ns:"common/packs"})})]}),t.jsxs("div",{className:"gap-2 flex-row gap-y-1 px-4 flex",children:[o?.search&&t.jsx(E,{className:"w-full sm:w-32",setSearchValue:p("search")}),o?.owned&&t.jsx(T,{options:_,value:e.owned,onChange:p("owned"),show:c=>l(c,{ns:"filters",keyPrefix:"f-owned"})}),o?.rarity&&t.jsxs(xt,{children:[t.jsx(mt,{asChild:!0,children:t.jsxs(C,{variant:"outline",children:[l("rarity",{ns:"filters"})," (",e.rarity.length,")"]})}),t.jsx(ae,{className:"w-28",children:t.jsx(F,{className:"flex-col bg-transparent",rarityFilter:e.rarity,setRarityFilter:p("rarity"),deckbuildingMode:e.deckbuildingMode})})]}),a&&t.jsxs(Te,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(C,{variant:"outline",children:l("filters.allFilters")})}),t.jsxs(_e,{className:"border-1 border-neutral-700 shadow-none max-h-[90vh] overflow-y-auto content-start",children:[t.jsx(Re,{children:t.jsx(Se,{children:l("filters.filtersCount")})}),t.jsxs("div",{className:"flex flex-col gap-3",children:[a.search&&t.jsx(E,{className:"w-full bg-neutral-900",setSearchValue:p("search")}),a.allTextSearch&&t.jsx(Ye,{allTextSearch:e.allTextSearch,setAllTextSearch:p("allTextSearch")}),a.expansions&&t.jsx(b,{className:"bg-neutral-900",label:l("expansion",{ns:"common/sets"}),options:R,value:e.expansion,onChange:f,show:m}),a.pack&&x&&t.jsx(T,{className:"w-full bg-neutral-900",options:x,value:e.pack,onChange:p("pack"),show:c=>l(c,{ns:"common/packs"})}),a.rarity&&t.jsx(F,{className:"bg-neutral-900",rarityFilter:e.rarity,setRarityFilter:p("rarity"),deckbuildingMode:e.deckbuildingMode}),a.cardType&&t.jsx(Ke,{className:"bg-neutral-900",options:K,value:e.cardType,onChange:p("cardType"),show:v}),a.owned&&t.jsx(T,{className:"w-full bg-neutral-900",options:_,value:e.owned,onChange:p("owned"),show:c=>l(c,{ns:"filters",keyPrefix:"f-owned"})}),a.sortBy&&t.jsx(b,{className:"bg-neutral-900",label:l("f-sortBy.sortBy",{ns:"filters"}),options:V,value:e.sortBy,onChange:p("sortBy"),show:c=>l(`f-sortBy.${c}`,{ns:"filters"})}),a.amount&&t.jsxs(t.Fragment,{children:[t.jsx(b,{className:"bg-neutral-900",label:l("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.minNumber,onChange:p("minNumber")}),t.jsx(b,{className:"bg-neutral-900",label:l("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.maxNumber,onChange:p("maxNumber")})]}),a.deckBuildingMode&&t.jsx(ze,{deckbuildingMode:e.deckbuildingMode,setDeckbuildingMode:p("deckbuildingMode")}),t.jsx(C,{variant:"outline",className:"!text-red-700",onClick:n,children:l("filters.clear")}),i&&t.jsx(G,{className:"mt-2",to:"/collection/missions",children:t.jsx(C,{className:"w-full",variant:"outline",children:l("goToMissions")})})]})]})]}),s!==void 0&&t.jsx(C,{variant:"outline",onClick:h,children:l("filters.share")})]})]})},L=e=>{const r=Number(e);return Number.isNaN(r)?void 0:r},I=e=>e==="true"?!0:e==="false"?!1:void 0,ht={search:e=>e,expansion:e=>R.includes(e)?e:void 0,pack:e=>e,cardType:e=>e.split(",").filter(r=>K.includes(r)),rarity:e=>e.split(",").filter(r=>Qe.includes(r)),owned:e=>_.includes(e)?e:void 0,sortBy:e=>V.includes(e)?e:void 0,minNumber:L,maxNumber:L,deckbuildingMode:I,allTextSearch:I};function re({cards:e,isPublic:r,extraOffset:n,share:o}){const a=Ue({query:"(max-width: 767px)"}),[s,i]=Me(),d=u.useMemo(()=>{const m={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1},v=(h,c)=>{const k=ht[h](c);k!==void 0&&(m[h]=k)};for(const h in m){const c=s.get(h);c!=null&&v(h,c)}return m},[s]),l=m=>{const v=new URLSearchParams(s);for(const h in m){const c=m[h];c==null||c==="all"||Array.isArray(c)&&c.length===0||c===""?v.delete(h):Array.isArray(c)?v.set(h,c.join(",")):v.set(h,String(c)),i(v)}},g=()=>i(new URLSearchParams),p=u.useMemo(()=>Xe(d,e),[d,e]),[x,f]=u.useState(!1);return u.useEffect(()=>{f(!0);const m=setTimeout(()=>f(!1),100);return()=>clearTimeout(m)},[d]),t.jsxs(t.Fragment,{children:[t.jsx(ft,{filters:d,setFilters:l,clearFilters:g,visibleFilters:{expansions:!a,allTextSearch:!a,search:!0,owned:!a,rarity:!a},filtersDialog:{expansions:!0,pack:!0,search:!0,owned:!0,sortBy:!0,rarity:!0,cardType:!0,amount:!0,deckBuildingMode:!0,allTextSearch:!0},missionsButton:!r,share:o}),p&&t.jsx(Ge,{cards:p,resetScrollTrigger:x,showStats:!d.deckbuildingMode,extraOffset:n,editable:!d.deckbuildingMode&&!r,groupExpansions:d.sortBy!=="recent"})]})}function gt(){const{t:e}=j("common"),{data:r,isLoading:n}=H(),{data:o=new Map,isLoading:a}=Ie();return n&&a?t.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")}):t.jsx("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:t.jsx(re,{cards:o,isPublic:!1,extraOffset:20,share:r!==void 0&&r.friend_id!==""&&r.is_public})})}function vt({friendId:e}){const{t:r}=j(["pages/collection","common"]),{data:n,isLoading:o}=Ee(e),{data:a,isLoading:s}=Le(e);return o||s?t.jsx("p",{className:"text-xl text-center py-8",children:r("common:loading")}):n===void 0||a===void 0?t.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):n===null?t.jsx("p",{className:"text-xl text-center py-8",children:r("common:noAccount")}):a===null?t.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):t.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[t.jsxs(Be,{className:"mb-1 border-1 border-neutral-700 shadow-none",children:[t.jsx(Ze,{className:"h-4 w-4"}),t.jsx(De,{children:r("publicCollectionTitle",{username:n.username})}),t.jsx($e,{children:t.jsxs("div",{className:"flex items-center",children:[r("publicCollectionDescription"),t.jsx(G,{to:`/trade/${e}`,children:t.jsx(C,{className:"mb-4",children:r("showPossibleTrades")})})]})})]}),t.jsx(re,{cards:a,isPublic:!0,extraOffset:124})]})}function St(){const{t:e}=j(["pages/collection","common"]),r=Oe(),{friendId:n}=Fe(),{data:o,isLoading:a}=H();if(u.useEffect(()=>{!n&&!a&&o?.friend_id&&r(`/collection/${o.friend_id}`,{replace:!0})},[a,n,o?.friend_id,r]),a)return t.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")});const s=n??o?.friend_id;return s&&s!==o?.friend_id?t.jsx(vt,{friendId:s}):t.jsx(gt,{})}export{St as default};
