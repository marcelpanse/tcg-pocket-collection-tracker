import{e as M,r as a,q as y,j as e,t as v,ar as E,U as $,C as T,B as S,M as L,u as P,J as A,A as O,S as B,L as F,N as R,O as X,D as Y,v as z,Q as H}from"./index-eSFM90zN.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],V=M("plus",U);function q({selected:l,setIsSelected:u,card:t,size:r="default"}){const i=a.useRef(null),[s,d]=a.useState({x:0,y:0}),[x,f]=a.useState(!1),c=a.useRef(J(o=>d(o),50)),h=o=>{c.current({x:o.clientX,y:o.clientY})},g=a.useCallback(()=>{f(!0),window.addEventListener("mousemove",h)},[]),j=a.useCallback(()=>{f(!1),window.removeEventListener("mousemove",h)},[]);let n=0,b=0;if(i.current&&x){const o=i.current.getBoundingClientRect(),k=o.left+o.width/2,I=o.top+o.height/2;n=s.x-k,b=s.y-I}const w=(o,k,I)=>Math.min(Math.max(o,k),I),C=x?w(n/4,-10,10):0,p=x?w(-b/4,-10,10):0,m={transform:`perspective(1000px)
                   rotateY(${C}deg)
                   rotateX(${p}deg)
                   scale(${x?1.04:1})`,transition:"transform 0.3s cubic-bezier(0.17, 0.67, 0.5, 1.03)",transformStyle:"preserve-3d",opacity:l?1:.5,width:r==="small"?"80px":"100%",height:r==="small"?"112px":"auto"},N=t.image?.split("/").at(-1),D=`/images/${y.language}/${N}`;return e.jsx("div",{style:{flex:"1 0 20%",perspective:"1000px",transformStyle:typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("firefox")?"flat":"preserve-3d",display:"flex",justifyContent:"center",alignItems:"center",zIndex:x?10:0},children:N&&e.jsx("img",{draggable:!1,loading:"lazy",onMouseDown:()=>u?.(!l),ref:i,className:"card-test",style:m,src:D,alt:v(t,y.language),onMouseEnter:g,onMouseLeave:j,onError:o=>{o.target.src=t.image}})})}const J=(l,u)=>{let t=0,r=null;return(...i)=>{const s=performance.now(),d=s-t;if(d<u){r||(r=setTimeout(()=>{t=performance.now(),r=null,l(...i)},u-d));return}t=s,l(...i)}},_={};function Q({card:l,onImageClick:u,className:t,editable:r=!0}){const i=E(),{user:s,setIsLoginDialogOpen:d}=a.use($),{setSelectedCardId:x,updateCards:f}=a.use(T),[c,h]=a.useState(l.amount_owned||0),[g,j]=a.useState(0);a.useEffect(()=>{j(c)},[c]);const n=a.useCallback(async p=>{if(!s?.user.email)return;const m=l.card_id,N=Math.max(0,p);h(N),_[m]&&window.clearTimeout(_[m]),_[m]=window.setTimeout(async()=>{if(!s||!s.user.email)throw new Error("User not logged in");await f([{card_id:m,amount_owned:N}])},1e3)},[s,c]),b=a.useCallback(async()=>{if(!s){d(!0);return}await n(c+1)},[n]),w=a.useCallback(async()=>{if(!s){d(!0);return}await n(c-1)},[n]),C=async p=>{const m=p.target.value===""?0:Number.parseInt(p.target.value,10);!Number.isNaN(m)&&m>=0&&await n(m)};return l.linkedCardID?null:e.jsxs("div",{className:`group flex flex-col items-center rounded-lg ${t}`,children:[e.jsx("button",{type:"button",className:"cursor-pointer",onClick:()=>{x(l.card_id),u?.()},children:e.jsx(q,{card:l,selected:c>0})}),e.jsxs("p",{className:"w-full min-w-0 text-[12px] pt-2 text-center font-semibold leading-tight",children:[e.jsx("span",{className:"block md:inline",children:l.card_id}),e.jsx("span",{className:"hidden md:inline",children:" – "}),e.jsx("span",{className:"block md:inline truncate",children:v(l,y.language)})]}),e.jsx("div",{className:"flex items-center gap-x-1",children:r&&!i.friendId?e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:w,className:"rounded-full",tabIndex:-1,children:e.jsx(L,{})}),e.jsx("input",{min:"0",max:"99",type:"text",disabled:!!i.friendId,value:g,onChange:C,className:"w-7 text-center border-none rounded",onFocus:p=>p.target.select()}),e.jsx(S,{variant:"ghost",size:"icon",className:"rounded-full",onClick:b,tabIndex:-1,children:e.jsx(V,{})})]}):e.jsx("span",{className:"mt-1",children:c})})]})}function K({cardId:l,onClose:u}){const{t}=P(["pages/card-detail","common/types","common/packs","common/sets"]),[r,i]=a.useState(l),s=A(r)||{},d=O(s.expansion),{ownedCards:x}=a.use(T),[f,c]=a.useState(!1);if(!s)return null;const h=s.pack==="everypack"?d?.packs[0].name:s.pack,g=x.find(n=>n.card_id===r),j=n=>new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"long"}).format(new Date(n));return e.jsx(B,{open:!0,onOpenChange:n=>{n||u()},children:e.jsxs(F,{className:"transition-all duration-300 ease-in-out border-slate-600 overflow-y-auto",children:[e.jsx(R,{children:e.jsxs(X,{children:[v(s,y.language)," ",s.rarity]})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"px-10 py-4 w-full",children:e.jsx("div",{className:"cursor-pointer",children:e.jsx(Q,{className:"w-full",card:{...s,amount_owned:g?.amount_owned||0},onImageClick:()=>c(!0)},r)})}),e.jsx(Y,{open:f,onOpenChange:c,children:e.jsx(z,{className:"flex items-center justify-center p-0 max-w-3xl max-h-[90vh]",children:s.image&&e.jsx("img",{src:s.image,alt:v(s,y.language),className:"w-full h-full object-scale-down",onClick:()=>c(!1)})})}),e.jsxs("div",{className:"p-4 w-full",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t("text.alternateVersions")}),s.alternate_versions?.map(n=>e.jsxs("p",{onClick:()=>i(n.card_id),className:"cursor-pointer",children:[n.card_id===r?"✓":"→"," ",n.version]},n.card_id))]}),d&&h&&e.jsx("p",{className:"text-lg mb-1",children:e.jsx("strong",{children:t("text.chanceToPull",{ns:"pages/card-detail",percent:H(d,h,s).toFixed(2)})})}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.expansion"),":"]})," ",s.expansion]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.pack"),":"]})," ",t(`${s.pack}`,{ns:"common/packs"})]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Energy:"})," ",s.energy]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.hp"),":"]})," ",s.hp]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.cardType"),":"]})," ",t(`cardType.${s.card_type}`)]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.evolutionType"),":"]})," ",t(`evolutionType.${s.evolution_type}`)]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.ex"),":"]})," ",t(`ex.${s.ex}`)]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.baby"),":"]})," ",t(`ex.${s.baby?"yes":"no"}`)]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.craftingCost"),":"]})," ",s.crafting_cost]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.artist"),":"]})," ",s.artist]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsxs("strong",{children:[t("text.setDetails"),":"]})," ",t(s.set_details,{ns:"common/sets"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t("text.details")}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t("text.weakness"),":"]})," ",t(`${s.weakness}`,{ns:"common/types"})||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t("text.retreat"),":"]})," ",s.retreat||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t("text.ability"),":"]})," ",s.ability?.name||"No ability"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t("text.abilityEffect"),":"]})," ",s.ability?.effect||"N/A"]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("p",{className:"text-neutral-400 text-sm",children:[e.jsxs("strong",{className:"font-semibold",children:[t("text.updated"),":"]})," ",g?.updated_at?j(g.updated_at):"N/A"]})})]})]})]})})}export{K as C,q as F,V as P,Q as a};
