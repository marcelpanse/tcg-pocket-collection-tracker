import{u as x,j as e,J as H,r as t,U as Q,C as Y,k as Z,v as k,V as R,W as ee,B as F,X as re}from"./index-DeW7bl5k.js";import{T as ae,a as se,b as v,c as $,C as I}from"./tabs-C_VxoxYb.js";import{R as ne,N as M}from"./useWindowDimensionsHook-zNWfCOyP.js";import{C as te}from"./CardDetail-CHmb32dp.js";import{A as b,a as C,b as j}from"./alert-B6Xr3wUC.js";import{S as h}from"./siren-q1oaBO3b.js";import"./Card-DUpf7T-i.js";function oe(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noCardsNeeded.title")}),e.jsx(j,{children:n("noCardsNeeded.description")})]})})}function ie(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noSellableCards.title")}),e.jsx(j,{children:n("noSellableCards.description")})]})})}function le(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noTradeableCards.title")}),e.jsx(j,{children:n("noTradeableCards.description")})]})})}function de(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("notLoggedIn.title")}),e.jsx(j,{children:n("notLoggedIn.description")})]})})}function be(){const{t:n}=x("pages/trade"),V=H(),{user:P,account:l,setIsProfileDialogOpen:A}=t.use(Q),{ownedCards:i,selectedCardId:S,setSelectedCardId:O}=t.use(Y),[c,B]=t.useState([]),[_,K]=t.useState(0),[y,U]=t.useState(2),[T,J]=t.useState(3),[m,W]=t.useState("looking_for"),E=t.useMemo(()=>Z.filter(r=>r.tradeable).map(r=>r.id),[]),N=r=>c.length===0?!0:r.rarity!==""&&c.includes(r.rarity),p=t.useMemo(()=>k.filter(r=>i.findIndex(a=>a.card_id===r.card_id)===-1||i[i.findIndex(a=>a.card_id===r.card_id)].amount_owned<=_).filter(r=>R[r.rarity]!==null&&E.includes(r.expansion)),[i,_]),w=t.useMemo(()=>p.filter(N),[p,c]),f=t.useMemo(()=>{const r=i.filter(a=>a.amount_owned>=y);return k.filter(a=>r.findIndex(o=>o.card_id===a.card_id)>-1).map(a=>({...a,amount_owned:r.find(o=>o.card_id===a.card_id)?.amount_owned})).filter(a=>R[a.rarity]!==null&&E.includes(a.expansion))},[i,y]),D=t.useMemo(()=>f.filter(N),[f,c]),g=t.useMemo(()=>{const r=i.filter(a=>a.amount_owned>=T);return k.filter(a=>r.findIndex(o=>o.card_id===a.card_id)>-1).map(a=>({...a,amount_owned:r.find(o=>o.card_id===a.card_id)?.amount_owned})).filter(a=>ee[a.rarity]!==null)},[i,T]),X=t.useMemo(()=>g.filter(N),[g,c]),q=()=>{let r="";l?.is_public&&(r+=`${n("publicTradePage")} https://tcgpocketcollectiontracker.com/#/collection/${l?.friend_id}/trade
`),l?.username&&(r+=`${n("friendID")} ${l.friend_id} (${l.username})

`),r+=`${n("lookingForCards")}
`;const a=w.sort((s,u)=>{const L=s.expansion.localeCompare(u.expansion);return L!==0?L:s.rarity.localeCompare(u.rarity)});for(let s=0;s<a.length;s++)(s>0?a[s-1].expansion:"")!==a[s].expansion&&(r+=`
${a[s].set_details}:
`),r+=`${a[s].rarity} ${a[s].card_id} - ${a[s].name}
`;const o=w.map(s=>s.rarity);r+=`

${n("forTradeCards")}
`;const d=D.filter(s=>o.includes(s.rarity)).sort((s,u)=>s.rarity.localeCompare(u.rarity));for(let s=0;s<d.length;s++)(s>0?d[s-1].expansion:"")!==d[s].expansion&&(r+=`
${d[s].set_details}:
`),r+=`${d[s].rarity} ${d[s].card_id} - ${d[s].name}
`;return r},z=async()=>{const r=q();re({title:n("copiedInClipboard"),variant:"default",duration:3e3}),await navigator.clipboard.writeText(r)},G=()=>{A(!0)};return P?e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs(ae,{defaultValue:m,onValueChange:r=>W(r),children:[e.jsxs("div",{className:"mx-auto max-w-[900px] flex flex-row flex-wrap align-center gap-x-4 gap-y-2 px-4",children:[e.jsxs(se,{className:"flex-grow m-auto flex-wrap h-auto border-1 border-neutral-700 rounded-md",children:[e.jsx(v,{value:"looking_for",children:n("lookingFor")}),e.jsx(v,{value:"for_trade",children:n("forTrade")}),e.jsx(v,{value:"buying_tokens",children:n("buyingTokens")})]}),e.jsx(ne,{rarityFilter:c,setRarityFilter:B}),e.jsxs("div",{className:"sm:mt-1 flex flex-row flex-wrap align-center gap-x-4 gap-y-1",children:[m==="looking_for"&&e.jsx(M,{numberFilter:_,setNumberFilter:K,options:[0,1,2,3,4,5],labelKey:"maxNum"}),m==="for_trade"&&e.jsx(M,{numberFilter:y,setNumberFilter:U,options:[2,3,4,5],labelKey:"minNum"}),m==="buying_tokens"&&e.jsx(M,{numberFilter:T,setNumberFilter:J,options:[2,3,4,5],labelKey:"minNum"}),e.jsx(F,{variant:"outline",onClick:()=>z(),children:"Copy to clipboard"}),l?.is_public?e.jsx(F,{variant:"outline",onClick:()=>V(`/collection/${l?.friend_id}/trade`),children:n("openTradingPage")}):e.jsx(F,{variant:"outline",onClick:()=>G(),children:n("enableTradingPage")})]})]}),e.jsxs("div",{className:"mx-auto max-w-[900px] ",children:[e.jsx($,{value:"looking_for",children:p&&p.length>0?e.jsx(I,{cards:w,extraOffset:105}):e.jsx(oe,{})}),e.jsx($,{value:"for_trade",children:f&&f.length>0?e.jsx(I,{cards:D,extraOffset:105}):e.jsx(le,{})}),e.jsx($,{value:"buying_tokens",children:g&&g.length>0?e.jsx(I,{cards:X,extraOffset:105}):e.jsx(ie,{})})]})]}),S&&e.jsx(te,{cardId:S,onClose:()=>O("")})]}):e.jsx(de,{})}export{be as default};
