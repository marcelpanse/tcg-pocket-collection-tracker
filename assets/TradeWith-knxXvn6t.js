import{u as y,j as e,t as I,a2 as B,B as R,a1 as U,ar as O,r as l,U as D,C as H,a3 as K,as as L,s as z,J as M}from"./index-BGH8ekYN.js";import{N as k,M as P,C as E}from"./NumberFilter-UhAbskWe.js";import"./index-tb2YRwz2.js";const A=({cards:r,ownedCards:o,selected:i,setSelected:n})=>{const{i18n:d}=y();function p(s){function j(){i?.card_id===s.card_id?n(null):n(s)}return e.jsxs("li",{className:`flex rounded px-2 ${i?.card_id===s.card_id&&"bg-green-900"} hover:bg-gray-500`,onClick:j,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[s.card_id," "]}),e.jsx("span",{children:I(s,d.language)}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",o.find(m=>m.card_id===s.card_id)?.amount_owned||0]})})]},s.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:r.map(p)})})},G=({yourId:r,friendId:o,yourCard:i,friendCard:n,setYourCard:d,setFriendCard:p})=>{const{t:s,i18n:j}=y("trade-matches"),{toast:m}=B();function b(u){return u?e.jsxs("span",{className:"flex w-1/2",children:[e.jsxs("span",{className:"min-w-10",children:[u.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[u.card_id," "]}),e.jsx("span",{children:I(u,j.language)})]}):e.jsx("span",{className:"w-1/2 text-center",children:"–"})}const x=i&&n&&i.rarity===n.rarity;async function g(){if(!x)return;const u={offering_friend_id:r,receiving_friend_id:o,offer_card_id:i.card_id,receiver_card_id:n.card_id,status:"offered"},{error:_}=await U.from("trades").insert(u);_?(console.log(_),m({title:s("tradeFailed"),variant:"default"})):(d(null),p(null),m({title:s("tradeOffered"),variant:"default"}))}return e.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 text-center",children:[e.jsxs("div",{className:"flex justify-between mx-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:s("youGive")}),e.jsx("h4",{className:"text-lg font-medium",children:s("youReceive")})]}),e.jsx("div",{className:"flex justify-between rounded bg-zinc-800 px-1 mt-2",children:i||n?e.jsxs(e.Fragment,{children:[b(i),b(n)]}):e.jsx("span",{className:"w-full text-center",children:s("selectCardsToTrade")})}),e.jsx(R,{className:"text-center mt-4",type:"button",variant:"outline",onClick:g,disabled:!x,children:s("offerTrades")})]})},N=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],$=()=>{const{t:r}=y("trade-matches"),{friendId:o}=O(),{account:i}=l.useContext(D),{ownedCards:n}=l.useContext(H),[d,p]=l.useState(null),[s,j]=l.useState(null),[m,b]=l.useState((i?.max_number_of_cards_wanted||1)-1),[x,g]=l.useState((i?.min_number_of_cards_to_keep||1)+1),[u,_]=l.useState(null),[F,T]=l.useState(null);l.useEffect(()=>{!d&&o&&K(o).then(p),o&&!s&&L(o).then(j)});const S=l.useMemo(()=>z.filter(a=>a.tradeable).map(a=>a.id),[]),f=l.useMemo(()=>{if(!s)return null;const a={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},w=s.filter(t=>t.amount_owned>(d?.min_number_of_cards_to_keep||1)),C=new Set(n.filter(t=>t.amount_owned>m).map(t=>t.card_id)),v=w.filter(t=>!C.has(t.card_id));for(const t of v){const c=M(t.card_id);c&&N.includes(c.rarity)&&S.includes(c.expansion)&&a[c.rarity].push({...c,amount_owned:t.amount_owned})}return a},[n,s,m,x]),h=l.useMemo(()=>{if(!s)return null;const a={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},w=n.filter(t=>t.amount_owned>=x),C=new Set(s.filter(t=>t.amount_owned>=(d?.max_number_of_cards_wanted||1)).map(t=>t.card_id)),v=w.filter(t=>!C.has(t.card_id));for(const t of v){const c=M(t.card_id);c&&N.includes(c.rarity)&&S.includes(c.expansion)&&a[c.rarity].push({...c,amount_owned:t.amount_owned})}return a},[n,s,m,x]),W=l.useMemo(()=>N.some(a=>f&&f[a].length>0&&h&&h[a].length>0),[f,h]);return o?!i||!d||f===null||h===null?null:d.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-likht",children:r("tradingWith")}),e.jsxs("span",{className:"text-4xl font-bold",children:[" ",d.username," "]}),e.jsx("span",{children:e.jsxs("span",{className:"text-md",children:["(",d.friend_id,")"]})})]}),e.jsxs("div",{className:"flex gap-4 mb-2 mt-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{numberFilter:m,setNumberFilter:b,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(P,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(E,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":r("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(E,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":r("maxFilterTooltip")}),e.jsx(k,{numberFilter:x,setNumberFilter:g,options:[2,3,4,5],labelKey:"minNum"})]})]}),e.jsx(G,{yourId:i.friend_id,friendId:d.friend_id,yourCard:u,friendCard:F,setYourCard:_,setFriendCard:T}),!W&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("noPossibleTradesDescription")})]}),N.map(a=>f[a].length>0&&h[a].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-6",children:a}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("youHave")}),e.jsx(A,{cards:h[a],ownedCards:n,selected:u,setSelected:_})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("friendHas")}),e.jsx(A,{cards:f[a],ownedCards:n,selected:F,setSelected:T})]})]})]},a))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("inActiveTradePage",{username:d?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("inActiveTradeDescription")})]}):"Wrong friend id"};export{$ as default};
