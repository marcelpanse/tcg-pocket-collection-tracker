import{j as e,v as W,s as U,f as X,u as k,r as p,x as oe,B as g,D as Y,y as ee,z as te,A as ae,M as ce,C as de,E as ue,F as se,G as xe,H as me,J as he,K as pe,t as R,L as fe,N as ge,O as je,n as be}from"./index-BTTmp02Y.js";import{A as ne,b as re,a as Ce}from"./alert-B1YsqEMV.js";import{D as ye,u as we}from"./index-DWjXTane.js";import{C as Ne}from"./CardsTable-CSNmnNCX.js";import{F as ve}from"./FancyCard-C781Q2Ho.js";import{P as ke}from"./Card-B94yVrD1.js";import{E as V}from"./ExpansionsFilter-PZPHziHJ.js";import{T as Te,c as Me,a as $,P as Se,b as _e,d as Fe,R as q,N as G}from"./RarityFilter-DBRQT6-2.js";import{O as H}from"./OwnedFilter-Da3oJtkY.js";import{T as Be,a as Ae,b as K}from"./tabs-BfBMJ6xT.js";import{S as Z}from"./SearchInput--iO1aQxW.js";import{M as Pe,C as Ie}from"./useWindowDimensionsHook-CUB85CfD.js";import{S as De}from"./siren-BRUOih-k.js";import"./index-sLjYtpYd.js";function Le({card:n,onSelect:a,selected:i}){const o=()=>{a(n.card_id,!i)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{type:"button",onClick:o,children:e.jsx(ve,{card:n,selected:i,size:"small"})}),e.jsx("p",{className:"text-xs text-center mt-1",children:W(n,U.language)})]})}const Oe=({children:n,className:a})=>e.jsx("div",{className:X("max-h-[300px] overflow-y-auto border border-gray-300 rounded-md",a),style:{maxHeight:"300px"},children:n});function Ee({filteredCards:n}){const{t:a}=k("bulk-update"),[i,o]=p.useState(!1),[c,s]=p.useState(0),[m,y]=p.useState({}),[w,j]=p.useState(!1),[N,T]=p.useState(!1),f=oe(),F=async(l,u)=>{f.mutate({updates:l.map(t=>({card_id:t,amount_owned:u}))})},I=n.length===0,v=p.useMemo(()=>n.reduce((l,u)=>(l.some(t=>t.card_id===u.card_id)||l.push(u),l),[]),[n]);p.useEffect(()=>{if(i){const l=v.reduce((u,t)=>(u[t.card_id]=!0,u),{});y(l)}i||T(!1)},[i]);const D=(l,u)=>{y(t=>({...t,[l]:u}))},B=()=>{const l=v.reduce((u,t)=>(u[t.card_id]=!0,u),{});y(l)},A=()=>{const l=v.reduce((u,t)=>(u[t.card_id]=!1,u),{});y(l)},P=Object.values(m).filter(l=>l).length,L=()=>{c!==null&&(c>0?s(l=>(l||0)-1):c===0&&s(0)),T(!0)},O=()=>{s(l=>l?l+1:1),T(!0)},E=l=>{const u=l.target.value.trim();if(u==="")s(0);else{const t=Number(u);Number.isNaN(t)?s(0):s(t<0?0:t)}T(!0)},M=async()=>{j(!0);const l=Object.entries(m).filter(([u,t])=>t).map(([u])=>u);l.length>0&&(await F(l,c),o(!1),j(!1))};return e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"hidden sm:block",variant:"outline",onClick:()=>o(!0),disabled:I,children:a("buttonTitle")}),e.jsx(Y,{open:i,onOpenChange:o,children:e.jsxs(ee,{className:"max-w-2xl",children:[e.jsx(te,{children:e.jsx(ae,{children:a("title")})}),e.jsx(ne,{variant:"destructive",children:e.jsxs(re,{children:[a("alert.beforeCount"),e.jsxs("strong",{children:[e.jsx("span",{style:{fontSize:"1.25rem",color:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.375rem",margin:"0 0.25rem"},children:P})," ",a("alert.cards")]})," ",a("alert.afterCount"),e.jsx("strong",{children:a("alert.warning")})]})}),e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsx(g,{variant:"outline",onClick:A,children:a("deselectAll")}),e.jsx(g,{variant:"outline",onClick:B,children:a("selectAll")})]}),e.jsx(Oe,{className:"h-64 rounded-md border p-4",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:v.map(l=>e.jsx(Le,{card:l,onSelect:D,selected:m[l.card_id]},l.card_id))})}),e.jsxs("div",{className:"flex items-center gap-x-1 justify-center",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:L,disabled:c===null||c===0,className:"rounded-full",children:e.jsx(ce,{size:14})}),e.jsx("input",{type:"text",min:"0",value:c??0,onChange:E,placeholder:a("enterAmount"),className:"w-7 text-center border-none rounded",onFocus:l=>l.target.select()}),e.jsx(g,{variant:"ghost",size:"icon",onClick:O,className:"rounded-full",children:e.jsx(ke,{size:14})})]}),e.jsxs(de,{children:[e.jsx(g,{variant:"outline",onClick:()=>o(!1),children:a("cancel")}),e.jsxs(g,{onClick:M,disabled:P===0||w||!N,variant:"default",children:[w&&e.jsxs("svg",{"aria-hidden":"true",className:"w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),e.jsx("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})]}),a(w?"batchProcessing":"batchUpdate")]})]})]})})]})}const Q=({value:n,onChange:a,expansion:i,className:o})=>{const{t:c}=k("common/packs");let s=ue(i)?.packs;return(s===void 0||s.length<=1)&&(s=[]),i==="all"||i==="P-A"?null:e.jsx(Be,{value:n,onValueChange:a,className:X("h-auto",o),children:e.jsxs(Ae,{className:"h-full flex-wrap w-full border-1 border-neutral-700 rounded-md flex-row justify-start content-start",children:[e.jsx(K,{value:"all",children:c("all")}),s.filter(m=>m.name!=="everypack").map(m=>e.jsx(K,{value:m.name,children:c(m.name)},`tab_trigger_${m.name}`))]})})};function ze(n,a){if(n.length===0)return a.length;if(a.length===0)return n.length;let i=Array(n.length+1).fill(0).map((c,s)=>s),o=Array(n.length+1);for(let c=1;c<=a.length;c++){o[0]=c;for(let s=1;s<=n.length;s++){const m=n[s-1]===a[c-1]?0:1;o[s]=Math.min(i[s]+1,o[s-1]+1,i[s-1]+m)}[i,o]=[o,i]}return i[n.length]}const Re=({allTextSearch:n,setAllTextSearch:a})=>{const{t:i}=k("search-input");return e.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[e.jsx("input",{type:"checkbox",id:"checkbox",checked:n,onChange:()=>a(!n),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:i("allTextLabel")}),e.jsx(Pe,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(Ie,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":i("allTextTooltip")})]})},Ue=({cardTypeFilter:n,setCardTypeFilter:a,collapse:i})=>{const{t:o}=k("card-type-filter"),c=p.useMemo(()=>e.jsxs(Te,{variant:"outline",type:"multiple",size:"sm",value:n,onValueChange:s=>{a(s)},className:`justify-center shadow-none border-1 border-neutral-700 rounded-md flex-wrap ${i?"flex-col":"flex-row"}`,children:[Me.filter(s=>s!==""&&s!=="trainer").map(s=>e.jsx($,{value:s,"aria-label":s,className:"text-gray-400 hover:text-gray-500 px-1",children:e.jsx("img",{src:`/images/energy/${s}.webp`,alt:s,className:"h-4"})},s)),e.jsx($,{value:"trainer","aria-label":"trainer",className:"text-gray-400 hover:text-gray-500 px-1",children:"T"})]}),[n,i]);return i?e.jsxs(Se,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(g,{variant:"outline",children:[o("filters")," (",n.length,")"]})}),e.jsx(Fe,{className:"w-32",children:c})]}):c},Ve=({sortBy:n,setSortBy:a})=>{const{t:i}=k("sort-by");return e.jsx("div",{className:"px-3 py-1 border-1 border-neutral-700 rounded-md",children:e.jsxs("label",{className:"flex items-center gap-x-2 text-white/50 text-sm",children:[e.jsx("h2",{children:i("sortBy")}),e.jsxs("select",{value:n,onChange:o=>a(o.target.value),className:"p-1",children:[e.jsx("option",{value:"default",className:"text-black",children:i("default")}),e.jsx("option",{value:"recent",className:"text-black",children:i("recent")}),e.jsx("option",{value:"expansion-newest",className:"text-black",children:i("expansion-newest")})]})]})})},$e=({cards:n,filters:a,setFilters:i,onFiltersChanged:o,visibleFilters:c,filtersDialog:s,batchUpdate:m,share:y,missionsButton:w})=>{const{t:j}=k(["pages/collection"]),N=se(),{setIsProfileDialogOpen:T}=xe(),f=t=>{i(d=>{const S={...d,...t},r=M(S);return o(r),S})},F=t=>f({search:t}),I=t=>f({allTextSearch:t}),v=t=>f({pack:t}),D=t=>f({cardType:t}),B=t=>{console.log("new rarity",t,a),f({rarity:t})},A=t=>f({owned:t}),P=t=>f({sortBy:t}),L=t=>f({minNumber:t}),O=t=>f({maxNumber:t}),E=t=>f({deckbuildingMode:t}),M=t=>{if(!n)return null;let d=he;if(t.deckbuildingMode&&(d=d.filter(r=>pe.includes(r.rarity)||r.rarity===""||r.rarity==="P")),t.expansion!=="all"&&(d=d.filter(r=>r.expansion===t.expansion)),t.pack!=="all"&&(d=d.filter(r=>r.pack===t.pack||r.pack==="everypack")),t.owned!=="all"&&(t.owned==="owned"?d=d.filter(r=>n.find(x=>x.card_id===r.card_id&&x.amount_owned>0)):t.owned==="missing"&&(d=d.filter(r=>!n.find(x=>x.card_id===r.card_id&&x.amount_owned>0)))),t.sortBy==="recent")d=[...d].sort((r,x)=>{const b=n.find(C=>C.card_id===r.card_id)?.updated_at,h=n.find(C=>C.card_id===x.card_id)?.updated_at;return b&&h?new Date(h).getTime()-new Date(b).getTime():b&&!h?-1:1});else if(t.sortBy==="expansion-newest"){const r=[...R].reverse().slice(1).concat(R[R.length-1]);d=[...d].sort((x,b)=>{const h=r.findIndex(_=>_.id===x.expansion),C=r.findIndex(_=>_.id===b.expansion);return h!==C?h-C:x.card_id.localeCompare(b.card_id,U.language||"en",{numeric:!0})})}d=d.filter(r=>t.rarity.length===0?!0:r.rarity!==""&&t.rarity.includes(r.rarity)),d=d.filter(r=>t.cardType.length===0?!0:r.card_type.toLowerCase()==="trainer"?t.cardType.includes("trainer"):r.energy!==""&&t.cardType.includes(r.energy.toLowerCase())),t.search&&(d=d.filter(x=>{const b=W(x,U.language).toLowerCase(),h=t.search.toLowerCase();let C=!1;t.allTextSearch&&(C=x.ability&&(x.ability.name.toLowerCase().includes(h)||x.ability.effect.toLowerCase().includes(h))||x.attacks.some(z=>z.name?.toLowerCase().includes(h)||z.effect?.toLowerCase()!=="no effect"&&z.effect?.toLowerCase()?.includes(h)));const _=b.includes(h),le=ze(b,h)<=2,ie=x.card_id.toLowerCase().includes(h);return C||_||le||ie}));const S=new Map((n||[]).map(r=>[r.card_id,r.amount_owned]));for(const r of d)r.linkedCardID?r.amount_owned=0:t.deckbuildingMode?r.amount_owned=r.alternate_versions.reduce((x,b)=>x+(S.get(b.card_id)||0),0):r.amount_owned=S.get(r.card_id)||0;return d=d.filter(r=>(r.amount_owned||0)>=t.minNumber),t.maxNumber!==100&&(d=d.filter(r=>(r.amount_owned||0)<=t.maxNumber)),d},l=p.useMemo(()=>M(a),[a,n]);p.useEffect(()=>{o(l)},[]);function u(t){f({expansion:t,pack:"all"})}return e.jsxs("div",{id:"filterbar",className:"flex flex-col gap-x-2 flex-wrap",children:[c?.expansions&&e.jsxs("div",{className:"flex gap-x-2 px-4 mb-2",children:[e.jsx(V,{value:a.expansion,onChange:u}),e.jsx(Q,{className:"w-84",value:a.pack,onChange:v,expansion:a.expansion})]}),e.jsxs("div",{className:"gap-2 flex-row gap-y-1 px-4 flex",children:[c?.search&&e.jsx(Z,{className:"w-full sm:w-32",setSearchValue:F}),c?.owned&&e.jsx(H,{ownedFilter:a.owned,setOwnedFilter:A}),c?.rarity&&e.jsx(q,{rarityFilter:a.rarity,setRarityFilter:B,deckbuildingMode:a.deckbuildingMode,collapse:!0}),s&&e.jsxs(Y,{children:[e.jsx(me,{asChild:!0,children:e.jsx(g,{variant:"outline",children:j("filters.allFilters")})}),e.jsxs(ee,{className:"border-1 border-neutral-700 shadow-none max-h-[90vh] overflow-y-auto content-start",children:[e.jsx(te,{children:e.jsx(ae,{children:j("filters.filtersCount",{count:(l||[]).filter(t=>!t.linkedCardID).length})})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[s.search&&e.jsx(Z,{className:"w-full",setSearchValue:F}),s.allTextSearch&&e.jsx(Re,{allTextSearch:a.allTextSearch,setAllTextSearch:I}),s.expansions&&e.jsx(V,{value:a.expansion,onChange:u}),s.pack&&e.jsx(Q,{className:"w-full",value:a.pack,onChange:v,expansion:a.expansion}),s.rarity&&e.jsx(q,{rarityFilter:a.rarity,setRarityFilter:B,deckbuildingMode:a.deckbuildingMode}),s.cardType&&e.jsx(Ue,{cardTypeFilter:a.cardType,setCardTypeFilter:D}),s.owned&&e.jsx(H,{className:"w-full",ownedFilter:a.owned,setOwnedFilter:A}),s.sortBy&&e.jsx(Ve,{sortBy:a.sortBy,setSortBy:P}),s.amount&&e.jsxs(e.Fragment,{children:[e.jsx(G,{numberFilter:a.minNumber,setNumberFilter:L,options:[0,1,2,3,4,5,6,7,8,9],labelKey:"minNum"}),e.jsx(G,{numberFilter:a.maxNumber,setNumberFilter:O,options:[0,1,2,3,4,5,6,7,8,9,10,100],labelKey:"maxNum"})]}),s.deckBuildingMode&&e.jsx(ye,{deckbuildingMode:a.deckbuildingMode,setDeckbuildingMode:E}),e.jsx(g,{variant:"outline",className:"!text-red-700",onClick:()=>{const t={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1},d=M(t);o(d),i(t)},children:j("filters.clear")}),w&&e.jsx(g,{className:"mt-2",variant:"outline",onClick:()=>N("/collection/missions"),children:j("goToMissions")})]})]})]}),m&&e.jsx(Ee,{filteredCards:l||[],disabled:!l||l.length===0}),y&&e.jsx(g,{variant:"outline",onClick:()=>T(!0),children:j("filters.share")})]})]})};function J({cards:n,isPublic:a,extraOffset:i}){const o=we({query:"(max-width: 767px)"}),[c,s]=p.useState(null),[m,y]=p.useState({search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1}),[w,j]=p.useState(!1);return p.useEffect(()=>{j(!0);const N=setTimeout(()=>j(!1),100);return()=>clearTimeout(N)},[m]),e.jsxs(e.Fragment,{children:[e.jsx($e,{cards:n,filters:m,setFilters:y,onFiltersChanged:N=>s(N),visibleFilters:{expansions:!o,allTextSearch:!o,search:!0,owned:!o,rarity:!o},filtersDialog:{expansions:!0,pack:!0,search:!0,owned:!0,sortBy:!0,rarity:!0,cardType:!0,amount:!0,deckBuildingMode:!0,allTextSearch:!0},batchUpdate:!a,missionsButton:!a,share:!0}),c&&e.jsx(Ne,{cards:c,resetScrollTrigger:w,showStats:!m.deckbuildingMode,extraOffset:i,editable:!m.deckbuildingMode&&!a})]})}function nt(){const{t:n}=k(["pages/collection","common"]),{friendId:a}=fe(),i=se(),{data:o}=ge(a),{data:c}=je(a),{data:s}=be();return a?o===null?e.jsx("p",{className:"text-xl text-center py-8",children:n("common:noAccount")}):c===null?e.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):c===void 0||o===void 0?e.jsxs("p",{className:"text-xl text-center py-8",children:[n("common:loading"),"..."]}):e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs(ne,{className:"mb-4 border-1 border-neutral-700 shadow-none",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx(Ce,{children:n("publicCollectionTitle",{username:o?.username})}),e.jsx(re,{children:e.jsxs("div",{className:"flex items-center",children:[n("publicCollectionDescription"),e.jsx(g,{className:"mb-4",onClick:()=>i(`/trade/${o?.friend_id}`),children:n("showPossibleTrades")})]})})]}),e.jsx(J,{cards:c,isPublic:!0,extraOffset:136})]}):s===void 0?e.jsxs("p",{className:"text-xl text-center py-8",children:[n("common:loading"),"..."]}):e.jsx("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:e.jsx(J,{cards:s,isPublic:!1,extraOffset:20})})}export{nt as default};
