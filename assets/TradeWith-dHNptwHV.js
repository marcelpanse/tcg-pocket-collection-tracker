import{e as A,a6 as k,j as e,f as D,az as P,B as I,u as g,v as S,aA as B,X as E,Y as L,Z as O,a2 as W,n as z,r as p,a3 as _,a4 as v,N as R,aB as H}from"./index-CdXUV4Gu.js";import{t as b,M as w,N as y,C as F}from"./index-DZIA6A7b.js";import"./index-DtEeuWtj.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Y=A("copy",K),G=({friendId:t,className:l="",showCopyButton:s=!0})=>{const{toast:r}=k(),a=async()=>{try{await navigator.clipboard.writeText(t),r({title:"Friend ID copied to clipboard!",variant:"default",duration:2e3})}catch(i){console.error("Failed to copy friend ID:",i),r({title:"Failed to copy friend ID",variant:"destructive",duration:3e3})}};return t?e.jsxs("span",{className:D("inline-flex items-center gap-1",l),children:[e.jsx("span",{className:"font-mono",children:P(t)}),s&&e.jsx(I,{variant:"ghost",size:"icon",onClick:a,className:"h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200","aria-label":"Copy friend ID",children:e.jsx(Y,{className:"h-2.5 w-2.5"})})]}):null},T=({cards:t,ownedCards:l,selected:s,setSelected:r})=>{const{i18n:a}=g();function i(n){function m(){s?.card_id===n.card_id?r(null):r(n)}return e.jsxs("li",{className:`flex rounded px-2 cursor-pointer ${s?.card_id===n.card_id&&"bg-green-900"} hover:bg-neutral-600`,onClick:m,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[n.card_id," "]}),e.jsx("span",{children:S(n,a.language)}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",l.find(o=>o.card_id===n.card_id)?.amount_owned||0]})})]},n.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:t.map(i)})})},Q=({yourId:t,friendId:l,yourCard:s,friendCard:r,setYourCard:a,setFriendCard:i})=>{const{t:n,i18n:m}=g("trade-matches"),{toast:o}=k(),j=B();function x(d){return d?e.jsxs("span",{className:"flex",children:[e.jsxs("span",{className:"min-w-10",children:[d.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[d.card_id," "]}),e.jsx("span",{children:S(d,m.language)})]}):"—"}const u=s&&r&&s.rarity===r.rarity;async function h(){if(!u)return;const d={offering_friend_id:t,receiving_friend_id:l,offer_card_id:s.card_id,receiver_card_id:r.card_id,status:"offered"};try{j.mutate(d)}catch(f){console.log("TradeOffer: Error inserting trade",f),o({title:n("tradeFailed"),variant:"default"})}a(null),i(null),o({title:n("tradeOffered"),variant:"default"})}return!s&&!r?e.jsx("div",{className:"flex rounded-lg border-1 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[206px] sm:h-[138px]",children:e.jsx("h4",{className:"text-lg font-medium",children:n("selectCardsToTrade")})}):e.jsxs("div",{className:"bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:n("youGive")}),x(s)]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:n("youReceive")}),x(r)]})]}),e.jsx(I,{className:"block w-full sm:w-1/2 mx-auto text-center",type:"button",variant:"outline",onClick:h,disabled:!u,children:n("offerTrades")})]})};function C(t,l){const s=new Set(l),r=t.filter(a=>s.has(a)).map(a=>R(a)).filter(a=>b.includes(a.rarity)&&H.includes(a.expansion));return Object.groupBy(r,a=>a.rarity)}function Z(){const{t}=g("trade-matches"),{friendId:l}=E(),{data:s}=L(l),{data:r}=O(l),{data:a}=W(),{data:i=[]}=z(),[n,m]=p.useState((a?.max_number_of_cards_wanted||1)-1),[o,j]=p.useState((a?.min_number_of_cards_to_keep||1)+1),[x,u]=p.useState(null),[h,d]=p.useState(null);if(!a)return null;if(s===null)return e.jsx("p",{className:"text-xl text-center py-8",children:t("notFound")});if(s===void 0||r===void 0)return e.jsx("p",{className:"text-xl text-center py-8",children:"Loading..."});if(!s.is_active_trading)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:s?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});const f=C(v(i,o-1),_(r,s.max_number_of_cards_wanted)),N=C(v(r,s.min_number_of_cards_to_keep),_(i,n+1)),M=b.some(c=>(f[c]??[]).length>0&&(N[c]??[]).length>0);return e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto px-2",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-light",children:t("tradingWith")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",s.username," "]}),e.jsx("span",{className:"block sm:inline text-sm",children:e.jsx(G,{friendId:s.friend_id})})]}),e.jsx(Q,{yourId:a.friend_id,friendId:s.friend_id,yourCard:x,friendCard:h,setYourCard:u,setFriendCard:d}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-2 mb-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(y,{className:"w-full sm:w-[260px]",numberFilter:o,setNumberFilter:j,options:[2,3,4,5],labelKey:"minNum"}),e.jsx(F,{className:"h-4 w-4 mx-1","data-tooltip-id":"maxFilter","data-tooltip-content":t("maxFilterTooltip")})]}),e.jsxs("div",{className:"flex sm:flex-row-reverse items-center gap-2",children:[e.jsx(w,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(y,{className:"w-full sm:w-[260px]",numberFilter:n,setNumberFilter:m,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(F,{className:"h-4 w-4 mx-1","data-tooltip-id":"minFilter","data-tooltip-content":t("minFilterTooltip")})]})]}),!M&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}),b.map(c=>N[c]&&f[c]&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-1 text-center",children:["[ ",c," ]"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("youHave")}),e.jsx(T,{cards:f[c],ownedCards:i,selected:x,setSelected:u})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("friendHas")}),e.jsx(T,{cards:N[c],ownedCards:i,selected:h,setSelected:d})]})]})]},c))]})}export{Z as default};
