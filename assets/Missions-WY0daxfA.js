import{j as n}from"./query-vendor-DpGHCXpY.js";import{h as B,c as F,u as G,s as Q,j as q,v as V,w as Y,o as K,x as L,g as A,k as J,l as X,m as Z,n as ee,e as te,B as se}from"./index-BwJ4XMZ0.js";import{r as S,L as ne}from"./react-vendor-DjlsVz29.js";import{D as oe,T as le}from"./Filters-YggpgWi8.js";import{u as z,i as P}from"./i18n-vendor-DDmeScd6.js";import{M as R,C as ie}from"./react-tooltip.min-B8vrgp4d.js";import{F as U}from"./FancyCard-B72fwlS5.js";import{a as ae,b as ce}from"./stats-1DGhOn1f.js";import"./charts-vendor-D-Ae2kUX.js";import"./supabase-vendor-CP3OYKhD.js";import"./ui-vendor-9yhwxkpr.js";import"./xlsx-vendor-De4COjWB.js";import"./tabs-D7tPh84h.js";import"./index-5ziEWJdO.js";const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],de=B("circle-check",re);const me=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],pe=B("trophy",me);function W(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}function fe(){const e=F.c(3);let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=W(),e[0]=t):t=e[0];const[s,g]=S.useState(t);let o,r;return e[1]===Symbol.for("react.memo_cache_sentinel")?(o=()=>{const a=function(){g(W())};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},r=[],e[1]=o,e[2]=r):(o=e[1],r=e[2]),S.useEffect(o,r),s}const ue=({mission:e,setSelectedMissionCardOptions:t})=>{const{width:s}=fe(),{t:g}=z("common/packs"),{t:o}=z("pages/collection"),{data:r=new Map}=G(),{setSelectedCardId:a}=Q(),{data:j}=q(),{mutate:C}=V(),b=`${e.expansionId}_${e.name}`,d=j?.completed_missions?.includes(b)||!1;let h=5,m=Math.min(s,890)/5+120;s>600&&s<800?(h=4,m=s/3+50):s<=600&&(h=3,m=s/3+100);const f=()=>{let l=!0;const w=e.requiredCards.flatMap(i=>{const c=[];for(const y of i.options){const k=L(y)?.internal_id||0,M=r.get(k);if(M?.collection.includes(y))for(let $=0;$<M.amount_owned&&(c.push({id:k,owned:!0,missionCardOptions:i.options}),!(c.length>=i.amount));$++);if(c.length>=i.amount)break}const _=i.amount-c.length;for(let y=0;y<_;y++)c.push({id:L(i.options[0])?.internal_id,owned:!1,missionCardOptions:i.options});return l=l&&_===0,c});e.completed=l||d;const p=[];for(let i=0;i<w.length;i+=h)p.push(w.slice(i,i+h));return p},x=()=>{if(!j)return;const l=j.completed_missions||[],w=d?l.filter(i=>i!==b):[...l,b],p={...j,completed_missions:w};delete p.trade_rarity_settings,C(p)},u=m*f().length+48;return n.jsxs("div",{className:"relative w-full",children:[n.jsx("div",{style:{height:`${u}px`},className:"relative w-full",children:f().map((l,w)=>n.jsx("div",{style:{height:`${m}px`,transform:`translateY(${m*w+72}px)`},className:"absolute top-0 left-0 w-full",children:n.jsx("div",{className:"flex justify-start gap-x-3",children:l.map((p,i)=>{const c=Y(p.id);return c&&n.jsxs("div",{className:"group flex w-fit max-w-32 md:max-w-40 flex-col items-center rounded-lg cursor-pointer",children:[n.jsx("button",{type:"button",onClick:()=>p.owned?a(p.id):t(p.missionCardOptions),children:n.jsx(U,{card:c,selected:p.owned})}),n.jsx("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:K(c,P.language)})]},`${e.name}__${i}`)})})},w))}),n.jsx("div",{className:"absolute top-0 left-0 w-full",children:n.jsxs("h2",{className:"flex items-center gap-x-4 mx-auto w-full max-w-[900px] scroll-m-20 border-b-2 border-slate-600 pb-2 font-semibold text-md sm:text-lg md:text-2xl tracking-tight transition-colors",children:[e.name,n.jsx(R,{id:`rewardDescription${e.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),n.jsx(pe,{className:"h-6 w-6","data-tooltip-id":`rewardDescription${e.name}`,"data-tooltip-html":e.reward}),n.jsx(R,{id:`probability${e.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),n.jsx(ie,{className:"h-6 w-6","data-tooltip-id":`probability${e.name}`,"data-tooltip-html":e.completed?"Completed!":ae(e,f()).filter(([l,w])=>l!=="everypack"&&w>0).map(([l,w])=>`${g(l)}: ${w.toFixed(2)}%`).join("<br/>")}),n.jsx(R,{id:`manualComplete${e.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),n.jsx(de,{className:`h-6 w-6 cursor-pointer ${d?"text-green-500":"text-white"}`,"data-tooltip-id":`manualComplete${e.name}`,"data-tooltip-html":o(d?"missionDetail.manuallyMarkedComplete":"missionDetail.manuallyMarkComplete"),onClick:x})]})},"header")]})},he=e=>{const t=F.c(15),{missions:s,resetScrollTrigger:g,setSelectedMissionCardOptions:o}=e,r=S.useRef(null),[a,j]=S.useState("auto");let C,b;t[0]===Symbol.for("react.memo_cache_sentinel")?(C=()=>{const u=()=>{if(r.current){const l=document.querySelector("#header")?.offsetHeight||0,w=document.querySelector("#filterbar")?.offsetHeight||0,p=window.innerHeight-l-w;j(`${p}px`)}};return u(),window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u)}},b=[],t[0]=C,t[1]=b):(C=t[0],b=t[1]),S.useLayoutEffect(C,b);let d;t[2]===Symbol.for("react.memo_cache_sentinel")?(d=()=>{r.current&&(r.current.scrollTop=0)},t[2]=d):d=t[2];let h;t[3]!==g?(h=[g],t[3]=g,t[4]=h):h=t[4],S.useEffect(d,h);let m;t[5]!==a?(m={scrollbarWidth:"none",height:a},t[5]=a,t[6]=m):m=t[6];let f;if(t[7]!==s||t[8]!==o){let u;t[10]!==o?(u=l=>n.jsx(ue,{mission:l,setSelectedMissionCardOptions:o},l.name),t[10]=o,t[11]=u):u=t[11],f=s.map(u),t[7]=s,t[8]=o,t[9]=f}else f=t[9];let x;return t[12]!==m||t[13]!==f?(x=n.jsx("div",{ref:r,className:"overflow-y-auto mt-2 sm:mt-4 px-4 flex flex-col justify-start",style:m,children:f}),t[12]=m,t[13]=f,t[14]=x):x=t[14],x};function xe(e){const t=F.c(31),{missionCardOptions:s,onClose:g}=e;let o;t[0]===Symbol.for("react.memo_cache_sentinel")?(o=["common/sets","common/packs","pages/collection"],t[0]=o):o=t[0];const{t:r}=z(o),a=s[0]||"";let j,C,b,d,h,m,f,x;if(t[1]!==a||t[2]!==s||t[3]!==g||t[4]!==r){const w=a.length>0?a.split("-")[0]:void 0,p=w===void 0?void 0:A(w),i=p?.name;C=J,f=!!s.length,t[13]!==g?(x=_=>{_||g()},t[13]=g,t[14]=x):x=t[14],j=X,b="transition-all duration-300 ease-in-out border-slate-600 overflow-y-auto";let c;t[15]!==s.length||t[16]!==r?(c=s.length===1?r("missionDetail.eligibleCards-singular",{ns:"pages/collection",options:1}):r("missionDetail.eligibleCards-plural",{ns:"pages/collection",options:s.length}),t[15]=s.length,t[16]=r,t[17]=c):c=t[17],t[18]!==c?(d=n.jsx(Z,{children:n.jsx(ee,{children:c})}),t[18]=c,t[19]=d):d=t[19],h=r(i??"Unknown expansion"),m=s.map(_=>{const y=L(_);return y&&n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:"px-10 py-4 w-full",children:n.jsx(U,{card:y,selected:!1})}),n.jsxs("p",{className:"max-w-[130px] whitespace-nowrap font-semibold text-[12px] pt-2",children:[_," - ",K(y,P.language),n.jsx("br",{}),p&&r("missionDetail.chanceFrom",{ns:"pages/collection",pack:r(y.pack,{ns:"common/packs"}),chance:ce(p,y.pack,y).toFixed(2)})]})]},_)}),t[1]=a,t[2]=s,t[3]=g,t[4]=r,t[5]=j,t[6]=C,t[7]=b,t[8]=d,t[9]=h,t[10]=m,t[11]=f,t[12]=x}else j=t[5],C=t[6],b=t[7],d=t[8],h=t[9],m=t[10],f=t[11],x=t[12];let u;t[20]!==j||t[21]!==b||t[22]!==d||t[23]!==h||t[24]!==m?(u=n.jsxs(j,{className:b,children:[d,h,m]}),t[20]=j,t[21]=b,t[22]=d,t[23]=h,t[24]=m,t[25]=u):u=t[25];let l;return t[26]!==C||t[27]!==f||t[28]!==x||t[29]!==u?(l=n.jsx(C,{open:f,onOpenChange:x,children:u}),t[26]=C,t[27]=f,t[28]=x,t[29]=u,t[30]=l):l=t[30],l}const we=["all","owned","missing"];function De(){const e=F.c(41);let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=["pages/collection","filters"],e[0]=t):t=e[0];const{t:s}=z(t),{data:g}=q(),[o,r]=S.useState("A1"),[a,j]=S.useState("all"),[C,b]=S.useState(null);let d;e[1]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[1]=d):d=e[1];const[h,m]=S.useState(d),[f]=S.useState(!1);let x;e[2]!==s?(x=v=>s(A(v).name,{ns:"common/sets"}),e[2]=s,e[3]=x):x=e[3];const u=x;let l;e[4]!==g?.completed_missions||e[5]!==o||e[6]!==a?(l=()=>{let v=A(o).missions;if(!v)throw new Error(`This expansion has no missions: ${o}`);a==="owned"?v=v.filter(N=>{const I=`${N.expansionId}_${N.name}`,O=g?.completed_missions?.includes(I)||!1;return N.completed||O}):a==="missing"&&(v=v.filter(N=>{const I=`${N.expansionId}_${N.name}`,O=g?.completed_missions?.includes(I)||!1;return!N.completed&&!O})),b(v)},e[4]=g?.completed_missions,e[5]=o,e[6]=a,e[7]=l):l=e[7];const w=g?.completed_missions;let p;e[8]!==o||e[9]!==a||e[10]!==w?(p=[o,a,w],e[8]=o,e[9]=a,e[10]=w,e[11]=p):p=e[11],S.useEffect(l,p);let i;e[12]!==s?(i=s("expansion",{ns:"common/sets"}),e[12]=s,e[13]=i):i=e[13];let c;e[14]!==o||e[15]!==u||e[16]!==i?(c=n.jsx(oe,{label:i,options:te,value:o,onChange:r,show:u}),e[14]=o,e[15]=u,e[16]=i,e[17]=c):c=e[17];let _;e[18]!==s?(_=v=>s(v,{ns:"filters",keyPrefix:"f-owned"}),e[18]=s,e[19]=_):_=e[19];let y;e[20]!==a||e[21]!==_?(y=n.jsx(le,{options:we,value:a,onChange:j,show:_}),e[20]=a,e[21]=_,e[22]=y):y=e[22];let k;e[23]!==s?(k=s("goToCollection"),e[23]=s,e[24]=k):k=e[24];let M;e[25]!==k?(M=n.jsx(ne,{to:"/collection",children:n.jsx(se,{className:"ml-auto cursor-pointer",variant:"outline",children:k})}),e[25]=k,e[26]=M):M=e[26];let $;e[27]!==M||e[28]!==c||e[29]!==y?($=n.jsxs("div",{className:"flex flex-wrap gap-2 mx-4",children:[c,y,M]}),e[27]=M,e[28]=c,e[29]=y,e[30]=$):$=e[30];let H;e[31]!==C||e[32]!==f?(H=C&&n.jsx(he,{missions:C,resetScrollTrigger:f,setSelectedMissionCardOptions:m}),e[31]=C,e[32]=f,e[33]=H):H=e[33];let D;e[34]===Symbol.for("react.memo_cache_sentinel")?(D=()=>m([]),e[34]=D):D=e[34];let E;e[35]!==h?(E=n.jsx(xe,{missionCardOptions:h,onClose:D}),e[35]=h,e[36]=E):E=e[36];let T;return e[37]!==$||e[38]!==H||e[39]!==E?(T=n.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[$,H,E]}),e[37]=$,e[38]=H,e[39]=E,e[40]=T):T=e[40],T}export{De as default};
