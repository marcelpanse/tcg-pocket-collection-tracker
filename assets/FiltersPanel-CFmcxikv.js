import{X as v,v as x,t as h,T as b,Q as k,_ as C,u as w,j as r,r as T,y as g,B as _}from"./index-DUmC-75t.js";import{R as N,D as f}from"./index-OOayBtdW.js";import{S as j}from"./SearchInput-DyiSgPkC.js";import{D as d,T as y,a as B}from"./Filters-5ZQ79jQl.js";import{M,C as L}from"./react-tooltip.min-DS9Nk92J.js";import{s as S}from"./utils-CZTqWIxr.js";function F(n,a){if(n.length===0)return a.length;if(a.length===0)return n.length;let o=Array(n.length+1).fill(0).map((i,t)=>t),e=Array(n.length+1);for(let i=1;i<=a.length;i++){e[0]=i;for(let t=1;t<=n.length;t++){const c=n[t-1]===a[i-1]?0:1;e[t]=Math.min(o[t]+1,e[t-1]+1,o[t-1]+c)}[o,e]=[e,o]}return o[n.length]}const D=["all","missing","owned"],A=["all",...x],E=["default","recent","expansion-newest"],I=C;function V(n,a){let o=v;if(n.deckbuildingMode&&(o=o.filter(e=>e.internal_id===e.alternate_versions[0])),n.expansion!==void 0&&n.expansion!=="all"&&(o=o.filter(e=>e.expansion===n.expansion)),n.expansion!==void 0&&n.pack!==void 0&&n.pack!=="all"&&(o=o.filter(e=>e.pack===n.pack||e.pack==="everypack")),n.owned!==void 0&&n.owned!=="all"&&(n.owned==="owned"?o=o.filter(e=>e.collected):n.owned==="missing"&&(o=o.filter(e=>!e.collected))),n.sortBy!==void 0&&(n.sortBy==="recent"?o=o.toSorted((e,i)=>{const t=a.get(e.internal_id)?.updated_at,c=a.get(i.internal_id)?.updated_at;return t&&c?new Date(c).getTime()-new Date(t).getTime():t&&!c?-1:1}):n.sortBy==="expansion-newest"&&(o=[...o].sort((e,i)=>e.expansion!==i.expansion?x.indexOf(e.expansion)-x.indexOf(i.expansion):e.card_id.localeCompare(i.card_id,h.language||"en",{numeric:!0})))),o=o.filter(e=>n.rarity===void 0||n.rarity.length===0?!0:n.rarity.includes(e.rarity)),o=o.filter(e=>n.cardType===void 0||n.cardType.length===0?!0:e.card_type.toLowerCase()==="trainer"?n.cardType.includes("trainer"):n.cardType.includes(e.energy.toLowerCase())),n.search){const e=n.search.toLowerCase(),i=2;o=o.filter(t=>{const c=b(t,h.language).toLowerCase();let l=!1;n.allTextSearch&&(l=t.ability&&(t.ability.name.toLowerCase().includes(e)||t.ability.effect.toLowerCase().includes(e))||t.attacks.some(m=>m.name?.toLowerCase().includes(e)||m.effect?.toLowerCase()!=="no effect"&&m.effect?.toLowerCase()?.includes(e)));const u=c.includes(e),s=F(c,e)<=i,p=t.card_id.toLowerCase().includes(e);return l||u||s||p})}for(const e of o){n.deckbuildingMode?e.amount_owned=e.alternate_versions.reduce((t,c)=>{const l=k(c);return t+(a.get(l?.internal_id||0)?.amount_owned??0)},0):e.amount_owned=a.get(e.internal_id)?.amount_owned??0;const i=a.get(e.internal_id);e.collected=i?.collection.includes(e.card_id)??!1,e.updated_at=i?.updated_at}if(n.minNumber){const e=n.minNumber;o=o.filter(i=>(i.amount_owned??0)>=e)}if(n.maxNumber&&n.maxNumber!==100){const e=n.maxNumber;o=o.filter(i=>(i.amount_owned??0)<=e)}return o}const O=({allTextSearch:n,setAllTextSearch:a})=>{const{t:o}=w("search-input");return r.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[r.jsx("input",{type:"checkbox",id:"checkbox",checked:n,onChange:()=>a(!n),className:"w-4 h-4"}),r.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:o("allTextLabel")}),r.jsx(M,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),r.jsx(L,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":o("allTextTooltip")})]})},W=({className:n,filters:a,setFilters:o,clearFilters:e})=>{const{t:i}=w(["pages/collection","common/sets","common/packs","filters"]),t=s=>p=>o({[s]:p}),c=T.useMemo(()=>{if(!(a.expansion===void 0||a.expansion==="all"))return["all",...g(a.expansion).packs.map(s=>s.name).filter(s=>s!=="everypack")]},[a.expansion]);function l(s){a.pack===void 0?o({expansion:s}):o({expansion:s,pack:"all"})}function u(s){return i(s==="all"?"all":g(s).name,{ns:"common/sets"})}return r.jsxs("div",{className:n,children:[a.search!==void 0&&r.jsx(j,{value:a.search,setValue:t("search")}),a.allTextSearch!==void 0&&r.jsx(O,{allTextSearch:a.allTextSearch,setAllTextSearch:t("allTextSearch")}),a.expansion!==void 0&&r.jsx(d,{label:i("expansion",{ns:"common/sets"}),options:A,value:a.expansion,onChange:l,show:u}),a.pack!==void 0&&c&&r.jsx(y,{className:"block",options:c,value:a.pack,onChange:t("pack"),show:s=>i(s,{ns:"common/packs"})}),a.rarity!==void 0&&r.jsx(N,{rarityFilter:a.rarity,setRarityFilter:t("rarity"),deckbuildingMode:a.deckbuildingMode}),a.cardType!==void 0&&r.jsx(B,{options:I,value:a.cardType,onChange:t("cardType"),show:S}),a.owned!==void 0&&r.jsx(y,{className:"block",options:D,value:a.owned,onChange:t("owned"),show:s=>i(s,{ns:"filters",keyPrefix:"f-owned"})}),a.sortBy!==void 0&&r.jsx(d,{label:i("f-sortBy.sortBy",{ns:"filters"}),options:E,value:a.sortBy,onChange:t("sortBy"),show:s=>i(`f-sortBy.${s}`,{ns:"filters"})}),a.minNumber!==void 0&&r.jsx(d,{label:i("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:a.minNumber,onChange:t("minNumber")}),a.maxNumber!==void 0&&r.jsx(d,{label:i("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:a.maxNumber,onChange:t("maxNumber")}),a.deckbuildingMode!==void 0&&r.jsx(f,{deckbuildingMode:a.deckbuildingMode,setDeckbuildingMode:t("deckbuildingMode")}),r.jsx(_,{variant:"outline",className:"!text-red-700",onClick:e,children:i("filters.clear")})]})};export{W as F,I as c,A as e,V as g,D as o,E as s};
