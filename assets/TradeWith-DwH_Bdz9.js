import{j as e,u as I,$ as W,B as R,Y as U,I as B,r as l,U as K,C as O,K as z,L as D,l as H,z as T}from"./index-COEZSbC_.js";import{N as M,M as k,C as E}from"./NumberFilter-_f3_YDRV.js";import"./index-DDOQuXD3.js";const P=({cards:r,ownedCards:m,selected:i,setSelected:n})=>{function d(c){function a(){i?.card_id===c.card_id?n(null):n(c)}return e.jsxs("li",{className:`flex rounded px-2 ${i?.card_id===c.card_id&&"bg-green-900"} hover:bg-gray-500`,onClick:a,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[c.card_id," "]}),e.jsx("span",{children:c.name}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",m.find(f=>f.card_id===c.card_id)?.amount_owned||0]})})]},c.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:r.map(d)})})},L=({yourId:r,friendId:m,yourCard:i,friendCard:n,setYourCard:d,setFriendCard:c})=>{const{t:a}=I("trade-matches"),{toast:f}=W();function x(u){return u?e.jsxs("span",{className:"flex w-1/2",children:[e.jsxs("span",{className:"min-w-10",children:[u.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[u.card_id," "]}),e.jsx("span",{children:u.name})]}):e.jsx("span",{className:"w-1/2 text-center",children:"–"})}const b=i&&n&&i.rarity===n.rarity;async function h(){if(!b)return;const u={offering_friend_id:r,receiving_friend_id:m,offer_card_id:i.card_id,receiver_card_id:n.card_id,status:"offered"},{error:_}=await U.from("trades").insert(u);_?(console.log(_),f({title:a("tradeFailed"),variant:"default"})):(d(null),c(null),f({title:a("tradeOffered"),variant:"default"}))}return e.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 text-center",children:[e.jsxs("div",{className:"flex justify-between mx-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:a("youGive")}),e.jsx("h4",{className:"text-lg font-medium",children:a("youReceive")})]}),e.jsx("div",{className:"flex justify-between rounded bg-zinc-800 px-1 mt-2",children:i||n?e.jsxs(e.Fragment,{children:[x(i),x(n)]}):e.jsx("span",{className:"w-full text-center",children:"Select cards to trade below"})}),e.jsx(R,{className:"text-center mt-4",type:"button",variant:"outline",onClick:h,disabled:!b,children:a("offerTrades")})]})},N=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],Q=()=>{const{t:r}=I("trade-matches"),{friendId:m}=B(),{account:i}=l.useContext(K),{ownedCards:n}=l.useContext(O),[d,c]=l.useState(null),[a,f]=l.useState(null),[x,b]=l.useState((i?.max_number_of_cards_wanted||1)-1),[h,u]=l.useState((i?.min_number_of_cards_to_keep||1)+1),[_,C]=l.useState(null),[y,F]=l.useState(null);l.useEffect(()=>{!d&&m&&z(m).then(c),a||D(void 0,m).then(f)});const S=l.useMemo(()=>H.filter(t=>t.tradeable).map(t=>t.id),[]),p=l.useMemo(()=>{if(!a)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},w=a.filter(s=>s.amount_owned>(d?.min_number_of_cards_to_keep||1)),g=new Set(n.filter(s=>s.amount_owned>x).map(s=>s.card_id)),v=w.filter(s=>!g.has(s.card_id));for(const s of v){const o=T(s.card_id);o&&N.includes(o.rarity)&&S.includes(o.expansion)&&t[o.rarity].push({...o,amount_owned:s.amount_owned})}return t},[n,a,x,h]),j=l.useMemo(()=>{if(!a)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},w=n.filter(s=>s.amount_owned>=h),g=new Set(a.filter(s=>s.amount_owned>=(d?.max_number_of_cards_wanted||1)).map(s=>s.card_id)),v=w.filter(s=>!g.has(s.card_id));for(const s of v){const o=T(s.card_id);o&&N.includes(o.rarity)&&S.includes(o.expansion)&&t[o.rarity].push({...o,amount_owned:s.amount_owned})}return t},[n,a,x,h]),A=l.useMemo(()=>N.some(t=>p&&p[t].length>0&&j&&j[t].length>0),[p,j]);return m?!i||!d||p===null||j===null?null:d.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-likht",children:r("tradingWith")}),e.jsxs("span",{className:"text-4xl font-bold",children:[" ",d.username," "]}),e.jsx("span",{children:e.jsxs("span",{className:"text-md",children:["(",d.friend_id,")"]})})]}),e.jsxs("div",{className:"flex gap-4 mb-2 mt-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{numberFilter:x,setNumberFilter:b,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(k,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(E,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":r("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(E,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":r("maxFilterTooltip")}),e.jsx(M,{numberFilter:h,setNumberFilter:u,options:[2,3,4,5],labelKey:"minNum"})]})]}),e.jsx(L,{yourId:i.friend_id,friendId:d.friend_id,yourCard:_,friendCard:y,setYourCard:C,setFriendCard:F}),!A&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("noPossibleTradesDescription")})]}),N.map(t=>p[t].length>0&&j[t].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-6",children:t}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("youHave")}),e.jsx(P,{cards:j[t],ownedCards:n,selected:_,setSelected:C})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:r("friendHas")}),e.jsx(P,{cards:p[t],ownedCards:n,selected:y,setSelected:F})]})]})]},t))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:r("inActiveTradePage",{username:d?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r("inActiveTradeDescription")})]}):"Wrong friend id"};export{Q as default};
