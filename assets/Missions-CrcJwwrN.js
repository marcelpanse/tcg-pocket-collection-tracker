import{e as D,r as d,u as y,o as $,P as F,Q as g,j as e,T,U as N,t as H,V as z,y as j,S as L,D as R,E as I,F as W,W as _,v as B,L as O,B as q}from"./index-BC4e_IOi.js";import{D as A,T as P}from"./Filters-R7VyAfv4.js";import{M as k,C as Q}from"./react-tooltip.min-D9yRlHdi.js";import{F as E}from"./FancyCard-ItcsBftH.js";import"./index-VmvPa3qA.js";const U=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],V=D("trophy",U);function M(){const{innerWidth:t,innerHeight:l}=window;return{width:t,height:l}}function G(){const[t,l]=d.useState(M());return d.useEffect(()=>{function n(){l(M())}return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}const Y=({mission:t,setSelectedMissionCardOptions:l})=>{const{width:n}=G(),{t:r}=y("common/packs"),{data:u=new Map}=$(),{setSelectedCardId:h}=F();let o=5,a=Math.min(n,890)/5+120;n>600&&n<800?(o=4,a=n/3+50):n<=600&&(o=3,a=n/3+100);const i=d.useMemo(()=>{let m=!0;const s=t.requiredCards.flatMap(c=>{const x=[];for(const w of c.options){const b=g(w)?.internal_id||0,C=u.get(b);if(C?.collection.includes(w))for(let S=0;S<C.amount_owned&&(x.push({id:b,owned:!0,missionCardOptions:c.options}),!(x.length>=c.amount));S++);if(x.length>=c.amount)break}const v=c.amount-x.length;for(let w=0;w<v;w++)x.push({id:g(c.options[0])?.internal_id,owned:!1,missionCardOptions:c.options});return m=m&&v===0,x});t.completed=m;const p=[];for(let c=0;c<s.length;c+=o)p.push(s.slice(c,c+o));return p},[o]),f=a*i.length+48;return e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{style:{height:`${f}px`},className:"relative w-full",children:i.map((m,s)=>e.jsx("div",{style:{height:`${a}px`,transform:`translateY(${a*s+72}px)`},className:"absolute top-0 left-0 w-full",children:e.jsx("div",{className:"flex justify-start gap-x-3",children:m.map((p,c)=>{const x=T(p.id);return x&&e.jsxs("div",{className:"group flex w-fit max-w-32 md:max-w-40 flex-col items-center rounded-lg cursor-pointer",children:[e.jsx("button",{type:"button",onClick:()=>p.owned?h(p.id):l(p.missionCardOptions),children:e.jsx(E,{card:x,selected:p.owned})}),e.jsx("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:N(x,H.language)})]},`${t.name}__${c}`)})})},s))}),e.jsx("div",{className:"absolute top-0 left-0 w-full",children:e.jsxs("h2",{className:"flex items-center gap-x-4 mx-auto w-full max-w-[900px] scroll-m-20 border-b-2 border-slate-600 pb-2 font-semibold text-md sm:text-lg md:text-2xl tracking-tight transition-colors",children:[t.name,e.jsx(k,{id:`rewardDescription${t.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),e.jsx(V,{className:"h-6 w-6","data-tooltip-id":`rewardDescription${t.name}`,"data-tooltip-html":t.reward}),e.jsx(k,{id:`probability${t.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),e.jsx(Q,{className:"h-6 w-6","data-tooltip-id":`probability${t.name}`,"data-tooltip-html":t.completed?"Completed!":z(t,i).filter(([m,s])=>m!=="everypack"&&s>0).map(([m,s])=>`${r(m)}: ${s.toFixed(2)}%`).join("<br/>")})]})},"header")]})},J=({missions:t,resetScrollTrigger:l,setSelectedMissionCardOptions:n})=>{const r=d.useRef(null),[u,h]=d.useState("auto");return d.useLayoutEffect(()=>{const o=()=>{if(r.current){const a=document.querySelector("#header")?.offsetHeight||0,i=document.querySelector("#filterbar")?.offsetHeight||0,f=window.innerHeight-a-i;h(`${f}px`)}};return o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),d.useEffect(()=>{r.current&&(r.current.scrollTop=0)},[l]),e.jsx("div",{ref:r,className:"overflow-y-auto mt-2 sm:mt-4 px-4 flex flex-col justify-start",style:{scrollbarWidth:"none",height:u},children:t.map(o=>e.jsx(Y,{mission:o,setSelectedMissionCardOptions:n},o.name))})};function K({missionCardOptions:t,onClose:l}){const{t:n}=y(["common/sets","common/packs","pages/collection"]),r=t[0]||"",u=r.length>0?r.split("-")[0]:void 0,h=u===void 0?void 0:j(u),o=h?.name;return e.jsx(L,{open:!!t.length,onOpenChange:a=>{a||l()},children:e.jsxs(R,{className:"transition-all duration-300 ease-in-out border-slate-600 overflow-y-auto",children:[e.jsx(I,{children:e.jsx(W,{children:t.length===1?n("missionDetail.eligibleCards-singular",{ns:"pages/collection",options:1}):n("missionDetail.eligibleCards-plural",{ns:"pages/collection",options:t.length})})}),n(o??"Unknown expansion"),t.map(a=>{const i=g(a);return i&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"px-10 py-4 w-full",children:e.jsx(E,{card:i,selected:!1})}),e.jsxs("p",{className:"max-w-[130px] whitespace-nowrap font-semibold text-[12px] pt-2",children:[a," - ",N(i,H.language),e.jsx("br",{}),h&&n("missionDetail.chanceFrom",{ns:"pages/collection",pack:n(i.pack,{ns:"common/packs"}),chance:_(h,i.pack,i).toFixed(2)})]})]},a)})]})})}const X=["all","owned","missing"];function oe(){const{t}=y(["pages/collection","filters"]),[l,n]=d.useState("A1"),[r,u]=d.useState("all"),[h,o]=d.useState(null),[a,i]=d.useState([]),[f]=d.useState(!1),m=s=>t(j(s).name,{ns:"common/sets"});return d.useEffect(()=>{let s=j(l).missions;if(!s)throw new Error(`This expansion has no missions: ${l}`);r==="owned"?s=s.filter(p=>p.completed):r==="missing"&&(s=s.filter(p=>!p.completed)),o(s)},[l,r]),e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mx-4",children:[e.jsx(A,{label:t("expansion",{ns:"common/sets"}),options:B,value:l,onChange:n,show:m}),e.jsx(P,{options:X,value:r,onChange:u,show:s=>t(s,{ns:"filters",keyPrefix:"f-owned"})}),e.jsx(O,{to:"/collection",children:e.jsx(q,{className:"ml-auto cursor-pointer",variant:"outline",children:t("goToCollection")})})]}),h&&e.jsx(J,{missions:h,resetScrollTrigger:f,setSelectedMissionCardOptions:i}),e.jsx(K,{missionCardOptions:a,onClose:()=>i([])})]})}export{oe as default};
