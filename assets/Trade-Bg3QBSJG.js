import{j as s,d as _e,u as je}from"./query-vendor-DpGHCXpY.js";import{h as Q,c as M,gU as O,gN as me,gY as be,gZ as Y,B as C,p as fe,q as ye,j as B,u as ue,w as U,S as X,g_ as ee,g$ as te,h0 as V,C as Z,h1 as Ne,o as ve,h2 as Ce,F as Te,h3 as Se,h4 as ke,h5 as we,h6 as $e,h7 as Ie,h8 as Fe,h9 as Le,ha as Ae,g6 as se,fb as Ee,ff as Me,fy as Pe,r as ze,A as Re,gT as ae,t as re}from"./index--3eOzWKG.js";import{e as Oe,j as xe,r as L,L as J,f as he,u as Ue,k as R,N as Be,l as He}from"./react-vendor-DjlsVz29.js";import{T as q,a as Ve,b as qe}from"./tabs-MuMobBH_.js";import{F as pe}from"./friend-id-display-Bz9XSnZ9.js";import{u as F,i as De}from"./i18n-vendor-DDmeScd6.js";import{S as Ke}from"./SearchInput-DymzZdKA.js";import{g as We}from"./filters-CVG0xEb2.js";import{S as ge,a as Ye}from"./SocialShareButtons-CLThK3HB.js";import{p as Ge}from"./ui-vendor-9yhwxkpr.js";import{M as G,C as ne}from"./react-tooltip.min-DN95HUru.js";import{u as Qe,a as Xe,b as Ze,F as D,c as K,e as W,d as Je}from"./form-B_oMv-wo.js";import{n as ie}from"./coerce-CTuWmYvL.js";import"./charts-vendor-D-Ae2kUX.js";import"./supabase-vendor-CP3OYKhD.js";import"./xlsx-vendor-De4COjWB.js";import"./index-5ziEWJdO.js";const et=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],tt=Q("arrow-left",et);const st=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],at=Q("arrow-right-left",st);const rt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],nt=Q("arrow-right",rt),le=t=>{const e=M.c(15),{cards:r,selected:n,setSelected:d}=t;let c,m,h;if(e[0]!==r||e[1]!==n?.card_id||e[2]!==d){const u=[...r].sort(lt);let l;e[6]!==n?.card_id||e[7]!==d?(l=function(o){const p=function(){n?.card_id===o.card_id?d(null):d(o)};return s.jsx("li",{className:"rounded cursor-pointer",onClick:p,children:s.jsx(O,{className:`w-full ${n?.card_id===o.card_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:o.card_id,rarity:"hidden"})},o.card_id)},e[6]=n?.card_id,e[7]=d,e[8]=l):l=e[8];const f=l;h="rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",c="space-y-1",m=u.map(f),e[0]=r,e[1]=n?.card_id,e[2]=d,e[3]=c,e[4]=m,e[5]=h}else c=e[3],m=e[4],h=e[5];let i;e[9]!==c||e[10]!==m?(i=s.jsx("ul",{className:c,children:m}),e[9]=c,e[10]=m,e[11]=i):i=e[11];let x;return e[12]!==h||e[13]!==i?(x=s.jsx("div",{className:h,children:i}),e[12]=h,e[13]=i,e[14]=x):x=e[14],x};function it(t){const e=t.split("-"),r=e[0]||"",n=e.length>1?parseInt(e[1],10):0;return{setName:r,cardNumber:n}}function lt(t,e){const r=it,n=r(t.card_id),d=r(e.card_id);return n.setName!==d.setName?n.setName.localeCompare(d.setName):n.cardNumber-d.cardNumber}function de(t){return t?s.jsx(O,{card_id:t.card_id,details:"hidden"}):"—"}const dt=t=>{const e=M.c(45),{yourId:r,friendId:n,yourCard:d,friendCard:c,setYourCard:m,setFriendCard:h}=t,{t:i}=F("trade-matches"),{toast:x}=me(),u=be(),l=d&&c&&d.rarity===c.rarity;let f;e[0]!==l||e[1]!==c||e[2]!==n||e[3]!==u||e[4]!==h||e[5]!==m||e[6]!==i||e[7]!==x||e[8]!==d||e[9]!==r?(f=async function(){if(!l)return;const S={offering_friend_id:r,receiving_friend_id:n,offer_card_id:d.card_id,receiver_card_id:c.card_id,status:"offered"};try{u.mutate(S)}catch(A){console.log("TradeOffer: Error inserting trade",A),x({title:i("tradeFailed"),variant:"default"})}m(null),h(null),x({title:i("tradeOffered"),variant:"default"}),Y("Offer trade")},e[0]=l,e[1]=c,e[2]=n,e[3]=u,e[4]=h,e[5]=m,e[6]=i,e[7]=x,e[8]=d,e[9]=r,e[10]=f):f=e[10];const a=f;if(!d&&!c){let w;e[11]!==i?(w=i("selectCardsToTrade"),e[11]=i,e[12]=w):w=e[12];let S;return e[13]!==w?(S=s.jsx("div",{className:"sticky top-0 z-10 flex rounded-lg border-1 bg-neutral-900 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[166px] sm:h-[110px]",children:s.jsx("h4",{className:"text-lg font-medium",children:w})}),e[13]=w,e[14]=S):S=e[14],S}let o;e[15]!==i?(o=i("youGive"),e[15]=i,e[16]=o):o=e[16];let p;e[17]!==o?(p=s.jsx("h4",{className:"text-lg font-medium",children:o}),e[17]=o,e[18]=p):p=e[18];let _;e[19]!==d?(_=de(d),e[19]=d,e[20]=_):_=e[20];let j;e[21]!==p||e[22]!==_?(j=s.jsxs("div",{className:"w-full sm:w-1/2",children:[p,_]}),e[21]=p,e[22]=_,e[23]=j):j=e[23];let g;e[24]!==i?(g=i("youReceive"),e[24]=i,e[25]=g):g=e[25];let y;e[26]!==g?(y=s.jsx("h4",{className:"text-lg font-medium",children:g}),e[26]=g,e[27]=y):y=e[27];let v;e[28]!==c?(v=de(c),e[28]=c,e[29]=v):v=e[29];let b;e[30]!==y||e[31]!==v?(b=s.jsxs("div",{className:"w-full sm:w-1/2",children:[y,v]}),e[30]=y,e[31]=v,e[32]=b):b=e[32];let N;e[33]!==j||e[34]!==b?(N=s.jsxs("div",{className:"flex flex-col sm:flex-row gap-x-4 gap-y-1 p-1",children:[j,b]}),e[33]=j,e[34]=b,e[35]=N):N=e[35];const k=!l;let T;e[36]!==i?(T=i("offerTrades"),e[36]=i,e[37]=T):T=e[37];let I;e[38]!==a||e[39]!==k||e[40]!==T?(I=s.jsx(C,{className:"block w-full sm:w-96 mx-auto mt-1 text-center",type:"button",variant:"outline",onClick:a,disabled:k,children:T}),e[38]=a,e[39]=k,e[40]=T,e[41]=I):I=e[41];let $;return e[42]!==N||e[43]!==I?($=s.jsxs("div",{className:"sticky top-0 z-10 bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-1",children:[N,I]}),e[42]=N,e[43]=I,e[44]=$):$=e[44],$};function ce(t,e){const r=new Set(e),n=t.filter(d=>r.has(d)).map(d=>U(d)).filter(d=>V.includes(d.rarity)&&Ne.includes(d.expansion));return Object.groupBy(n,d=>d.rarity)}function ct(){const{t}=F(["trade-matches","common"]),{friendId:e}=Oe(),[r]=xe(),{data:n,isLoading:d,isError:c}=fe(e),{data:m=new Map,isLoading:h,isError:i}=ye(e),{data:x}=B(),{data:u=new Map}=ue(),[l,f]=L.useState(null),[a,o]=L.useState(()=>{const g=r.get("friend_card");return g?U(Number(g))??null:null});if(L.useEffect(()=>{const g=r.get("friend_card");if(!g||!m||!u)return;const y=U(Number(g));if(!y)return;const v=document.getElementById(y.rarity);v&&v.scrollIntoView({behavior:"smooth"})},[r,m,u]),!x)return null;if(n===null)return s.jsx("p",{className:"text-xl text-center py-8",children:t("notFound")});if(c||i)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(d||h)return s.jsx(X,{size:"lg",overlay:!0});if(!n?.is_active_trading)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:n?.username})}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});const p=ce(te(u,x.trade_rarity_settings||[]),ee(m,n.trade_rarity_settings||[])),_=ce(te(m,n.trade_rarity_settings||[]),ee(u,x.trade_rarity_settings||[])),j=V.some(g=>(p[g]??[]).length>0&&(_[g]??[]).length>0);return s.jsxs("div",{className:"kap-4 justify-center w-full m-auto px-1 sm:px-2",children:[s.jsx("title",{children:`Trade with ${n.username} – TCG Pocket Collection Tracker`}),s.jsxs("div",{className:"mb-4 mx-1 flex justify-between",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"text-2xl font-light",children:t("tradingWith")}),s.jsxs("span",{className:"text-2xl font-bold",children:[" ",n.username," "]}),s.jsx("span",{className:"block sm:inline text-sm",children:s.jsx(pe,{friendId:n.friend_id})})]}),s.jsx(J,{to:`/collection/${e}`,children:s.jsxs(C,{children:["Collection",s.jsx(Z,{})]})})]}),s.jsx(dt,{yourId:x.friend_id,friendId:n.friend_id,yourCard:l,friendCard:a,setYourCard:f,setFriendCard:o}),!j&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}),V.map(g=>s.jsxs("div",{className:"mt-4",children:[s.jsxs("h3",{id:g,className:"text-xl font-semibold mb-2 text-center",children:["[ ",g," ]"]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("youHave")}),p[g]?s.jsx(le,{cards:p[g],selected:l,setSelected:f}):s.jsx("div",{className:"text-center text-neutral-500 rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]}),s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("friendHas")}),_[g]?s.jsx(le,{cards:_[g],selected:a,setSelected:o}):s.jsx("div",{className:"text-center text-neutral-500  rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]})]})]},g))]})}function ot(){const{t}=F(["trade-matches","common"]),e=he(),r=L.useRef(null),[n,d]=L.useState(""),[c,m]=L.useState(),h=We({search:n,rarity:[...V]},new Map),i=c&&U(c),x=_e({getScrollElement:()=>r.current,count:h.length,getItemKey:u=>h[u].card_id,estimateSize:()=>32});if(c&&!i)throw new Error("Selected card was not found in the database");return s.jsxs("div",{className:"sm:w-sm mx-auto",children:[s.jsx(Ke,{setValue:d}),s.jsx("div",{ref:r,className:"my-2 h-96 rounded border border-neutral-700 px-1 overflow-y-auto",children:s.jsx("ul",{style:{height:`${x.getTotalSize()}px`},className:"relative",children:x.getVirtualItems().map(u=>{const l=h[u.index];return s.jsx("button",{type:"button",className:"absolute top-0 left-0 w-full cursor-pointer",style:{height:`${u.size}px`,transform:`translateY(${u.start}px)`},onClick:()=>m(f=>f===l.internal_id?void 0:l.internal_id),children:s.jsx(O,{className:`w-full ${c===l.internal_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:l.card_id})},u.key)})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(C,{className:"w-1/2",disabled:!c,onClick:()=>e(`/trade/matches/results?card_id=${c}`),children:i?t("search.byCard",{cardName:ve(i,De.language)}):t("search.selectCard")}),s.jsx(C,{className:"w-1/2",onClick:()=>e("/trade/matches/results"),children:t("search.allCards")})]})]})}function mt(){const t=M.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=F(e),[n]=xe();let d;t[1]!==n?(d=n.has("card_id")?Number(n.get("card_id")):void 0,t[1]=n,t[2]=d):d=t[2];const c=d,{data:m,isLoading:h}=Ce(c);if(c!==void 0&&U(c)===void 0)throw new Error("Requested card was not found in the database");if(h){let l;t[3]!==r?(l=r("common:loading"),t[3]=r,t[4]=l):l=t[4];let f;t[5]===Symbol.for("react.memo_cache_sentinel")?(f=s.jsx("br",{}),t[5]=f):f=t[5];let a;t[6]!==r?(a=r("longOperation"),t[6]=r,t[7]=a):a=t[7];let o;return t[8]!==l||t[9]!==a?(o=s.jsxs("p",{className:"text-xl text-center py-8",children:[l,f,a]}),t[8]=l,t[9]=a,t[10]=o):o=t[10],o}if(!m){let l;return t[11]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx(Te,{}),t[11]=l):l=t[11],l}if(m.length===0){let l;t[12]!==r?(l=r("noTradePartners"),t[12]=r,t[13]=l):l=t[13];let f;return t[14]!==l?(f=s.jsx("p",{className:"text-xl text-center py-8",children:l}),t[14]=l,t[15]=f):f=t[15],f}const i=c?`?friend_card=${c}`:"";let x;if(t[16]!==m||t[17]!==i||t[18]!==r){let l;t[20]!==i||t[21]!==r?(l=f=>s.jsxs("div",{className:"max-w-md w-full flex justify-between items-center mx-auto px-4",children:[s.jsx("p",{className:"mr-2",children:f.username}),s.jsx(J,{to:`/trade/${f.friend_id}${i}`,children:s.jsxs(C,{variant:"outline",className:"my-auto",children:[r("viewTradePartner",{tradeMatches:f.trade_matches}),s.jsx(Z,{})]})})]},f.friend_id),t[20]=i,t[21]=r,t[22]=l):l=t[22],x=m.map(l),t[16]=m,t[17]=i,t[18]=r,t[19]=x}else x=t[19];let u;return t[23]!==x?(u=s.jsx("div",{className:"flex flex-col gap-4",children:x}),t[23]=x,t[24]=u):u=t[24],u}const ft=t=>{const e=M.c(28),{row:r,selectedTradeId:n,setSelectedTradeId:d}=t,{t:c}=F("trade-matches"),{data:m,isLoading:h}=B();if(h)return null;if(!m){let b;e[0]!==c?(b=c("common:error"),e[0]=c,e[1]=b):b=e[1];let N;return e[2]!==b?(N=s.jsx("p",{className:"text-xl text-center py-8",children:b}),e[2]=b,e[3]=N):N=e[3],N}const i=r.offering_friend_id===m.friend_id?r.offer_card_id:r.receiver_card_id,x=r.offering_friend_id===m.friend_id?r.receiver_card_id:r.offer_card_id;let u;e[4]!==n||e[5]!==d?(u=function(N){n===N.id?d(void 0):d(N.id)},e[4]=n,e[5]=d,e[6]=u):u=e[6];const l=u;let f;e[7]!==m.friend_id||e[8]!==c?(f=b=>{const N={offered:b.offering_friend_id===m.friend_id?s.jsx(nt,{className:"bg-amber-600"}):s.jsx(tt,{className:"bg-amber-600"}),accepted:s.jsx(at,{className:"bg-lime-600"}),declined:s.jsx(ke,{className:"bg-stone-600"}),finished:s.jsx(Se,{className:"bg-indigo-600"})};return s.jsxs(s.Fragment,{children:[s.jsx(G,{id:`status-${b.id}`}),s.jsx(Ge,{className:"rounded-full p-[3px] my-auto","data-tooltip-id":`status-${b.id}`,"data-tooltip-content":c(`status.${b.status}`),children:N[b.status]})]})},e[7]=m.friend_id,e[8]=c,e[9]=f):f=e[9];const a=f,o=`flex cursor-pointer rounded gap-1 md:gap-2 p-1 ${n===r.id&&"bg-green-900"} hover:bg-neutral-500`;let p;e[10]!==l||e[11]!==r?(p=()=>l(r),e[10]=l,e[11]=r,e[12]=p):p=e[12];let _;e[13]!==r||e[14]!==a?(_=a(r),e[13]=r,e[14]=a,e[15]=_):_=e[15];let j;e[16]!==i?(j=s.jsx(O,{className:"md:w-1/2",card_id:i,increment:-1}),e[16]=i,e[17]=j):j=e[17];let g;e[18]!==x?(g=s.jsx(O,{className:"md:w-1/2",card_id:x,increment:1}),e[18]=x,e[19]=g):g=e[19];let y;e[20]!==j||e[21]!==g?(y=s.jsxs("div",{className:"flex flex-col md:flex-row grow-1 justify-between gap-1 md:gap-2",children:[j,g]}),e[20]=j,e[21]=g,e[22]=y):y=e[22];let v;return e[23]!==o||e[24]!==p||e[25]!==_||e[26]!==y?(v=s.jsxs("li",{className:o,onClick:p,children:[_,y]}),e[23]=o,e[24]=p,e[25]=_,e[26]=y,e[27]=v):v=e[27],v};function oe({trades:t}){const{t:e}=F("trade-matches"),{toast:r}=me(),{data:n}=B(),{data:d=new Map}=ue(),c=we(),[m,h]=L.useState(void 0),i=$e();if(!n)return null;const x=(a,o)=>{const p=Ie(a);return{card_id:a,internal_id:p,amount_owned:(d.get(p)?.amount_owned??0)+o}},u=async a=>{if(a.offer_card_id!==a.receiver_card_id)if(a.offering_friend_id===n.friend_id){const o=[x(a.offer_card_id,-1),x(a.receiver_card_id,1)];c.mutate({updates:o}),r({title:e("collectionUpdated"),variant:"default"})}else if(a.receiving_friend_id===n.friend_id){const o=[x(a.offer_card_id,1),x(a.receiver_card_id,-1)];c.mutate({updates:o}),r({title:e("collectionUpdated"),variant:"default"})}else console.log(a,"can't match friend id")},l=a=>{const o=async j=>{i.mutate({id:a.id,trade:{status:j}}),h(a.id),Y(`Updated trade: ${j}`)},p=async()=>{const j=a.offering_friend_id===n.friend_id?{offerer_ended:!0}:a.receiving_friend_id===n.friend_id?{receiver_ended:!0}:null;if(j===null){console.log(a," doesn't match your friend_id");return}i.mutate({id:a.id,trade:j}),h(void 0),Y("Updated trade: ended")},_=a.offering_friend_id===n.friend_id&&a.offerer_ended||a.receiving_friend_id===n.friend_id&&a.receiver_ended;switch(a.status){case"offered":return s.jsxs(s.Fragment,{children:[a.receiving_friend_id===n.friend_id&&s.jsx(C,{type:"button",onClick:async()=>o("accepted"),children:e("actionAccept")}),s.jsx(C,{type:"button",onClick:async()=>o("declined"),children:a.receiving_friend_id===n.friend_id?e("actionDecline"):e("actionCancel")})]});case"accepted":return s.jsxs(s.Fragment,{children:[s.jsx(C,{type:"button",onClick:async()=>o("finished"),children:e("actionComplete")}),s.jsx(C,{type:"button",onClick:async()=>o("declined"),children:e("actionCancel")})]});case"declined":return _?null:s.jsx(C,{type:"button",onClick:p,children:e("actionHide")});case"finished":return _?null:s.jsxs(s.Fragment,{children:[s.jsx(C,{type:"button",onClick:async()=>{await u(a),await p()},children:e("actionUpdate")}),s.jsx(C,{type:"button",onClick:p,children:e("actionHide")})]});default:return console.log(`Unknown trade status ${a.status}`),null}},f=t.find(a=>a.id===m);return t.length===0?null:s.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-1 md:p-2",children:[s.jsxs("div",{className:"hidden md:flex pr-1",children:[s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:e("youGive")}),s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:e("youReceive")})]}),s.jsx("ul",{className:"flex flex-col gap-2 md:gap-0",children:t.toSorted((a,o)=>a.created_at>o.created_at?-1:1).map(a=>s.jsx(ft,{row:a,selectedTradeId:m,setSelectedTradeId:h},a.id))}),f&&s.jsx("div",{className:"flex gap-4 text-center items-center mt-2",children:l(f)})]})}function ut(t){const e=M.c(50),{friendId:r,activeTrades:n}=t;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=["trade-matches","common"],e[0]=d):d=e[0];const{t:c}=F(d),{data:m,isLoading:h}=fe(r),[i,x]=L.useState(!1);let u,l;e[1]!==r?(u=["trades",r],l=()=>Fe(r),e[1]=r,e[2]=u,e[3]=l):(u=e[2],l=e[3]);let f;e[4]!==u||e[5]!==l||e[6]!==i?(f={queryKey:u,queryFn:l,enabled:i},e[4]=u,e[5]=l,e[6]=i,e[7]=f):f=e[7];const a=je(f);if(h)return null;let o;e[8]!==c?(o=c("tradingWith"),e[8]=c,e[9]=o):o=e[9];let p;e[10]!==o?(p=s.jsx("span",{className:"text-md",children:o}),e[10]=o,e[11]=p):p=e[11];const _=m?.username||"unknown";let j;e[12]!==_?(j=s.jsxs("span",{className:"text-md font-bold",children:[" ",_," "]}),e[12]=_,e[13]=j):j=e[13];let g;e[14]!==m?(g=m&&s.jsx(pe,{friendId:m.friend_id,showFriendId:!1,className:"ml-1"}),e[14]=m,e[15]=g):g=e[15];let y;e[16]!==p||e[17]!==j||e[18]!==g?(y=s.jsxs("p",{children:[p,j,g]}),e[16]=p,e[17]=j,e[18]=g,e[19]=y):y=e[19];const v=`history-${r}`;let b;e[20]!==c?(b=c("viewHistory"),e[20]=c,e[21]=b):b=e[21];const N=`history-${r}`;let k;e[22]!==N||e[23]!==i?(k=s.jsx(ge,{id:N,className:"ml-2 my-auto",checked:i,onCheckedChange:x}),e[22]=N,e[23]=i,e[24]=k):k=e[24];let T;e[25]!==v||e[26]!==b||e[27]!==k?(T=s.jsxs("label",{htmlFor:v,className:"my-auto flex items-center",children:[b,k]}),e[25]=v,e[26]=b,e[27]=k,e[28]=T):T=e[28];const I=`/trade/${r}`;let $;e[29]!==c?($=c("openTradeWith"),e[29]=c,e[30]=$):$=e[30];let w;e[31]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(Z,{}),e[31]=w):w=e[31];let S;e[32]!==$?(S=s.jsxs(C,{variant:"outline",className:"my-auto",children:[$,w]}),e[32]=$,e[33]=S):S=e[33];let A;e[34]!==I||e[35]!==S?(A=s.jsx(J,{to:I,children:S}),e[34]=I,e[35]=S,e[36]=A):A=e[36];let E;e[37]!==T||e[38]!==A?(E=s.jsxs("span",{className:"flex gap-4",children:[T,A]}),e[37]=T,e[38]=A,e[39]=E):E=e[39];let P;e[40]!==y||e[41]!==E?(P=s.jsxs("div",{className:"flex justify-between items-center mb-1 mx-1",children:[y,E]}),e[40]=y,e[41]=E,e[42]=P):P=e[42];let z;e[43]!==n||e[44]!==a||e[45]!==i?(z=i?a.isLoading?s.jsx(X,{size:"md"}):a.data&&s.jsx(oe,{trades:a.data}):s.jsx(oe,{trades:n}),e[43]=n,e[44]=a,e[45]=i,e[46]=z):z=e[46];let H;return e[47]!==P||e[48]!==z?(H=s.jsxs("div",{className:"w-full",children:[P,z]}),e[47]=P,e[48]=z,e[49]=H):H=e[49],H}function xt(){const t=M.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=F(e),{data:n,isLoading:d}=B(),{data:c,isLoading:m}=Le();if(d||m){let a;return t[1]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsx(X,{size:"lg",overlay:!0}),t[1]=a):a=t[1],a}if(!c||!n){let a;t[2]!==r?(a=r("common:error"),t[2]=r,t[3]=a):a=t[3];let o;return t[4]!==a?(o=s.jsx("p",{className:"text-xl text-center py-8",children:a}),t[4]=a,t[5]=o):o=t[5],o}if(c.length===0){let a;t[6]!==r?(a=r("noTradeOffers"),t[6]=r,t[7]=a):a=t[7];let o;return t[8]!==a?(o=s.jsx("p",{children:a}),t[8]=a,t[9]=o):o=t[9],o}let h,i;t[10]!==n.friend_id||t[11]!==c?(h=gt(c,n.friend_id),i=Object.fromEntries(Object.entries(h).map(ht)),t[10]=n.friend_id,t[11]=c,t[12]=h,t[13]=i):(h=t[12],i=t[13]);const x=i;let u,l;if(t[14]!==h||t[15]!==x){let a;t[18]!==x?(a=(_,j)=>x[j]-x[_],t[18]=x,t[19]=a):a=t[19];const o=Object.keys(h).toSorted(a);u="flex flex-col items-center mx-auto gap-6 sm:px-4 mb-12 w-full";let p;t[20]!==h?(p=_=>s.jsx(ut,{friendId:_,activeTrades:h[_]},_),t[20]=h,t[21]=p):p=t[21],l=o.map(p),t[14]=h,t[15]=x,t[16]=u,t[17]=l}else u=t[16],l=t[17];let f;return t[22]!==u||t[23]!==l?(f=s.jsx("div",{className:u,children:l}),t[22]=u,t[23]=l,t[24]=f):f=t[24],f}function ht(t){const[e,r]=t;return[e,Math.max(...r.map(pt))]}function pt(t){return new Date(t.updated_at).getTime()}function gt(t,e){return Object.groupBy(t,r=>r.offering_friend_id===e?r.receiving_friend_id:r.receiving_friend_id===e?r.offering_friend_id:(console.log("Fetched row does not match user friend_id",r),"undefined"))}function _t(){const{t}=F("trade-matches"),{data:e}=B(),r=Ae(),n=se({is_active_trading:Me(),trade_rarity_settings:Ee(se({rarity:Pe(ze),to_collect:ie().min(0).max(100),to_keep:ie().min(0).max(100)}))}),d=Qe({resolver:Xe(n),values:{is_active_trading:e?.is_active_trading||!1,trade_rarity_settings:e?.trade_rarity_settings||[]}}),c=async m=>{r.mutate({username:e?.username,is_active_trading:m.is_active_trading,trade_rarity_settings:m.trade_rarity_settings},{onSuccess:()=>re({title:t("accountSaved"),variant:"default"}),onError:h=>{console.error("error saving account",h),re({title:t("errorSavingAccount"),variant:"destructive"})}})};return!e||!e.username?s.jsx(Re,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:t("noAccount")}):s.jsxs("div",{children:[s.jsx(Ze,{...d,children:s.jsxs("form",{onSubmit:d.handleSubmit(c),className:"rounded-md border-1 border-neutral-700 space-y-2 p-4 mx-auto max-w-xl",children:[s.jsx("h2",{className:"text-xl text-center mb-6",children:t("settingsTitle")}),s.jsx(D,{control:d.control,name:"is_active_trading",render:({field:m})=>s.jsx(K,{className:"flex flex-col items-start",children:s.jsx(W,{children:s.jsxs(Je,{className:"flex",children:[t("isActiveTrading"),s.jsx(ge,{className:"ml-2",checked:m.value,onCheckedChange:m.onChange})]})})})}),s.jsxs("div",{className:"grid grid-cols-3 gap-y-2 gap-x-8 w-fit mt-6",children:[s.jsx("span",{children:t("rarity")}),s.jsxs("span",{className:"flex items-center",children:[t("toCollect"),s.jsx(G,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toCollectTooltip")})]}),s.jsxs("span",{className:"flex items-center",children:[t("toKeep"),s.jsx(G,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toKeepTooltip")})]}),d.watch("trade_rarity_settings").map((m,h)=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex-1",children:m.rarity},`label-${m.rarity}`),s.jsx(D,{control:d.control,name:`trade_rarity_settings.${h}.to_collect`,render:({field:i})=>s.jsx(K,{className:"flex-1",children:s.jsx(W,{children:s.jsx(ae,{className:"w-24",type:"number",...i})})})},`to-collect-${m.rarity}`),s.jsx(D,{control:d.control,name:`trade_rarity_settings.${h}.to_keep`,render:({field:i})=>s.jsx(K,{className:"flex-1",children:s.jsx(W,{children:s.jsx(ae,{className:"w-24",type:"number",...i})})})},`to-keep-${m.rarity}`)]}))]}),s.jsx(C,{type:"submit",className:"block ml-auto flex gap-2",disabled:r.isPending,isPending:r.isPending,children:t("save")})]})}),s.jsx(Ye,{className:"mt-4 mx-auto w-fit"})]})}function Pt(){const t=M.c(34),{t:e}=F("trade-matches"),r=Ue(),n=he();let d;t[0]!==r.pathname?(d=r.pathname.split("/").pop()||"offers",t[0]=r.pathname,t[1]=d):d=t[1];const c=d;let m,h;t[2]!==r.pathname||t[3]!==n?(m=()=>{r.pathname==="/trade"&&n("/trade/offers")},h=[r.pathname,n],t[2]=r.pathname,t[3]=n,t[4]=m,t[5]=h):(m=t[4],h=t[5]),L.useEffect(m,h);let i;t[6]!==n?(i=k=>n(`/trade/${k}`),t[6]=n,t[7]=i):i=t[7];let x;t[8]!==e?(x=e("tabOffers"),t[8]=e,t[9]=x):x=t[9];let u;t[10]!==x?(u=s.jsx(q,{className:"text-md",value:"offers",children:x}),t[10]=x,t[11]=u):u=t[11];let l;t[12]!==e?(l=e("tabMatches"),t[12]=e,t[13]=l):l=t[13];let f;t[14]!==l?(f=s.jsx(q,{className:"text-md",value:"matches",children:l}),t[14]=l,t[15]=f):f=t[15];let a;t[16]!==e?(a=e("tabSettings"),t[16]=e,t[17]=a):a=t[17];let o;t[18]!==a?(o=s.jsx(q,{className:"text-md",value:"settings",children:a}),t[18]=a,t[19]=o):o=t[19];let p;t[20]!==u||t[21]!==f||t[22]!==o?(p=s.jsxs(Ve,{className:"gap-4 mb-6 rounded-lg border-b-1 border-neutral-700 border-solid dark:bg-transparent pb-2",children:[u,f,o]}),t[20]=u,t[21]=f,t[22]=o,t[23]=p):p=t[23];let _;t[24]===Symbol.for("react.memo_cache_sentinel")?(_=s.jsx(R,{path:"/",element:s.jsx(Be,{to:"/trade/offers",replace:!0})}),t[24]=_):_=t[24];let j;t[25]===Symbol.for("react.memo_cache_sentinel")?(j=s.jsx(R,{path:"offers",element:s.jsx(xt,{})}),t[25]=j):j=t[25];let g;t[26]===Symbol.for("react.memo_cache_sentinel")?(g=s.jsx(R,{path:"matches",element:s.jsx(ot,{})}),t[26]=g):g=t[26];let y;t[27]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx(R,{path:"matches/results",element:s.jsx(mt,{})}),t[27]=y):y=t[27];let v;t[28]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(R,{path:"settings",element:s.jsx(_t,{})}),t[28]=v):v=t[28];let b;t[29]===Symbol.for("react.memo_cache_sentinel")?(b=s.jsxs(He,{children:[_,j,g,y,v,s.jsx(R,{path:":friendId",element:s.jsx(ct,{})})]}),t[29]=b):b=t[29];let N;return t[30]!==c||t[31]!==p||t[32]!==i?(N=s.jsxs(qe,{className:"flex flex-col mx-auto max-w-[900px]",value:c,onValueChange:i,children:[p,b]}),t[30]=c,t[31]=p,t[32]=i,t[33]=N):N=t[33],N}export{Pt as default};
