import{e as $,y as z,t as k,z as U,A as G,u as b,j as t,r as f,x as T,B as v,C as H,o as F,L as B,D as Q,E as J,S as K,F as V,G as W,H as X,J as Y,K as Z,M as P,N as ee,O as ne}from"./index-DlFIrZBo.js";import{A as ae,a as te,b as oe}from"./alert-CnpzcGyt.js";import{R as se,D as ie,u as re}from"./index-BhutZ2Ji.js";import{C as le}from"./CardsTable-CxQ72_Ys.js";import{e as N,c as ce,D as j,T as _,a as de,r as ue}from"./index-DhTdzcWy.js";import{M as O,C as me}from"./react-tooltip.min-CpQ8L-UY.js";import{S as xe}from"./SearchInput-CZK98xWq.js";import{S as pe}from"./siren-mMhSFcJh.js";import"./utils-B1crL2gY.js";import"./Card-j-EggN-l.js";import"./FancyCard-BAntYNsN.js";import"./index-DmPmirto.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ge=$("circle-alert",he);function fe(e,n){if(e.length===0)return n.length;if(n.length===0)return e.length;let o=Array(e.length+1).fill(0).map((s,i)=>i),a=Array(e.length+1);for(let s=1;s<=n.length;s++){a[0]=s;for(let i=1;i<=e.length;i++){const l=e[i-1]===n[s-1]?0:1;a[i]=Math.min(o[i]+1,a[i-1]+1,o[i-1]+l)}[o,a]=[a,o]}return o[e.length]}const D=["all","missing","owned"],I=["all",...N],E=["default","recent","expansion-newest"],R=ce;function we(e,n){let o=z;if(e.deckbuildingMode&&(o=o.filter(a=>a.internal_id===a.alternate_versions[0])),e.expansion!==void 0&&e.expansion!=="all"&&(o=o.filter(a=>a.expansion===e.expansion)),e.expansion!==void 0&&e.pack!==void 0&&e.pack!=="all"&&(o=o.filter(a=>a.pack===e.pack||a.pack==="everypack")),e.owned!==void 0&&e.owned!=="all"&&(e.owned==="owned"?o=o.filter(a=>a.collected):e.owned==="missing"&&(o=o.filter(a=>!a.collected))),e.sortBy!==void 0&&(e.sortBy==="recent"?o=o.toSorted((a,s)=>{const i=n.get(a.internal_id)?.updated_at,l=n.get(s.internal_id)?.updated_at;return i&&l?new Date(l).getTime()-new Date(i).getTime():i&&!l?-1:1}):e.sortBy==="expansion-newest"&&(o=[...o].sort((a,s)=>a.expansion!==s.expansion?N.indexOf(a.expansion)-N.indexOf(s.expansion):a.card_id.localeCompare(s.card_id,k.language||"en",{numeric:!0})))),o=o.filter(a=>e.rarity===void 0||e.rarity.length===0?!0:e.rarity.includes(a.rarity)),o=o.filter(a=>e.cardType===void 0||e.cardType.length===0?!0:a.card_type.toLowerCase()==="trainer"?e.cardType.includes("trainer"):e.cardType.includes(a.energy.toLowerCase())),e.search){const a=e.search.toLowerCase(),s=2;o=o.filter(i=>{const l=U(i,k.language).toLowerCase();let x=!1;e.allTextSearch&&(x=i.ability&&(i.ability.name.toLowerCase().includes(a)||i.ability.effect.toLowerCase().includes(a))||i.attacks.some(p=>p.name?.toLowerCase().includes(a)||p.effect?.toLowerCase()!=="no effect"&&p.effect?.toLowerCase()?.includes(a)));const h=l.includes(a),c=fe(l,a)<=s,r=i.card_id.toLowerCase().includes(a);return x||h||c||r})}for(const a of o)e.deckbuildingMode?a.amount_owned=a.alternate_versions.reduce((s,i)=>{const l=G(i);return s+(n.get(l?.internal_id||0)?.amount_owned??0)},0):a.amount_owned=n.get(a.internal_id)?.amount_owned??0,a.collected=n.get(a.internal_id)?.collection.includes(a.card_id)??!1;if(e.minNumber){const a=e.minNumber;o=o.filter(s=>(s.amount_owned??0)>=a)}if(e.maxNumber&&e.maxNumber!==100){const a=e.maxNumber;o=o.filter(s=>(s.amount_owned??0)<=a)}return o}const ye=({allTextSearch:e,setAllTextSearch:n})=>{const{t:o}=b("search-input");return t.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[t.jsx("input",{type:"checkbox",id:"checkbox",checked:e,onChange:()=>n(!e),className:"w-4 h-4"}),t.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:o("allTextLabel")}),t.jsx(O,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),t.jsx(me,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":o("allTextTooltip")})]})},be=({className:e,filters:n,setFilters:o,clearFilters:a})=>{const{t:s}=b(["pages/collection","common/sets","common/packs","filters"]),i=r=>p=>o({[r]:p}),l=f.useMemo(()=>{if(!(n.expansion===void 0||n.expansion==="all"))return["all",...T(n.expansion).packs.map(r=>r.name).filter(r=>r!=="everypack")]},[n.expansion]);function x(r){n.pack===void 0?o({expansion:r}):o({expansion:r,pack:"all"})}function h(r){return s(r==="all"?"all":T(r).name,{ns:"common/sets"})}function c(r){return r==="trainer"?"T":t.jsx("img",{src:`/images/energy/${r}.webp`,alt:r,className:"h-4"})}return t.jsxs("div",{className:e,children:[n.search!==void 0&&t.jsx(xe,{value:n.search,setValue:i("search")}),n.allTextSearch!==void 0&&t.jsx(ye,{allTextSearch:n.allTextSearch,setAllTextSearch:i("allTextSearch")}),n.expansion!==void 0&&t.jsx(j,{label:s("expansion",{ns:"common/sets"}),options:I,value:n.expansion,onChange:x,show:h}),n.pack!==void 0&&l&&t.jsx(_,{className:"block",options:l,value:n.pack,onChange:i("pack"),show:r=>s(r,{ns:"common/packs"})}),n.rarity!==void 0&&t.jsx(se,{rarityFilter:n.rarity,setRarityFilter:i("rarity"),deckbuildingMode:n.deckbuildingMode}),n.cardType!==void 0&&t.jsx(de,{options:R,value:n.cardType,onChange:i("cardType"),show:c}),n.owned!==void 0&&t.jsx(_,{className:"block",options:D,value:n.owned,onChange:i("owned"),show:r=>s(r,{ns:"filters",keyPrefix:"f-owned"})}),n.sortBy!==void 0&&t.jsx(j,{label:s("f-sortBy.sortBy",{ns:"filters"}),options:E,value:n.sortBy,onChange:i("sortBy"),show:r=>s(`f-sortBy.${r}`,{ns:"filters"})}),n.minNumber!==void 0&&t.jsx(j,{label:s("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:n.minNumber,onChange:i("minNumber")}),n.maxNumber!==void 0&&t.jsx(j,{label:s("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:n.maxNumber,onChange:i("maxNumber")}),n.deckbuildingMode!==void 0&&t.jsx(ie,{deckbuildingMode:n.deckbuildingMode,setDeckbuildingMode:i("deckbuildingMode")}),t.jsx(v,{variant:"outline",className:"!text-red-700",onClick:a,children:s("filters.clear")})]})};function S({cards:e,filters:n,setFilters:o,clearFilters:a,share:s,missions:i}){const{t:l}=b("pages/collection"),{setIsProfileDialogOpen:x}=H(),{data:h=new Map}=F();async function c(){s?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),Q({title:"Copied to clipboard",variant:"default"})):x(!0)}const r=f.useMemo(()=>{let w=0;const y=new Set;for(const d of e)y.has(d.internal_id)||(w+=d.amount_owned||0,y.add(d.internal_id));return w},[e]),p=f.useMemo(()=>(h?.get(83654)?.amount_owned??0)>0,[e]);return t.jsxs("div",{className:"flex flex-col h-fit gap-2",children:[t.jsxs("small",{className:"flex gap-2",children:[l("stats.summary",{selected:e.length,uniquesOwned:e.filter(w=>!!w.collected).length,totalOwned:r}),p&&t.jsxs(t.Fragment,{children:[t.jsx(O,{id:"mewCardOwned",className:"text-start max-w-72",clickable:!0}),t.jsx(ge,{className:"h-5 w-5","data-tooltip-id":"mewCardOwned","data-tooltip-content":l("stats.mewCardOwned")})]})]}),t.jsx(be,{className:"flex flex-col gap-y-3",filters:n,setFilters:o,clearFilters:a}),t.jsxs("div",{className:"flex flex-col mt-4 gap-2",children:[s!==void 0&&t.jsx(v,{variant:"outline",onClick:c,children:l("filters.share")}),i&&t.jsx(B,{className:"w-full",to:"/collection/missions",children:t.jsx(v,{className:"w-full",variant:"outline",children:l("goToMissions")})})]})]})}const M=e=>{const n=Number(e);return Number.isNaN(n)?void 0:n},L=e=>e==="true"?!0:e==="false"?!1:void 0,ve={search:e=>e,expansion:e=>I.includes(e)?e:void 0,pack:e=>e,cardType:e=>e.split(",").filter(n=>R.includes(n)),rarity:e=>e.split(",").filter(n=>ue.includes(n)),owned:e=>D.includes(e)?e:void 0,sortBy:e=>E.includes(e)?e:void 0,minNumber:M,maxNumber:M,deckbuildingMode:L,allTextSearch:L},A={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1};function q({children:e,cards:n,isPublic:o,share:a}){const s=re({query:"(max-width: 767px)"}),[i,l]=f.useState(!1),[x,h]=J(),c=f.useMemo(()=>{const d={...A},g=(u,m)=>{const C=ve[u](m);C!==void 0&&(d[u]=C)};for(const u in d){const m=x.get(u);m!=null&&g(u,m)}return d},[x]),r=d=>{const g=new URLSearchParams(x);for(const u in d){const m=d[u];m==null||m==="all"||Array.isArray(m)&&m.length===0||m===""?g.delete(u):Array.isArray(m)?g.set(u,m.join(",")):g.set(u,String(m)),h(g)}},p=()=>h(new URLSearchParams),w=f.useMemo(()=>{let d=0;for(const g in c){const u=g;c[u]!==A[u]&&d++}return d},[c]),y=f.useMemo(()=>we(c,n),[c,n]);return t.jsxs("div",{className:"flex justify-center gap-2 xl:gap-8 px-1",children:[s?t.jsx(K,{open:i,onOpenChange:l,children:t.jsxs(V,{side:"left",className:"w-full",children:[t.jsx(W,{children:t.jsx(X,{children:"Filters"})}),t.jsx(S,{cards:y,filters:c,setFilters:r,clearFilters:p,share:a,missions:!o})]})}):t.jsx("div",{className:"w-80",children:t.jsx(S,{cards:y,filters:c,setFilters:r,clearFilters:p,share:a,missions:!o})}),t.jsxs("div",{className:"w-full max-w-[900px]",children:[s&&t.jsxs(v,{variant:"outline",className:"w-full mb-1",onClick:()=>l(!0),children:["Filters",w>0&&` (${w})`]}),t.jsx(le,{cards:y,editable:!c.deckbuildingMode&&!o,groupExpansions:c.sortBy!=="recent",children:e})]})]})}function je(){const{t:e}=b("common"),{data:n,isLoading:o}=P(),{data:a=new Map,isLoading:s}=F();return o&&s?t.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")}):t.jsx(q,{cards:a,isPublic:!1,share:n!==void 0&&n.friend_id!==""&&n.is_public})}function Ne({friendId:e}){const{t:n}=b(["pages/collection","common"]),{data:o,isLoading:a}=ee(e),{data:s,isLoading:i}=ne(e);return a||i?t.jsx("p",{className:"text-xl text-center py-8",children:n("common:loading")}):o===void 0||s===void 0?t.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):o===null?t.jsx("p",{className:"text-xl text-center py-8",children:n("common:noAccount")}):s===null?t.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):t.jsx("div",{className:"flex flex-col gap-y-1",children:t.jsx(q,{cards:s,isPublic:!0,children:t.jsxs(ae,{className:"mb-1 border-1 border-neutral-700 shadow-none",children:[t.jsx(pe,{className:"h-4 w-4"}),t.jsx(te,{children:n("publicCollectionTitle",{username:o.username})}),t.jsx(oe,{children:t.jsxs("div",{className:"flex items-center",children:[n("publicCollectionDescription"),t.jsx(B,{to:`/trade/${e}`,children:t.jsx(v,{className:"mb-4",children:n("showPossibleTrades")})})]})})]})})})}function De(){const{t:e}=b(["pages/collection","common"]),n=Y(),{friendId:o}=Z(),{data:a,isLoading:s}=P();if(f.useEffect(()=>{!o&&!s&&a?.friend_id&&n(`/collection/${a.friend_id}`,{replace:!0})},[s,o,a?.friend_id,n]),s)return t.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")});const i=o??a?.friend_id;return i&&i!==a?.friend_id?t.jsx(Ne,{friendId:i}):t.jsx(je,{})}export{De as default};
