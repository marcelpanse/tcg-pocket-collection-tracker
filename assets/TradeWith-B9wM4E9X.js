import{e as A,a2 as S,j as e,f as B,ar as L,B as D,u as C,t as E,a1 as R,T as U,r as m,U as W,C as O,s as z,J as F}from"./index-DUaBDRCB.js";import{M as T,N as k,C as I}from"./NumberFilter-cHuXSayJ.js";import"./index-D8ZbGT2d.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],K=A("copy",H),G=({friendId:a,className:i="",showCopyButton:r=!0})=>{const{toast:n}=S(),d=async()=>{try{await navigator.clipboard.writeText(a),n({title:"Friend ID copied to clipboard!",variant:"default",duration:2e3})}catch(o){console.error("Failed to copy friend ID:",o),n({title:"Failed to copy friend ID",variant:"destructive",duration:3e3})}};return a?e.jsxs("span",{className:B("inline-flex items-center gap-1",i),children:[e.jsx("span",{className:"font-mono",children:L(a)}),r&&e.jsx(D,{variant:"ghost",size:"icon",onClick:d,className:"h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200","aria-label":"Copy friend ID",children:e.jsx(K,{className:"h-2.5 w-2.5"})})]}):null},M=({cards:a,ownedCards:i,selected:r,setSelected:n})=>{const{i18n:d}=C();function o(l){function x(){r?.card_id===l.card_id?n(null):n(l)}return e.jsxs("li",{className:`flex rounded px-2 cursor-pointer ${r?.card_id===l.card_id&&"bg-green-900"} hover:bg-neutral-600`,onClick:x,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[l.card_id," "]}),e.jsx("span",{children:E(l,d.language)}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",i.find(f=>f.card_id===l.card_id)?.amount_owned||0]})})]},l.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:a.map(o)})})},J=({yourId:a,friendId:i,yourCard:r,friendCard:n,setYourCard:d,setFriendCard:o})=>{const{t:l,i18n:x}=C("trade-matches"),{toast:f}=S();function j(u){return u?e.jsxs("span",{className:"flex",children:[e.jsxs("span",{className:"min-w-10",children:[u.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[u.card_id," "]}),e.jsx("span",{children:E(u,x.language)})]}):"—"}const _=r&&n&&r.rarity===n.rarity;async function w(){if(!_)return;const u={offering_friend_id:a,receiving_friend_id:i,offer_card_id:r.card_id,receiver_card_id:n.card_id,status:"offered"},{error:N}=await R.from("trades").insert(u);N?(console.log(N),f({title:l("tradeFailed"),variant:"default"})):(d(null),o(null),f({title:l("tradeOffered"),variant:"default"}))}return!r&&!n?e.jsx("div",{className:"flex rounded-lg border-1 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[206px] sm:h-[138px]",children:e.jsx("h4",{className:"text-lg font-medium",children:l("selectCardsToTrade")})}):e.jsxs("div",{className:"bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:l("youGive")}),j(r)]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:l("youReceive")}),j(n)]})]}),e.jsx(D,{className:"block w-full sm:w-1/2 mx-auto text-center",type:"button",variant:"outline",onClick:w,disabled:!_,children:l("offerTrades")})]})},b=["◊","◊◊","◊◊◊","◊◊◊◊","☆"];function $(){const{t:a}=C("trade-matches"),{friendAccount:i,friendCollection:r}=U(),{account:n}=m.useContext(W),{ownedCards:d}=m.useContext(O),[o,l]=m.useState((n?.max_number_of_cards_wanted||1)-1),[x,f]=m.useState((n?.min_number_of_cards_to_keep||1)+1),[j,_]=m.useState(null),[w,u]=m.useState(null),N=m.useMemo(()=>z.filter(t=>t.tradeable).map(t=>t.id),[]),h=m.useMemo(()=>{if(!r)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},g=r.filter(s=>s.amount_owned>(i?.min_number_of_cards_to_keep||1)),v=new Set(d.filter(s=>s.amount_owned>o).map(s=>s.card_id)),y=g.filter(s=>!v.has(s.card_id));for(const s of y){const c=F(s.card_id);c&&b.includes(c.rarity)&&N.includes(c.expansion)&&t[c.rarity].push({...c,amount_owned:s.amount_owned})}return t},[d,r,o,x]),p=m.useMemo(()=>{if(!r)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},g=d.filter(s=>s.amount_owned>=x),v=new Set(r.filter(s=>s.amount_owned>=(i?.max_number_of_cards_wanted||1)).map(s=>s.card_id)),y=g.filter(s=>!v.has(s.card_id));for(const s of y){const c=F(s.card_id);c&&b.includes(c.rarity)&&N.includes(c.expansion)&&t[c.rarity].push({...c,amount_owned:s.amount_owned})}return t},[d,r,o,x]),P=m.useMemo(()=>b.some(t=>h&&h[t].length>0&&p&&p[t].length>0),[h,p]);return!n||!i||h===null||p===null?null:i.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto px-2",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-light",children:a("tradingWith")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",i.username," "]}),e.jsx("span",{className:"block sm:inline text-sm",children:e.jsx(G,{friendId:i.friend_id})})]}),e.jsx(J,{yourId:n.friend_id,friendId:i.friend_id,yourCard:j,friendCard:w,setYourCard:_,setFriendCard:u}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-2 mb-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(k,{className:"w-full sm:w-[260px]",numberFilter:x,setNumberFilter:f,options:[2,3,4,5],labelKey:"minNum"}),e.jsx(I,{className:"h-4 w-4 mx-1","data-tooltip-id":"maxFilter","data-tooltip-content":a("maxFilterTooltip")})]}),e.jsxs("div",{className:"flex sm:flex-row-reverse items-center gap-2",children:[e.jsx(T,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(k,{className:"w-full sm:w-[260px]",numberFilter:o,setNumberFilter:l,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(I,{className:"h-4 w-4 mx-1","data-tooltip-id":"minFilter","data-tooltip-content":a("minFilterTooltip")})]})]}),!P&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("noPossibleTradesDescription")})]}),b.map(t=>h[t].length>0&&p[t].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-1 text-center",children:["[ ",t," ]"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:a("youHave")}),e.jsx(M,{cards:p[t],ownedCards:d,selected:j,setSelected:_})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:a("friendHas")}),e.jsx(M,{cards:h[t],ownedCards:d,selected:w,setSelected:u})]})]})]},t))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("inActiveTradePage",{username:i?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("inActiveTradeDescription")})]})}export{$ as default};
