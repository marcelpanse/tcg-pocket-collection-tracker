import{e as T,u as S,z as L,o as A,r as x,j as e,B as j,L as P,A as O,C as _,S as B,D,E,F as I,G as q,H as z,J as R,K as F,M as $,N as G}from"./index-CYYXzUJa.js";import{A as H,a as U,b as J}from"./alert-Bk9bo30h.js";import{u as K}from"./index-CTiiNzas.js";import{C as Q}from"./Card-DpegY_DE.js";import{C as V}from"./CardsTable-ByR3lBzn.js";import{F as W,g as X,s as Y,o as Z,c as ee,e as se}from"./FiltersPanel-B3l-M8qP.js";import{M as te}from"./react-tooltip.min-cQRWt_BL.js";import{T as re}from"./trash-2-smRgQCq1.js";import{S as ae}from"./siren-BFPz7T1i.js";import"./Filters-B_URLXiM.js";import"./utils-CFg3JwEl.js";import"./FancyCard-Bo8Amv-i.js";import"./SearchInput-CnK4C55t.js";import"./index-CPPhtNpr.js";const ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ie=T("circle-alert",ne);function N({cards:s,filters:t,setFilters:r,clearFilters:l,share:n,missions:p}){const{t:m}=S("pages/collection"),{setIsProfileDialogOpen:h}=L(),{data:w=new Map}=A();async function c(){n?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),O({title:"Copied to clipboard",variant:"default"})):h(!0)}const b=x.useMemo(()=>{let d=0;const f=new Set;for(const a of s)a.collected&&!f.has(a.internal_id)&&(d+=a.amount_owned||0,f.add(a.internal_id));return d},[s]),g=x.useMemo(()=>(w?.get(83654)?.amount_owned??0)>0,[s]);return e.jsxs("div",{className:"flex flex-col h-fit gap-2",children:[e.jsxs("small",{className:"flex gap-2",children:[m("stats.summary",{selected:s.length,uniquesOwned:s.filter(d=>!!d.collected).length,totalOwned:b}),g&&e.jsxs(e.Fragment,{children:[e.jsx(te,{id:"mewCardOwned",className:"text-start max-w-72",clickable:!0}),e.jsx(ie,{className:"h-5 w-5","data-tooltip-id":"mewCardOwned","data-tooltip-content":m("stats.mewCardOwned")})]})]}),e.jsx(W,{className:"flex flex-col gap-y-3",filters:t,setFilters:r,clearFilters:l}),e.jsxs("div",{className:"flex flex-col mt-4 gap-2",children:[n!==void 0&&e.jsx(j,{variant:"outline",onClick:c,children:m("filters.share")}),p&&e.jsx(P,{className:"w-full",to:"/collection/missions",children:e.jsx(j,{className:"w-full",variant:"outline",children:m("goToMissions")})})]})]})}const y=s=>{const t=Number(s);return Number.isNaN(t)?void 0:t},C=s=>s==="true"?!0:s==="false"?!1:void 0,oe={search:s=>s,expansion:s=>se.includes(s)?s:void 0,pack:s=>s,cardType:s=>s.split(",").filter(t=>ee.includes(t)),rarity:s=>s.split(",").filter(t=>q.includes(t)),owned:s=>Z.includes(s)?s:void 0,sortBy:s=>Y.includes(s)?s:void 0,minNumber:y,maxNumber:y,deckbuildingMode:C,allTextSearch:C},k={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1};function M({children:s,cards:t,isPublic:r,share:l}){const n=K({query:"(max-width: 767px)"}),[p,m]=x.useState(!1),[h,w]=_(),c=x.useMemo(()=>{const a={...k},u=(i,o)=>{const v=oe[i](o);v!==void 0&&(a[i]=v)};for(const i in a){const o=h.get(i);o!=null&&u(i,o)}return a},[h]),b=a=>{const u=new URLSearchParams(h);for(const i in a){const o=a[i];o==null||o==="all"||Array.isArray(o)&&o.length===0||o===""?u.delete(i):Array.isArray(o)?u.set(i,o.join(",")):u.set(i,String(o)),w(u)}},g=()=>w(new URLSearchParams),d=x.useMemo(()=>{let a=0;for(const u in c){const i=u;c[i]!==k[i]&&a++}return a},[c]),f=x.useMemo(()=>X(c,t),[c,t]);return e.jsxs("div",{className:"flex justify-center gap-2 xl:gap-8 px-1",children:[n?e.jsx(B,{open:p,onOpenChange:m,children:e.jsxs(D,{side:"left",className:"w-full",children:[e.jsx(E,{children:e.jsx(I,{children:"Filters"})}),e.jsx(N,{cards:f,filters:c,setFilters:b,clearFilters:g,share:l,missions:!r})]})}):e.jsx("div",{className:"w-80",children:e.jsx(N,{cards:f,filters:c,setFilters:b,clearFilters:g,share:l,missions:!r})}),e.jsxs("div",{className:"w-full max-w-[900px]",children:[n&&e.jsxs("div",{className:"h-9 flex overflow-hidden text-center rounded-md text-sm font-medium border shadow-sm border-neutral-700 divide-x divide-neutral-700 [&>*]:cursor-pointer [&>*]:hover:bg-neutral-600 [&>*]:hover:text-neutral-50",children:[e.jsxs("button",{type:"button",className:"flex-1",onClick:()=>m(!0),children:["Filters",d>0&&` (${d})`]}),d>0&&e.jsx("button",{type:"button",className:"group px-2",onClick:g,children:e.jsx(re,{className:"stroke-neutral-200 group-hover:stroke-neutral-50"})})]}),e.jsx(V,{cards:f,groupExpansions:c.sortBy!=="recent",render:a=>e.jsx(Q,{card:a,editable:!c.deckbuildingMode&&!r}),children:s})]})]})}function le(){const{data:s,isLoading:t}=F(),{data:r=new Map,isLoading:l}=A();return t&&l?e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"}):e.jsx(M,{cards:r,isPublic:!1,share:s!==void 0&&s.friend_id!==""&&s.is_public})}function ce({friendId:s}){const{t}=S(["pages/collection","common"]),{data:r,isLoading:l}=$(s),{data:n,isLoading:p}=G(s);return l||p?e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"}):r===void 0||n===void 0?e.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):r===null?e.jsx("p",{className:"text-xl text-center py-8",children:t("common:noAccount")}):n===null?e.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):e.jsx("div",{className:"flex flex-col gap-y-1",children:e.jsx(M,{cards:n,isPublic:!0,children:e.jsxs(H,{className:"mb-1 border-1 border-neutral-700 shadow-none",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(U,{children:t("publicCollectionTitle",{username:r.username})}),e.jsx(J,{children:e.jsxs("div",{className:"flex items-center",children:[t("publicCollectionDescription"),e.jsx(P,{to:`/trade/${s}`,children:e.jsx(j,{className:"mb-4",children:t("showPossibleTrades")})})]})})]})})})}function Ce(){const s=z(),{friendId:t}=R(),{data:r,isLoading:l}=F();if(x.useEffect(()=>{!t&&!l&&r?.friend_id&&s(`/collection/${r.friend_id}`,{replace:!0})},[l,t,r?.friend_id,s]),l)return e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"});const n=t??r?.friend_id;return n&&n!==r?.friend_id?e.jsx(ce,{friendId:n}):e.jsx(le,{})}export{Ce as default};
