import{e as A,a2 as S,j as e,f as B,ar as L,B as D,u as C,t as E,a1 as R,T as U,r as m,U as W,C as z,s as O,J as F}from"./index-CAO0Rjw3.js";import{N as T,M as k,C as I}from"./NumberFilter-D0dZFf6A.js";import"./index-CzeD8bow.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],K=A("copy",H),G=({friendId:a,className:d="",showCopyButton:r=!0})=>{const{toast:n}=S(),l=async()=>{try{await navigator.clipboard.writeText(a),n({title:"Friend ID copied to clipboard!",variant:"default",duration:2e3})}catch(o){console.error("Failed to copy friend ID:",o),n({title:"Failed to copy friend ID",variant:"destructive",duration:3e3})}};return a?e.jsxs("span",{className:B("inline-flex items-center gap-1",d),children:[e.jsx("span",{className:"font-mono",children:L(a)}),r&&e.jsx(D,{variant:"ghost",size:"icon",onClick:l,className:"h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200","aria-label":"Copy friend ID",children:e.jsx(K,{className:"h-2.5 w-2.5"})})]}):null},M=({cards:a,ownedCards:d,selected:r,setSelected:n})=>{const{i18n:l}=C();function o(i){function x(){r?.card_id===i.card_id?n(null):n(i)}return e.jsxs("li",{className:`flex rounded px-2 ${r?.card_id===i.card_id&&"bg-green-900"} hover:bg-gray-500`,onClick:x,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[i.card_id," "]}),e.jsx("span",{children:E(i,l.language)}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",d.find(f=>f.card_id===i.card_id)?.amount_owned||0]})})]},i.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:a.map(o)})})},J=({yourId:a,friendId:d,yourCard:r,friendCard:n,setYourCard:l,setFriendCard:o})=>{const{t:i,i18n:x}=C("trade-matches"),{toast:f}=S();function j(u){return u?e.jsxs("span",{className:"flex w-1/2",children:[e.jsxs("span",{className:"min-w-10",children:[u.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[u.card_id," "]}),e.jsx("span",{children:E(u,x.language)})]}):e.jsx("span",{className:"w-1/2 text-center",children:"–"})}const _=r&&n&&r.rarity===n.rarity;async function b(){if(!_)return;const u={offering_friend_id:a,receiving_friend_id:d,offer_card_id:r.card_id,receiver_card_id:n.card_id,status:"offered"},{error:N}=await R.from("trades").insert(u);N?(console.log(N),f({title:i("tradeFailed"),variant:"default"})):(l(null),o(null),f({title:i("tradeOffered"),variant:"default"}))}return e.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 text-center",children:[e.jsxs("div",{className:"flex justify-between mx-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:i("youGive")}),e.jsx("h4",{className:"text-lg font-medium",children:i("youReceive")})]}),e.jsx("div",{className:"flex justify-between rounded bg-zinc-800 px-1 mt-2",children:r||n?e.jsxs(e.Fragment,{children:[j(r),j(n)]}):e.jsx("span",{className:"w-full text-center",children:i("selectCardsToTrade")})}),e.jsx(D,{className:"text-center mt-4",type:"button",variant:"outline",onClick:b,disabled:!_,children:i("offerTrades")})]})},g=["◊","◊◊","◊◊◊","◊◊◊◊","☆"];function $(){const{t:a}=C("trade-matches"),{friendAccount:d,friendCollection:r}=U(),{account:n}=m.useContext(W),{ownedCards:l}=m.useContext(z),[o,i]=m.useState((n?.max_number_of_cards_wanted||1)-1),[x,f]=m.useState((n?.min_number_of_cards_to_keep||1)+1),[j,_]=m.useState(null),[b,u]=m.useState(null),N=m.useMemo(()=>O.filter(t=>t.tradeable).map(t=>t.id),[]),h=m.useMemo(()=>{if(!r)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},y=r.filter(s=>s.amount_owned>(d?.min_number_of_cards_to_keep||1)),w=new Set(l.filter(s=>s.amount_owned>o).map(s=>s.card_id)),v=y.filter(s=>!w.has(s.card_id));for(const s of v){const c=F(s.card_id);c&&g.includes(c.rarity)&&N.includes(c.expansion)&&t[c.rarity].push({...c,amount_owned:s.amount_owned})}return t},[l,r,o,x]),p=m.useMemo(()=>{if(!r)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},y=l.filter(s=>s.amount_owned>=x),w=new Set(r.filter(s=>s.amount_owned>=(d?.max_number_of_cards_wanted||1)).map(s=>s.card_id)),v=y.filter(s=>!w.has(s.card_id));for(const s of v){const c=F(s.card_id);c&&g.includes(c.rarity)&&N.includes(c.expansion)&&t[c.rarity].push({...c,amount_owned:s.amount_owned})}return t},[l,r,o,x]),P=m.useMemo(()=>g.some(t=>h&&h[t].length>0&&p&&p[t].length>0),[h,p]);return!n||!d||h===null||p===null?null:d.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-light",children:a("tradingWith")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",d.username," "]}),e.jsx("span",{className:"text-sm",children:e.jsx(G,{friendId:d.friend_id})})]}),e.jsxs("div",{className:"flex gap-4 mb-2 mt-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{numberFilter:o,setNumberFilter:i,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(k,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(I,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":a("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(I,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":a("maxFilterTooltip")}),e.jsx(T,{numberFilter:x,setNumberFilter:f,options:[2,3,4,5],labelKey:"minNum"})]})]}),e.jsx(J,{yourId:n.friend_id,friendId:d.friend_id,yourCard:j,friendCard:b,setYourCard:_,setFriendCard:u}),!P&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("noPossibleTradesDescription")})]}),g.map(t=>h[t].length>0&&p[t].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-6",children:t}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("youHave")}),e.jsx(M,{cards:p[t],ownedCards:l,selected:j,setSelected:_})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("friendHas")}),e.jsx(M,{cards:h[t],ownedCards:l,selected:b,setSelected:u})]})]})]},t))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("inActiveTradePage",{username:d?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("inActiveTradeDescription")})]})}export{$ as default};
