import{e as $,u as y,n as E,a6 as F,r as p,j as e,a7 as k,x as N,s as M,a8 as I,v as j,t as T,a9 as D,aa as z,ab as R,ac as _,ad as L,_ as B,B as O}from"./index-DQVDfiPJ.js";import{u as q,M as S,C as A,D as W,e as P,T as U}from"./useWindowDimensionsHook-D_im_HM8.js";import{F as H}from"./FancyCard-B2dWfnX1.js";import"./index-D1E5okkA.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Q=$("trophy",G),V=({mission:t,setSelectedMissionCardOptions:u})=>{const{width:n}=q(),{t:r}=y("common/packs"),{data:x=[]}=E(),{setSelectedCardId:h}=F();let o=5,l=Math.min(n,890)/5+120;n>600&&n<800?(o=4,l=n/3+50):n<=600&&(o=3,l=n/3+100);const i=p.useMemo(()=>{let c=!0;const d=t.requiredCards.flatMap(a=>{let m=x.reduce((g,v)=>{const C=a.options.find(w=>w===v.card_id);if(C)for(let w=0;w<v.amount_owned;w++)g.push({cardId:C,owned:!0,missionCardOptions:a.options});return g},[]);m.length>a.amount&&(m=m.slice(0,a.amount));const b=a.amount-m.length;for(let g=0;g<b;g++)m.push({cardId:a.options[0],owned:!1,missionCardOptions:a.options});return c=c&&b===0,m});t.completed=c;const s=[];for(let a=0;a<d.length;a+=o)s.push(d.slice(a,a+o));return s},[o]),f=l*i.length+72;return e.jsxs("div",{style:{height:`${f}px`},className:"relative w-full",children:[e.jsx("div",{style:{height:`${f}px`},className:"relative w-full",children:i.map((c,d)=>e.jsx("div",{style:{height:`${l}px`,transform:`translateY(${l*d+72}px)`},className:"absolute top-0 left-0 w-full",children:e.jsx("div",{className:"flex justify-start gap-x-3",children:c.map((s,a)=>{const m=k(s.cardId);return m&&e.jsxs("div",{className:"group flex w-fit max-w-32 md:max-w-40 flex-col items-center rounded-lg cursor-pointer",children:[e.jsx("button",{type:"button",onClick:()=>s.owned?h(s.cardId):u(s.missionCardOptions),children:e.jsx(H,{card:m,selected:s.owned})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[s.cardId," - ",N(m,M.language)]})]},`${t.name}__${a}`)})})},d))}),e.jsx("div",{style:{height:"72px"},className:"absolute top-0 left-0 w-full",children:e.jsxs("h2",{className:"flex items-center gap-x-4 mx-auto mt-10 w-full max-w-[900px] scroll-m-20 border-b-2 border-slate-600 pb-2 font-semibold text-md sm:text-lg md:text-2xl tracking-tight transition-colors first:mt-0",children:[t.name,e.jsx(S,{id:`rewardDescription${t.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),e.jsx(Q,{className:"h-6 w-6","data-tooltip-id":`rewardDescription${t.name}`,"data-tooltip-html":t.reward}),e.jsx(S,{id:`probability${t.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),e.jsx(A,{className:"h-6 w-6","data-tooltip-id":`probability${t.name}`,"data-tooltip-html":t.completed?"Completed!":I(t,i).filter(([c,d])=>c!=="everypack"&&d>0).map(([c,d])=>`${r(c)}: ${d.toFixed(2)}%`).join("<br/>")})]})},"header")]})},Y=({missions:t,resetScrollTrigger:u,setSelectedMissionCardOptions:n})=>{const r=p.useRef(null),[x,h]=p.useState("auto");return p.useLayoutEffect(()=>{const o=()=>{if(r.current){const l=document.querySelector("#header")?.offsetHeight||0,i=document.querySelector("#filterbar")?.offsetHeight||0,f=window.innerHeight-l-i;h(`${f}px`)}};return o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),p.useEffect(()=>{r.current&&(r.current.scrollTop=0)},[u]),e.jsx("div",{ref:r,className:"overflow-y-auto mt-2 sm:mt-4 px-4 flex flex-col justify-start",style:{scrollbarWidth:"none",height:x},children:t.map(o=>e.jsx(V,{mission:o,setSelectedMissionCardOptions:n},o.name))})};function J({missionCardOptions:t,onClose:u}){const{t:n}=y(["common/sets","common/packs","pages/collection"]),r=t[0]||"",x=r.length>0?r.split("-")[0]:"Unknown",h=j(x)||T[0],o=h.name;return e.jsx(D,{open:!!t.length,onOpenChange:l=>{l||u()},children:e.jsxs(z,{className:"transition-all duration-300 ease-in-out border-slate-600 overflow-y-auto",children:[e.jsx(R,{children:e.jsx(_,{children:t.length===1?n("missionDetail.eligibleCards-singular",{ns:"pages/collection",options:1}):n("missionDetail.eligibleCards-plural",{ns:"pages/collection",options:t.length})})}),n(o),t.map(l=>{const i=k(l);return i&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"px-10 py-4 w-full",children:e.jsx(H,{card:i,selected:!1})}),e.jsxs("p",{className:"max-w-[130px] whitespace-nowrap font-semibold text-[12px] pt-2",children:[l," - ",N(i,M.language),e.jsx("br",{}),n("missionDetail.chanceFrom",{ns:"pages/collection",pack:n(i.pack,{ns:"common/packs"}),chance:L(h,i.pack,i).toFixed(2)})]})]})})]})})}const K=["all","owned","missing"];function se(){const{t}=y(["pages/collection","filters"]),u=B(),[n,r]=p.useState("A1"),[x,h]=p.useState("all"),[o,l]=p.useState(null),[i,f]=p.useState([]),[c]=p.useState(!1),d=s=>t(j(s)?.name??"unknown",{ns:"common/sets"});return p.useEffect(()=>{let s=j(n)?.missions;if(!s)throw new Error(`Unrecognized expansion id: ${n}`);x==="owned"?s=s.filter(a=>a.completed):x==="missing"&&(s=s.filter(a=>!a.completed)),l(s)},[n,x]),e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mx-4",children:[e.jsx(W,{label:t("expansion",{ns:"common/sets"}),options:P,value:n,onChange:r,show:d}),e.jsx(U,{options:K,value:x,onChange:h,show:s=>t(s,{ns:"filters",keyPrefix:"f-owned"})}),e.jsx(O,{className:"ml-auto cursor-pointer",variant:"outline",onClick:()=>u("/collection"),children:t("goToCollection")})]}),o&&e.jsx(Y,{missions:o,resetScrollTrigger:c,setSelectedMissionCardOptions:f}),e.jsx(J,{missionCardOptions:i,onClose:()=>f([])})]})}export{se as default};
