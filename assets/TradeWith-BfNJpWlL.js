import{e as P,a6 as k,j as e,f as A,aA as B,B as I,u as S,aB as E,L as O,N as L,O as W,a2 as R,n as z,r as h,a3 as _,a4 as v,S as H,aC as K}from"./index-CMmWZtwh.js";import{M as g,C as w}from"./react-tooltip.min-BF281Pyl.js";import{t as N,N as y}from"./index-CkYZSutq.js";import{C as M}from"./CardLine-D4-pF1ZG.js";import"./index-Cfyuwbua.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Q=P("copy",G),U=({friendId:s,className:n="",showCopyButton:a=!0})=>{const{toast:r}=k(),t=async()=>{try{await navigator.clipboard.writeText(s),r({title:"Friend ID copied to clipboard!",variant:"default",duration:2e3})}catch(d){console.error("Failed to copy friend ID:",d),r({title:"Failed to copy friend ID",variant:"destructive",duration:3e3})}};return s?e.jsxs("span",{className:A("inline-flex items-center gap-1",n),children:[e.jsx("span",{className:"font-mono",children:B(s)}),a&&e.jsx(I,{variant:"ghost",size:"icon",onClick:t,className:"h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200","aria-label":"Copy friend ID",children:e.jsx(Q,{className:"h-2.5 w-2.5"})})]}):null},F=({cards:s,selected:n,setSelected:a})=>{function r(t){function d(){n?.card_id===t.card_id?a(null):a(t)}return e.jsx("li",{className:"rounded cursor-pointer",onClick:d,children:e.jsx(M,{className:`w-full ${n?.card_id===t.card_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:t.card_id,rarity:"hidden"})},t.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:s.map(r)})})};function C(s){return s?e.jsx(M,{card_id:s.card_id,details:"hidden"}):"â€”"}const V=({yourId:s,friendId:n,yourCard:a,friendCard:r,setYourCard:t,setFriendCard:d})=>{const{t:i}=S("trade-matches"),{toast:c}=k(),o=E(),m=a&&r&&a.rarity===r.rarity;async function x(){if(!m)return;const u={offering_friend_id:s,receiving_friend_id:n,offer_card_id:a.card_id,receiver_card_id:r.card_id,status:"offered"};try{o.mutate(u)}catch(f){console.log("TradeOffer: Error inserting trade",f),c({title:i("tradeFailed"),variant:"default"})}t(null),d(null),c({title:i("tradeOffered"),variant:"default"})}return!a&&!r?e.jsx("div",{className:"flex rounded-lg border-1 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[206px] sm:h-[138px]",children:e.jsx("h4",{className:"text-lg font-medium",children:i("selectCardsToTrade")})}):e.jsxs("div",{className:"bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:i("youGive")}),C(a)]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:i("youReceive")}),C(r)]})]}),e.jsx(I,{className:"block w-full sm:w-1/2 mx-auto text-center",type:"button",variant:"outline",onClick:x,disabled:!m,children:i("offerTrades")})]})};function T(s,n){const a=new Set(n),r=s.filter(t=>a.has(t)).map(t=>H(t)).filter(t=>N.includes(t.rarity)&&K.includes(t.expansion));return Object.groupBy(r,t=>t.rarity)}function Z(){const{t:s}=S(["trade-matches","common"]),{friendId:n}=O(),{data:a}=L(n),{data:r}=W(n),{data:t}=R(),{data:d=[]}=z(),[i,c]=h.useState((t?.max_number_of_cards_wanted||1)-1),[o,m]=h.useState((t?.min_number_of_cards_to_keep||1)+1),[x,u]=h.useState(null),[f,b]=h.useState(null);if(!t)return null;if(a===null)return e.jsx("p",{className:"text-xl text-center py-8",children:s("notFound")});if(a===void 0||r===void 0)return e.jsxs("p",{className:"text-xl text-center py-8",children:[s("common:loading"),"..."]});if(!a.is_active_trading)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:s("inActiveTradePage",{username:a?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:s("inActiveTradeDescription")})]});const p=T(v(d,o-1),_(r,a.max_number_of_cards_wanted)),j=T(v(r,a.min_number_of_cards_to_keep),_(d,i+1)),D=N.some(l=>(p[l]??[]).length>0&&(j[l]??[]).length>0);return e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto px-2",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-light",children:s("tradingWith")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",a.username," "]}),e.jsx("span",{className:"block sm:inline text-sm",children:e.jsx(U,{friendId:a.friend_id})})]}),e.jsx(V,{yourId:t.friend_id,friendId:a.friend_id,yourCard:x,friendCard:f,setYourCard:u,setFriendCard:b}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-2 mb-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(y,{className:"w-full sm:w-[260px]",numberFilter:o,setNumberFilter:m,options:[2,3,4,5],labelKey:"minNum"}),e.jsx(w,{className:"h-4 w-4 mx-1","data-tooltip-id":"maxFilter","data-tooltip-content":s("maxFilterTooltip")})]}),e.jsxs("div",{className:"flex sm:flex-row-reverse items-center gap-2",children:[e.jsx(g,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(y,{className:"w-full sm:w-[260px]",numberFilter:i,setNumberFilter:c,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(w,{className:"h-4 w-4 mx-1","data-tooltip-id":"minFilter","data-tooltip-content":s("minFilterTooltip")})]})]}),!D&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:s("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:s("noPossibleTradesDescription")})]}),N.map(l=>j[l]&&p[l]&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-1 text-center",children:["[ ",l," ]"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:s("youHave")}),e.jsx(F,{cards:p[l],selected:x,setSelected:u})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:s("friendHas")}),e.jsx(F,{cards:j[l],selected:f,setSelected:b})]})]})]},l))]})}export{Z as default};
