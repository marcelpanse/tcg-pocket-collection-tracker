import{j as s,d as pe,u as ge}from"./query-vendor-DpGHCXpY.js";import{h as Q,c as R,gU as O,gN as me,gY as je,gZ as Y,B as I,p as fe,q as _e,j as U,u as ue,w as V,S as X,g_ as ee,g$ as te,h0 as D,C as Z,h1 as be,h2 as ye,o as Ne,h3 as ve,h4 as Ce,h5 as Te,h6 as Se,h7 as ke,h8 as we,h9 as Ie,ha as $e,g6 as se,fb as Le,ff as Fe,fy as Ae,r as Pe,A as Ee,gT as ae,t as re}from"./index-ySkPw9mU.js";import{e as Me,j as ze,r as L,L as J,u as Re,f as Oe,k as z,N as Ue,l as Be}from"./react-vendor-DjlsVz29.js";import{T as H,a as He,b as Ve}from"./tabs-CSWfRf9u.js";import{F as xe}from"./friend-id-display-CUfs7cwV.js";import{u as F,i as De}from"./i18n-vendor-DDmeScd6.js";import{S as qe}from"./SearchInput-BumcgqXj.js";import{g as Ke}from"./filters-mmfwoDlA.js";import{S as he,a as We}from"./SocialShareButtons-CTfY9HQ9.js";import{p as Ye}from"./ui-vendor-9yhwxkpr.js";import{M as G,C as ne}from"./react-tooltip.min-BRkcunPY.js";import{u as Ge,a as Qe,b as Xe,F as q,c as K,e as W,d as Ze}from"./form-BgQs4gcU.js";import{n as ie}from"./coerce-gswI_oG0.js";import"./charts-vendor-D-Ae2kUX.js";import"./supabase-vendor-CP3OYKhD.js";import"./xlsx-vendor-De4COjWB.js";import"./index-5ziEWJdO.js";const Je=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],et=Q("arrow-left",Je);const tt=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],st=Q("arrow-right-left",tt);const at=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],rt=Q("arrow-right",at),le=t=>{const e=R.c(15),{cards:r,selected:i,setSelected:n}=t;let o,m,f;if(e[0]!==r||e[1]!==i?.card_id||e[2]!==n){const h=[...r].sort(it);let g;e[6]!==i?.card_id||e[7]!==n?(g=function(d){const c=function(){i?.card_id===d.card_id?n(null):n(d)};return s.jsx("li",{className:"rounded cursor-pointer",onClick:c,children:s.jsx(O,{className:`w-full ${i?.card_id===d.card_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:d.card_id,rarity:"hidden"})},d.card_id)},e[6]=i?.card_id,e[7]=n,e[8]=g):g=e[8];const _=g;f="rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",o="space-y-1",m=h.map(_),e[0]=r,e[1]=i?.card_id,e[2]=n,e[3]=o,e[4]=m,e[5]=f}else o=e[3],m=e[4],f=e[5];let l;e[9]!==o||e[10]!==m?(l=s.jsx("ul",{className:o,children:m}),e[9]=o,e[10]=m,e[11]=l):l=e[11];let u;return e[12]!==f||e[13]!==l?(u=s.jsx("div",{className:f,children:l}),e[12]=f,e[13]=l,e[14]=u):u=e[14],u};function nt(t){const e=t.split("-"),r=e[0]||"",i=e.length>1?parseInt(e[1],10):0;return{setName:r,cardNumber:i}}function it(t,e){const r=nt,i=r(t.card_id),n=r(e.card_id);return i.setName!==n.setName?i.setName.localeCompare(n.setName):i.cardNumber-n.cardNumber}function de(t){return t?s.jsx(O,{card_id:t.card_id,details:"hidden"}):"—"}const lt=t=>{const e=R.c(45),{yourId:r,friendId:i,yourCard:n,friendCard:o,setYourCard:m,setFriendCard:f}=t,{t:l}=F("trade-matches"),{toast:u}=me(),h=je(),g=n&&o&&n.rarity===o.rarity;let _;e[0]!==g||e[1]!==o||e[2]!==i||e[3]!==h||e[4]!==f||e[5]!==m||e[6]!==l||e[7]!==u||e[8]!==n||e[9]!==r?(_=async function(){if(!g)return;const $={offering_friend_id:r,receiving_friend_id:i,offer_card_id:n.card_id,receiver_card_id:o.card_id,status:"offered"};try{h.mutate($)}catch(A){console.log("TradeOffer: Error inserting trade",A),u({title:l("tradeFailed"),variant:"default"})}m(null),f(null),u({title:l("tradeOffered"),variant:"default"}),Y("Offer trade")},e[0]=g,e[1]=o,e[2]=i,e[3]=h,e[4]=f,e[5]=m,e[6]=l,e[7]=u,e[8]=n,e[9]=r,e[10]=_):_=e[10];const a=_;if(!n&&!o){let w;e[11]!==l?(w=l("selectCardsToTrade"),e[11]=l,e[12]=w):w=e[12];let $;return e[13]!==w?($=s.jsx("div",{className:"sticky top-0 z-10 flex rounded-lg border-1 bg-neutral-900 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[166px] sm:h-[110px]",children:s.jsx("h4",{className:"text-lg font-medium",children:w})}),e[13]=w,e[14]=$):$=e[14],$}let d;e[15]!==l?(d=l("youGive"),e[15]=l,e[16]=d):d=e[16];let c;e[17]!==d?(c=s.jsx("h4",{className:"text-lg font-medium",children:d}),e[17]=d,e[18]=c):c=e[18];let x;e[19]!==n?(x=de(n),e[19]=n,e[20]=x):x=e[20];let j;e[21]!==c||e[22]!==x?(j=s.jsxs("div",{className:"w-full sm:w-1/2",children:[c,x]}),e[21]=c,e[22]=x,e[23]=j):j=e[23];let p;e[24]!==l?(p=l("youReceive"),e[24]=l,e[25]=p):p=e[25];let y;e[26]!==p?(y=s.jsx("h4",{className:"text-lg font-medium",children:p}),e[26]=p,e[27]=y):y=e[27];let N;e[28]!==o?(N=de(o),e[28]=o,e[29]=N):N=e[29];let b;e[30]!==y||e[31]!==N?(b=s.jsxs("div",{className:"w-full sm:w-1/2",children:[y,N]}),e[30]=y,e[31]=N,e[32]=b):b=e[32];let v;e[33]!==j||e[34]!==b?(v=s.jsxs("div",{className:"flex flex-col sm:flex-row gap-x-4 gap-y-1 p-1",children:[j,b]}),e[33]=j,e[34]=b,e[35]=v):v=e[35];const k=!g;let C;e[36]!==l?(C=l("offerTrades"),e[36]=l,e[37]=C):C=e[37];let T;e[38]!==a||e[39]!==k||e[40]!==C?(T=s.jsx(I,{className:"block w-full sm:w-96 mx-auto mt-1 text-center",type:"button",variant:"outline",onClick:a,disabled:k,children:C}),e[38]=a,e[39]=k,e[40]=C,e[41]=T):T=e[41];let S;return e[42]!==v||e[43]!==T?(S=s.jsxs("div",{className:"sticky top-0 z-10 bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-1",children:[v,T]}),e[42]=v,e[43]=T,e[44]=S):S=e[44],S};function ce(t,e){const r=new Set(e),i=t.filter(n=>r.has(n)).map(n=>V(n)).filter(n=>D.includes(n.rarity)&&be.includes(n.expansion));return Object.groupBy(i,n=>n.rarity)}function dt(){const{t}=F(["trade-matches","common"]),{friendId:e}=Me(),[r]=ze(),{data:i,isLoading:n,isError:o}=fe(e),{data:m=new Map,isLoading:f,isError:l}=_e(e),{data:u}=U(),{data:h=new Map}=ue(),[g,_]=L.useState(null),[a,d]=L.useState(()=>{const p=r.get("friend_card");return p?V(Number(p))??null:null});if(L.useEffect(()=>{const p=r.get("friend_card");if(!p||!m||!h)return;const y=V(Number(p));if(!y)return;const N=document.getElementById(y.rarity);N&&N.scrollIntoView({behavior:"smooth"})},[r,m,h]),!u)return null;if(i===null)return s.jsx("p",{className:"text-xl text-center py-8",children:t("notFound")});if(o||l)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(n||f)return s.jsx(X,{size:"lg",overlay:!0});if(!i?.is_active_trading)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:i?.username})}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});const c=ce(te(h,u.trade_rarity_settings||[]),ee(m,i.trade_rarity_settings||[])),x=ce(te(m,i.trade_rarity_settings||[]),ee(h,u.trade_rarity_settings||[])),j=D.some(p=>(c[p]??[]).length>0&&(x[p]??[]).length>0);return s.jsxs("div",{className:"kap-4 justify-center w-full m-auto px-1 sm:px-2",children:[s.jsx("title",{children:`Trade with ${i.username} – TCG Pocket Collection Tracker`}),s.jsxs("div",{className:"mb-4 mx-1 flex justify-between",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"text-2xl font-light",children:t("tradingWith")}),s.jsxs("span",{className:"text-2xl font-bold",children:[" ",i.username," "]}),s.jsx("span",{className:"block sm:inline text-sm",children:s.jsx(xe,{friendId:i.friend_id})})]}),s.jsx(J,{to:`/collection/${e}`,children:s.jsxs(I,{children:["Collection",s.jsx(Z,{})]})})]}),s.jsx(lt,{yourId:u.friend_id,friendId:i.friend_id,yourCard:g,friendCard:a,setYourCard:_,setFriendCard:d}),!j&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}),D.map(p=>s.jsxs("div",{className:"mt-4",children:[s.jsxs("h3",{id:p,className:"text-xl font-semibold mb-2 text-center",children:["[ ",p," ]"]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("youHave")}),c[p]?s.jsx(le,{cards:c[p],selected:g,setSelected:_}):s.jsx("div",{className:"text-center text-neutral-500 rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]}),s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("friendHas")}),x[p]?s.jsx(le,{cards:x[p],selected:a,setSelected:d}):s.jsx("div",{className:"text-center text-neutral-500  rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]})]})]},p))]})}function ct(){const{t}=F(["trade-matches","common"]),e=L.useRef(null),[r,i]=L.useState(""),[n,o]=L.useState(),[m,f]=L.useState(!1),l=Ke({search:r,rarity:[...D]},new Map),u=n&&V(n),{data:h,isLoading:g,isError:_}=ye(m,n),a=pe({getScrollElement:()=>e.current,count:l.length,getItemKey:c=>l[c].card_id,estimateSize:()=>32});if(n&&!u)throw new Error("Card selected was not found in the database!");if(!m)return s.jsxs("div",{className:"sm:w-sm mx-auto",children:[s.jsx(qe,{setValue:i}),s.jsx("div",{ref:e,className:"my-2 h-96 rounded border border-neutral-700 px-1 overflow-y-auto",children:s.jsx("ul",{style:{height:`${a.getTotalSize()}px`},className:"relative",children:a.getVirtualItems().map(c=>{const x=l[c.index];return s.jsx("button",{type:"button",className:"absolute top-0 left-0 w-full cursor-pointer",style:{height:`${c.size}px`,transform:`translateY(${c.start}px)`},onClick:()=>o(j=>j===x.internal_id?void 0:x.internal_id),children:s.jsx(O,{className:`w-full ${n===x.internal_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:x.card_id})},c.key)})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(I,{className:"w-1/2",disabled:!n,onClick:()=>{f(!0)},children:u?t("search.byCard",{cardName:Ne(u,De.language)}):t("search.selectCard")}),s.jsx(I,{className:"w-1/2",onClick:()=>{o(void 0),f(!0)},children:t("search.allCards")})]})]});if(g)return s.jsxs("p",{className:"text-xl text-center py-8",children:[t("common:loading"),s.jsx("br",{}),t("longOperation")]});if(_||!h)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(h.length===0)return s.jsx("p",{className:"text-xl text-center py-8",children:t("noTradePartners")});const d=n?`?friend_card=${n}`:"";return s.jsx("div",{className:"flex flex-col gap-4",children:h.map(c=>s.jsxs("div",{className:"max-w-md w-full flex justify-between items-center mx-auto px-4",children:[s.jsx("p",{className:"mr-2",children:c.username}),s.jsx(J,{to:`/trade/${c.friend_id}${d}`,children:s.jsxs(I,{variant:"outline",className:"my-auto",children:[t("viewTradePartner",{tradeMatches:c.trade_matches}),s.jsx(Z,{})]})})]},c.friend_id))})}const ot=t=>{const e=R.c(28),{row:r,selectedTradeId:i,setSelectedTradeId:n}=t,{t:o}=F("trade-matches"),{data:m,isLoading:f}=U();if(f)return null;if(!m){let b;e[0]!==o?(b=o("common:error"),e[0]=o,e[1]=b):b=e[1];let v;return e[2]!==b?(v=s.jsx("p",{className:"text-xl text-center py-8",children:b}),e[2]=b,e[3]=v):v=e[3],v}const l=r.offering_friend_id===m.friend_id?r.offer_card_id:r.receiver_card_id,u=r.offering_friend_id===m.friend_id?r.receiver_card_id:r.offer_card_id;let h;e[4]!==i||e[5]!==n?(h=function(v){i===v.id?n(void 0):n(v.id)},e[4]=i,e[5]=n,e[6]=h):h=e[6];const g=h;let _;e[7]!==m.friend_id||e[8]!==o?(_=b=>{const v={offered:b.offering_friend_id===m.friend_id?s.jsx(rt,{className:"bg-amber-600"}):s.jsx(et,{className:"bg-amber-600"}),accepted:s.jsx(st,{className:"bg-lime-600"}),declined:s.jsx(Ce,{className:"bg-stone-600"}),finished:s.jsx(ve,{className:"bg-indigo-600"})};return s.jsxs(s.Fragment,{children:[s.jsx(G,{id:`status-${b.id}`}),s.jsx(Ye,{className:"rounded-full p-[3px] my-auto","data-tooltip-id":`status-${b.id}`,"data-tooltip-content":o(`status.${b.status}`),children:v[b.status]})]})},e[7]=m.friend_id,e[8]=o,e[9]=_):_=e[9];const a=_,d=`flex cursor-pointer rounded gap-1 md:gap-2 p-1 ${i===r.id&&"bg-green-900"} hover:bg-neutral-500`;let c;e[10]!==g||e[11]!==r?(c=()=>g(r),e[10]=g,e[11]=r,e[12]=c):c=e[12];let x;e[13]!==r||e[14]!==a?(x=a(r),e[13]=r,e[14]=a,e[15]=x):x=e[15];let j;e[16]!==l?(j=s.jsx(O,{className:"md:w-1/2",card_id:l,increment:-1}),e[16]=l,e[17]=j):j=e[17];let p;e[18]!==u?(p=s.jsx(O,{className:"md:w-1/2",card_id:u,increment:1}),e[18]=u,e[19]=p):p=e[19];let y;e[20]!==j||e[21]!==p?(y=s.jsxs("div",{className:"flex flex-col md:flex-row grow-1 justify-between gap-1 md:gap-2",children:[j,p]}),e[20]=j,e[21]=p,e[22]=y):y=e[22];let N;return e[23]!==d||e[24]!==c||e[25]!==x||e[26]!==y?(N=s.jsxs("li",{className:d,onClick:c,children:[x,y]}),e[23]=d,e[24]=c,e[25]=x,e[26]=y,e[27]=N):N=e[27],N};function oe({trades:t}){const{t:e}=F("trade-matches"),{toast:r}=me(),{data:i}=U(),{data:n=new Map}=ue(),o=Te(),[m,f]=L.useState(void 0),l=Se();if(!i)return null;const u=(a,d)=>{const c=ke(a);return{card_id:a,internal_id:c,amount_owned:(n.get(c)?.amount_owned??0)+d}},h=async a=>{if(a.offer_card_id!==a.receiver_card_id)if(a.offering_friend_id===i.friend_id){const d=[u(a.offer_card_id,-1),u(a.receiver_card_id,1)];o.mutate({updates:d}),r({title:e("collectionUpdated"),variant:"default"})}else if(a.receiving_friend_id===i.friend_id){const d=[u(a.offer_card_id,1),u(a.receiver_card_id,-1)];o.mutate({updates:d}),r({title:e("collectionUpdated"),variant:"default"})}else console.log(a,"can't match friend id")},g=a=>{const d=async j=>{l.mutate({id:a.id,trade:{status:j}}),f(a.id),Y(`Updated trade: ${j}`)},c=async()=>{const j=a.offering_friend_id===i.friend_id?{offerer_ended:!0}:a.receiving_friend_id===i.friend_id?{receiver_ended:!0}:null;if(j===null){console.log(a," doesn't match your friend_id");return}l.mutate({id:a.id,trade:j}),f(void 0),Y("Updated trade: ended")},x=a.offering_friend_id===i.friend_id&&a.offerer_ended||a.receiving_friend_id===i.friend_id&&a.receiver_ended;switch(a.status){case"offered":return s.jsxs(s.Fragment,{children:[a.receiving_friend_id===i.friend_id&&s.jsx(I,{type:"button",onClick:async()=>d("accepted"),children:e("actionAccept")}),s.jsx(I,{type:"button",onClick:async()=>d("declined"),children:a.receiving_friend_id===i.friend_id?e("actionDecline"):e("actionCancel")})]});case"accepted":return s.jsxs(s.Fragment,{children:[s.jsx(I,{type:"button",onClick:async()=>d("finished"),children:e("actionComplete")}),s.jsx(I,{type:"button",onClick:async()=>d("declined"),children:e("actionCancel")})]});case"declined":return x?null:s.jsx(I,{type:"button",onClick:c,children:e("actionHide")});case"finished":return x?null:s.jsxs(s.Fragment,{children:[s.jsx(I,{type:"button",onClick:async()=>{await h(a),await c()},children:e("actionUpdate")}),s.jsx(I,{type:"button",onClick:c,children:e("actionHide")})]});default:return console.log(`Unknown trade status ${a.status}`),null}},_=t.find(a=>a.id===m);return t.length===0?null:s.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-1 md:p-2",children:[s.jsxs("div",{className:"hidden md:flex pr-1",children:[s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:e("youGive")}),s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:e("youReceive")})]}),s.jsx("ul",{className:"flex flex-col gap-2 md:gap-0",children:t.toSorted((a,d)=>a.created_at>d.created_at?-1:1).map(a=>s.jsx(ot,{row:a,selectedTradeId:m,setSelectedTradeId:f},a.id))}),_&&s.jsx("div",{className:"flex gap-4 text-center items-center mt-2",children:g(_)})]})}function mt(t){const e=R.c(50),{friendId:r,activeTrades:i}=t;let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=["trade-matches","common"],e[0]=n):n=e[0];const{t:o}=F(n),{data:m,isLoading:f}=fe(r),[l,u]=L.useState(!1);let h,g;e[1]!==r?(h=["trades",r],g=()=>we(r),e[1]=r,e[2]=h,e[3]=g):(h=e[2],g=e[3]);let _;e[4]!==h||e[5]!==g||e[6]!==l?(_={queryKey:h,queryFn:g,enabled:l},e[4]=h,e[5]=g,e[6]=l,e[7]=_):_=e[7];const a=ge(_);if(f)return null;let d;e[8]!==o?(d=o("tradingWith"),e[8]=o,e[9]=d):d=e[9];let c;e[10]!==d?(c=s.jsx("span",{className:"text-md",children:d}),e[10]=d,e[11]=c):c=e[11];const x=m?.username||"unknown";let j;e[12]!==x?(j=s.jsxs("span",{className:"text-md font-bold",children:[" ",x," "]}),e[12]=x,e[13]=j):j=e[13];let p;e[14]!==m?(p=m&&s.jsx(xe,{friendId:m.friend_id,showFriendId:!1,className:"ml-1"}),e[14]=m,e[15]=p):p=e[15];let y;e[16]!==c||e[17]!==j||e[18]!==p?(y=s.jsxs("p",{children:[c,j,p]}),e[16]=c,e[17]=j,e[18]=p,e[19]=y):y=e[19];const N=`history-${r}`;let b;e[20]!==o?(b=o("viewHistory"),e[20]=o,e[21]=b):b=e[21];const v=`history-${r}`;let k;e[22]!==v||e[23]!==l?(k=s.jsx(he,{id:v,className:"ml-2 my-auto",checked:l,onCheckedChange:u}),e[22]=v,e[23]=l,e[24]=k):k=e[24];let C;e[25]!==N||e[26]!==b||e[27]!==k?(C=s.jsxs("label",{htmlFor:N,className:"my-auto flex items-center",children:[b,k]}),e[25]=N,e[26]=b,e[27]=k,e[28]=C):C=e[28];const T=`/trade/${r}`;let S;e[29]!==o?(S=o("openTradeWith"),e[29]=o,e[30]=S):S=e[30];let w;e[31]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(Z,{}),e[31]=w):w=e[31];let $;e[32]!==S?($=s.jsxs(I,{variant:"outline",className:"my-auto",children:[S,w]}),e[32]=S,e[33]=$):$=e[33];let A;e[34]!==T||e[35]!==$?(A=s.jsx(J,{to:T,children:$}),e[34]=T,e[35]=$,e[36]=A):A=e[36];let P;e[37]!==C||e[38]!==A?(P=s.jsxs("span",{className:"flex gap-4",children:[C,A]}),e[37]=C,e[38]=A,e[39]=P):P=e[39];let E;e[40]!==y||e[41]!==P?(E=s.jsxs("div",{className:"flex justify-between items-center mb-1 mx-1",children:[y,P]}),e[40]=y,e[41]=P,e[42]=E):E=e[42];let M;e[43]!==i||e[44]!==a||e[45]!==l?(M=l?a.isLoading?s.jsx(X,{size:"md"}):a.data&&s.jsx(oe,{trades:a.data}):s.jsx(oe,{trades:i}),e[43]=i,e[44]=a,e[45]=l,e[46]=M):M=e[46];let B;return e[47]!==E||e[48]!==M?(B=s.jsxs("div",{className:"w-full",children:[E,M]}),e[47]=E,e[48]=M,e[49]=B):B=e[49],B}function ft(){const t=R.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=F(e),{data:i,isLoading:n}=U(),{data:o,isLoading:m}=Ie();if(n||m){let a;return t[1]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsx(X,{size:"lg",overlay:!0}),t[1]=a):a=t[1],a}if(!o||!i){let a;t[2]!==r?(a=r("common:error"),t[2]=r,t[3]=a):a=t[3];let d;return t[4]!==a?(d=s.jsx("p",{className:"text-xl text-center py-8",children:a}),t[4]=a,t[5]=d):d=t[5],d}if(o.length===0){let a;t[6]!==r?(a=r("noTradeOffers"),t[6]=r,t[7]=a):a=t[7];let d;return t[8]!==a?(d=s.jsx("p",{children:a}),t[8]=a,t[9]=d):d=t[9],d}let f,l;t[10]!==i.friend_id||t[11]!==o?(f=ht(o,i.friend_id),l=Object.fromEntries(Object.entries(f).map(ut)),t[10]=i.friend_id,t[11]=o,t[12]=f,t[13]=l):(f=t[12],l=t[13]);const u=l;let h,g;if(t[14]!==f||t[15]!==u){let a;t[18]!==u?(a=(x,j)=>u[j]-u[x],t[18]=u,t[19]=a):a=t[19];const d=Object.keys(f).toSorted(a);h="flex flex-col items-center mx-auto gap-6 sm:px-4 mb-12 w-full";let c;t[20]!==f?(c=x=>s.jsx(mt,{friendId:x,activeTrades:f[x]},x),t[20]=f,t[21]=c):c=t[21],g=d.map(c),t[14]=f,t[15]=u,t[16]=h,t[17]=g}else h=t[16],g=t[17];let _;return t[22]!==h||t[23]!==g?(_=s.jsx("div",{className:h,children:g}),t[22]=h,t[23]=g,t[24]=_):_=t[24],_}function ut(t){const[e,r]=t;return[e,Math.max(...r.map(xt))]}function xt(t){return new Date(t.updated_at).getTime()}function ht(t,e){return Object.groupBy(t,r=>r.offering_friend_id===e?r.receiving_friend_id:r.receiving_friend_id===e?r.offering_friend_id:(console.log("Fetched row does not match user friend_id",r),"undefined"))}function pt(){const{t}=F("trade-matches"),{data:e}=U(),r=$e(),i=se({is_active_trading:Fe(),trade_rarity_settings:Le(se({rarity:Ae(Pe),to_collect:ie().min(0).max(100),to_keep:ie().min(0).max(100)}))}),n=Ge({resolver:Qe(i),values:{is_active_trading:e?.is_active_trading||!1,trade_rarity_settings:e?.trade_rarity_settings||[]}}),o=async m=>{r.mutate({username:e?.username,is_active_trading:m.is_active_trading,trade_rarity_settings:m.trade_rarity_settings},{onSuccess:()=>re({title:t("accountSaved"),variant:"default"}),onError:f=>{console.error("error saving account",f),re({title:t("errorSavingAccount"),variant:"destructive"})}})};return!e||!e.username?s.jsx(Ee,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:t("noAccount")}):s.jsxs("div",{children:[s.jsx(Xe,{...n,children:s.jsxs("form",{onSubmit:n.handleSubmit(o),className:"rounded-md border-1 border-neutral-700 space-y-2 p-4 mx-auto max-w-xl",children:[s.jsx("h2",{className:"text-xl text-center mb-6",children:t("settingsTitle")}),s.jsx(q,{control:n.control,name:"is_active_trading",render:({field:m})=>s.jsx(K,{className:"flex flex-col items-start",children:s.jsx(W,{children:s.jsxs(Ze,{className:"flex",children:[t("isActiveTrading"),s.jsx(he,{className:"ml-2",checked:m.value,onCheckedChange:m.onChange})]})})})}),s.jsxs("div",{className:"grid grid-cols-3 gap-y-2 gap-x-8 w-fit mt-6",children:[s.jsx("span",{children:t("rarity")}),s.jsxs("span",{className:"flex items-center",children:[t("toCollect"),s.jsx(G,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toCollectTooltip")})]}),s.jsxs("span",{className:"flex items-center",children:[t("toKeep"),s.jsx(G,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toKeepTooltip")})]}),n.watch("trade_rarity_settings").map((m,f)=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex-1",children:m.rarity},`label-${m.rarity}`),s.jsx(q,{control:n.control,name:`trade_rarity_settings.${f}.to_collect`,render:({field:l})=>s.jsx(K,{className:"flex-1",children:s.jsx(W,{children:s.jsx(ae,{className:"w-24",type:"number",...l})})})},`to-collect-${m.rarity}`),s.jsx(q,{control:n.control,name:`trade_rarity_settings.${f}.to_keep`,render:({field:l})=>s.jsx(K,{className:"flex-1",children:s.jsx(W,{children:s.jsx(ae,{className:"w-24",type:"number",...l})})})},`to-keep-${m.rarity}`)]}))]}),s.jsx(I,{type:"submit",className:"block ml-auto flex gap-2",disabled:r.isPending,isPending:r.isPending,children:t("save")})]})}),s.jsx(We,{className:"mt-4 mx-auto w-fit"})]})}function Pt(){const t=R.c(45),{t:e}=F("trade-matches"),r=Re(),i=Oe();let n;t[0]!==r.pathname?(n=r.pathname.split("/").pop()||"offers",t[0]=r.pathname,t[1]=n):n=t[1];const o=n;let m,f;t[2]!==r.pathname||t[3]!==i?(m=()=>{r.pathname==="/trade"&&i("/trade/offers")},f=[r.pathname,i],t[2]=r.pathname,t[3]=i,t[4]=m,t[5]=f):(m=t[4],f=t[5]),L.useEffect(m,f);let l;t[6]!==i?(l=w=>i(`/trade/${w}`),t[6]=i,t[7]=l):l=t[7];let u;t[8]!==e?(u=e("tabCards"),t[8]=e,t[9]=u):u=t[9];let h;t[10]!==u?(h=s.jsx(H,{className:"text-md",value:"cards",children:u}),t[10]=u,t[11]=h):h=t[11];let g;t[12]!==e?(g=e("tabOffers"),t[12]=e,t[13]=g):g=t[13];let _;t[14]!==g?(_=s.jsx(H,{className:"text-md",value:"offers",children:g}),t[14]=g,t[15]=_):_=t[15];let a;t[16]!==e?(a=e("tabMatches"),t[16]=e,t[17]=a):a=t[17];let d;t[18]!==a?(d=s.jsx(H,{className:"text-md",value:"matches",children:a}),t[18]=a,t[19]=d):d=t[19];let c;t[20]!==e?(c=e("tabSettings"),t[20]=e,t[21]=c):c=t[21];let x;t[22]!==c?(x=s.jsx(H,{className:"text-md",value:"settings",children:c}),t[22]=c,t[23]=x):x=t[23];let j;t[24]!==x||t[25]!==h||t[26]!==_||t[27]!==d?(j=s.jsxs(He,{className:"gap-4 mb-6 rounded-lg border-b-1 border-neutral-700 border-solid dark:bg-transparent pb-2",children:[h,_,d,x]}),t[24]=x,t[25]=h,t[26]=_,t[27]=d,t[28]=j):j=t[28];let p;t[29]===Symbol.for("react.memo_cache_sentinel")?(p=s.jsx(z,{path:"/",element:s.jsx(Ue,{to:"/trade/offers",replace:!0})}),t[29]=p):p=t[29];let y;t[30]!==e?(y=e("movedToCollectionPage"),t[30]=e,t[31]=y):y=t[31];let N;t[32]!==y?(N=s.jsx(z,{path:"cards",element:s.jsx("p",{children:y})}),t[32]=y,t[33]=N):N=t[33];let b;t[34]===Symbol.for("react.memo_cache_sentinel")?(b=s.jsx(z,{path:"offers",element:s.jsx(ft,{})}),t[34]=b):b=t[34];let v;t[35]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(z,{path:"matches",element:s.jsx(ct,{})}),t[35]=v):v=t[35];let k;t[36]===Symbol.for("react.memo_cache_sentinel")?(k=s.jsx(z,{path:"settings",element:s.jsx(pt,{})}),t[36]=k):k=t[36];let C;t[37]===Symbol.for("react.memo_cache_sentinel")?(C=s.jsx(z,{path:":friendId",element:s.jsx(dt,{})}),t[37]=C):C=t[37];let T;t[38]!==N?(T=s.jsxs(Be,{children:[p,N,b,v,k,C]}),t[38]=N,t[39]=T):T=t[39];let S;return t[40]!==o||t[41]!==j||t[42]!==T||t[43]!==l?(S=s.jsxs(Ve,{className:"flex flex-col mx-auto max-w-[900px]",value:o,onValueChange:l,children:[j,T]}),t[40]=o,t[41]=j,t[42]=T,t[43]=l,t[44]=S):S=t[44],S}export{Pt as default};
