import{c as je,j as e,m as U,k as P,u as A,r as d,C as G,B as I,D as se,n as ae,o as re,q as le,M as be,s as Ce,t as oe,U as ye,v as ve,w as Ne,x as ke,l as O,y as Se,z as ie,A as Te,S as Me,E as _e,F as Ie,G as Fe,H as Ae,I as Be,J as De,K as Ee,L as Pe}from"./index-B1VpVbZY.js";import{E as Q,D as Le,u as He}from"./index-Bi_9JLZa.js";import{T as ce,a as de,b as $,C as $e}from"./tabs-BQ5La3iI.js";import{F as K,P as Re,C as ze}from"./CardDetail-CPEMzsJS.js";import{A as ue,b as xe,a as Oe}from"./alert-Cx9DT0Dz.js";import{M as V,C as he,N as J}from"./NumberFilter-CdzvskRn.js";import{T as Ue,a as Y,P as qe,b as We,c as Ve,R as X,u as Ge}from"./useWindowDimensionsHook-CYql2rP0.js";import{S as ee}from"./SearchInput-DPEX2Ua5.js";import{S as Ke}from"./siren-CvfgS_jX.js";import"./index-4ZQY1jHZ.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Qe=je("trophy",Ze);function Je({card:s,onSelect:a,selected:t}){const l=()=>{a(s.card_id,!t)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(K,{card:s,selected:t,setIsSelected:l,size:"small"}),e.jsx("p",{className:"text-xs text-center mt-1",children:U(s,P.language)})]})}const Ye=({children:s,className:a})=>e.jsx("div",{className:`max-h-[300px] overflow-y-auto border border-gray-300 rounded-md ${a}`,style:{maxHeight:"300px"},children:s});function Xe({filteredCards:s}){const{t:a}=A("bulk-update"),{updateCards:t}=d.use(G),[l,u]=d.useState(!1),[r,x]=d.useState(0),[i,f]=d.useState({}),[T,j]=d.useState(!1),[y,b]=d.useState(!1),g=async(c,m)=>{await t(c.map(w=>({card_id:w,amount_owned:m})))},C=s.length===0,v=d.useMemo(()=>s.reduce((c,m)=>(c.some(w=>w.card_id===m.card_id)||c.push(m),c),[]),[s]);d.useEffect(()=>{if(l){const c=v.reduce((m,w)=>(m[w.card_id]=!0,m),{});f(c)}l||b(!1)},[l]);const M=(c,m)=>{f(w=>({...w,[c]:m}))},_=()=>{const c=v.reduce((m,w)=>(m[w.card_id]=!0,m),{});f(c)},E=()=>{const c=v.reduce((m,w)=>(m[w.card_id]=!1,m),{});f(c)},N=Object.values(i).filter(c=>c).length,L=()=>{r!==null&&(r>0?x(c=>(c||0)-1):r===0&&x(0)),b(!0)},R=()=>{x(c=>c?c+1:1),b(!0)},k=c=>{const m=c.target.value.trim();if(m==="")x(0);else{const w=Number(m);Number.isNaN(w)?x(0):x(w<0?0:w)}b(!0)},B=async()=>{j(!0);const c=Object.entries(i).filter(([m,w])=>w).map(([m])=>m);c.length>0&&(await g(c,r),u(!1),j(!1))};return e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"hidden sm:block",variant:"outline",onClick:()=>u(!0),disabled:C,children:a("buttonTitle")}),e.jsx(se,{open:l,onOpenChange:u,children:e.jsxs(ae,{className:"max-w-2xl",children:[e.jsx(re,{children:e.jsx(le,{children:a("title")})}),e.jsx(ue,{variant:"destructive",children:e.jsxs(xe,{children:[a("alert.beforeCount"),e.jsxs("strong",{children:[e.jsx("span",{style:{fontSize:"1.25rem",color:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.375rem",margin:"0 0.25rem"},children:N})," ",a("alert.cards")]})," ",a("alert.afterCount"),e.jsx("strong",{children:a("alert.warning")})]})}),e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsx(I,{variant:"outline",onClick:E,children:a("deselectAll")}),e.jsx(I,{variant:"outline",onClick:_,children:a("selectAll")})]}),e.jsx(Ye,{className:"h-64 rounded-md border p-4",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:v.map(c=>e.jsx(Je,{card:c,onSelect:M,selected:i[c.card_id]},c.card_id))})}),e.jsxs("div",{className:"flex items-center gap-x-1 justify-center",children:[e.jsx(I,{variant:"ghost",size:"icon",onClick:L,disabled:r===null||r===0,className:"rounded-full",children:e.jsx(be,{size:14})}),e.jsx("input",{type:"text",min:"0",value:r??0,onChange:k,placeholder:a("enterAmount"),className:"w-7 text-center border-none rounded",onFocus:c=>c.target.select()}),e.jsx(I,{variant:"ghost",size:"icon",onClick:R,className:"rounded-full",children:e.jsx(Re,{size:14})})]}),e.jsxs(Ce,{children:[e.jsx(I,{variant:"outline",onClick:()=>u(!1),children:a("cancel")}),e.jsxs(I,{onClick:B,disabled:N===0||T||!y,variant:"default",children:[T&&e.jsxs("svg",{"aria-hidden":"true",className:"w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),e.jsx("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})]}),a(T?"batchProcessing":"batchUpdate")]})]})]})})]})}const te=({ownedFilter:s,setOwnedFilter:a,fullWidth:t})=>{const{t:l}=A("owned-filter");return e.jsx(ce,{value:s,onValueChange:u=>a(u),className:t?"w-full":"w-70",children:e.jsxs(de,{className:"w-full flex-wrap h-auto lg:h-10 bg-neutral-50 border-1 border-neutral-700 rounded-md",children:[e.jsx($,{value:"all",children:l("all")}),e.jsx($,{value:"missing",children:l("missing")}),e.jsx($,{value:"owned",children:l("owned")})]})})},ne=({value:s,onChange:a,expansion:t,fullWidth:l})=>{const{t:u}=A("common/packs");let r=oe(t)?.packs;const x=!(r===void 0||t==="P-A");return(r===void 0||r.length<=1)&&(r=[]),t==="all"||t==="P-A"?null:e.jsx(ce,{value:s,onValueChange:a,className:`h-auto ${l?"w-full":"w-[440px]"}`,children:e.jsxs(de,{className:"h-full flex-wrap w-full border-1 border-neutral-700 rounded-md flex-row justify-start content-start",children:[e.jsx($,{value:"all",children:u("all")}),r.filter(i=>i.name!=="everypack").map(i=>e.jsx($,{value:i.name,children:u(i.name)},`tab_trigger_${i.name}`)),x&&e.jsx($,{value:"missions",children:u("missions")})]})})};function et(s,a){if(s.length===0)return a.length;if(a.length===0)return s.length;let t=Array(s.length+1).fill(0).map((u,r)=>r),l=Array(s.length+1);for(let u=1;u<=a.length;u++){l[0]=u;for(let r=1;r<=s.length;r++){const x=s[r-1]===a[u-1]?0:1;l[r]=Math.min(t[r]+1,l[r-1]+1,t[r-1]+x)}[t,l]=[l,t]}return t[s.length]}const tt=({allTextSearch:s,setAllTextSearch:a})=>{const{t}=A("search-input");return e.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[e.jsx("input",{type:"checkbox",id:"checkbox",checked:s,onChange:()=>a(!s),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:t("allTextLabel")}),e.jsx(V,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(he,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":t("allTextTooltip")})]})},nt=["grass","fire","water","lightning","psychic","fighting","darkness","metal","dragon","colorless","trainer",""],st=({cardTypeFilter:s,setCardTypeFilter:a,collapse:t})=>{const{t:l}=A("card-type-filter"),u=d.useMemo(()=>e.jsxs(Ue,{variant:"outline",type:"multiple",size:"sm",value:s,onValueChange:r=>{a(r)},className:`justify-center shadow-none border-1 border-neutral-700 rounded-md flex-wrap ${t?"flex-col":"flex-row"}`,children:[nt.filter(r=>r!==""&&r!=="trainer").map(r=>e.jsx(Y,{value:r,"aria-label":r,className:"text-gray-400 hover:text-gray-500 px-1",children:e.jsx("img",{src:`/images/energy/${r}.webp`,alt:r,className:"h-4"})},r)),e.jsx(Y,{value:"trainer","aria-label":"trainer",className:"text-gray-400 hover:text-gray-500 px-1",children:"T"})]}),[s,t]);return t?e.jsxs(qe,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(I,{variant:"outline",children:[l("filters")," (",s.length,")"]})}),e.jsx(Ve,{className:"w-32",children:u})]}):u},at=({sortBy:s,setSortBy:a})=>{const{t}=A("sort-by");return e.jsx("div",{className:"px-3 py-1 border-1 border-neutral-700 rounded-md",children:e.jsxs("label",{className:"flex items-center gap-x-2 text-white/50 text-sm",children:[e.jsx("h2",{children:t("sortBy")}),e.jsxs("select",{value:s,onChange:l=>a(l.target.value),className:"p-1",children:[e.jsx("option",{value:"default",className:"text-black",children:t("default")}),e.jsx("option",{value:"recent",className:"text-black",children:t("recent")}),e.jsx("option",{value:"expansion-newest",className:"text-black",children:t("expansion-newest")})]})]})})},rt=({children:s,cards:a,filters:t,setFilters:l,onFiltersChanged:u,onChangeToMissions:r,visibleFilters:x,filtersDialog:i,batchUpdate:f,share:T})=>{const{t:j}=A(["pages/collection"]),{setIsProfileDialogOpen:y}=d.useContext(ye),[b,g]=d.useState(P.language),C=n=>l(h=>({...h,search:n})),v=n=>l(h=>({...h,allTextSearch:n})),M=n=>l(h=>({...h,expansion:n})),_=n=>l(h=>({...h,pack:n})),E=n=>l(h=>({...h,cardType:n})),N=n=>l(h=>({...h,rarity:n})),L=n=>l(h=>({...h,owned:n})),R=n=>l(h=>({...h,sortBy:n})),k=n=>l(h=>({...h,minNumber:n})),B=n=>l(h=>({...h,maxNumber:n})),c=n=>l(h=>({...h,deckbuildingMode:n})),[m,w]=d.useState(null),me=n=>t.rarity.length===0?!0:n.rarity!==""&&t.rarity.includes(n.rarity),pe=n=>t.cardType.length===0?!0:n.card_type.toLowerCase()==="trainer"?t.cardType.includes("trainer"):n.energy!==""&&t.cardType.includes(n.energy.toLowerCase()),H=d.useMemo(()=>{if(!a)return null;let n=ve;if(t.deckbuildingMode&&(n=n.filter(o=>Ne.includes(o.rarity)||o.rarity===""||o.rarity==="P")),t.expansion!=="all"&&(n=n.filter(o=>o.expansion===t.expansion)),t.pack==="missions"){n=[];let o=ke.get(t.expansion)?.missions||null;o&&(t.owned==="owned"?o=o.filter(p=>p.completed):t.owned==="missing"&&(o=o.filter(p=>!p.completed))),w(o)}else w(null),t.pack!=="all"&&(n=n.filter(o=>o.pack===t.pack||o.pack==="everypack"));if(t.owned!=="all"&&(t.owned==="owned"?n=n.filter(o=>a.find(p=>p.card_id===o.card_id&&p.amount_owned>0)):t.owned==="missing"&&(n=n.filter(o=>!a.find(p=>p.card_id===o.card_id&&p.amount_owned>0)))),t.sortBy==="recent")n=[...n].sort((o,p)=>{const F=a.find(D=>D.card_id===o.card_id)?.updated_at,S=a.find(D=>D.card_id===p.card_id)?.updated_at;return F&&S?new Date(S).getTime()-new Date(F).getTime():F&&!S?-1:1});else if(t.sortBy==="expansion-newest"){const o=[...O].reverse().slice(1).concat(O[O.length-1]);n=[...n].sort((p,F)=>{const S=o.findIndex(z=>z.id===p.expansion),D=o.findIndex(z=>z.id===F.expansion);return S!==D?S-D:p.card_id.localeCompare(F.card_id,P.language||"en",{numeric:!0})})}n=n.filter(me),n=n.filter(pe),t.search&&(n=n.filter(p=>{const F=U(p,P.language).toLowerCase(),S=t.search.toLowerCase();let D=!1;if(t.allTextSearch){const q=p.ability.name?.toLowerCase(),we=p.ability.effect?.toLowerCase();D=q&&q!=="no ability"&&(q.includes(S)||we.includes(S))||p.attacks.some(W=>W.name?.toLowerCase().includes(S)||W.effect?.toLowerCase()!=="no effect"&&W.effect?.toLowerCase()?.includes(S))}const z=F.includes(S),fe=et(F,S)<=2,ge=p.card_id.toLowerCase().includes(S);return D||z||fe||ge}));const h=new Map((a||[]).map(o=>[o.card_id,o.amount_owned]));for(const o of n)o.linkedCardID?o.amount_owned=0:t.deckbuildingMode?o.amount_owned=o.alternate_versions.reduce((p,F)=>p+(h.get(F.card_id)||0),0):o.amount_owned=h.get(o.card_id)||0;return n=n.filter(o=>(o.amount_owned||0)>=t.minNumber),t.maxNumber!==100&&(n=n.filter(o=>(o.amount_owned||0)<=t.maxNumber)),n},[a,t,b]);d.useEffect(()=>{u(H);const n=h=>{g(h)};return P.on("languageChanged",n),()=>{P.off("languageChanged",n)}},[H]),d.useEffect(()=>{r(m)},[m]);function Z(n){M(n),_("all")}return e.jsxs("div",{id:"filterbar",className:"flex flex-col gap-x-2 flex-wrap",children:[s,x?.expansions&&e.jsxs("div",{className:"flex gap-x-2 px-4 mb-2",children:[e.jsx(Q,{value:t.expansion,onChange:Z}),e.jsx(ne,{value:t.pack,onChange:_,expansion:t.expansion})]}),e.jsxs("div",{className:"gap-2 flex-row gap-y-1 px-4 flex",children:[x?.search&&e.jsx(ee,{setSearchValue:C}),x?.owned&&e.jsx(te,{ownedFilter:t.owned,setOwnedFilter:L}),x?.rarity&&e.jsx(X,{rarityFilter:t.rarity,setRarityFilter:N,collapse:!0}),i&&e.jsxs(se,{children:[e.jsx(Se,{asChild:!0,children:e.jsx(I,{variant:"outline",children:j("filters.allFilters")})}),e.jsxs(ae,{className:"border-1 border-neutral-700 shadow-none max-h-[90vh] overflow-y-auto content-start",children:[e.jsx(re,{children:e.jsx(le,{children:j("filters.filtersCount",{count:(H||[]).filter(n=>!n.linkedCardID).length})})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[i.search&&e.jsx(ee,{setSearchValue:C,fullWidth:!0}),i.allTextSearch&&e.jsx(tt,{allTextSearch:t.allTextSearch,setAllTextSearch:v}),i.expansions&&e.jsx(Q,{value:t.expansion,onChange:Z}),i.pack&&e.jsx(ne,{value:t.pack,onChange:_,expansion:t.expansion,fullWidth:!0}),i.rarity&&e.jsx(X,{rarityFilter:t.rarity,setRarityFilter:N}),i.cardType&&e.jsx(st,{cardTypeFilter:t.cardType,setCardTypeFilter:E}),i.owned&&e.jsx(te,{ownedFilter:t.owned,setOwnedFilter:L,fullWidth:!0}),i.sortBy&&e.jsx(at,{sortBy:t.sortBy,setSortBy:R}),i.amount&&e.jsxs(e.Fragment,{children:[e.jsx(J,{numberFilter:t.minNumber,setNumberFilter:k,options:[0,1,2,3,4,5,6,7,8,9],labelKey:"minNum"}),e.jsx(J,{numberFilter:t.maxNumber,setNumberFilter:B,options:[1,2,3,4,5,6,7,8,9,10,100],labelKey:"maxNum"})]}),i.deckBuildingMode&&e.jsx(Le,{deckbuildingMode:t.deckbuildingMode,setDeckbuildingMode:c}),e.jsx(I,{variant:"outline",className:"!text-red-700",onClick:()=>l({search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1}),children:j("filters.clear")})]})]})]}),f&&e.jsx(Xe,{filteredCards:H||[],disabled:!H||H.length===0}),T&&e.jsx(I,{variant:"outline",onClick:()=>y(!0),children:j("filters.share")})]})]})};function lt({mission:s}){const{width:a}=Ge(),{t}=A("common/packs"),{ownedCards:l,setSelectedCardId:u,setSelectedMissionCardOptions:r}=d.use(G);let x=5,i=Math.min(a,890)/5+120;a>600&&a<800?(x=4,i=a/3+50):a<=600&&(x=3,i=a/3+100);const f=d.useMemo(()=>{let j=!0;const y=s.requiredCards.flatMap(g=>{let C=l.reduce((M,_)=>{const E=g.options.find(N=>N===_.card_id);if(E)for(let N=0;N<_.amount_owned;N++)M.push({cardId:E,owned:!0,missionCardOptions:g.options});return M},[]);C.length>g.amount&&(C=C.slice(0,g.amount));const v=g.amount-C.length;for(let M=0;M<v;M++)C.push({cardId:g.options[0],owned:!1,missionCardOptions:g.options});return j=j&&v===0,C});s.completed=j;const b=[];for(let g=0;g<y.length;g+=x)b.push(y.slice(g,g+x));return b},[x]),T=i*f.length+72;return e.jsxs("div",{style:{height:`${T}px`},className:"relative w-full",children:[e.jsx("div",{style:{height:`${T}px`},className:"relative w-full",children:f.map((j,y)=>e.jsx("div",{style:{height:`${i}px`,transform:`translateY(${i*y+72}px)`},className:"absolute top-0 left-0 w-full",children:e.jsx("div",{className:"flex justify-start gap-x-3",children:j.map((b,g)=>{const C=ie(b.cardId);return C&&e.jsxs("div",{className:"group flex w-fit max-w-32 md:max-w-40 flex-col items-center rounded-lg cursor-pointer",children:[e.jsx("button",{type:"button",onClick:()=>b.owned?u(b.cardId):r(b.missionCardOptions),children:e.jsx(K,{card:C,selected:b.owned})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[b.cardId," - ",U(C,P.language)]})]},`${s.name}__${g}`)})})},y))}),e.jsx("div",{style:{height:"72px"},className:"absolute top-0 left-0 w-full",children:e.jsxs("h2",{className:"flex items-center gap-x-4 mx-auto mt-10 w-full max-w-[900px] scroll-m-20 border-b-2 border-slate-600 pb-2 font-semibold text-md sm:text-lg md:text-2xl tracking-tight transition-colors first:mt-0",children:[s.name,e.jsx(V,{id:`rewardDescription${s.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),e.jsx(Qe,{className:"h-6 w-6","data-tooltip-id":`rewardDescription${s.name}`,"data-tooltip-html":s.reward}),e.jsx(V,{id:`probability${s.name}`,style:{maxWidth:"300px",whiteSpace:"normal",fontSize:16},clickable:!0}),e.jsx(he,{className:"h-6 w-6","data-tooltip-id":`probability${s.name}`,"data-tooltip-html":s.completed?"Completed!":Te(s,f).filter(([j,y])=>j!=="everypack"&&y>0).map(([j,y])=>`${t(j)}: ${y.toFixed(2)}%`).join("<br/>")})]})},"header")]})}function ot({missions:s,resetScrollTrigger:a}){const t=d.useRef(null),[l,u]=d.useState("auto");return d.useLayoutEffect(()=>{const r=()=>{if(t.current){const x=document.querySelector("#header")?.offsetHeight||0,i=document.querySelector("#filterbar")?.offsetHeight||0,f=window.innerHeight-x-i;u(`${f}px`)}};return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),d.useEffect(()=>{t.current&&(t.current.scrollTop=0)},[a]),e.jsx("div",{ref:t,className:"overflow-y-auto mt-2 sm:mt-4 px-4 flex flex-col justify-start",style:{scrollbarWidth:"none",height:l},children:s.map(r=>e.jsx(lt,{mission:r},r.name))})}function it({missionCardOptions:s,onClose:a}){const{t}=A(["common/sets","common/packs","pages/collection"]),l=s[0]||"",u=l.length>0?l.split("-")[0]:"Unknown",r=oe(u)||O[0],x=r.name;return e.jsx(Me,{open:!!s.length,onOpenChange:i=>{i||a()},children:e.jsxs(_e,{className:"transition-all duration-300 ease-in-out border-slate-600 overflow-y-auto",children:[e.jsx(Ie,{children:e.jsx(Fe,{children:s.length===1?t("missionDetail.eligibleCards-singular",{ns:"pages/collection",options:1}):t("missionDetail.eligibleCards-plural",{ns:"pages/collection",options:s.length})})}),t(x),s.map(i=>{const f=ie(i);return f&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"px-10 py-4 w-full",children:e.jsx(K,{card:f,selected:!1})}),e.jsxs("p",{className:"max-w-[130px] whitespace-nowrap font-semibold text-[12px] pt-2",children:[i," - ",U(f,P.language),e.jsx("br",{}),t("missionDetail.chanceFrom",{ns:"pages/collection",pack:t(f.pack,{ns:"common/packs"}),chance:Ae(r,f.pack,f).toFixed(2)})]})]})})]})})}function jt(){const s=Be(),a=De(),{t}=A(["pages/collection"]),l=He({query:"(max-width: 767px)"}),{ownedCards:u,selectedCardId:r,setSelectedCardId:x,selectedMissionCardOptions:i,setSelectedMissionCardOptions:f}=d.useContext(G),[T,j]=d.useState({search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1}),[y,b]=d.useState(!1),[g,C]=d.useState(null),[v,M]=d.useState(null),[_,E]=d.useState(null),[N,L]=d.useState(null);d.useEffect(()=>{const k=s.friendId;k&&!v?(console.log("fetching collection by friend id",k),Ee(k).then(B=>{console.log("friend account",B),C(B)}).catch(console.error),Pe(k).then(B=>{B.length===0&&(console.log("not a public collection, going back to normal mode."),a("/collection")),M(B)}).catch(console.error)):!k&&v&&window.location.reload()},[s]),d.useEffect(()=>()=>{M(null)},[]);const R=d.useMemo(()=>s.friendId?v:u||[],[u,v]);return d.useEffect(()=>{b(!0);const k=setTimeout(()=>b(!1),100);return()=>clearTimeout(k)},[_]),e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsx(rt,{cards:R,filters:T,setFilters:j,onFiltersChanged:k=>E(k),onChangeToMissions:k=>L(k),visibleFilters:{expansions:!l,allTextSearch:!l,search:!0,owned:!l,rarity:!l},filtersDialog:{expansions:!0,pack:!0,search:!0,owned:!0,sortBy:!0,rarity:!0,cardType:!0,amount:!0,deckBuildingMode:!0,allTextSearch:!0},batchUpdate:!v,share:!0,children:e.jsx("div",{children:v&&e.jsxs(ue,{className:"mb-4 border-1 border-neutral-700 shadow-none",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx(Oe,{children:t("publicCollectionTitle",{username:g?.username})}),e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center",children:[t("publicCollectionDescription"),e.jsx(I,{className:"mb-4",onClick:()=>{a(`/trade/${g?.friend_id}`)},children:t("showPossibleTrades")})]})})]})})}),e.jsxs("div",{children:[_&&!N&&e.jsx($e,{cards:_,resetScrollTrigger:y,showStats:!T.deckbuildingMode,extraOffset:24,editable:!T.deckbuildingMode}),r&&e.jsx(ze,{cardId:r,onClose:()=>x("")})]}),e.jsx("div",{children:N&&e.jsx(ot,{missions:N,resetScrollTrigger:y})}),N&&e.jsx(it,{missionCardOptions:i,onClose:()=>f([])})]})}export{jt as default};
