import{u as E,j as e,r as u,y as Z,z as ge,A as ve,m as Ce,B as we,C as J,n as X,D as _,E as Y,F as ee,G as ye,H as be,J as Pe,K as je,L as Ne,M as ke,N as Te,O as _e,Q as Re,f as Ae,S as te,T as Me,x as G,U as b,V as Se,W as Oe,X as Fe,Y as Ee,Z as Ie,_ as Be,$ as De,v as Le,t as U,a0 as $e,a1 as ze,a2 as He,a3 as Ge,a4 as Ue,o as Ke}from"./index-BqVUje8p.js";import{A as Qe,a as Ve,b as We}from"./alert-UXtbFlEa.js";import{R as K,D as qe,u as Ze}from"./index-C-qDOZfT.js";import{C as Je}from"./CardsTable-BuJ3xwdd.js";import{S as Q}from"./SearchInput-CCqdGvT6.js";import{C as Xe,D as T,e as Ye,T as M,a as et,c as tt}from"./useWindowDimensionsHook-IuKnsflS.js";import{M as ot}from"./react-tooltip.min-D1SxipPd.js";import{S as nt}from"./siren-DiQ4_Wa7.js";import"./utils-HqfYraIU.js";import"./Card-BJX5OPDw.js";import"./FancyCard-M6U28rSm.js";import"./index-B1PdPLYa.js";function at(o,n){if(o.length===0)return n.length;if(n.length===0)return o.length;let l=Array(o.length+1).fill(0).map((r,a)=>a),s=Array(o.length+1);for(let r=1;r<=n.length;r++){s[0]=r;for(let a=1;a<=o.length;a++){const d=o[a-1]===n[r-1]?0:1;s[a]=Math.min(l[a]+1,s[a-1]+1,l[a-1]+d)}[l,s]=[s,l]}return l[o.length]}const rt=({allTextSearch:o,setAllTextSearch:n})=>{const{t:l}=E("search-input");return e.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[e.jsx("input",{type:"checkbox",id:"checkbox",checked:o,onChange:()=>n(!o),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:l("allTextLabel")}),e.jsx(ot,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(Xe,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":l("allTextTooltip")})]})};var S="Popover",[oe]=Ce(S,[Z]),R=Z(),[st,y]=oe(S),ne=o=>{const{__scopePopover:n,children:l,open:s,defaultOpen:r,onOpenChange:a,modal:d=!1}=o,x=R(n),p=u.useRef(null),[v,C]=u.useState(!1),[m,w]=ge({prop:s,defaultProp:r??!1,onChange:a,caller:S});return e.jsx(ve,{...x,children:e.jsx(st,{scope:n,contentId:we(),triggerRef:p,open:m,onOpenChange:w,onOpenToggle:u.useCallback(()=>w(j=>!j),[w]),hasCustomAnchor:v,onCustomAnchorAdd:u.useCallback(()=>C(!0),[]),onCustomAnchorRemove:u.useCallback(()=>C(!1),[]),modal:d,children:l})})};ne.displayName=S;var ae="PopoverAnchor",lt=u.forwardRef((o,n)=>{const{__scopePopover:l,...s}=o,r=y(ae,l),a=R(l),{onCustomAnchorAdd:d,onCustomAnchorRemove:x}=r;return u.useEffect(()=>(d(),()=>x()),[d,x]),e.jsx(Y,{...a,...s,ref:n})});lt.displayName=ae;var re="PopoverTrigger",se=u.forwardRef((o,n)=>{const{__scopePopover:l,...s}=o,r=y(re,l),a=R(l),d=J(n,r.triggerRef),x=e.jsx(X.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":ue(r.open),...s,ref:d,onClick:_(o.onClick,r.onOpenToggle)});return r.hasCustomAnchor?x:e.jsx(Y,{asChild:!0,...a,children:x})});se.displayName=re;var I="PopoverPortal",[it,ct]=oe(I,{forceMount:void 0}),le=o=>{const{__scopePopover:n,forceMount:l,children:s,container:r}=o,a=y(I,n);return e.jsx(it,{scope:n,forceMount:l,children:e.jsx(ee,{present:l||a.open,children:e.jsx(ye,{asChild:!0,container:r,children:s})})})};le.displayName=I;var P="PopoverContent",ie=u.forwardRef((o,n)=>{const l=ct(P,o.__scopePopover),{forceMount:s=l.forceMount,...r}=o,a=y(P,o.__scopePopover);return e.jsx(ee,{present:s||a.open,children:a.modal?e.jsx(ut,{...r,ref:n}):e.jsx(pt,{...r,ref:n})})});ie.displayName=P;var dt=je("PopoverContent.RemoveScroll"),ut=u.forwardRef((o,n)=>{const l=y(P,o.__scopePopover),s=u.useRef(null),r=J(n,s),a=u.useRef(!1);return u.useEffect(()=>{const d=s.current;if(d)return be(d)},[]),e.jsx(Pe,{as:dt,allowPinchZoom:!0,children:e.jsx(ce,{...o,ref:r,trapFocus:l.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_(o.onCloseAutoFocus,d=>{d.preventDefault(),a.current||l.triggerRef.current?.focus()}),onPointerDownOutside:_(o.onPointerDownOutside,d=>{const x=d.detail.originalEvent,p=x.button===0&&x.ctrlKey===!0,v=x.button===2||p;a.current=v},{checkForDefaultPrevented:!1}),onFocusOutside:_(o.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),pt=u.forwardRef((o,n)=>{const l=y(P,o.__scopePopover),s=u.useRef(!1),r=u.useRef(!1);return e.jsx(ce,{...o,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{o.onCloseAutoFocus?.(a),a.defaultPrevented||(s.current||l.triggerRef.current?.focus(),a.preventDefault()),s.current=!1,r.current=!1},onInteractOutside:a=>{o.onInteractOutside?.(a),a.defaultPrevented||(s.current=!0,a.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const d=a.target;l.triggerRef.current?.contains(d)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&r.current&&a.preventDefault()}})}),ce=u.forwardRef((o,n)=>{const{__scopePopover:l,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:a,disableOutsidePointerEvents:d,onEscapeKeyDown:x,onPointerDownOutside:p,onFocusOutside:v,onInteractOutside:C,...m}=o,w=y(P,l),j=R(l);return Ne(),e.jsx(ke,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:a,children:e.jsx(Te,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:C,onEscapeKeyDown:x,onPointerDownOutside:p,onFocusOutside:v,onDismiss:()=>w.onOpenChange(!1),children:e.jsx(_e,{"data-state":ue(w.open),role:"dialog",id:w.contentId,...j,...m,ref:n,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),de="PopoverClose",xt=u.forwardRef((o,n)=>{const{__scopePopover:l,...s}=o,r=y(de,l);return e.jsx(X.button,{type:"button",...s,ref:n,onClick:_(o.onClick,()=>r.onOpenChange(!1))})});xt.displayName=de;var mt="PopoverArrow",ft=u.forwardRef((o,n)=>{const{__scopePopover:l,...s}=o,r=R(l);return e.jsx(Re,{...r,...s,ref:n})});ft.displayName=mt;function ue(o){return o?"open":"closed"}var ht=ne,gt=se,vt=le,pe=ie;const Ct=ht,wt=gt,xe=u.forwardRef(({className:o,align:n="center",sideOffset:l=4,...s},r)=>e.jsx(vt,{children:e.jsx(pe,{ref:r,align:n,sideOffset:l,className:Ae("z-50 w-72 rounded-md border border-neutral-200 bg-white p-4 text-neutral-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-50",o),...s})}));xe.displayName=pe.displayName;const V=["all","missing","owned"],W=["all",...Ye],yt=["default","recent","expansion-newest"],bt=tt,Pt=({cards:o,filters:n,setFilters:l,onFiltersChanged:s,visibleFilters:r,filtersDialog:a,share:d,missionsButton:x})=>{const{t:p}=E(["pages/collection","common/sets","common/packs","filters"]),v=te(),{setIsProfileDialogOpen:C}=Me(),m=t=>{l(c=>{const i={...c,...t},h=O(i);return s(h),i})},w=t=>m({search:t}),j=t=>m({allTextSearch:t}),B=t=>m({pack:t}),D=t=>m({rarity:t}),L=t=>m({owned:t}),O=t=>{let c=Be;if(t.deckbuildingMode&&(c=c.filter(i=>De.includes(i.rarity)||i.rarity==="P")),t.expansion!=="all"&&(c=c.filter(i=>i.expansion===t.expansion)),t.pack!=="all"&&(c=c.filter(i=>i.pack===t.pack||i.pack==="everypack")),t.owned!=="all"&&(t.owned==="owned"?c=c.filter(i=>i.collected):t.owned==="missing"&&(c=c.filter(i=>!i.collected))),t.sortBy==="recent")c=[...c].sort((i,h)=>{const g=o.get(i.internal_id)?.updated_at,f=o.get(h.internal_id)?.updated_at;return g&&f?new Date(f).getTime()-new Date(g).getTime():g&&!f?-1:1});else if(t.sortBy==="expansion-newest"){const i=[...Le].reverse();c=[...c].sort((h,g)=>{const f=i.findIndex(k=>k.id===h.expansion),N=i.findIndex(k=>k.id===g.expansion);return f!==N?f-N:h.card_id.localeCompare(g.card_id,U.language||"en",{numeric:!0})})}c=c.filter(i=>t.rarity.length===0?!0:t.rarity.includes(i.rarity)),c=c.filter(i=>t.cardType.length===0?!0:i.card_type.toLowerCase()==="trainer"?t.cardType.includes("trainer"):t.cardType.includes(i.energy)),t.search&&(c=c.filter(h=>{const g=$e(h,U.language).toLowerCase(),f=t.search.toLowerCase();let N=!1;t.allTextSearch&&(N=h.ability&&(h.ability.name.toLowerCase().includes(f)||h.ability.effect.toLowerCase().includes(f))||h.attacks.some(F=>F.name?.toLowerCase().includes(f)||F.effect?.toLowerCase()!=="no effect"&&F.effect?.toLowerCase()?.includes(f)));const k=g.includes(f),fe=at(g,f)<=2,he=h.card_id.toLowerCase().includes(f);return N||k||fe||he}));for(const i of c)t.deckbuildingMode?i.amount_owned=i.alternate_versions.reduce((h,g)=>{const f=ze(g);return h+(o.get(f?.internal_id||0)?.amount_owned??0)},0):i.amount_owned=o.get(i.internal_id)?.amount_owned??0,i.collected=o.get(i.internal_id)?.collection.includes(i.card_id)??!1;return c=c.filter(i=>(i.amount_owned??0)>=t.minNumber),t.maxNumber!==100&&(c=c.filter(i=>(i.amount_owned??0)<=t.maxNumber)),c},$=u.useMemo(()=>O(n),[n,o]),A=u.useMemo(()=>{const t=G(n.expansion);if(!(!t||t.packs.length<=1))return["all",...t.packs.map(c=>c.name).filter(c=>c!=="everypack")]},[n.expansion]);u.useEffect(()=>{s($)},[]);function z(t){m({expansion:t,pack:"all"})}const H=t=>{const c=t==="all"?"all":G(t)?.name??"unknown";return p(c,{ns:"common/sets"})};function me(t){return t==="trainer"?"T":e.jsx("img",{src:`/images/energy/${t}.webp`,alt:t,className:"h-4"})}return e.jsxs("div",{id:"filterbar",className:"flex flex-col gap-x-2 flex-wrap",children:[r?.expansions&&e.jsxs("div",{className:"flex gap-x-2 px-4 mb-2",children:[e.jsx(T,{label:p("expansion",{ns:"common/sets"}),options:W,value:n.expansion,onChange:z,show:H}),A&&e.jsx(M,{options:A,value:n.pack,onChange:B,show:t=>p(t,{ns:"common/packs"})})]}),e.jsxs("div",{className:"gap-2 flex-row gap-y-1 px-4 flex",children:[r?.search&&e.jsx(Q,{className:"w-full sm:w-32",setSearchValue:w}),r?.owned&&e.jsx(M,{options:V,value:n.owned,onChange:L,show:t=>p(t,{ns:"filters",keyPrefix:"f-owned"})}),r?.rarity&&e.jsxs(Ct,{children:[e.jsx(wt,{asChild:!0,children:e.jsxs(b,{variant:"outline",children:[p("rarity",{ns:"filters"})," (",n.rarity.length,")"]})}),e.jsx(xe,{className:"w-28",children:e.jsx(K,{className:"flex-col bg-transparent",rarityFilter:n.rarity,setRarityFilter:D,deckbuildingMode:n.deckbuildingMode})})]}),a&&e.jsxs(Se,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(b,{variant:"outline",children:p("filters.allFilters")})}),e.jsxs(Fe,{className:"border-1 border-neutral-700 shadow-none max-h-[90vh] overflow-y-auto content-start",children:[e.jsx(Ee,{children:e.jsx(Ie,{children:p("filters.filtersCount",{count:($||[]).length})})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[a.search&&e.jsx(Q,{className:"w-full bg-neutral-900",setSearchValue:w}),a.allTextSearch&&e.jsx(rt,{allTextSearch:n.allTextSearch,setAllTextSearch:j}),a.expansions&&e.jsx(T,{className:"bg-neutral-900",label:p("expansion",{ns:"common/sets"}),options:W,value:n.expansion,onChange:z,show:H}),a.pack&&A&&e.jsx(M,{className:"w-full bg-neutral-900",options:A,value:n.pack,onChange:B,show:t=>p(t,{ns:"common/packs"})}),a.rarity&&e.jsx(K,{className:"bg-neutral-900",rarityFilter:n.rarity,setRarityFilter:D,deckbuildingMode:n.deckbuildingMode}),a.cardType&&e.jsx(et,{className:"bg-neutral-900",options:bt,value:n.cardType,onChange:t=>m({cardType:t}),show:me}),a.owned&&e.jsx(M,{className:"w-full bg-neutral-900",options:V,value:n.owned,onChange:L,show:t=>p(t,{ns:"filters",keyPrefix:"f-owned"})}),a.sortBy&&e.jsx(T,{className:"bg-neutral-900",label:p("f-sortBy.sortBy",{ns:"filters"}),options:yt,value:n.sortBy,onChange:t=>m({sortBy:t}),show:t=>p(`f-sortBy.${t}`,{ns:"filters"})}),a.amount&&e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"bg-neutral-900",label:p("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:n.minNumber,onChange:t=>m({minNumber:t})}),e.jsx(T,{className:"bg-neutral-900",label:p("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:n.maxNumber,onChange:t=>m({maxNumber:t})})]}),a.deckBuildingMode&&e.jsx(qe,{deckbuildingMode:n.deckbuildingMode,setDeckbuildingMode:t=>m({deckbuildingMode:t})}),e.jsx(b,{variant:"outline",className:"!text-red-700",onClick:()=>{const t={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1},c=O(t);s(c),l(t)},children:p("filters.clear")}),x&&e.jsx(b,{className:"mt-2",variant:"outline",onClick:()=>v("/collection/missions"),children:p("goToMissions")})]})]})]}),d&&e.jsx(b,{variant:"outline",onClick:()=>C(!0),children:p("filters.share")})]})]})};function q({cards:o,isPublic:n,extraOffset:l}){const s=Ze({query:"(max-width: 767px)"}),[r,a]=u.useState(null),[d,x]=u.useState({search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1}),[p,v]=u.useState(!1);return u.useEffect(()=>{v(!0);const C=setTimeout(()=>v(!1),100);return()=>clearTimeout(C)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(Pt,{cards:o,filters:d,setFilters:x,onFiltersChanged:C=>a(C),visibleFilters:{expansions:!s,allTextSearch:!s,search:!0,owned:!s,rarity:!s},filtersDialog:{expansions:!0,pack:!0,search:!0,owned:!0,sortBy:!0,rarity:!0,cardType:!0,amount:!0,deckBuildingMode:!0,allTextSearch:!0},missionsButton:!n,share:!0}),r&&e.jsx(Je,{cards:r,resetScrollTrigger:p,showStats:!d.deckbuildingMode,extraOffset:l,editable:!d.deckbuildingMode&&!n,groupExpansions:d.sortBy!=="recent"})]})}function It(){const{t:o}=E(["pages/collection","common"]),{friendId:n}=He(),l=te(),{data:s}=Ge(n),{data:r}=Ue(n),{data:a=new Map,isLoading:d}=Ke();return n?s===null?e.jsx("p",{className:"text-xl text-center py-8",children:o("common:noAccount")}):r===null?e.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):r===void 0||s===void 0?e.jsxs("p",{className:"text-xl text-center py-8",children:[o("common:loading"),"..."]}):e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs(Qe,{className:"mb-4 border-1 border-neutral-700 shadow-none",children:[e.jsx(nt,{className:"h-4 w-4"}),e.jsx(Ve,{children:o("publicCollectionTitle",{username:s?.username})}),e.jsx(We,{children:e.jsxs("div",{className:"flex items-center",children:[o("publicCollectionDescription"),e.jsx(b,{className:"mb-4",onClick:()=>l(`/trade/${s?.friend_id}`),children:o("showPossibleTrades")})]})})]}),e.jsx(q,{cards:r,isPublic:!0,extraOffset:136})]}):d?e.jsxs("p",{className:"text-xl text-center py-8",children:[o("common:loading"),"..."]}):e.jsx("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:e.jsx(q,{cards:a,isPublic:!1,extraOffset:20})})}export{It as default};
