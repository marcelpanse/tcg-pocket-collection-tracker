import{e as T,u as y,z as L,o as A,r as f,j as e,B as N,L as P,A as O,C as _,S as B,D,E,F as I,G as q,H as R,J as $,K as F,M as G,N as H}from"./index-Bk18c1qm.js";import{A as U,a as z,b as J}from"./alert-OrSYDZyn.js";import{u as K}from"./index-WQWbeFQo.js";import{C as Q}from"./Card-DvjtfyBa.js";import{C as V}from"./CardsTable-KW-YJn--.js";import{F as W,g as X,s as Y,o as Z,c as ee,e as se}from"./FiltersPanel-COIhWoy2.js";import{M as te}from"./react-tooltip.min-oauS1XLg.js";import{T as ne}from"./trash-2-7oevKQem.js";import{S as ae}from"./siren-oCZTrhGi.js";import"./Filters-CQfpdT0s.js";import"./utils-JtfY1ExW.js";import"./FancyCard-RTXhWqaZ.js";import"./SearchInput-ChtlLu1r.js";import"./index-BXLfMSBe.js";const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ie=T("circle-alert",re);function v({cards:s,filters:t,setFilters:a,clearFilters:i,share:r,missions:d}){const{t:x}=y("pages/collection"),{setIsProfileDialogOpen:h}=L(),{data:w=new Map}=A();async function c(){r?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),O({title:"Copied to clipboard",variant:"default"})):h(!0)}const j=f.useMemo(()=>{let u=0;const p=new Set;for(const n of s)n.collected&&!p.has(n.internal_id)&&(u+=n.amount_owned||0,p.add(n.internal_id));return u},[s]),g=f.useMemo(()=>(w?.get(83654)?.amount_owned??0)>0,[s]);return e.jsxs("div",{className:"flex flex-col h-fit gap-2",children:[e.jsxs("small",{className:"flex gap-2",children:[x("stats.summary",{selected:s.length,uniquesOwned:s.filter(u=>!!u.collected).length,totalOwned:j}),g&&e.jsxs(e.Fragment,{children:[e.jsx(te,{id:"mewCardOwned",className:"text-start max-w-72",clickable:!0}),e.jsx(ie,{className:"h-5 w-5","data-tooltip-id":"mewCardOwned","data-tooltip-content":x("stats.mewCardOwned")})]})]}),e.jsx(W,{className:"flex flex-col gap-y-3",filters:t,setFilters:a,clearFilters:i}),e.jsxs("div",{className:"flex flex-col mt-4 gap-2",children:[r!==void 0&&e.jsx(N,{variant:"outline",onClick:c,children:x("filters.share")}),d&&e.jsx(P,{className:"w-full",to:"/collection/missions",children:e.jsx(N,{className:"w-full",variant:"outline",children:x("goToMissions")})})]})]})}const C=s=>{const t=Number(s);return Number.isNaN(t)?void 0:t},k=s=>s==="true"?!0:s==="false"?!1:void 0,oe={search:s=>s,expansion:s=>se.includes(s)?s:void 0,pack:s=>s,cardType:s=>s.split(",").filter(t=>ee.includes(t)),rarity:s=>s.split(",").filter(t=>q.includes(t)),owned:s=>Z.includes(s)?s:void 0,sortBy:s=>Y.includes(s)?s:void 0,minNumber:C,maxNumber:C,deckbuildingMode:k,allTextSearch:k},S={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1};function M({children:s,cards:t,isPublic:a,share:i}){const r=K({query:"(max-width: 767px)"}),[d,x]=f.useState(!1),[h,w]=_(),c=f.useMemo(()=>{const n={...S},m=(o,l)=>{const b=oe[o](l);b!==void 0&&(n[o]=b)};for(const o in n){const l=h.get(o);l!=null&&m(o,l)}return n},[h]),j=n=>{const m=new URLSearchParams(h);for(const o in n){const l=n[o];l==null||l==="all"||Array.isArray(l)&&l.length===0||l===""?m.delete(o):Array.isArray(l)?m.set(o,l.join(",")):m.set(o,String(l)),w(m)}},g=()=>w(new URLSearchParams),u=f.useMemo(()=>{let n=0;for(const m in c){const o=m;c[o]!==S[o]&&n++}return n},[c]),p=f.useMemo(()=>X(c,t),[c,t]);return e.jsxs("div",{className:"flex justify-center gap-2 xl:gap-8 px-1",children:[r?e.jsx(B,{open:d,onOpenChange:x,children:e.jsxs(D,{side:"left",className:"w-full",children:[e.jsx(E,{children:e.jsx(I,{children:"Filters"})}),e.jsx(v,{cards:p,filters:c,setFilters:j,clearFilters:g,share:i,missions:!a})]})}):e.jsx("div",{className:"w-80",children:e.jsx(v,{cards:p,filters:c,setFilters:j,clearFilters:g,share:i,missions:!a})}),e.jsxs("div",{className:"w-full max-w-[900px]",children:[r&&e.jsxs("div",{className:"h-9 flex overflow-hidden text-center rounded-md text-sm font-medium border shadow-sm border-neutral-700 divide-x divide-neutral-700 [&>*]:cursor-pointer [&>*]:hover:bg-neutral-600 [&>*]:hover:text-neutral-50",children:[e.jsxs("button",{type:"button",className:"flex-1",onClick:()=>x(!0),children:["Filters",u>0&&` (${u})`]}),u>0&&e.jsx("button",{type:"button",className:"group px-2",onClick:g,children:e.jsx(ne,{className:"stroke-neutral-200 group-hover:stroke-neutral-50"})})]}),e.jsx(V,{cards:p,groupExpansions:c.sortBy!=="recent",render:n=>e.jsx(Q,{card:n,editable:!c.deckbuildingMode&&!a}),children:s})]})]})}function le(){const{t:s}=y("common"),{data:t,isLoading:a}=F(),{data:i=new Map,isLoading:r}=A();return a&&r?e.jsx("p",{className:"text-xl text-center py-8",children:s("common:loading")}):e.jsx(M,{cards:i,isPublic:!1,share:t!==void 0&&t.friend_id!==""&&t.is_public})}function ce({friendId:s}){const{t}=y(["pages/collection","common"]),{data:a,isLoading:i}=G(s),{data:r,isLoading:d}=H(s);return i||d?e.jsx("p",{className:"text-xl text-center py-8",children:t("common:loading")}):a===void 0||r===void 0?e.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):a===null?e.jsx("p",{className:"text-xl text-center py-8",children:t("common:noAccount")}):r===null?e.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):e.jsx("div",{className:"flex flex-col gap-y-1",children:e.jsx(M,{cards:r,isPublic:!0,children:e.jsxs(U,{className:"mb-1 border-1 border-neutral-700 shadow-none",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(z,{children:t("publicCollectionTitle",{username:a.username})}),e.jsx(J,{children:e.jsxs("div",{className:"flex items-center",children:[t("publicCollectionDescription"),e.jsx(P,{to:`/trade/${s}`,children:e.jsx(N,{className:"mb-4",children:t("showPossibleTrades")})})]})})]})})})}function Ce(){const{t:s}=y(["pages/collection","common"]),t=R(),{friendId:a}=$(),{data:i,isLoading:r}=F();if(f.useEffect(()=>{!a&&!r&&i?.friend_id&&t(`/collection/${i.friend_id}`,{replace:!0})},[r,a,i?.friend_id,t]),r)return e.jsx("p",{className:"text-xl text-center py-8",children:s("common:loading")});const d=a??i?.friend_id;return d&&d!==i?.friend_id?e.jsx(ce,{friendId:d}):e.jsx(le,{})}export{Ce as default};
