import{j as a}from"./query-vendor-DpGHCXpY.js";import{c as h,a as b,s as _,u as $,hm as D,w as N,g as E,k as R,l as B,m as O,n as F,o as y,hl as P,hi as A,hj as L,hk as M,h6 as U,gU as z,B as w,hn as C}from"./index-CQ4HdQn1.js";import{u as H,i as v}from"./i18n-vendor-DDmeScd6.js";import{r as u,L as V}from"./react-vendor-DjlsVz29.js";import{M as Q,C as W}from"./react-tooltip.min-DUiW2uQQ.js";import{C as q}from"./Card-DGfgHgV-.js";import{A as G,B as J,E as K}from"./ui-vendor-9yhwxkpr.js";import{b as X}from"./stats-vYPa41UU.js";import"./charts-vendor-D-Ae2kUX.js";import"./supabase-vendor-CP3OYKhD.js";import"./xlsx-vendor-De4COjWB.js";import"./index-5ziEWJdO.js";import"./FancyCard-DHxjc4yt.js";import"./trash-2-jzFvfHp5.js";import"./plus-C1m3bVMV.js";const Y=G;function Z(s){const e=h.c(8);let i,r;e[0]!==s?({className:i,...r}=s,e[0]=s,e[1]=i,e[2]=r):(i=e[1],r=e[2]);let n;e[3]!==i?(n=b("w-4 h-4 mr-2 rounded-full bg-neutral-700 hover:bg-neutral-500",i),e[3]=i,e[4]=n):n=e[4];let o;return e[5]!==r||e[6]!==n?(o=a.jsx(J,{className:n,...r}),e[5]=r,e[6]=n,e[7]=o):o=e[7],o}function ee(s){const e=h.c(8);let i,r;e[0]!==s?({className:i,...r}=s,e[0]=s,e[1]=i,e[2]=r):(i=e[1],r=e[2]);let n;e[3]!==i?(n=b("w-2 h-2 mx-1 xm-auto my-auto rounded-full flex bg-neutral-300",i),e[3]=i,e[4]=n):n=e[4];let o;return e[5]!==r||e[6]!==n?(o=a.jsx(K,{className:n,...r}),e[5]=r,e[6]=n,e[7]=o):o=e[7],o}function c(s){const e=h.c(5),{name:i,children:r}=s;let n;e[0]!==i?(n=a.jsx("strong",{className:"block min-w-[175px]",children:i}),e[0]=i,e[1]=n):n=e[1];let o;return e[2]!==r||e[3]!==n?(o=a.jsxs("p",{className:"flex",children:[n,r]}),e[2]=r,e[3]=n,e[4]=o):o=e[4],o}function fe(){const{t:s}=H(["pages/card-detail","common/types","common/packs","common/sets"]),{selectedCardId:e,setSelectedCardId:i}=_(),{data:r=new Map}=$(),n=D(),[o,f]=u.useState(!1),[k,x]=u.useState(!1),t=e===void 0?void 0:N(e),d=e===void 0?void 0:r.get(e),p=t?.alternate_versions.map(l=>({card:N(l),amount_owned:r.get(l)?.amount_owned??0})),m=t&&E(t.expansion);if(u.useEffect(()=>{e&&f(!0)},[e]),e&&!t)return console.log(`Unrecognized card id: ${e}`),null;if(t&&!m)return console.log(`Unrecognized expansion: ${t.expansion}`),null;const j=t?.pack==="everypack"?m?.packs[0].name:t?.pack,I=l=>new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"long"}).format(l),S=l=>{e&&d?.collection.includes(l)&&n.mutate({cardId:l})},g=l=>{l||(f(l),setTimeout(()=>i(void 0),300))};return a.jsx(R,{open:!!e&&o,onOpenChange:g,children:a.jsxs(B,{className:"transition-all duration-300 ease-in-out border-slate-600 overflow-y-auto w-full md:w-[725px]",children:[a.jsx(O,{children:a.jsxs(F,{children:[t&&y(t,v.language)," ",t?.rarity]})}),a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("div",{className:"px-10 py-4 w-full",children:a.jsx("div",{className:"cursor-pointer",children:t&&a.jsx(q,{className:"w-full",card:{...t,amount_owned:d?.amount_owned||0},onImageClick:()=>x(!0)})})}),a.jsxs(P,{open:k,onOpenChange:x,children:[a.jsx(A,{className:"hidden",children:a.jsx(L,{children:"Card image dialog"})}),a.jsx(M,{className:"flex items-center justify-center p-0 max-w-3xl max-h-[90vh]",children:t?.image&&a.jsx("img",{src:t.image,alt:y(t,v.language),className:"w-full h-full object-scale-down",onClick:()=>x(!1)})})]}),a.jsxs("div",{className:"p-4 w-full",children:[a.jsxs("div",{className:"mb-3",children:[a.jsx("h2",{className:"text-xl font-semibold",children:s("text.alternateVersions")}),p&&a.jsxs(Y,{className:"w-fit",value:String(e),onValueChange:l=>i(Number(l)),children:[p.map(l=>a.jsxs("label",{className:"flex items-center cursor-pointer",htmlFor:`radio-${l.card.card_id}`,children:[a.jsx(Z,{id:`radio-${l.card.card_id}`,value:String(l.card.internal_id),children:a.jsx(ee,{})}),a.jsx(z,{className:"w-auto bg-transparent",card_id:l.card.card_id,rarity:"w-14",name:"hidden",details:"hidden",amount:"pl-4"})]},l.card.card_id)),a.jsxs("p",{className:"flex items-baseline mt-1",children:[a.jsxs("span",{className:"mr-4",children:[s("text.totalAmount"),":"]}),a.jsxs("span",{className:"text-neutral-400 ml-auto mr-2",children:["Ã—",p?.reduce((l,T)=>l+T.amount_owned,0)]})]})]})]}),t?.rarity&&U.includes(t.rarity)&&a.jsx(V,{to:`/trade/matches/results?card_id=${t?.internal_id}`,onClick:()=>g(!1),children:a.jsx(w,{children:"Find trades"})}),a.jsxs("div",{className:"mt-8",children:[a.jsx(c,{name:s("text.expansion"),children:t?.expansion}),a.jsx(c,{name:s("text.pack"),children:t&&s(t.pack,{ns:"common/packs"})}),a.jsx(c,{name:"Energy",children:t?.energy}),a.jsx(c,{name:s("text.weakness"),children:t&&s(t.weakness,{ns:"common/types"})||"N/A"}),t?.hp&&a.jsx(c,{name:s("text.hp"),children:t?.hp}),t?.retreat&&a.jsx(c,{name:s("text.retreat"),children:t.retreat}),a.jsx(c,{name:s("text.ability"),children:t?.ability?.name??a.jsx("i",{children:"None"})}),t?.ability&&a.jsx(c,{name:s("text.abilityEffect"),children:t?.ability.effect}),a.jsx(c,{name:s("text.cardType"),children:t&&s(`cardType.${t.card_type}`)}),a.jsx(c,{name:s("text.evolutionType"),children:t&&s(`evolutionType.${t.evolution_type}`)}),m&&j&&t&&t.rarity!=="P"&&a.jsxs(c,{name:s("text.chanceToPull"),children:[t&&X(m,j,t).toFixed(2),"%"]}),t&&C[t.rarity]&&a.jsx(c,{name:s("text.craftingCost"),children:C[t.rarity]}),a.jsx(c,{name:s("text.artist"),children:t?.artist})]}),!!d?.collection?.length&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"flex items-center gap-2 mt-6 mb-1",children:[a.jsx("span",{children:"Collected in"}),a.jsx(Q,{id:"minInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),a.jsx(W,{className:"h-4 w-4","data-tooltip-id":"minInput","data-tooltip-content":s("text.uncollectTooltip")})]}),a.jsx("div",{className:"flex flex-col gap-1 w-fit",children:d?.collection.map(l=>a.jsxs(w,{variant:"destructive",className:"mr-auto min-w-48 w-full",onClick:()=>S(l),disabled:n.isPending,isPending:n.isPending,children:[s("text.uncollect")," ",l]},l))})]}),a.jsxs("p",{className:"mt-4 text-neutral-400 text-sm flex",children:[a.jsx("strong",{className:"font-semibold mr-1",children:s("text.updated")})," ",d?.updated_at?I(d.updated_at):"N/A"]})]})]})]})})}export{fe as default};
