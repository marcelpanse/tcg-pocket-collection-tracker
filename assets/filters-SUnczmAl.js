import{r as w,o as T,X as k,a5 as F,a6 as R,x,v as M,J as A,U as D,ar as L}from"./index-DskfJr1K.js";function v(i,l,n){let t=n.initialDeps??[],e;function s(){var o,r,a,c;let h;n.key&&((o=n.debug)!=null&&o.call(n))&&(h=Date.now());const d=i();if(!(d.length!==t.length||d.some((f,g)=>t[g]!==f)))return e;t=d;let m;if(n.key&&((r=n.debug)!=null&&r.call(n))&&(m=Date.now()),e=l(...d),n.key&&((a=n.debug)!=null&&a.call(n))){const f=Math.round((Date.now()-h)*100)/100,g=Math.round((Date.now()-m)*100)/100,y=g/16,b=(p,I)=>{for(p=String(p);p.length<I;)p=" "+p;return p};console.info(`%câ± ${b(g,5)} /${b(f,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,n?.key)}return(c=n?.onChange)==null||c.call(n,e),e}return s.updateDeps=o=>{t=o},s}function C(i,l){if(i===void 0)throw new Error("Unexpected undefined");return i}const W=(i,l)=>Math.abs(i-l)<1.01,N=(i,l,n)=>{let t;return function(...e){i.clearTimeout(t),t=i.setTimeout(()=>l.apply(this,e),n)}},S=i=>{const{offsetWidth:l,offsetHeight:n}=i;return{width:l,height:n}},B=i=>i,j=i=>{const l=Math.max(i.startIndex-i.overscan,0),n=Math.min(i.endIndex+i.overscan,i.count-1),t=[];for(let e=l;e<=n;e++)t.push(e);return t},P=(i,l)=>{const n=i.scrollElement;if(!n)return;const t=i.targetWindow;if(!t)return;const e=o=>{const{width:r,height:a}=o;l({width:Math.round(r),height:Math.round(a)})};if(e(S(n)),!t.ResizeObserver)return()=>{};const s=new t.ResizeObserver(o=>{const r=()=>{const a=o[0];if(a?.borderBoxSize){const c=a.borderBoxSize[0];if(c){e({width:c.inlineSize,height:c.blockSize});return}}e(S(n))};i.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()});return s.observe(n,{box:"border-box"}),()=>{s.unobserve(n)}},E={passive:!0},z=typeof window>"u"?!0:"onscrollend"in window,V=(i,l)=>{const n=i.scrollElement;if(!n)return;const t=i.targetWindow;if(!t)return;let e=0;const s=i.options.useScrollendEvent&&z?()=>{}:N(t,()=>{l(e,!1)},i.options.isScrollingResetDelay),o=h=>()=>{const{horizontal:d,isRtl:u}=i.options;e=d?n.scrollLeft*(u&&-1||1):n.scrollTop,s(),l(e,h)},r=o(!0),a=o(!1);a(),n.addEventListener("scroll",r,E);const c=i.options.useScrollendEvent&&z;return c&&n.addEventListener("scrollend",a,E),()=>{n.removeEventListener("scroll",r),c&&n.removeEventListener("scrollend",a)}},U=(i,l,n)=>{if(l?.borderBoxSize){const t=l.borderBoxSize[0];if(t)return Math.round(t[n.options.horizontal?"inlineSize":"blockSize"])}return i[n.options.horizontal?"offsetWidth":"offsetHeight"]},$=(i,{adjustments:l=0,behavior:n},t)=>{var e,s;const o=i+l;(s=(e=t.scrollElement)==null?void 0:e.scrollTo)==null||s.call(e,{[t.options.horizontal?"left":"top"]:o,behavior:n})};class q{constructor(l){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let n=null;const t=()=>n||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:n=new this.targetWindow.ResizeObserver(e=>{e.forEach(s=>{const o=()=>{this._measureElement(s.target,s)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var e;(e=t())==null||e.disconnect(),n=null},observe:e=>{var s;return(s=t())==null?void 0:s.observe(e,{box:"border-box"})},unobserve:e=>{var s;return(s=t())==null?void 0:s.unobserve(e)}}})(),this.range=null,this.setOptions=n=>{Object.entries(n).forEach(([t,e])=>{typeof e>"u"&&delete n[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:B,rangeExtractor:j,onChange:()=>{},measureElement:U,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...n}},this.notify=n=>{var t,e;(e=(t=this.options).onChange)==null||e.call(t,this,n)},this.maybeNotify=v(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),n=>{this.notify(n)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(n=>n()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var n;const t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t){this.maybeNotify();return}this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((n=this.scrollElement)==null?void 0:n.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,s)=>{this.scrollAdjustments=0,this.scrollDirection=s?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=s,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(n,t)=>{const e=new Map,s=new Map;for(let o=t-1;o>=0;o--){const r=n[o];if(e.has(r.lane))continue;const a=s.get(r.lane);if(a==null||r.end>a.end?s.set(r.lane,r):r.end<a.end&&e.set(r.lane,!0),e.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,r)=>o.end===r.end?o.index-r.index:o.end-r.end)[0]:void 0},this.getMeasurementOptions=v(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(n,t,e,s,o)=>(this.pendingMeasuredCacheIndexes=[],{count:n,paddingStart:t,scrollMargin:e,getItemKey:s,enabled:o}),{key:!1}),this.getMeasurements=v(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:n,paddingStart:t,scrollMargin:e,getItemKey:s,enabled:o},r)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(h=>{this.itemSizeCache.set(h.key,h.size)}));const a=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const c=this.measurementsCache.slice(0,a);for(let h=a;h<n;h++){const d=s(h),u=this.options.lanes===1?c[h-1]:this.getFurthestMeasurement(c,h),m=u?u.end+this.options.gap:t+e,f=r.get(d),g=typeof f=="number"?f:this.options.estimateSize(h),y=m+g,b=u?u.lane:h%this.options.lanes;c[h]={index:h,start:m,size:g,end:y,key:d,lane:b}}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=v(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(n,t,e,s)=>this.range=n.length>0&&t>0?H({measurements:n,outerSize:t,scrollOffset:e,lanes:s}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=v(()=>{let n=null,t=null;const e=this.calculateRange();return e&&(n=e.startIndex,t=e.endIndex),this.maybeNotify.updateDeps([this.isScrolling,n,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,n,t]},(n,t,e,s,o)=>s===null||o===null?[]:n({startIndex:s,endIndex:o,overscan:t,count:e}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=n=>{const t=this.options.indexAttribute,e=n.getAttribute(t);return e?parseInt(e,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(n,t)=>{const e=this.indexFromElement(n),s=this.measurementsCache[e];if(!s)return;const o=s.key,r=this.elementsCache.get(o);r!==n&&(r&&this.observer.unobserve(r),this.observer.observe(n),this.elementsCache.set(o,n)),n.isConnected&&this.resizeItem(e,this.options.measureElement(n,t,this))},this.resizeItem=(n,t)=>{const e=this.measurementsCache[n];if(!e)return;const s=this.itemSizeCache.get(e.key)??e.size,o=t-s;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(e,o,this):e.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(e.index),this.itemSizeCache=new Map(this.itemSizeCache.set(e.key,t)),this.notify(!1))},this.measureElement=n=>{if(!n){this.elementsCache.forEach((t,e)=>{t.isConnected||(this.observer.unobserve(t),this.elementsCache.delete(e))});return}this._measureElement(n,void 0)},this.getVirtualItems=v(()=>[this.getVirtualIndexes(),this.getMeasurements()],(n,t)=>{const e=[];for(let s=0,o=n.length;s<o;s++){const r=n[s],a=t[r];e.push(a)}return e},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=n=>{const t=this.getMeasurements();if(t.length!==0)return C(t[_(0,t.length-1,e=>C(t[e]).start,n)])},this.getOffsetForAlignment=(n,t,e=0)=>{const s=this.getSize(),o=this.getScrollOffset();t==="auto"&&(t=n>=o+s?"end":"start"),t==="center"?n+=(e-s)/2:t==="end"&&(n-=s);const r=this.getTotalSize()+this.options.scrollMargin-s;return Math.max(Math.min(r,n),0)},this.getOffsetForIndex=(n,t="auto")=>{n=Math.max(0,Math.min(n,this.options.count-1));const e=this.measurementsCache[n];if(!e)return;const s=this.getSize(),o=this.getScrollOffset();if(t==="auto")if(e.end>=o+s-this.options.scrollPaddingEnd)t="end";else if(e.start<=o+this.options.scrollPaddingStart)t="start";else return[o,t];const r=t==="end"?e.end+this.options.scrollPaddingEnd:e.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(r,t,e.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(n,{align:t="start",behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(n,t),{adjustments:void 0,behavior:e})},this.scrollToIndex=(n,{align:t="auto",behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),n=Math.max(0,Math.min(n,this.options.count-1));let s=0;const o=10,r=c=>{if(!this.targetWindow)return;const h=this.getOffsetForIndex(n,c);if(!h){console.warn("Failed to get offset for index:",n);return}const[d,u]=h;this._scrollToOffset(d,{adjustments:void 0,behavior:e}),this.targetWindow.requestAnimationFrame(()=>{const m=this.getScrollOffset(),f=this.getOffsetForIndex(n,u);if(!f){console.warn("Failed to get offset for index:",n);return}W(f[0],m)||a(u)})},a=c=>{this.targetWindow&&(s++,s<o?this.targetWindow.requestAnimationFrame(()=>r(c)):console.warn(`Failed to scroll to index ${n} after ${o} attempts.`))};r(t)},this.scrollBy=(n,{behavior:t}={})=>{t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+n,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var n;const t=this.getMeasurements();let e;if(t.length===0)e=this.options.paddingStart;else if(this.options.lanes===1)e=((n=t[t.length-1])==null?void 0:n.end)??0;else{const s=Array(this.options.lanes).fill(null);let o=t.length-1;for(;o>=0&&s.some(r=>r===null);){const r=t[o];s[r.lane]===null&&(s[r.lane]=r.end),o--}e=Math.max(...s.filter(r=>r!==null))}return Math.max(e-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(n,{adjustments:t,behavior:e})=>{this.options.scrollToFn(n,{behavior:e,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(l)}}const _=(i,l,n,t)=>{for(;i<=l;){const e=(i+l)/2|0,s=n(e);if(s<t)i=e+1;else if(s>t)l=e-1;else return e}return i>0?i-1:0};function H({measurements:i,outerSize:l,scrollOffset:n,lanes:t}){const e=i.length-1,s=a=>i[a].start;if(i.length<=t)return{startIndex:0,endIndex:e};let o=_(0,e,s,n),r=o;if(t===1)for(;r<e&&i[r].end<n+l;)r++;else if(t>1){const a=Array(t).fill(0);for(;r<e&&a.some(h=>h<n+l);){const h=i[r];a[h.lane]=h.end,r++}const c=Array(t).fill(n+l);for(;o>=0&&c.some(h=>h>=n);){const h=i[o];c[h.lane]=h.start,o--}o=Math.max(0,o-o%t),r=Math.min(e,r+(t-1-r%t))}return{startIndex:o,endIndex:r}}const O=typeof document<"u"?w.useLayoutEffect:w.useEffect;function K(i){const l=w.useReducer(()=>({}),{})[1],n={...i,onChange:(e,s)=>{var o;s?T.flushSync(l):l(),(o=i.onChange)==null||o.call(i,e,s)}},[t]=w.useState(()=>new q(n));return t.setOptions(n),O(()=>t._didMount(),[]),O(()=>t._willUpdate()),t}function G(i){return K({observeElementRect:P,observeElementOffset:V,scrollToFn:$,...i})}function J(i,l){if(i.length===0)return l.length;if(l.length===0)return i.length;let n=Array(i.length+1).fill(0).map((e,s)=>s),t=Array(i.length+1);for(let e=1;e<=l.length;e++){t[0]=e;for(let s=1;s<=i.length;s++){const o=i[s-1]===l[e-1]?0:1;t[s]=Math.min(n[s]+1,t[s-1]+1,n[s-1]+o)}[n,t]=[t,n]}return n[i.length]}const Q=["all",...x],Y=["default","recent","expansion-newest"],Z=L,ee=["all","wanted","extra"];function te(i,l,n){let t=k;if(i.deckbuildingMode&&(t=t.filter(e=>e.internal_id===e.alternate_versions[0])),i.expansion!==void 0&&i.expansion!=="all"&&(t=t.filter(e=>e.expansion===i.expansion)),i.expansion!==void 0&&i.pack!==void 0&&i.pack!=="all"&&(t=t.filter(e=>e.pack===i.pack||e.pack==="everypack")),i.trading!==void 0&&i.trading!=="all"){if(!n)throw new Error("Cannot filter by trading status without trading settings");const e=new Set(i.trading==="wanted"?F(l,n):R(l,n));t=t.filter(s=>e.has(s.internal_id))}if(i.sortBy!==void 0&&(i.sortBy==="recent"?t=t.toSorted((e,s)=>{const o=l.get(e.internal_id)?.updated_at,r=l.get(s.internal_id)?.updated_at;return o&&r?new Date(r).getTime()-new Date(o).getTime():o&&!r?-1:1}):i.sortBy==="expansion-newest"&&(t=[...t].sort((e,s)=>e.expansion!==s.expansion?x.indexOf(e.expansion)-x.indexOf(s.expansion):e.card_id.localeCompare(s.card_id,M.language||"en",{numeric:!0})))),t=t.filter(e=>i.rarity===void 0||i.rarity.length===0?!0:i.rarity.includes(e.rarity)),t=t.filter(e=>i.cardType===void 0||i.cardType.length===0?!0:e.card_type.toLowerCase()==="trainer"?i.cardType.includes("trainer"):i.cardType.includes(e.energy.toLowerCase())),i.search){const e=i.search.toLowerCase(),s=2;t=t.filter(o=>{const r=A(o,M.language).toLowerCase();let a=!1;i.allTextSearch&&(a=o.ability&&(o.ability.name.toLowerCase().includes(e)||o.ability.effect.toLowerCase().includes(e))||o.attacks.some(u=>u.name?.toLowerCase().includes(e)||u.effect?.toLowerCase()!=="no effect"&&u.effect?.toLowerCase()?.includes(e)));const c=r.includes(e),h=J(r,e)<=s,d=o.card_id.toLowerCase().includes(e);return a||c||h||d})}for(const e of t){i.deckbuildingMode?e.amount_owned=e.alternate_versions.reduce((o,r)=>{const a=D(r);return o+(l.get(a?.internal_id||0)?.amount_owned??0)},0):e.amount_owned=l.get(e.internal_id)?.amount_owned??0;const s=l.get(e.internal_id);e.collected=s?.collection.includes(e.card_id)??!1,e.updated_at=s?.updated_at}if(i.minNumber!==void 0){const e=i.minNumber;t=t.filter(s=>(s.amount_owned??0)>=e)}if(i.maxNumber!==void 0&&i.maxNumber!==100){const e=i.maxNumber;t=t.filter(s=>(s.amount_owned??0)<=e)}return t}export{Z as c,Q as e,te as g,Y as s,ee as t,G as u};
