import{e as C,P as N,ab as f,aS as b,r as i,j as e,f as v,U as _,t as y,B as r,aU as w}from"./index-BmcotQxr.js";import{F as k}from"./FancyCard-BI9o79kO.js";import{T as I}from"./trash-2-BPt_9Rk2.js";const M=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],B=C("plus",M);function S({card:t,onImageClick:u,className:m,editable:p=!0}){const{setSelectedCardId:x}=N(),o=f(),l=b(),c=o.isPending||l.isPending,[s,h]=i.useOptimistic(t.amount_owned??0,(a,n)=>n),d=a=>{i.startTransition(async()=>{h(a);try{await o.mutateAsync({updates:[{card_id:t.card_id,internal_id:t.internal_id,amount_owned:a}]})}catch(n){console.log("Failed updating card count:",n)}})},g=i.useCallback(()=>{t.collected&&s===0?i.startTransition(async()=>{await l.mutateAsync({cardId:t.card_id})}):d(s-1)},[t.collected,t.card_id,s,l]),j=async a=>{const n=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(n)&&n>=0&&d(n)};return e.jsxs("div",{className:v("group flex flex-col items-center rounded-lg",m),children:[e.jsxs("button",{type:"button",className:"relative cursor-pointer",onClick:()=>{x(t.internal_id),u?.()},children:[e.jsx(k,{card:t,selected:!!t.collected&&!c}),c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full size-12 border-4 border-white border-t-transparent"})})]}),e.jsxs("p",{className:"w-full min-w-0 text-[12px] pt-2 text-center font-semibold leading-tight",title:t.updated_at?`Last update ${new Date(t.updated_at).toLocaleString()}`:void 0,children:[e.jsx("span",{className:"block md:inline",children:t.card_id}),e.jsx("span",{className:"hidden md:inline",children:" â€“ "}),e.jsx("span",{className:"block md:inline truncate",children:_(t,y.language)})]}),e.jsx("div",{className:"flex items-center gap-x-1",children:p?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:g,className:"rounded-full",tabIndex:-1,disabled:!t.collected&&s===0,title:s===0?"Remove from card dex":"Decrease amount",children:t.collected&&s===0?e.jsx(I,{}):e.jsx(w,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:s,onChange:j,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(r,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>d(s+1),tabIndex:-1,title:"Increase amount",children:e.jsx(B,{})})]}):e.jsx("span",{className:"mt-1",children:s})})]})}export{S as C};
