import{j as s,d as pe}from"./query-vendor-BtExsvmS.js";import{c as q,_ as ge,Z as _e,a as R,w as oe,x as je,y as Q,B as I,m as me,n as be,h as B,u as fe,p as V,z as ee,A as te,C as G,D as Ne,E as ye,l as ve,F as Ce,X as Te,G as ke,H as Se,J as we,K as ue,L as Ie,M as se,N as $e,O as Le,Q as Fe,I as re,r as Ae,t as ae}from"./index-B7pfeaGh.js";import{h as Ee,i as Me,r as F,L as J,u as Pe,j as ze,k as O,N as Oe,l as Re}from"./react-vendor-BHI5tqau.js";import{T as D,a as He,b as Be}from"./tabs-DPtFrGUk.js";import{F as xe}from"./friend-id-display-D0C_QcUi.js";import{C as H}from"./CardLine-CPqu-tZu.js";import{u as A,i as Ue}from"./i18n-vendor-Dl1_3pZV.js";import{C as X}from"./chevron-right-CqY4Yj2o.js";import{S as De}from"./SearchInput-BTGcleG6.js";import{g as Ve}from"./filters-CtEwLrQE.js";import{S as he,u as Ge,a as Ke,F as We,b as K,c as W,d as Y,e as Ye,f as Qe}from"./form-vxs93I8u.js";import{S as Ze}from"./ui-vendor-CC9RJ6yZ.js";import{M as Z,C as ne}from"./react-tooltip.min-CcFhWTa-.js";import{A as qe}from"./alert-f0j9_2CE.js";import"./charts-vendor-GpVpfCKE.js";import"./supabase-vendor-CP3OYKhD.js";import"./xlsx-vendor-De4COjWB.js";import"./index-DqUCnBUv.js";const Je=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Xe=q("arrow-left",Je);const et=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],tt=q("arrow-right-left",et);const st=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],rt=q("arrow-right",st);function ie(t){return ge(_e,t)}const de=t=>{const e=R.c(15),{cards:r,selected:l,setSelected:n}=t;let x,m,f;if(e[0]!==r||e[1]!==l?.card_id||e[2]!==n){const g=[...r].sort(nt);let p;e[6]!==l?.card_id||e[7]!==n?(p=function(i){const c=function(){l?.card_id===i.card_id?n(null):n(i)};return s.jsx("li",{className:"rounded cursor-pointer",onClick:c,children:s.jsx(H,{className:`w-full ${l?.card_id===i.card_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:i.card_id,rarity:"hidden"})},i.card_id)},e[6]=l?.card_id,e[7]=n,e[8]=p):p=e[8];const _=p;f="rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",x="space-y-1",m=g.map(_),e[0]=r,e[1]=l?.card_id,e[2]=n,e[3]=x,e[4]=m,e[5]=f}else x=e[3],m=e[4],f=e[5];let d;e[9]!==x||e[10]!==m?(d=s.jsx("ul",{className:x,children:m}),e[9]=x,e[10]=m,e[11]=d):d=e[11];let h;return e[12]!==f||e[13]!==d?(h=s.jsx("div",{className:f,children:d}),e[12]=f,e[13]=d,e[14]=h):h=e[14],h};function at(t){const e=t.split("-"),r=e[0]||"",l=e.length>1?parseInt(e[1],10):0;return{setName:r,cardNumber:l}}function nt(t,e){const r=at,l=r(t.card_id),n=r(e.card_id);return l.setName!==n.setName?l.setName.localeCompare(n.setName):l.cardNumber-n.cardNumber}function le(t){return t?s.jsx(H,{card_id:t.card_id,details:"hidden"}):"—"}const it=t=>{const e=R.c(45),{yourId:r,friendId:l,yourCard:n,friendCard:x,setYourCard:m,setFriendCard:f}=t,{t:d}=A("trade-matches"),{toast:h}=oe(),g=je(),p=n&&x&&n.rarity===x.rarity;let _;e[0]!==p||e[1]!==x||e[2]!==l||e[3]!==g||e[4]!==f||e[5]!==m||e[6]!==d||e[7]!==h||e[8]!==n||e[9]!==r?(_=async function(){if(!p)return;const $={offering_friend_id:r,receiving_friend_id:l,offer_card_id:n.card_id,receiver_card_id:x.card_id,status:"offered"};try{g.mutate($)}catch(E){console.log("TradeOffer: Error inserting trade",E),h({title:d("tradeFailed"),variant:"default"})}m(null),f(null),h({title:d("tradeOffered"),variant:"default"}),Q("Offer trade")},e[0]=p,e[1]=x,e[2]=l,e[3]=g,e[4]=f,e[5]=m,e[6]=d,e[7]=h,e[8]=n,e[9]=r,e[10]=_):_=e[10];const j=_;if(!n&&!x){let T;e[11]!==d?(T=d("selectCardsToTrade"),e[11]=d,e[12]=T):T=e[12];let $;return e[13]!==T?($=s.jsx("div",{className:"sticky top-0 z-10 flex rounded-lg border-1 bg-neutral-900 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[166px] sm:h-[110px]",children:s.jsx("h4",{className:"text-lg font-medium",children:T})}),e[13]=T,e[14]=$):$=e[14],$}let i;e[15]!==d?(i=d("youGive"),e[15]=d,e[16]=i):i=e[16];let c;e[17]!==i?(c=s.jsx("h4",{className:"text-lg font-medium",children:i}),e[17]=i,e[18]=c):c=e[18];let a;e[19]!==n?(a=le(n),e[19]=n,e[20]=a):a=e[20];let u;e[21]!==c||e[22]!==a?(u=s.jsxs("div",{className:"w-full sm:w-1/2",children:[c,a]}),e[21]=c,e[22]=a,e[23]=u):u=e[23];let o;e[24]!==d?(o=d("youReceive"),e[24]=d,e[25]=o):o=e[25];let N;e[26]!==o?(N=s.jsx("h4",{className:"text-lg font-medium",children:o}),e[26]=o,e[27]=N):N=e[27];let b;e[28]!==x?(b=le(x),e[28]=x,e[29]=b):b=e[29];let y;e[30]!==N||e[31]!==b?(y=s.jsxs("div",{className:"w-full sm:w-1/2",children:[N,b]}),e[30]=N,e[31]=b,e[32]=y):y=e[32];let v;e[33]!==u||e[34]!==y?(v=s.jsxs("div",{className:"flex flex-col sm:flex-row gap-x-4 gap-y-1 p-1",children:[u,y]}),e[33]=u,e[34]=y,e[35]=v):v=e[35];const k=!p;let S;e[36]!==d?(S=d("offerTrades"),e[36]=d,e[37]=S):S=e[37];let C;e[38]!==j||e[39]!==k||e[40]!==S?(C=s.jsx(I,{className:"block w-full sm:w-96 mx-auto mt-1 text-center",type:"button",variant:"outline",onClick:j,disabled:k,children:S}),e[38]=j,e[39]=k,e[40]=S,e[41]=C):C=e[41];let w;return e[42]!==v||e[43]!==C?(w=s.jsxs("div",{className:"sticky top-0 z-10 bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-1",children:[v,C]}),e[42]=v,e[43]=C,e[44]=w):w=e[44],w};function ce(t,e){const r=new Set(e),l=t.filter(n=>r.has(n)).map(n=>V(n)).filter(n=>G.includes(n.rarity)&&Ne.includes(n.expansion));return Object.groupBy(l,n=>n.rarity)}function dt(){const{t}=A(["trade-matches","common"]),{friendId:e}=Ee(),[r]=Me(),{data:l,isLoading:n,isError:x}=me(e),{data:m=new Map,isLoading:f,isError:d}=be(e),{data:h}=B(),{data:g=new Map}=fe(),[p,_]=F.useState(null),[j,i]=F.useState(()=>{const o=r.get("friend_card");return o?V(Number(o))??null:null});if(F.useEffect(()=>{const o=r.get("friend_card");if(!o||!m||!g)return;const N=V(Number(o));if(!N)return;const b=document.getElementById(N.rarity);b&&b.scrollIntoView({behavior:"smooth"})},[r,m,g]),!h)return null;if(l===null)return s.jsx("p",{className:"text-xl text-center py-8",children:t("notFound")});if(x||d)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(n||f)return s.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"});if(!l?.is_active_trading)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:l?.username})}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});const c=ce(te(g,h.trade_rarity_settings),ee(m,l.trade_rarity_settings)),a=ce(te(m,l.trade_rarity_settings),ee(g,h.trade_rarity_settings)),u=G.some(o=>(c[o]??[]).length>0&&(a[o]??[]).length>0);return s.jsxs("div",{className:"kap-4 justify-center w-full m-auto px-1 sm:px-2",children:[s.jsx("title",{children:`Trade with ${l.username} – TCG Pocket Collection Tracker`}),s.jsxs("div",{className:"mb-4 mx-1 flex justify-between",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"text-2xl font-light",children:t("tradingWith")}),s.jsxs("span",{className:"text-2xl font-bold",children:[" ",l.username," "]}),s.jsx("span",{className:"block sm:inline text-sm",children:s.jsx(xe,{friendId:l.friend_id})})]}),s.jsx(J,{to:`/collection/${e}`,children:s.jsxs(I,{children:["Collection",s.jsx(X,{})]})})]}),s.jsx(it,{yourId:h.friend_id,friendId:l.friend_id,yourCard:p,friendCard:j,setYourCard:_,setFriendCard:i}),!u&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}),G.map(o=>s.jsxs("div",{className:"mt-4",children:[s.jsxs("h3",{id:o,className:"text-xl font-semibold mb-2 text-center",children:["[ ",o," ]"]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("youHave")}),c[o]?s.jsx(de,{cards:c[o],selected:p,setSelected:_}):s.jsx("div",{className:"text-center text-neutral-500 rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]}),s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("friendHas")}),a[o]?s.jsx(de,{cards:a[o],selected:j,setSelected:i}):s.jsx("div",{className:"text-center text-neutral-500  rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]})]})]},o))]})}function lt(){const{t}=A(["trade-matches","common"]),e=F.useRef(null),[r,l]=F.useState(""),[n,x]=F.useState(),[m,f]=F.useState(!1),d=Ve({search:r,rarity:[...G]},new Map),h=n&&V(n),{data:g,isLoading:p,isError:_}=ye(m,n),j=pe({getScrollElement:()=>e.current,count:d.length,getItemKey:c=>d[c].card_id,estimateSize:()=>32});if(n&&!h)throw new Error("Card selected was not found in the database!");if(!m)return s.jsxs("div",{className:"sm:w-sm mx-auto",children:[s.jsx(De,{setValue:l}),s.jsx("div",{ref:e,className:"my-2 h-96 rounded border border-neutral-700 px-1 overflow-y-auto",children:s.jsx("ul",{style:{height:`${j.getTotalSize()}px`},className:"relative",children:j.getVirtualItems().map(c=>{const a=d[c.index];return s.jsx("button",{type:"button",className:"absolute top-0 left-0 w-full cursor-pointer",style:{height:`${c.size}px`,transform:`translateY(${c.start}px)`},onClick:()=>x(u=>u===a.internal_id?void 0:a.internal_id),children:s.jsx(H,{className:`w-full ${n===a.internal_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:a.card_id})},c.key)})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(I,{className:"w-1/2",disabled:!n,onClick:()=>{f(!0)},children:h?t("search.byCard",{cardName:ve(h,Ue.language)}):t("search.selectCard")}),s.jsx(I,{className:"w-1/2",onClick:()=>{x(void 0),f(!0)},children:t("search.allCards")})]})]});if(p)return s.jsxs("p",{className:"text-xl text-center py-8",children:[t("common:loading"),s.jsx("br",{}),t("longOperation")]});if(_||!g)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(g.length===0)return s.jsx("p",{className:"text-xl text-center py-8",children:t("noTradePartners")});const i=n?`?friend_card=${n}`:"";return s.jsx("div",{className:"flex flex-col gap-4",children:g.map(c=>s.jsxs("div",{className:"max-w-md w-full flex justify-between items-center mx-auto px-4",children:[s.jsx("p",{className:"mr-2",children:c.username}),s.jsx(J,{to:`/trade/${c.friend_id}${i}`,children:s.jsxs(I,{variant:"outline",className:"my-auto",children:[t("viewTradePartner",{tradeMatches:c.trade_matches}),s.jsx(X,{})]})})]},c.friend_id))})}const ct=t=>{const e=R.c(28),{row:r,selectedTradeId:l,setSelectedTradeId:n}=t,{t:x}=A("trade-matches"),{data:m,isLoading:f}=B();if(f)return null;if(!m){let y;e[0]!==x?(y=x("common:error"),e[0]=x,e[1]=y):y=e[1];let v;return e[2]!==y?(v=s.jsx("p",{className:"text-xl text-center py-8",children:y}),e[2]=y,e[3]=v):v=e[3],v}const d=r.offering_friend_id===m.friend_id?r.offer_card_id:r.receiver_card_id,h=r.offering_friend_id===m.friend_id?r.receiver_card_id:r.offer_card_id;let g;e[4]!==l||e[5]!==n?(g=function(v){l===v.id?n(void 0):n(v.id)},e[4]=l,e[5]=n,e[6]=g):g=e[6];const p=g;let _;e[7]!==m.friend_id||e[8]!==x?(_=y=>{const v={offered:y.offering_friend_id===m.friend_id?s.jsx(rt,{className:"bg-amber-600"}):s.jsx(Xe,{className:"bg-amber-600"}),accepted:s.jsx(tt,{className:"bg-lime-600"}),declined:s.jsx(Te,{className:"bg-stone-600"}),finished:s.jsx(Ce,{className:"bg-indigo-600"})};return s.jsxs(s.Fragment,{children:[s.jsx(Z,{id:`status-${y.id}`}),s.jsx(Ze,{className:"rounded-full p-[3px] my-auto","data-tooltip-id":`status-${y.id}`,"data-tooltip-content":x(`status.${y.status}`),children:v[y.status]})]})},e[7]=m.friend_id,e[8]=x,e[9]=_):_=e[9];const j=_,i=`flex cursor-pointer rounded gap-1 md:gap-2 p-1 ${l===r.id&&"bg-green-900"} hover:bg-neutral-500`;let c;e[10]!==p||e[11]!==r?(c=()=>p(r),e[10]=p,e[11]=r,e[12]=c):c=e[12];let a;e[13]!==r||e[14]!==j?(a=j(r),e[13]=r,e[14]=j,e[15]=a):a=e[15];let u;e[16]!==d?(u=s.jsx(H,{className:"md:w-1/2",card_id:d,increment:-1}),e[16]=d,e[17]=u):u=e[17];let o;e[18]!==h?(o=s.jsx(H,{className:"md:w-1/2",card_id:h,increment:1}),e[18]=h,e[19]=o):o=e[19];let N;e[20]!==u||e[21]!==o?(N=s.jsxs("div",{className:"flex flex-col md:flex-row grow-1 justify-between gap-1 md:gap-2",children:[u,o]}),e[20]=u,e[21]=o,e[22]=N):N=e[22];let b;return e[23]!==i||e[24]!==c||e[25]!==a||e[26]!==N?(b=s.jsxs("li",{className:i,onClick:c,children:[a,N]}),e[23]=i,e[24]=c,e[25]=a,e[26]=N,e[27]=b):b=e[27],b};function ot({trades:t,viewHistory:e}){const{t:r}=A("trade-matches"),{toast:l}=oe(),{data:n}=B(),{data:x=new Map}=fe(),m=ke();function f(a){return a.offering_friend_id===n?.friend_id&&!a.offerer_ended||a.receiving_friend_id===n?.friend_id&&!a.receiver_ended}const d=e?t.filter(a=>!f(a)):t.filter(f),[h,g]=F.useState(void 0),p=Se();if(!n)return null;const _=(a,u)=>{const o=we(a);return{card_id:a,internal_id:o,amount_owned:(x.get(o)?.amount_owned??0)+u}},j=async a=>{if(a.offer_card_id!==a.receiver_card_id)if(a.offering_friend_id===n.friend_id){const u=[_(a.offer_card_id,-1),_(a.receiver_card_id,1)];m.mutate({updates:u}),l({title:r("collectionUpdated"),variant:"default"})}else if(a.receiving_friend_id===n.friend_id){const u=[_(a.offer_card_id,1),_(a.receiver_card_id,-1)];m.mutate({updates:u}),l({title:r("collectionUpdated"),variant:"default"})}else console.log(a,"can't match friend id")},i=a=>{const u=async b=>{p.mutate({id:a.id,trade:{status:b}}),g(a.id),Q(`Updated trade: ${b}`)},o=async()=>{const b=a.offering_friend_id===n.friend_id?{offerer_ended:!0}:a.receiving_friend_id===n.friend_id?{receiver_ended:!0}:null;if(b===null){console.log(a," doesn't match your friend_id");return}p.mutate({id:a.id,trade:b}),g(void 0),Q("Updated trade: ended")},N=a.offering_friend_id===n.friend_id&&a.offerer_ended||a.receiving_friend_id===n.friend_id&&a.receiver_ended;switch(a.status){case"offered":return s.jsxs(s.Fragment,{children:[a.receiving_friend_id===n.friend_id&&s.jsx(I,{type:"button",onClick:async()=>u("accepted"),children:r("actionAccept")}),s.jsx(I,{type:"button",onClick:async()=>u("declined"),children:a.receiving_friend_id===n.friend_id?r("actionDecline"):r("actionCancel")})]});case"accepted":return s.jsxs(s.Fragment,{children:[s.jsx(I,{type:"button",onClick:async()=>u("finished"),children:r("actionComplete")}),s.jsx(I,{type:"button",onClick:async()=>u("declined"),children:r("actionCancel")})]});case"declined":return N?null:s.jsx(I,{type:"button",onClick:o,children:r("actionHide")});case"finished":return N?null:s.jsxs(s.Fragment,{children:[s.jsx(I,{type:"button",onClick:async()=>{await j(a),await o()},children:r("actionUpdate")}),s.jsx(I,{type:"button",onClick:o,children:r("actionHide")})]});default:return console.log(`Unknown trade status ${a.status}`),null}},c=d.find(a=>a.id===h);return d.length===0?null:s.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-1 md:p-2",children:[s.jsxs("div",{className:"hidden md:flex pr-1",children:[s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:r("youGive")}),s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:r("youReceive")})]}),s.jsx("ul",{className:"flex flex-col gap-2 md:gap-0",children:d.toSorted((a,u)=>a.created_at>u.created_at?-1:1).map(a=>s.jsx(ct,{row:a,selectedTradeId:h,setSelectedTradeId:g},a.id))}),c&&s.jsx("div",{className:"flex gap-4 text-center items-center mt-2",children:i(c)})]})}function mt(t){const e=R.c(52),{friendId:r}=t;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=["trade-matches","common"],e[0]=l):l=e[0];const{t:n}=A(l),{data:x,isLoading:m}=ue(),{data:f,isLoading:d}=me(r),[h,g]=F.useState(!1);if(m||d)return null;if(!x){let L;e[1]!==n?(L=n("common:error"),e[1]=n,e[2]=L):L=e[2];let P;return e[3]!==L?(P=s.jsx("p",{className:"text-xl text-center py-8",children:L}),e[3]=L,e[4]=P):P=e[4],P}let p;if(e[5]!==r||e[6]!==x){let L;e[8]!==r?(L=P=>P.offering_friend_id===r||P.receiving_friend_id===r,e[8]=r,e[9]=L):L=e[9],p=x.filter(L),e[5]=r,e[6]=x,e[7]=p}else p=e[7];const _=p;let j;e[10]!==n?(j=n("tradingWith"),e[10]=n,e[11]=j):j=e[11];let i;e[12]!==j?(i=s.jsx("span",{className:"text-md",children:j}),e[12]=j,e[13]=i):i=e[13];const c=f?.username||"unknown";let a;e[14]!==c?(a=s.jsxs("span",{className:"text-md font-bold",children:[" ",c," "]}),e[14]=c,e[15]=a):a=e[15];let u;e[16]!==f?(u=f&&s.jsx(xe,{friendId:f.friend_id,showFriendId:!1,className:"ml-1"}),e[16]=f,e[17]=u):u=e[17];let o;e[18]!==i||e[19]!==a||e[20]!==u?(o=s.jsxs("p",{children:[i,a,u]}),e[18]=i,e[19]=a,e[20]=u,e[21]=o):o=e[21];const N=`history-${r}`;let b;e[22]!==n?(b=n("viewHistory"),e[22]=n,e[23]=b):b=e[23];const y=`history-${r}`;let v;e[24]!==y||e[25]!==h?(v=s.jsx(he,{id:y,className:"ml-2 my-auto",checked:h,onCheckedChange:g}),e[24]=y,e[25]=h,e[26]=v):v=e[26];let k;e[27]!==b||e[28]!==v||e[29]!==N?(k=s.jsxs("label",{htmlFor:N,className:"my-auto flex items-center",children:[b,v]}),e[27]=b,e[28]=v,e[29]=N,e[30]=k):k=e[30];const S=`/trade/${r}`;let C;e[31]!==n?(C=n("openTradeWith"),e[31]=n,e[32]=C):C=e[32];let w;e[33]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(X,{}),e[33]=w):w=e[33];let T;e[34]!==C?(T=s.jsxs(I,{variant:"outline",className:"my-auto",children:[C,w]}),e[34]=C,e[35]=T):T=e[35];let $;e[36]!==S||e[37]!==T?($=s.jsx(J,{to:S,children:T}),e[36]=S,e[37]=T,e[38]=$):$=e[38];let E;e[39]!==k||e[40]!==$?(E=s.jsxs("span",{className:"flex gap-4",children:[k,$]}),e[39]=k,e[40]=$,e[41]=E):E=e[41];let M;e[42]!==E||e[43]!==o?(M=s.jsxs("div",{className:"flex justify-between items-center mb-1 mx-1",children:[o,E]}),e[42]=E,e[43]=o,e[44]=M):M=e[44];let z;e[45]!==f||e[46]!==_||e[47]!==h?(z=f!==null&&s.jsx(ot,{trades:_,viewHistory:h}),e[45]=f,e[46]=_,e[47]=h,e[48]=z):z=e[48];let U;return e[49]!==M||e[50]!==z?(U=s.jsxs("div",{className:"w-full",children:[M,z]}),e[49]=M,e[50]=z,e[51]=U):U=e[51],U}function ft(){const t=R.c(26);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=A(e),{data:l,isLoading:n}=B(),{data:x,isLoading:m}=ue();if(n||m){let i;return t[1]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"}),t[1]=i):i=t[1],i}if(!x||!l){let i;t[2]!==r?(i=r("common:error"),t[2]=r,t[3]=i):i=t[3];let c;return t[4]!==i?(c=s.jsx("p",{className:"text-xl text-center py-8",children:i}),t[4]=i,t[5]=c):c=t[5],c}if(x.length===0){let i;t[6]!==r?(i=r("noTradeOffers"),t[6]=r,t[7]=i):i=t[7];let c;return t[8]!==i?(c=s.jsx("p",{children:i}),t[8]=i,t[9]=c):c=t[9],c}let f,d,h;t[10]!==l.friend_id||t[11]!==x?(f=gt(x,l.friend_id),d=Object.fromEntries(Object.entries(f).map(i=>{const[c,a]=i;return[c,+(pt(a,l.friend_id).length===0)]})),h=Object.fromEntries(Object.entries(f).map(xt)),t[10]=l.friend_id,t[11]=x,t[12]=f,t[13]=d,t[14]=h):(f=t[12],d=t[13],h=t[14]);const g=h;let p,_;if(t[15]!==f||t[16]!==d||t[17]!==g){let i;t[20]!==d||t[21]!==g?(i=(a,u)=>d[a]!==d[u]?d[a]-d[u]:g[u]-g[a],t[20]=d,t[21]=g,t[22]=i):i=t[22];const c=Object.keys(f).toSorted(i);p="flex flex-col items-center mx-auto gap-6 sm:px-4 mb-12 w-full",_=c.map(ut),t[15]=f,t[16]=d,t[17]=g,t[18]=p,t[19]=_}else p=t[18],_=t[19];let j;return t[23]!==p||t[24]!==_?(j=s.jsx("div",{className:p,children:_}),t[23]=p,t[24]=_,t[25]=j):j=t[25],j}function ut(t){return s.jsx(mt,{friendId:t},t)}function xt(t){const[e,r]=t;return[e,Math.max(...r.map(ht))]}function ht(t){return new Date(t.updated_at).getTime()}function pt(t,e){return t.filter(r=>r.offering_friend_id===e?!r.offerer_ended:!r.receiver_ended)}function gt(t,e){return Object.groupBy(t,r=>r.offering_friend_id===e?r.receiving_friend_id:r.receiving_friend_id===e?r.offering_friend_id:(console.log("Fetched row does not match user friend_id",r),"undefined"))}function _t(){const{t}=A("trade-matches"),{data:e}=B(),r=Ie(),l=se({is_active_trading:Le(),trade_rarity_settings:$e(se({rarity:Fe(Ae),to_collect:ie().min(0).max(100),to_keep:ie().min(0).max(100)}))}),n=Ge({resolver:Ke(l),values:{is_active_trading:e?.is_active_trading||!1,trade_rarity_settings:e?.trade_rarity_settings||[]}}),x=async m=>{r.mutate({username:e?.username,is_active_trading:m.is_active_trading,trade_rarity_settings:m.trade_rarity_settings},{onSuccess:()=>ae({title:t("accountSaved"),variant:"default"}),onError:f=>{console.error("error saving account",f),ae({title:t("errorSavingAccount"),variant:"destructive"})}})};return!e||!e.username?s.jsx(qe,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:t("noAccount")}):s.jsxs("div",{children:[s.jsx(We,{...n,children:s.jsxs("form",{onSubmit:n.handleSubmit(x),className:"rounded-md border-1 border-neutral-700 space-y-2 p-4 mx-auto max-w-xl",children:[s.jsx("h2",{className:"text-xl text-center mb-6",children:t("settingsTitle")}),s.jsx(K,{control:n.control,name:"is_active_trading",render:({field:m})=>s.jsx(W,{className:"flex flex-col items-start",children:s.jsx(Y,{children:s.jsxs(Ye,{className:"flex",children:[t("isActiveTrading"),s.jsx(he,{className:"ml-2",checked:m.value,onCheckedChange:m.onChange})]})})})}),s.jsxs("div",{className:"grid grid-cols-3 gap-y-2 gap-x-8 w-fit mt-6",children:[s.jsx("span",{children:t("rarity")}),s.jsxs("span",{className:"flex items-center",children:[t("toCollect"),s.jsx(Z,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toCollectTooltip")})]}),s.jsxs("span",{className:"flex items-center",children:[t("toKeep"),s.jsx(Z,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toKeepTooltip")})]}),n.watch("trade_rarity_settings").map((m,f)=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex-1",children:m.rarity},`label-${m.rarity}`),s.jsx(K,{control:n.control,name:`trade_rarity_settings.${f}.to_collect`,render:({field:d})=>s.jsx(W,{className:"flex-1",children:s.jsx(Y,{children:s.jsx(re,{className:"w-24",type:"number",...d})})})},`to-collect-${m.rarity}`),s.jsx(K,{control:n.control,name:`trade_rarity_settings.${f}.to_keep`,render:({field:d})=>s.jsx(W,{className:"flex-1",children:s.jsx(Y,{children:s.jsx(re,{className:"w-24",type:"number",...d})})})},`to-keep-${m.rarity}`)]}))]}),s.jsxs(I,{type:"submit",className:"block ml-auto mt-4",disabled:r.isPending,children:[t("save"),r.isPending&&s.jsx("div",{className:"ml-2 inline-block animate-spin rounded-full size-4 border-2 border-black border-t-transparent"})]})]})}),s.jsx(Qe,{className:"mt-4 mx-auto w-fit"})]})}function zt(){const t=R.c(45),{t:e}=A("trade-matches"),r=Pe(),l=ze();let n;t[0]!==r.pathname?(n=r.pathname.split("/").pop()||"offers",t[0]=r.pathname,t[1]=n):n=t[1];const x=n;let m,f;t[2]!==r.pathname||t[3]!==l?(m=()=>{r.pathname==="/trade"&&l("/trade/offers")},f=[r.pathname,l],t[2]=r.pathname,t[3]=l,t[4]=m,t[5]=f):(m=t[4],f=t[5]),F.useEffect(m,f);let d;t[6]!==l?(d=T=>l(`/trade/${T}`),t[6]=l,t[7]=d):d=t[7];let h;t[8]!==e?(h=e("tabCards"),t[8]=e,t[9]=h):h=t[9];let g;t[10]!==h?(g=s.jsx(D,{className:"text-md",value:"cards",children:h}),t[10]=h,t[11]=g):g=t[11];let p;t[12]!==e?(p=e("tabOffers"),t[12]=e,t[13]=p):p=t[13];let _;t[14]!==p?(_=s.jsx(D,{className:"text-md",value:"offers",children:p}),t[14]=p,t[15]=_):_=t[15];let j;t[16]!==e?(j=e("tabMatches"),t[16]=e,t[17]=j):j=t[17];let i;t[18]!==j?(i=s.jsx(D,{className:"text-md",value:"matches",children:j}),t[18]=j,t[19]=i):i=t[19];let c;t[20]!==e?(c=e("tabSettings"),t[20]=e,t[21]=c):c=t[21];let a;t[22]!==c?(a=s.jsx(D,{className:"text-md",value:"settings",children:c}),t[22]=c,t[23]=a):a=t[23];let u;t[24]!==a||t[25]!==g||t[26]!==_||t[27]!==i?(u=s.jsxs(He,{className:"gap-4 mb-6 rounded-lg border-b-1 border-neutral-700 border-solid dark:bg-transparent pb-2",children:[g,_,i,a]}),t[24]=a,t[25]=g,t[26]=_,t[27]=i,t[28]=u):u=t[28];let o;t[29]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(O,{path:"/",element:s.jsx(Oe,{to:"/trade/offers",replace:!0})}),t[29]=o):o=t[29];let N;t[30]!==e?(N=e("movedToCollectionPage"),t[30]=e,t[31]=N):N=t[31];let b;t[32]!==N?(b=s.jsx(O,{path:"cards",element:s.jsx("p",{children:N})}),t[32]=N,t[33]=b):b=t[33];let y;t[34]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx(O,{path:"offers",element:s.jsx(ft,{})}),t[34]=y):y=t[34];let v;t[35]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(O,{path:"matches",element:s.jsx(lt,{})}),t[35]=v):v=t[35];let k;t[36]===Symbol.for("react.memo_cache_sentinel")?(k=s.jsx(O,{path:"settings",element:s.jsx(_t,{})}),t[36]=k):k=t[36];let S;t[37]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsx(O,{path:":friendId",element:s.jsx(dt,{})}),t[37]=S):S=t[37];let C;t[38]!==b?(C=s.jsxs(Re,{children:[o,b,y,v,k,S]}),t[38]=b,t[39]=C):C=t[39];let w;return t[40]!==x||t[41]!==u||t[42]!==C||t[43]!==d?(w=s.jsxs(Be,{className:"flex flex-col mx-auto max-w-[900px]",value:x,onValueChange:d,children:[u,C]}),t[40]=x,t[41]=u,t[42]=C,t[43]=d,t[44]=w):w=t[44],w}export{zt as default};
