import{r as w,o as T,X as k,a5 as F,a6 as R,x,v as M,J as A,U as D,ar as L}from"./index-DQ6Z05XJ.js";function v(s,l,n){let t=n.initialDeps??[],e;function i(){var o,r,a,c;let h;n.key&&((o=n.debug)!=null&&o.call(n))&&(h=Date.now());const u=s();if(!(u.length!==t.length||u.some((f,g)=>t[g]!==f)))return e;t=u;let m;if(n.key&&((r=n.debug)!=null&&r.call(n))&&(m=Date.now()),e=l(...u),n.key&&((a=n.debug)!=null&&a.call(n))){const f=Math.round((Date.now()-h)*100)/100,g=Math.round((Date.now()-m)*100)/100,y=g/16,b=(p,I)=>{for(p=String(p);p.length<I;)p=" "+p;return p};console.info(`%câ± ${b(g,5)} /${b(f,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,n?.key)}return(c=n?.onChange)==null||c.call(n,e),e}return i.updateDeps=o=>{t=o},i}function C(s,l){if(s===void 0)throw new Error("Unexpected undefined");return s}const W=(s,l)=>Math.abs(s-l)<1.01,N=(s,l,n)=>{let t;return function(...e){s.clearTimeout(t),t=s.setTimeout(()=>l.apply(this,e),n)}},S=s=>{const{offsetWidth:l,offsetHeight:n}=s;return{width:l,height:n}},B=s=>s,j=s=>{const l=Math.max(s.startIndex-s.overscan,0),n=Math.min(s.endIndex+s.overscan,s.count-1),t=[];for(let e=l;e<=n;e++)t.push(e);return t},P=(s,l)=>{const n=s.scrollElement;if(!n)return;const t=s.targetWindow;if(!t)return;const e=o=>{const{width:r,height:a}=o;l({width:Math.round(r),height:Math.round(a)})};if(e(S(n)),!t.ResizeObserver)return()=>{};const i=new t.ResizeObserver(o=>{const r=()=>{const a=o[0];if(a?.borderBoxSize){const c=a.borderBoxSize[0];if(c){e({width:c.inlineSize,height:c.blockSize});return}}e(S(n))};s.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()});return i.observe(n,{box:"border-box"}),()=>{i.unobserve(n)}},E={passive:!0},O=typeof window>"u"?!0:"onscrollend"in window,V=(s,l)=>{const n=s.scrollElement;if(!n)return;const t=s.targetWindow;if(!t)return;let e=0;const i=s.options.useScrollendEvent&&O?()=>{}:N(t,()=>{l(e,!1)},s.options.isScrollingResetDelay),o=h=>()=>{const{horizontal:u,isRtl:d}=s.options;e=u?n.scrollLeft*(d&&-1||1):n.scrollTop,i(),l(e,h)},r=o(!0),a=o(!1);a(),n.addEventListener("scroll",r,E);const c=s.options.useScrollendEvent&&O;return c&&n.addEventListener("scrollend",a,E),()=>{n.removeEventListener("scroll",r),c&&n.removeEventListener("scrollend",a)}},U=(s,l,n)=>{if(l?.borderBoxSize){const t=l.borderBoxSize[0];if(t)return Math.round(t[n.options.horizontal?"inlineSize":"blockSize"])}return s[n.options.horizontal?"offsetWidth":"offsetHeight"]},$=(s,{adjustments:l=0,behavior:n},t)=>{var e,i;const o=s+l;(i=(e=t.scrollElement)==null?void 0:e.scrollTo)==null||i.call(e,{[t.options.horizontal?"left":"top"]:o,behavior:n})};class q{constructor(l){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let n=null;const t=()=>n||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:n=new this.targetWindow.ResizeObserver(e=>{e.forEach(i=>{const o=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var e;(e=t())==null||e.disconnect(),n=null},observe:e=>{var i;return(i=t())==null?void 0:i.observe(e,{box:"border-box"})},unobserve:e=>{var i;return(i=t())==null?void 0:i.unobserve(e)}}})(),this.range=null,this.setOptions=n=>{Object.entries(n).forEach(([t,e])=>{typeof e>"u"&&delete n[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:B,rangeExtractor:j,onChange:()=>{},measureElement:U,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...n}},this.notify=n=>{var t,e;(e=(t=this.options).onChange)==null||e.call(t,this,n)},this.maybeNotify=v(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),n=>{this.notify(n)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(n=>n()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var n;const t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t){this.maybeNotify();return}this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((n=this.scrollElement)==null?void 0:n.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=i,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(n,t)=>{const e=new Map,i=new Map;for(let o=t-1;o>=0;o--){const r=n[o];if(e.has(r.lane))continue;const a=i.get(r.lane);if(a==null||r.end>a.end?i.set(r.lane,r):r.end<a.end&&e.set(r.lane,!0),e.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((o,r)=>o.end===r.end?o.index-r.index:o.end-r.end)[0]:void 0},this.getMeasurementOptions=v(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(n,t,e,i,o)=>(this.pendingMeasuredCacheIndexes=[],{count:n,paddingStart:t,scrollMargin:e,getItemKey:i,enabled:o}),{key:!1}),this.getMeasurements=v(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:n,paddingStart:t,scrollMargin:e,getItemKey:i,enabled:o},r)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(h=>{this.itemSizeCache.set(h.key,h.size)}));const a=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const c=this.measurementsCache.slice(0,a);for(let h=a;h<n;h++){const u=i(h),d=this.options.lanes===1?c[h-1]:this.getFurthestMeasurement(c,h),m=d?d.end+this.options.gap:t+e,f=r.get(u),g=typeof f=="number"?f:this.options.estimateSize(h),y=m+g,b=d?d.lane:h%this.options.lanes;c[h]={index:h,start:m,size:g,end:y,key:u,lane:b}}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=v(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(n,t,e,i)=>this.range=n.length>0&&t>0?H({measurements:n,outerSize:t,scrollOffset:e,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=v(()=>{let n=null,t=null;const e=this.calculateRange();return e&&(n=e.startIndex,t=e.endIndex),this.maybeNotify.updateDeps([this.isScrolling,n,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,n,t]},(n,t,e,i,o)=>i===null||o===null?[]:n({startIndex:i,endIndex:o,overscan:t,count:e}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=n=>{const t=this.options.indexAttribute,e=n.getAttribute(t);return e?parseInt(e,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(n,t)=>{const e=this.indexFromElement(n),i=this.measurementsCache[e];if(!i)return;const o=i.key,r=this.elementsCache.get(o);r!==n&&(r&&this.observer.unobserve(r),this.observer.observe(n),this.elementsCache.set(o,n)),n.isConnected&&this.resizeItem(e,this.options.measureElement(n,t,this))},this.resizeItem=(n,t)=>{const e=this.measurementsCache[n];if(!e)return;const i=this.itemSizeCache.get(e.key)??e.size,o=t-i;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(e,o,this):e.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(e.index),this.itemSizeCache=new Map(this.itemSizeCache.set(e.key,t)),this.notify(!1))},this.measureElement=n=>{if(!n){this.elementsCache.forEach((t,e)=>{t.isConnected||(this.observer.unobserve(t),this.elementsCache.delete(e))});return}this._measureElement(n,void 0)},this.getVirtualItems=v(()=>[this.getVirtualIndexes(),this.getMeasurements()],(n,t)=>{const e=[];for(let i=0,o=n.length;i<o;i++){const r=n[i],a=t[r];e.push(a)}return e},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=n=>{const t=this.getMeasurements();if(t.length!==0)return C(t[_(0,t.length-1,e=>C(t[e]).start,n)])},this.getOffsetForAlignment=(n,t,e=0)=>{const i=this.getSize(),o=this.getScrollOffset();t==="auto"&&(t=n>=o+i?"end":"start"),t==="center"?n+=(e-i)/2:t==="end"&&(n-=i);const r=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(r,n),0)},this.getOffsetForIndex=(n,t="auto")=>{n=Math.max(0,Math.min(n,this.options.count-1));const e=this.measurementsCache[n];if(!e)return;const i=this.getSize(),o=this.getScrollOffset();if(t==="auto")if(e.end>=o+i-this.options.scrollPaddingEnd)t="end";else if(e.start<=o+this.options.scrollPaddingStart)t="start";else return[o,t];const r=t==="end"?e.end+this.options.scrollPaddingEnd:e.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(r,t,e.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(n,{align:t="start",behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(n,t),{adjustments:void 0,behavior:e})},this.scrollToIndex=(n,{align:t="auto",behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),n=Math.max(0,Math.min(n,this.options.count-1));let i=0;const o=10,r=c=>{if(!this.targetWindow)return;const h=this.getOffsetForIndex(n,c);if(!h){console.warn("Failed to get offset for index:",n);return}const[u,d]=h;this._scrollToOffset(u,{adjustments:void 0,behavior:e}),this.targetWindow.requestAnimationFrame(()=>{const m=this.getScrollOffset(),f=this.getOffsetForIndex(n,d);if(!f){console.warn("Failed to get offset for index:",n);return}W(f[0],m)||a(d)})},a=c=>{this.targetWindow&&(i++,i<o?this.targetWindow.requestAnimationFrame(()=>r(c)):console.warn(`Failed to scroll to index ${n} after ${o} attempts.`))};r(t)},this.scrollBy=(n,{behavior:t}={})=>{t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+n,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var n;const t=this.getMeasurements();let e;if(t.length===0)e=this.options.paddingStart;else if(this.options.lanes===1)e=((n=t[t.length-1])==null?void 0:n.end)??0;else{const i=Array(this.options.lanes).fill(null);let o=t.length-1;for(;o>=0&&i.some(r=>r===null);){const r=t[o];i[r.lane]===null&&(i[r.lane]=r.end),o--}e=Math.max(...i.filter(r=>r!==null))}return Math.max(e-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(n,{adjustments:t,behavior:e})=>{this.options.scrollToFn(n,{behavior:e,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(l)}}const _=(s,l,n,t)=>{for(;s<=l;){const e=(s+l)/2|0,i=n(e);if(i<t)s=e+1;else if(i>t)l=e-1;else return e}return s>0?s-1:0};function H({measurements:s,outerSize:l,scrollOffset:n,lanes:t}){const e=s.length-1,i=a=>s[a].start;if(s.length<=t)return{startIndex:0,endIndex:e};let o=_(0,e,i,n),r=o;if(t===1)for(;r<e&&s[r].end<n+l;)r++;else if(t>1){const a=Array(t).fill(0);for(;r<e&&a.some(h=>h<n+l);){const h=s[r];a[h.lane]=h.end,r++}const c=Array(t).fill(n+l);for(;o>=0&&c.some(h=>h>=n);){const h=s[o];c[h.lane]=h.start,o--}o=Math.max(0,o-o%t),r=Math.min(e,r+(t-1-r%t))}return{startIndex:o,endIndex:r}}const z=typeof document<"u"?w.useLayoutEffect:w.useEffect;function K(s){const l=w.useReducer(()=>({}),{})[1],n={...s,onChange:(e,i)=>{var o;i?T.flushSync(l):l(),(o=s.onChange)==null||o.call(s,e,i)}},[t]=w.useState(()=>new q(n));return t.setOptions(n),z(()=>t._didMount(),[]),z(()=>t._willUpdate()),t}function G(s){return K({observeElementRect:P,observeElementOffset:V,scrollToFn:$,...s})}function J(s,l){if(s.length===0)return l.length;if(l.length===0)return s.length;let n=Array(s.length+1).fill(0).map((e,i)=>i),t=Array(s.length+1);for(let e=1;e<=l.length;e++){t[0]=e;for(let i=1;i<=s.length;i++){const o=s[i-1]===l[e-1]?0:1;t[i]=Math.min(n[i]+1,t[i-1]+1,n[i-1]+o)}[n,t]=[t,n]}return n[s.length]}const Q=["all",...x],Y=["default","recent","expansion-newest"],Z=L,ee=["all","missing","registered"],te=["all","wanted","extra"];function ne(s,l,n){let t=k;if(s.deckbuildingMode&&(t=t.filter(e=>e.internal_id===e.alternate_versions[0])),s.expansion!==void 0&&s.expansion!=="all"&&(t=t.filter(e=>e.expansion===s.expansion)),s.expansion!==void 0&&s.pack!==void 0&&s.pack!=="all"&&(t=t.filter(e=>e.pack===s.pack||e.pack==="everypack")),s.ownership!==void 0&&s.ownership!=="all"&&(t=t.filter(e=>s.ownership==="missing"?!e.collected:e.collected)),s.trading!==void 0&&s.trading!=="all"){if(!n)throw new Error("Cannot filter by trading status without trading settings");const e=new Set(s.trading==="wanted"?F(l,n):R(l,n));t=t.filter(i=>e.has(i.internal_id))}if(s.sortBy!==void 0&&(s.sortBy==="recent"?t=t.toSorted((e,i)=>{const o=l.get(e.internal_id)?.updated_at,r=l.get(i.internal_id)?.updated_at;return o&&r?new Date(r).getTime()-new Date(o).getTime():o&&!r?-1:1}):s.sortBy==="expansion-newest"&&(t=[...t].sort((e,i)=>e.expansion!==i.expansion?x.indexOf(e.expansion)-x.indexOf(i.expansion):e.card_id.localeCompare(i.card_id,M.language||"en",{numeric:!0})))),t=t.filter(e=>s.rarity===void 0||s.rarity.length===0?!0:s.rarity.includes(e.rarity)),t=t.filter(e=>s.cardType===void 0||s.cardType.length===0?!0:e.card_type.toLowerCase()==="trainer"?s.cardType.includes("trainer"):s.cardType.includes(e.energy.toLowerCase())),s.search){const e=s.search.toLowerCase(),i=2;t=t.filter(o=>{const r=A(o,M.language).toLowerCase();let a=!1;s.allTextSearch&&(a=o.ability&&(o.ability.name.toLowerCase().includes(e)||o.ability.effect.toLowerCase().includes(e))||o.attacks.some(d=>d.name?.toLowerCase().includes(e)||d.effect?.toLowerCase()!=="no effect"&&d.effect?.toLowerCase()?.includes(e)));const c=r.includes(e),h=J(r,e)<=i,u=o.card_id.toLowerCase().includes(e);return a||c||h||u})}for(const e of t){s.deckbuildingMode?e.amount_owned=e.alternate_versions.reduce((o,r)=>{const a=D(r);return o+(l.get(a?.internal_id||0)?.amount_owned??0)},0):e.amount_owned=l.get(e.internal_id)?.amount_owned??0;const i=l.get(e.internal_id);e.collected=i?.collection.includes(e.card_id)??!1,e.updated_at=i?.updated_at}if(s.minNumber!==void 0){const e=s.minNumber;t=t.filter(i=>(i.amount_owned??0)>=e)}if(s.maxNumber!==void 0&&s.maxNumber!==100){const e=s.maxNumber;t=t.filter(i=>(i.amount_owned??0)<=e)}return t}export{Z as c,Q as e,ne as g,ee as o,Y as s,te as t,G as u};
