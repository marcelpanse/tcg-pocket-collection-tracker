import{j as s,d as ye}from"./query-vendor-DpGHCXpY.js";import{h as B,c as A,gX as H,gQ as fe,g$ as Ne,h0 as J,B as k,j as D,h1 as Ce,h2 as we,u as me,h3 as Te,h4 as Se,h5 as ke,C as ue,D as $e,h6 as xe,I as R,S as W,h7 as se,h8 as re,h9 as K,E as O,R as he,ha as Ie,z as Le,hb as Ae,Q as Fe,hc as Ee,hd as Pe,o as ae,s as ze,p as Me,_ as He,x as Re,A as Oe,gW as ie,t as ne}from"./index-gS_9Ig_6.js";import{r as I,e as Be,j as _e,L as ee,f as pe,u as De,k as M,N as Ue,l as Ve}from"./react-vendor-DjlsVz29.js";import{T as Q,a as We,b as Ke}from"./tabs-BYIhdTYx.js";import{F as ge}from"./friend-id-display-DBvKtiWT.js";import{S as te,a as Qe}from"./SocialShareButtons-judEgH7n.js";import{u as L,i as Ye}from"./i18n-vendor-DDmeScd6.js";import{p as qe}from"./ui-vendor-9yhwxkpr.js";import{M as V,C as Y}from"./react-tooltip.min-BdNar_4C.js";import{C as je}from"./chevron-first-D3qcbkQP.js";import{S as Xe}from"./SearchInput-5KQXUkdM.js";import{g as Ge}from"./filters-DlshxfMI.js";import{u as Je,a as Ze,b as et,F as q,c as X,e as G,d as tt}from"./form-CZwlug4Q.js";import{n as le}from"./coerce-ku9TGZfK.js";import"./charts-vendor-D-Ae2kUX.js";import"./supabase-vendor-CP3OYKhD.js";import"./xlsx-vendor-De4COjWB.js";import"./index-5ziEWJdO.js";const st=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],rt=B("arrow-left",st);const at=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],it=B("arrow-right-left",at);const nt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],lt=B("arrow-right",nt);const dt=[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]],be=B("chevrons-down",dt);const ct=[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]],ve=B("chevrons-up",ct),de=t=>{const e=A.c(15),{cards:r,selected:l,setSelected:a}=t;let f,i,g;if(e[0]!==r||e[1]!==l?.card_id||e[2]!==a){const x=[...r].sort(ft);let d;e[6]!==l?.card_id||e[7]!==a?(d=function(h){const j=function(){l?.card_id===h.card_id?a(null):a(h)};return s.jsx("li",{className:"rounded cursor-pointer",onClick:j,children:s.jsx(H,{className:`w-full ${l?.card_id===h.card_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:h.card_id,rarity:"hidden"})},h.card_id)},e[6]=l?.card_id,e[7]=a,e[8]=d):d=e[8];const m=d;g="rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",f="space-y-1",i=x.map(m),e[0]=r,e[1]=l?.card_id,e[2]=a,e[3]=f,e[4]=i,e[5]=g}else f=e[3],i=e[4],g=e[5];let c;e[9]!==f||e[10]!==i?(c=s.jsx("ul",{className:f,children:i}),e[9]=f,e[10]=i,e[11]=c):c=e[11];let _;return e[12]!==g||e[13]!==c?(_=s.jsx("div",{className:g,children:c}),e[12]=g,e[13]=c,e[14]=_):_=e[14],_};function ot(t){const e=t.split("-"),r=e[0]||"",l=e.length>1?parseInt(e[1],10):0;return{setName:r,cardNumber:l}}function ft(t,e){const r=ot,l=r(t.card_id),a=r(e.card_id);return l.setName!==a.setName?l.setName.localeCompare(a.setName):l.cardNumber-a.cardNumber}function ce(t){return t===null?s.jsx("span",{className:"inline-block mx-auto",children:"—"}):s.jsx(H,{className:"flex-1",card_id:t.card_id,details:"hidden"})}const mt=t=>{const e=A.c(37),{yourId:r,friendId:l,yourCard:a,friendCard:f,setYourCard:i,setFriendCard:g}=t,{t:c}=L("trade-matches"),{toast:_}=fe(),x=Ne(),d=a&&f&&a.rarity===f.rarity;let m;e[0]!==d||e[1]!==f||e[2]!==l||e[3]!==x||e[4]!==g||e[5]!==i||e[6]!==c||e[7]!==_||e[8]!==a||e[9]!==r?(m=async function(){if(!d)return;const S={offering_friend_id:r,receiving_friend_id:l,offer_card_id:a.card_id,receiver_card_id:f.card_id,status:"offered"};try{x.mutate(S)}catch($){console.log("TradeOffer: Error inserting trade",$),_({title:c("tradeFailed"),variant:"default"})}i(null),g(null),_({title:c("tradeOffered"),variant:"default"}),J("Offer trade")},e[0]=d,e[1]=f,e[2]=l,e[3]=x,e[4]=g,e[5]=i,e[6]=c,e[7]=_,e[8]=a,e[9]=r,e[10]=m):m=e[10];const o=m;if(!a&&!f){let N;e[11]!==c?(N=c("selectCardsToTrade"),e[11]=c,e[12]=N):N=e[12];let S;return e[13]!==N?(S=s.jsx("div",{className:"sticky top-0 z-10 flex rounded-lg border-1 bg-neutral-900 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[110px] sm:h-[82px]",children:s.jsx("h4",{className:"text-lg font-medium text-neutral-400",children:N})}),e[13]=N,e[14]=S):S=e[14],S}let h;e[15]===Symbol.for("react.memo_cache_sentinel")?(h=s.jsx(ve,{}),e[15]=h):h=e[15];let j;e[16]!==a?(j=ce(a),e[16]=a,e[17]=j):j=e[17];let v;e[18]!==j?(v=s.jsxs("div",{className:"flex w-full sm:w-1/2",children:[h,j]}),e[18]=j,e[19]=v):v=e[19];let T;e[20]===Symbol.for("react.memo_cache_sentinel")?(T=s.jsx(be,{}),e[20]=T):T=e[20];let C;e[21]!==f?(C=ce(f),e[21]=f,e[22]=C):C=e[22];let y;e[23]!==C?(y=s.jsxs("div",{className:"flex w-full sm:w-1/2",children:[T,C]}),e[23]=C,e[24]=y):y=e[24];let w;e[25]!==v||e[26]!==y?(w=s.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-x-4 gap-y-1 p-1",children:[v,y]}),e[25]=v,e[26]=y,e[27]=w):w=e[27];const u=!d;let p;e[28]!==c?(p=c("offerTrades"),e[28]=c,e[29]=p):p=e[29];let n;e[30]!==o||e[31]!==p||e[32]!==u?(n=s.jsx(k,{className:"block w-full sm:w-96 mx-auto mt-1 text-center",variant:"outline",onClick:o,disabled:u,children:p}),e[30]=o,e[31]=p,e[32]=u,e[33]=n):n=e[33];let b;return e[34]!==n||e[35]!==w?(b=s.jsxs("div",{className:"sticky top-0 z-10 bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-1",children:[w,n]}),e[34]=n,e[35]=w,e[36]=b):b=e[36],b},ut=t=>{const e=A.c(30),{row:r,selectedTradeId:l,setSelectedTradeId:a}=t,{t:f}=L("trade-matches"),{data:i,isLoading:g}=D();if(g)return null;if(!i){let n;e[0]!==f?(n=f("common:error"),e[0]=f,e[1]=n):n=e[1];let b;return e[2]!==n?(b=s.jsx("p",{className:"text-xl text-center py-8",children:n}),e[2]=n,e[3]=b):b=e[3],b}const c=r.offering_friend_id===i.friend_id?r.offer_card_id:r.receiver_card_id,_=r.offering_friend_id===i.friend_id?r.receiver_card_id:r.offer_card_id;let x;e[4]!==l||e[5]!==a?(x=function(b){l===b.id?a(void 0):a(b.id)},e[4]=l,e[5]=a,e[6]=x):x=e[6];const d=x;let m;e[7]!==i.friend_id||e[8]!==f?(m=n=>{const b={offered:n.offering_friend_id===i.friend_id?s.jsx(lt,{className:"bg-amber-600"}):s.jsx(rt,{className:"bg-amber-600"}),accepted:s.jsx(it,{className:"bg-lime-600"}),declined:s.jsx(we,{className:"bg-stone-600"}),finished:s.jsx(Ce,{className:"bg-indigo-600"})};return s.jsxs(s.Fragment,{children:[s.jsx(V,{id:`status-${n.id}`}),s.jsx(qe,{className:"rounded-full p-[3px] my-auto","data-tooltip-id":`status-${n.id}`,"data-tooltip-content":f(`status.${n.status}`),children:b[n.status]})]})},e[7]=i.friend_id,e[8]=f,e[9]=m):m=e[9];const o=m,h=`flex cursor-pointer rounded gap-1 md:gap-2 p-1 ${l===r.id&&"bg-green-900"} hover:bg-neutral-500`;let j;e[10]!==d||e[11]!==r?(j=()=>d(r),e[10]=d,e[11]=r,e[12]=j):j=e[12];let v;e[13]!==r||e[14]!==o?(v=o(r),e[13]=r,e[14]=o,e[15]=v):v=e[15];let T;e[16]===Symbol.for("react.memo_cache_sentinel")?(T=s.jsx(ve,{}),e[16]=T):T=e[16];let C;e[17]!==c?(C=s.jsxs("div",{className:"flex flex-1",children:[T,s.jsx(H,{className:"flex-1",card_id:c,increment:-1})]}),e[17]=c,e[18]=C):C=e[18];let y;e[19]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx(be,{}),e[19]=y):y=e[19];let w;e[20]!==_?(w=s.jsxs("div",{className:"flex flex-1",children:[y,s.jsx(H,{className:"flex-1",card_id:_,increment:1})]}),e[20]=_,e[21]=w):w=e[21];let u;e[22]!==C||e[23]!==w?(u=s.jsxs("div",{className:"flex flex-col-reverse md:flex-row grow-1 justify-between gap-1 md:gap-2",children:[C,w]}),e[22]=C,e[23]=w,e[24]=u):u=e[24];let p;return e[25]!==u||e[26]!==h||e[27]!==j||e[28]!==v?(p=s.jsxs("li",{className:h,onClick:j,children:[v,u]}),e[25]=u,e[26]=h,e[27]=j,e[28]=v,e[29]=p):p=e[29],p};function xt(t){const e=A.c(78),{trade:r,setSelected:l}=t,{t:a}=L("trade-matches"),{toast:f}=fe(),{data:i,isLoading:g}=D(),{data:c,isLoading:_}=me(),x=Te(),d=Se();if(g||_)return null;if(!i||!c)throw new Error("Cannot deduce trade actions: not logged in");let m;e[0]!==c?(m=(u,p)=>{const n=ke(u);return{card_id:u,internal_id:n,amount_owned:(c.get(n)?.amount_owned??0)+p}},e[0]=c,e[1]=m):m=e[1];const o=m;let h;e[2]!==i.friend_id||e[3]!==l||e[4]!==r.id||e[5]!==r.offering_friend_id||e[6]!==r.receiving_friend_id||e[7]!==d?(h=async()=>{const u=r.offering_friend_id===i.friend_id?{offerer_ended:!0}:r.receiving_friend_id===i.friend_id?{receiver_ended:!0}:null;if(u===null)throw new Error("Error hiding trade: cannot match your friend id");await d.mutateAsync({id:r.id,trade:u}),l(void 0),J("Updated trade: ended")},e[2]=i.friend_id,e[3]=l,e[4]=r.id,e[5]=r.offering_friend_id,e[6]=r.receiving_friend_id,e[7]=d,e[8]=h):h=e[8];const j=h;let v;e[9]!==i.friend_id||e[10]!==j||e[11]!==o||e[12]!==a||e[13]!==f||e[14]!==r.offer_card_id||e[15]!==r.offering_friend_id||e[16]!==r.receiver_card_id||e[17]!==r.receiving_friend_id||e[18]!==x?(v=async()=>{if(r.offer_card_id===r.receiver_card_id)return;const u=r.offering_friend_id===i.friend_id?[o(r.offer_card_id,-1),o(r.receiver_card_id,1)]:r.receiving_friend_id===i.friend_id?[o(r.offer_card_id,1),o(r.receiver_card_id,-1)]:null;if(u===null)throw new Error("Error updating collection: cannot match your friend id");await x.mutateAsync(u),await j(),f({title:a("collectionUpdated"),variant:"default"})},e[9]=i.friend_id,e[10]=j,e[11]=o,e[12]=a,e[13]=f,e[14]=r.offer_card_id,e[15]=r.offering_friend_id,e[16]=r.receiver_card_id,e[17]=r.receiving_friend_id,e[18]=x,e[19]=v):v=e[19];const T=v;let C;e[20]!==l||e[21]!==r.id||e[22]!==d?(C=async u=>{d.mutate({id:r.id,trade:{status:u}}),l(r.id),J(`Updated trade: ${u}`)},e[20]=l,e[21]=r.id,e[22]=d,e[23]=C):C=e[23];const y=C,w=r.offering_friend_id===i.friend_id&&r.offerer_ended||r.receiving_friend_id===i.friend_id&&r.receiver_ended;switch(r.status){case"offered":{let u;e[24]!==i.friend_id||e[25]!==a||e[26]!==r.receiving_friend_id||e[27]!==y?(u=r.receiving_friend_id===i.friend_id&&s.jsx(k,{onClick:()=>y("accepted"),children:a("actionAccept")}),e[24]=i.friend_id,e[25]=a,e[26]=r.receiving_friend_id,e[27]=y,e[28]=u):u=e[28];let p;e[29]!==y?(p=()=>y("declined"),e[29]=y,e[30]=p):p=e[30];let n;e[31]!==i.friend_id||e[32]!==a||e[33]!==r.receiving_friend_id?(n=r.receiving_friend_id===i.friend_id?a("actionDecline"):a("actionCancel"),e[31]=i.friend_id,e[32]=a,e[33]=r.receiving_friend_id,e[34]=n):n=e[34];let b;e[35]!==p||e[36]!==n?(b=s.jsx(k,{onClick:p,children:n}),e[35]=p,e[36]=n,e[37]=b):b=e[37];let N;return e[38]!==u||e[39]!==b?(N=s.jsxs(s.Fragment,{children:[u,b]}),e[38]=u,e[39]=b,e[40]=N):N=e[40],N}case"accepted":{let u;e[41]!==y?(u=()=>y("finished"),e[41]=y,e[42]=u):u=e[42];let p;e[43]!==a?(p=a("actionComplete"),e[43]=a,e[44]=p):p=e[44];let n;e[45]!==u||e[46]!==p?(n=s.jsx(k,{onClick:u,children:p}),e[45]=u,e[46]=p,e[47]=n):n=e[47];let b;e[48]!==y?(b=()=>y("declined"),e[48]=y,e[49]=b):b=e[49];let N;e[50]!==a?(N=a("actionCancel"),e[50]=a,e[51]=N):N=e[51];let S;e[52]!==b||e[53]!==N?(S=s.jsx(k,{onClick:b,children:N}),e[52]=b,e[53]=N,e[54]=S):S=e[54];let $;return e[55]!==S||e[56]!==n?($=s.jsxs(s.Fragment,{children:[n,S]}),e[55]=S,e[56]=n,e[57]=$):$=e[57],$}case"declined":{if(w)return null;let u;e[58]!==a?(u=a("actionHide"),e[58]=a,e[59]=u):u=e[59];let p;return e[60]!==j||e[61]!==u?(p=s.jsx(k,{onClick:j,children:u}),e[60]=j,e[61]=u,e[62]=p):p=e[62],p}case"finished":{if(w)return null;let u;e[63]!==T?(u=()=>T(),e[63]=T,e[64]=u):u=e[64];let p;e[65]!==a?(p=a("actionUpdate"),e[65]=a,e[66]=p):p=e[66];let n;e[67]!==u||e[68]!==p?(n=s.jsx(k,{onClick:u,children:p}),e[67]=u,e[68]=p,e[69]=n):n=e[69];let b;e[70]!==a?(b=a("actionHide"),e[70]=a,e[71]=b):b=e[71];let N;e[72]!==j||e[73]!==b?(N=s.jsx(k,{onClick:j,children:b}),e[72]=j,e[73]=b,e[74]=N):N=e[74];let S;return e[75]!==n||e[76]!==N?(S=s.jsxs(s.Fragment,{children:[n,N]}),e[75]=n,e[76]=N,e[77]=S):S=e[77],S}default:return console.log(`Unknown trade status ${r.status}`),null}}function Z(t){const e=A.c(18),{children:r,trades:l}=t,[a,f]=I.useState(void 0);let i;if(e[0]!==a||e[1]!==l){let m;e[3]!==a?(m=o=>o.id===a,e[3]=a,e[4]=m):m=e[4],i=l.find(m),e[0]=a,e[1]=l,e[2]=i}else i=e[2];const g=i;if(l.length===0)return null;let c;if(e[5]!==a||e[6]!==l){let m;e[8]!==a?(m=o=>s.jsx(ut,{row:o,selectedTradeId:a,setSelectedTradeId:f},o.id),e[8]=a,e[9]=m):m=e[9],c=l.toSorted(ht).map(m),e[5]=a,e[6]=l,e[7]=c}else c=e[7];let _;e[10]!==c?(_=s.jsx("ul",{className:"flex flex-col gap-2 md:gap-0",children:c}),e[10]=c,e[11]=_):_=e[11];let x;e[12]!==g?(x=g&&s.jsx("div",{className:"flex gap-2 text-center items-center mt-2",children:s.jsx(xt,{trade:g,setSelected:f})}),e[12]=g,e[13]=x):x=e[13];let d;return e[14]!==r||e[15]!==_||e[16]!==x?(d=s.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-1 md:p-2",children:[_,r,x]}),e[14]=r,e[15]=_,e[16]=x,e[17]=d):d=e[17],d}function ht(t,e){return t.created_at>e.created_at?-1:1}function oe(t,e){const r=new Set(e),l=t.filter(a=>r.has(a)).map(a=>R(a)).filter(a=>K.includes(a.rarity)&&Ie.includes(a.expansion));return Object.groupBy(l,a=>a.rarity)}function _t(){const{t}=L(["trade-matches","common"]),{friendId:e}=Be(),[r]=_e(),{data:l,isLoading:a,isError:f}=ue(e),{data:i=new Map,isLoading:g,isError:c}=$e(e),{data:_}=D(),{data:x=new Map}=me(),[d,m]=I.useState(!1),[o,h]=I.useState(0),j=xe(l?.friend_id,d,o,!0),[v,T]=I.useState(null),[C,y]=I.useState(()=>{const n=r.get("friend_card");return n?R(Number(n))??null:null});if(I.useEffect(()=>{const n=r.get("friend_card");if(!n||!i||!x)return;const b=R(Number(n));if(!b)return;const N=document.getElementById(b.rarity);N&&N.scrollIntoView({behavior:"smooth"})},[r,i,x]),!_)return null;if(l===null)return s.jsx("p",{className:"text-xl text-center py-8",children:t("notFound")});if(f||c)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(a||g)return s.jsx(W,{size:"lg",overlay:!0});if(!l?.is_active_trading)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:l?.username})}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});const w=oe(re(x,_.trade_rarity_settings||[]),se(i,l.trade_rarity_settings||[])),u=oe(re(i,l.trade_rarity_settings||[]),se(x,_.trade_rarity_settings||[])),p=K.some(n=>(w[n]??[]).length>0&&(u[n]??[]).length>0);return s.jsxs("div",{className:"flex flex-col gap-4 w-full px-1 sm:px-2",children:[s.jsx("title",{children:`Trade with ${l.username} – TCG Pocket Collection Tracker`}),s.jsxs("div",{className:"mx-1 flex justify-between",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"text-2xl font-light",children:t("tradingWith")}),s.jsxs("span",{className:"text-2xl font-bold",children:[" ",l.username," "]}),s.jsx("span",{className:"block sm:inline text-sm",children:s.jsx(ge,{friendId:l.friend_id})})]}),s.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2",children:[s.jsxs("label",{htmlFor:`history-${e}`,className:"my-auto flex items-center",children:[t("viewHistory"),s.jsx(te,{id:`history-${e}`,className:"ml-2 my-auto",checked:d,onCheckedChange:n=>{m(n),h(0)}})]}),s.jsx(ee,{to:`/collection/${e}`,children:s.jsxs(k,{children:["Collection",s.jsx(O,{})]})})]})]}),j.isLoading?s.jsx(W,{size:"md"}):j.data&&s.jsx(Z,{trades:j.data.trades,children:s.jsxs("div",{className:"flex justify-between mt-2",children:[s.jsxs("span",{className:"text-neutral-400",children:[j.data.count," total offers"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{children:["Page ",o+1]}),s.jsx(k,{variant:"outline",onClick:()=>h(()=>0),disabled:o<=0,children:s.jsx(je,{})}),s.jsx(k,{variant:"outline",onClick:()=>h(n=>n-1),disabled:o<=0,children:s.jsx(he,{})}),s.jsx(k,{variant:"outline",onClick:()=>h(n=>n+1),disabled:!j.data.hasNext,children:s.jsx(O,{})})]})]})}),s.jsx(mt,{yourId:_.friend_id,friendId:l.friend_id,yourCard:v,friendCard:C,setYourCard:T,setFriendCard:y}),!p&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}),K.map(n=>s.jsxs("div",{children:[s.jsxs("h3",{id:n,className:"text-xl font-semibold mb-2 text-center",children:["[ ",n," ]"]}),s.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-4",children:[s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2 text-neutral-400",children:t("youHave")}),w[n]?s.jsx(de,{cards:w[n],selected:v,setSelected:T}):s.jsx("div",{className:"text-center text-neutral-500 rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]}),s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2 text-neutral-400",children:t("friendHas")}),u[n]?s.jsx(de,{cards:u[n],selected:C,setSelected:y}):s.jsx("div",{className:"text-center text-neutral-500  rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]})]})]},n))]})}function pt(){const{t}=L(["trade-matches","common"]),e=pe(),r=I.useRef(null),[l,a]=I.useState(""),[f,i]=I.useState(),g=Ge({search:l,rarity:[...K]},new Map),c=f&&R(f),_=ye({getScrollElement:()=>r.current,count:g.length,getItemKey:x=>g[x].card_id,estimateSize:()=>32});if(f&&!c)throw new Error("Selected card was not found in the database");return s.jsxs("div",{className:"sm:w-sm mx-auto",children:[s.jsx(Xe,{setValue:a}),s.jsx("div",{ref:r,className:"my-2 h-96 rounded border border-neutral-700 px-1 overflow-y-auto",children:s.jsx("ul",{style:{height:`${_.getTotalSize()}px`},className:"relative",children:_.getVirtualItems().map(x=>{const d=g[x.index];return s.jsx("button",{type:"button",className:"absolute top-0 left-0 w-full cursor-pointer",style:{height:`${x.size}px`,transform:`translateY(${x.start}px)`},onClick:()=>i(m=>m===d.internal_id?void 0:d.internal_id),children:s.jsx(H,{className:`w-full ${f===d.internal_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:d.card_id})},x.key)})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(k,{className:"w-1/2",disabled:!f,onClick:()=>e(`/trade/matches/results?card_id=${f}`),children:c?t("search.byCard",{cardName:Le(c,Ye.language)}):t("search.selectCard")}),s.jsx(k,{className:"w-1/2",onClick:()=>e("/trade/matches/results"),children:t("search.allCards")})]})]})}function gt(){const t=A.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=L(e),[l]=_e();let a;t[1]!==l?(a=l.has("card_id")?Number(l.get("card_id")):void 0,t[1]=l,t[2]=a):a=t[2];const f=a,{data:i,isLoading:g}=Ae(f);if(f!==void 0&&R(f)===void 0)throw new Error("Requested card was not found in the database");if(g){let d;t[3]!==r?(d=r("common:loading"),t[3]=r,t[4]=d):d=t[4];let m;t[5]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsx("br",{}),t[5]=m):m=t[5];let o;t[6]!==r?(o=r("longOperation"),t[6]=r,t[7]=o):o=t[7];let h;return t[8]!==d||t[9]!==o?(h=s.jsxs("p",{className:"text-xl text-center py-8",children:[d,m,o]}),t[8]=d,t[9]=o,t[10]=h):h=t[10],h}if(!i){let d;return t[11]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx(Fe,{}),t[11]=d):d=t[11],d}if(i.length===0){let d;t[12]!==r?(d=r("noTradePartners"),t[12]=r,t[13]=d):d=t[13];let m;return t[14]!==d?(m=s.jsx("p",{className:"text-xl text-center py-8",children:d}),t[14]=d,t[15]=m):m=t[15],m}const c=f?`?friend_card=${f}`:"";let _;if(t[16]!==i||t[17]!==c||t[18]!==r){let d;t[20]!==c||t[21]!==r?(d=m=>s.jsxs("div",{className:"max-w-md w-full flex justify-between items-center mx-auto px-4",children:[s.jsx("p",{className:"mr-2",children:m.username}),s.jsx(ee,{to:`/trade/${m.friend_id}${c}`,children:s.jsxs(k,{variant:"outline",className:"my-auto",children:[r("viewTradePartner",{tradeMatches:m.trade_matches}),s.jsx(O,{})]})})]},m.friend_id),t[20]=c,t[21]=r,t[22]=d):d=t[22],_=i.map(d),t[16]=i,t[17]=c,t[18]=r,t[19]=_}else _=t[19];let x;return t[23]!==_?(x=s.jsx("div",{className:"flex flex-col gap-4",children:_}),t[23]=_,t[24]=x):x=t[24],x}function jt(t){const e=A.c(44),{friendId:r,activeTrades:l}=t;let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=["trade-matches","common"],e[0]=a):a=e[0];const{t:f}=L(a),{data:i,isLoading:g}=ue(r),[c,_]=I.useState(!1),[x,d]=I.useState(0),m=xe(r,c,x,c);if(g)return null;let o;e[1]!==f?(o=f("tradingWith"),e[1]=f,e[2]=o):o=e[2];let h;e[3]!==o?(h=s.jsx("span",{className:"text-md",children:o}),e[3]=o,e[4]=h):h=e[4];const j=i?.username||"unknown";let v;e[5]!==j?(v=s.jsxs("span",{className:"text-md font-bold",children:[" ",j," "]}),e[5]=j,e[6]=v):v=e[6];let T;e[7]!==i?(T=i&&s.jsx(ge,{friendId:i.friend_id,showFriendId:!1,className:"ml-1"}),e[7]=i,e[8]=T):T=e[8];let C;e[9]!==h||e[10]!==v||e[11]!==T?(C=s.jsxs("p",{children:[h,v,T]}),e[9]=h,e[10]=v,e[11]=T,e[12]=C):C=e[12];const y=`history-${r}`;let w;e[13]!==f?(w=f("viewHistory"),e[13]=f,e[14]=w):w=e[14];const u=`history-${r}`;let p;e[15]!==u||e[16]!==c?(p=s.jsx(te,{id:u,className:"ml-2 my-auto",checked:c,onCheckedChange:_}),e[15]=u,e[16]=c,e[17]=p):p=e[17];let n;e[18]!==p||e[19]!==y||e[20]!==w?(n=s.jsxs("label",{htmlFor:y,className:"my-auto flex items-center",children:[w,p]}),e[18]=p,e[19]=y,e[20]=w,e[21]=n):n=e[21];const b=`/trade/${r}`;let N;e[22]!==f?(N=f("openTradeWith"),e[22]=f,e[23]=N):N=e[23];let S;e[24]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsx(O,{}),e[24]=S):S=e[24];let $;e[25]!==N?($=s.jsxs(k,{variant:"outline",className:"my-auto",children:[N,S]}),e[25]=N,e[26]=$):$=e[26];let F;e[27]!==b||e[28]!==$?(F=s.jsx(ee,{to:b,children:$}),e[27]=b,e[28]=$,e[29]=F):F=e[29];let E;e[30]!==n||e[31]!==F?(E=s.jsxs("span",{className:"flex gap-4",children:[n,F]}),e[30]=n,e[31]=F,e[32]=E):E=e[32];let P;e[33]!==E||e[34]!==C?(P=s.jsxs("div",{className:"flex justify-between items-center mb-1 mx-1",children:[C,E]}),e[33]=E,e[34]=C,e[35]=P):P=e[35];let z;e[36]!==l||e[37]!==m||e[38]!==x||e[39]!==c?(z=c?m.isLoading?s.jsx(W,{size:"md"}):m.data&&s.jsx(Z,{trades:m.data.trades,children:s.jsxs("p",{className:"flex justify-between mt-2",children:[s.jsxs("span",{className:"text-neutral-400",children:[m.data.count," total offers"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{children:["Page ",x+1]}),s.jsx(k,{variant:"outline",onClick:()=>d(yt),disabled:x<=0,children:s.jsx(je,{})}),s.jsx(k,{variant:"outline",onClick:()=>d(vt),disabled:x<=0,children:s.jsx(he,{})}),s.jsx(k,{variant:"outline",onClick:()=>d(bt),disabled:!m.data.hasNext,children:s.jsx(O,{})})]})]})}):s.jsx(Z,{trades:l}),e[36]=l,e[37]=m,e[38]=x,e[39]=c,e[40]=z):z=e[40];let U;return e[41]!==P||e[42]!==z?(U=s.jsxs("div",{className:"w-full",children:[P,z]}),e[41]=P,e[42]=z,e[43]=U):U=e[43],U}function bt(t){return t+1}function vt(t){return t-1}function yt(){return 0}function Nt(){const t=A.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=L(e),{data:l,isLoading:a}=D(),{data:f,isLoading:i}=Ee();if(a||i){let o;return t[1]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(W,{size:"lg",overlay:!0}),t[1]=o):o=t[1],o}if(!f||!l){let o;t[2]!==r?(o=r("common:error"),t[2]=r,t[3]=o):o=t[3];let h;return t[4]!==o?(h=s.jsx("p",{className:"text-xl text-center py-8",children:o}),t[4]=o,t[5]=h):h=t[5],h}if(f.length===0){let o;t[6]!==r?(o=r("noTradeOffers"),t[6]=r,t[7]=o):o=t[7];let h;return t[8]!==o?(h=s.jsx("p",{children:o}),t[8]=o,t[9]=h):h=t[9],h}let g,c;t[10]!==l.friend_id||t[11]!==f?(g=Tt(f,l.friend_id),c=Object.fromEntries(Object.entries(g).map(Ct)),t[10]=l.friend_id,t[11]=f,t[12]=g,t[13]=c):(g=t[12],c=t[13]);const _=c;let x,d;if(t[14]!==g||t[15]!==_){let o;t[18]!==_?(o=(v,T)=>_[T]-_[v],t[18]=_,t[19]=o):o=t[19];const h=Object.keys(g).toSorted(o);x="flex flex-col items-center mx-auto gap-6 sm:px-4 mb-12 w-full";let j;t[20]!==g?(j=v=>s.jsx(jt,{friendId:v,activeTrades:g[v]},v),t[20]=g,t[21]=j):j=t[21],d=h.map(j),t[14]=g,t[15]=_,t[16]=x,t[17]=d}else x=t[16],d=t[17];let m;return t[22]!==x||t[23]!==d?(m=s.jsx("div",{className:x,children:d}),t[22]=x,t[23]=d,t[24]=m):m=t[24],m}function Ct(t){const[e,r]=t;return[e,Math.max(...r.map(wt))]}function wt(t){return new Date(t.updated_at).getTime()}function Tt(t,e){return Object.groupBy(t,r=>r.offering_friend_id===e?r.receiving_friend_id:r.receiving_friend_id===e?r.offering_friend_id:(console.log("Fetched row does not match user friend_id",r),"undefined"))}function St(){const{t}=L("trade-matches"),{data:e}=D(),r=Pe(),l=ae({is_active_trading:Me(),trade_rarity_settings:ze(ae({rarity:He(Re),to_collect:le().min(0).max(100),to_keep:le().min(0).max(100)}))}),a=Je({resolver:Ze(l),values:{is_active_trading:e?.is_active_trading||!1,trade_rarity_settings:e?.trade_rarity_settings||[]}}),f=async i=>{r.mutate({username:e?.username,is_active_trading:i.is_active_trading,trade_rarity_settings:i.trade_rarity_settings},{onSuccess:()=>ne({title:t("accountSaved"),variant:"default"}),onError:g=>{console.error("error saving account",g),ne({title:t("errorSavingAccount"),variant:"destructive"})}})};return!e||!e.username?s.jsx(Oe,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:t("noAccount")}):s.jsxs("div",{children:[s.jsx(et,{...a,children:s.jsxs("form",{onSubmit:a.handleSubmit(f),className:"rounded-md border-1 border-neutral-700 space-y-2 p-4 mx-auto max-w-xl",children:[s.jsx("h2",{className:"text-xl text-center mb-6",children:t("settingsTitle")}),s.jsx(q,{control:a.control,name:"is_active_trading",render:({field:i})=>s.jsx(X,{className:"flex flex-col items-start",children:s.jsx(G,{children:s.jsxs(tt,{className:"flex",children:[t("isActiveTrading"),s.jsx(te,{className:"ml-2",checked:i.value,onCheckedChange:i.onChange,disabled:!e?.is_public,"data-tooltip-id":"is-active-trading-disabled","data-tooltip-content":e?.is_public?void 0:t("isActiveTradingDisabledTooltip")}),!e?.is_public&&s.jsxs(s.Fragment,{children:[s.jsx(V,{id:"is-active-trading-disabled"}),s.jsx(Y,{className:"size-4 ml-1","data-tooltip-id":"is-active-trading-disabled","data-tooltip-content":t("isActiveTradingDisabledTooltip")})]})]})})})}),s.jsxs("div",{className:"grid grid-cols-3 gap-y-2 gap-x-8 w-fit mt-6",children:[s.jsx("span",{children:t("rarity")}),s.jsxs("span",{className:"flex items-center",children:[t("toCollect"),s.jsx(V,{id:"to-collect"}),s.jsx(Y,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toCollectTooltip")})]}),s.jsxs("span",{className:"flex items-center",children:[t("toKeep"),s.jsx(V,{id:"to-collect"}),s.jsx(Y,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toKeepTooltip")})]}),a.watch("trade_rarity_settings").map((i,g)=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex-1",children:i.rarity},`label-${i.rarity}`),s.jsx(q,{control:a.control,name:`trade_rarity_settings.${g}.to_collect`,render:({field:c})=>s.jsx(X,{className:"flex-1",children:s.jsx(G,{children:s.jsx(ie,{className:"w-24",type:"number",...c})})})},`to-collect-${i.rarity}`),s.jsx(q,{control:a.control,name:`trade_rarity_settings.${g}.to_keep`,render:({field:c})=>s.jsx(X,{className:"flex-1",children:s.jsx(G,{children:s.jsx(ie,{className:"w-24",type:"number",...c})})})},`to-keep-${i.rarity}`)]}))]}),s.jsx(k,{type:"submit",className:"block ml-auto flex gap-2",disabled:r.isPending,isPending:r.isPending,children:t("save")})]})}),s.jsx(Qe,{className:"mt-4 mx-auto w-fit"})]})}function Kt(){const t=A.c(34),{t:e}=L("trade-matches"),r=De(),l=pe();let a;t[0]!==r.pathname?(a=r.pathname.split("/").pop()||"offers",t[0]=r.pathname,t[1]=a):a=t[1];const f=a;let i,g;t[2]!==r.pathname||t[3]!==l?(i=()=>{r.pathname==="/trade"&&l("/trade/offers")},g=[r.pathname,l],t[2]=r.pathname,t[3]=l,t[4]=i,t[5]=g):(i=t[4],g=t[5]),I.useEffect(i,g);let c;t[6]!==l?(c=n=>l(`/trade/${n}`),t[6]=l,t[7]=c):c=t[7];let _;t[8]!==e?(_=e("tabOffers"),t[8]=e,t[9]=_):_=t[9];let x;t[10]!==_?(x=s.jsx(Q,{className:"text-md",value:"offers",children:_}),t[10]=_,t[11]=x):x=t[11];let d;t[12]!==e?(d=e("tabMatches"),t[12]=e,t[13]=d):d=t[13];let m;t[14]!==d?(m=s.jsx(Q,{className:"text-md",value:"matches",children:d}),t[14]=d,t[15]=m):m=t[15];let o;t[16]!==e?(o=e("tabSettings"),t[16]=e,t[17]=o):o=t[17];let h;t[18]!==o?(h=s.jsx(Q,{className:"text-md",value:"settings",children:o}),t[18]=o,t[19]=h):h=t[19];let j;t[20]!==x||t[21]!==m||t[22]!==h?(j=s.jsxs(We,{className:"gap-4 mb-6 rounded-lg border-b-1 border-neutral-700 border-solid dark:bg-transparent pb-2",children:[x,m,h]}),t[20]=x,t[21]=m,t[22]=h,t[23]=j):j=t[23];let v;t[24]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(M,{path:"/",element:s.jsx(Ue,{to:"/trade/offers",replace:!0})}),t[24]=v):v=t[24];let T;t[25]===Symbol.for("react.memo_cache_sentinel")?(T=s.jsx(M,{path:"offers",element:s.jsx(Nt,{})}),t[25]=T):T=t[25];let C;t[26]===Symbol.for("react.memo_cache_sentinel")?(C=s.jsx(M,{path:"matches",element:s.jsx(pt,{})}),t[26]=C):C=t[26];let y;t[27]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx(M,{path:"matches/results",element:s.jsx(gt,{})}),t[27]=y):y=t[27];let w;t[28]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(M,{path:"settings",element:s.jsx(St,{})}),t[28]=w):w=t[28];let u;t[29]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsxs(Ve,{children:[v,T,C,y,w,s.jsx(M,{path:":friendId",element:s.jsx(_t,{})})]}),t[29]=u):u=t[29];let p;return t[30]!==f||t[31]!==j||t[32]!==c?(p=s.jsxs(Ke,{className:"flex flex-col mx-auto max-w-[900px]",value:f,onValueChange:c,children:[j,u]}),t[30]=f,t[31]=j,t[32]=c,t[33]=p):p=t[33],p}export{Kt as default};
