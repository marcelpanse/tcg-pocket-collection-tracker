import{j as s,d as ge}from"./query-vendor-DpGHCXpY.js";import{h as X,c as z,gU as H,gN as oe,gY as _e,gZ as q,B as I,p as fe,q as je,j as U,u as me,w as D,S as ue,g_ as ee,g$ as te,h0 as W,C as Z,h1 as be,h2 as ye,o as Ne,h3 as ve,h4 as Ce,h5 as Te,h6 as ke,h7 as Se,h8 as xe,h9 as we,g6 as se,fb as Ie,ff as $e,fy as Le,r as Fe,A as Ae,gT as re,t as ae}from"./index-BzHp76IK.js";import{e as Ee,j as Pe,r as F,L as J,u as Me,f as Oe,k as R,N as Re,l as ze}from"./react-vendor-DjlsVz29.js";import{T as V,a as He,b as Ue}from"./tabs-Ldv3abkq.js";import{F as he}from"./friend-id-display-BB5FbBAc.js";import{u as A,i as Be}from"./i18n-vendor-DDmeScd6.js";import{S as Ve}from"./SearchInput-DQ795cwr.js";import{g as De}from"./filters-DMH8BmfB.js";import{S as pe,a as We}from"./SocialShareButtons-BX8zTi6b.js";import{p as Ye}from"./ui-vendor-9yhwxkpr.js";import{M as Q,C as ne}from"./react-tooltip.min-Bn43uU6H.js";import{u as Ge,a as Ke,b as qe,F as Y,c as G,e as K,d as Qe}from"./form-DiVFzQum.js";import{n as ie}from"./coerce-C3wOUOiv.js";import"./charts-vendor-D-Ae2kUX.js";import"./supabase-vendor-CP3OYKhD.js";import"./xlsx-vendor-De4COjWB.js";import"./index-5ziEWJdO.js";const Xe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ze=X("arrow-left",Xe);const Je=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],et=X("arrow-right-left",Je);const tt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],st=X("arrow-right",tt),le=t=>{const e=z.c(15),{cards:r,selected:d,setSelected:n}=t;let x,f,m;if(e[0]!==r||e[1]!==d?.card_id||e[2]!==n){const g=[...r].sort(at);let p;e[6]!==d?.card_id||e[7]!==n?(p=function(i){const c=function(){d?.card_id===i.card_id?n(null):n(i)};return s.jsx("li",{className:"rounded cursor-pointer",onClick:c,children:s.jsx(H,{className:`w-full ${d?.card_id===i.card_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:i.card_id,rarity:"hidden"})},i.card_id)},e[6]=d?.card_id,e[7]=n,e[8]=p):p=e[8];const _=p;m="rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",x="space-y-1",f=g.map(_),e[0]=r,e[1]=d?.card_id,e[2]=n,e[3]=x,e[4]=f,e[5]=m}else x=e[3],f=e[4],m=e[5];let l;e[9]!==x||e[10]!==f?(l=s.jsx("ul",{className:x,children:f}),e[9]=x,e[10]=f,e[11]=l):l=e[11];let h;return e[12]!==m||e[13]!==l?(h=s.jsx("div",{className:m,children:l}),e[12]=m,e[13]=l,e[14]=h):h=e[14],h};function rt(t){const e=t.split("-"),r=e[0]||"",d=e.length>1?parseInt(e[1],10):0;return{setName:r,cardNumber:d}}function at(t,e){const r=rt,d=r(t.card_id),n=r(e.card_id);return d.setName!==n.setName?d.setName.localeCompare(n.setName):d.cardNumber-n.cardNumber}function de(t){return t?s.jsx(H,{card_id:t.card_id,details:"hidden"}):"—"}const nt=t=>{const e=z.c(45),{yourId:r,friendId:d,yourCard:n,friendCard:x,setYourCard:f,setFriendCard:m}=t,{t:l}=A("trade-matches"),{toast:h}=oe(),g=_e(),p=n&&x&&n.rarity===x.rarity;let _;e[0]!==p||e[1]!==x||e[2]!==d||e[3]!==g||e[4]!==m||e[5]!==f||e[6]!==l||e[7]!==h||e[8]!==n||e[9]!==r?(_=async function(){if(!p)return;const $={offering_friend_id:r,receiving_friend_id:d,offer_card_id:n.card_id,receiver_card_id:x.card_id,status:"offered"};try{g.mutate($)}catch(E){console.log("TradeOffer: Error inserting trade",E),h({title:l("tradeFailed"),variant:"default"})}f(null),m(null),h({title:l("tradeOffered"),variant:"default"}),q("Offer trade")},e[0]=p,e[1]=x,e[2]=d,e[3]=g,e[4]=m,e[5]=f,e[6]=l,e[7]=h,e[8]=n,e[9]=r,e[10]=_):_=e[10];const j=_;if(!n&&!x){let T;e[11]!==l?(T=l("selectCardsToTrade"),e[11]=l,e[12]=T):T=e[12];let $;return e[13]!==T?($=s.jsx("div",{className:"sticky top-0 z-10 flex rounded-lg border-1 bg-neutral-900 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[166px] sm:h-[110px]",children:s.jsx("h4",{className:"text-lg font-medium",children:T})}),e[13]=T,e[14]=$):$=e[14],$}let i;e[15]!==l?(i=l("youGive"),e[15]=l,e[16]=i):i=e[16];let c;e[17]!==i?(c=s.jsx("h4",{className:"text-lg font-medium",children:i}),e[17]=i,e[18]=c):c=e[18];let a;e[19]!==n?(a=de(n),e[19]=n,e[20]=a):a=e[20];let u;e[21]!==c||e[22]!==a?(u=s.jsxs("div",{className:"w-full sm:w-1/2",children:[c,a]}),e[21]=c,e[22]=a,e[23]=u):u=e[23];let o;e[24]!==l?(o=l("youReceive"),e[24]=l,e[25]=o):o=e[25];let y;e[26]!==o?(y=s.jsx("h4",{className:"text-lg font-medium",children:o}),e[26]=o,e[27]=y):y=e[27];let b;e[28]!==x?(b=de(x),e[28]=x,e[29]=b):b=e[29];let N;e[30]!==y||e[31]!==b?(N=s.jsxs("div",{className:"w-full sm:w-1/2",children:[y,b]}),e[30]=y,e[31]=b,e[32]=N):N=e[32];let v;e[33]!==u||e[34]!==N?(v=s.jsxs("div",{className:"flex flex-col sm:flex-row gap-x-4 gap-y-1 p-1",children:[u,N]}),e[33]=u,e[34]=N,e[35]=v):v=e[35];const k=!p;let S;e[36]!==l?(S=l("offerTrades"),e[36]=l,e[37]=S):S=e[37];let C;e[38]!==j||e[39]!==k||e[40]!==S?(C=s.jsx(I,{className:"block w-full sm:w-96 mx-auto mt-1 text-center",type:"button",variant:"outline",onClick:j,disabled:k,children:S}),e[38]=j,e[39]=k,e[40]=S,e[41]=C):C=e[41];let w;return e[42]!==v||e[43]!==C?(w=s.jsxs("div",{className:"sticky top-0 z-10 bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-1",children:[v,C]}),e[42]=v,e[43]=C,e[44]=w):w=e[44],w};function ce(t,e){const r=new Set(e),d=t.filter(n=>r.has(n)).map(n=>D(n)).filter(n=>W.includes(n.rarity)&&be.includes(n.expansion));return Object.groupBy(d,n=>n.rarity)}function it(){const{t}=A(["trade-matches","common"]),{friendId:e}=Ee(),[r]=Pe(),{data:d,isLoading:n,isError:x}=fe(e),{data:f=new Map,isLoading:m,isError:l}=je(e),{data:h}=U(),{data:g=new Map}=me(),[p,_]=F.useState(null),[j,i]=F.useState(()=>{const o=r.get("friend_card");return o?D(Number(o))??null:null});if(F.useEffect(()=>{const o=r.get("friend_card");if(!o||!f||!g)return;const y=D(Number(o));if(!y)return;const b=document.getElementById(y.rarity);b&&b.scrollIntoView({behavior:"smooth"})},[r,f,g]),!h)return null;if(d===null)return s.jsx("p",{className:"text-xl text-center py-8",children:t("notFound")});if(x||l)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(n||m)return s.jsx(ue,{size:"lg",overlay:!0});if(!d?.is_active_trading)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:d?.username})}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});const c=ce(te(g,h.trade_rarity_settings||[]),ee(f,d.trade_rarity_settings||[])),a=ce(te(f,d.trade_rarity_settings||[]),ee(g,h.trade_rarity_settings||[])),u=W.some(o=>(c[o]??[]).length>0&&(a[o]??[]).length>0);return s.jsxs("div",{className:"kap-4 justify-center w-full m-auto px-1 sm:px-2",children:[s.jsx("title",{children:`Trade with ${d.username} – TCG Pocket Collection Tracker`}),s.jsxs("div",{className:"mb-4 mx-1 flex justify-between",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"text-2xl font-light",children:t("tradingWith")}),s.jsxs("span",{className:"text-2xl font-bold",children:[" ",d.username," "]}),s.jsx("span",{className:"block sm:inline text-sm",children:s.jsx(he,{friendId:d.friend_id})})]}),s.jsx(J,{to:`/collection/${e}`,children:s.jsxs(I,{children:["Collection",s.jsx(Z,{})]})})]}),s.jsx(nt,{yourId:h.friend_id,friendId:d.friend_id,yourCard:p,friendCard:j,setYourCard:_,setFriendCard:i}),!u&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),s.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}),W.map(o=>s.jsxs("div",{className:"mt-4",children:[s.jsxs("h3",{id:o,className:"text-xl font-semibold mb-2 text-center",children:["[ ",o," ]"]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("youHave")}),c[o]?s.jsx(le,{cards:c[o],selected:p,setSelected:_}):s.jsx("div",{className:"text-center text-neutral-500 rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]}),s.jsxs("div",{className:"w-full sm:w-1/2",children:[s.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:t("friendHas")}),a[o]?s.jsx(le,{cards:a[o],selected:j,setSelected:i}):s.jsx("div",{className:"text-center text-neutral-500  rounded-lg border-1 border-neutral-700 border-solid p-2",children:"No cards to trade"})]})]})]},o))]})}function lt(){const{t}=A(["trade-matches","common"]),e=F.useRef(null),[r,d]=F.useState(""),[n,x]=F.useState(),[f,m]=F.useState(!1),l=De({search:r,rarity:[...W]},new Map),h=n&&D(n),{data:g,isLoading:p,isError:_}=ye(f,n),j=ge({getScrollElement:()=>e.current,count:l.length,getItemKey:c=>l[c].card_id,estimateSize:()=>32});if(n&&!h)throw new Error("Card selected was not found in the database!");if(!f)return s.jsxs("div",{className:"sm:w-sm mx-auto",children:[s.jsx(Ve,{setValue:d}),s.jsx("div",{ref:e,className:"my-2 h-96 rounded border border-neutral-700 px-1 overflow-y-auto",children:s.jsx("ul",{style:{height:`${j.getTotalSize()}px`},className:"relative",children:j.getVirtualItems().map(c=>{const a=l[c.index];return s.jsx("button",{type:"button",className:"absolute top-0 left-0 w-full cursor-pointer",style:{height:`${c.size}px`,transform:`translateY(${c.start}px)`},onClick:()=>x(u=>u===a.internal_id?void 0:a.internal_id),children:s.jsx(H,{className:`w-full ${n===a.internal_id&&"bg-green-900"} hover:bg-neutral-600`,card_id:a.card_id})},c.key)})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(I,{className:"w-1/2",disabled:!n,onClick:()=>{m(!0)},children:h?t("search.byCard",{cardName:Ne(h,Be.language)}):t("search.selectCard")}),s.jsx(I,{className:"w-1/2",onClick:()=>{x(void 0),m(!0)},children:t("search.allCards")})]})]});if(p)return s.jsxs("p",{className:"text-xl text-center py-8",children:[t("common:loading"),s.jsx("br",{}),t("longOperation")]});if(_||!g)return s.jsx("p",{className:"text-xl text-center py-8",children:t("common:error")});if(g.length===0)return s.jsx("p",{className:"text-xl text-center py-8",children:t("noTradePartners")});const i=n?`?friend_card=${n}`:"";return s.jsx("div",{className:"flex flex-col gap-4",children:g.map(c=>s.jsxs("div",{className:"max-w-md w-full flex justify-between items-center mx-auto px-4",children:[s.jsx("p",{className:"mr-2",children:c.username}),s.jsx(J,{to:`/trade/${c.friend_id}${i}`,children:s.jsxs(I,{variant:"outline",className:"my-auto",children:[t("viewTradePartner",{tradeMatches:c.trade_matches}),s.jsx(Z,{})]})})]},c.friend_id))})}const dt=t=>{const e=z.c(28),{row:r,selectedTradeId:d,setSelectedTradeId:n}=t,{t:x}=A("trade-matches"),{data:f,isLoading:m}=U();if(m)return null;if(!f){let N;e[0]!==x?(N=x("common:error"),e[0]=x,e[1]=N):N=e[1];let v;return e[2]!==N?(v=s.jsx("p",{className:"text-xl text-center py-8",children:N}),e[2]=N,e[3]=v):v=e[3],v}const l=r.offering_friend_id===f.friend_id?r.offer_card_id:r.receiver_card_id,h=r.offering_friend_id===f.friend_id?r.receiver_card_id:r.offer_card_id;let g;e[4]!==d||e[5]!==n?(g=function(v){d===v.id?n(void 0):n(v.id)},e[4]=d,e[5]=n,e[6]=g):g=e[6];const p=g;let _;e[7]!==f.friend_id||e[8]!==x?(_=N=>{const v={offered:N.offering_friend_id===f.friend_id?s.jsx(st,{className:"bg-amber-600"}):s.jsx(Ze,{className:"bg-amber-600"}),accepted:s.jsx(et,{className:"bg-lime-600"}),declined:s.jsx(Ce,{className:"bg-stone-600"}),finished:s.jsx(ve,{className:"bg-indigo-600"})};return s.jsxs(s.Fragment,{children:[s.jsx(Q,{id:`status-${N.id}`}),s.jsx(Ye,{className:"rounded-full p-[3px] my-auto","data-tooltip-id":`status-${N.id}`,"data-tooltip-content":x(`status.${N.status}`),children:v[N.status]})]})},e[7]=f.friend_id,e[8]=x,e[9]=_):_=e[9];const j=_,i=`flex cursor-pointer rounded gap-1 md:gap-2 p-1 ${d===r.id&&"bg-green-900"} hover:bg-neutral-500`;let c;e[10]!==p||e[11]!==r?(c=()=>p(r),e[10]=p,e[11]=r,e[12]=c):c=e[12];let a;e[13]!==r||e[14]!==j?(a=j(r),e[13]=r,e[14]=j,e[15]=a):a=e[15];let u;e[16]!==l?(u=s.jsx(H,{className:"md:w-1/2",card_id:l,increment:-1}),e[16]=l,e[17]=u):u=e[17];let o;e[18]!==h?(o=s.jsx(H,{className:"md:w-1/2",card_id:h,increment:1}),e[18]=h,e[19]=o):o=e[19];let y;e[20]!==u||e[21]!==o?(y=s.jsxs("div",{className:"flex flex-col md:flex-row grow-1 justify-between gap-1 md:gap-2",children:[u,o]}),e[20]=u,e[21]=o,e[22]=y):y=e[22];let b;return e[23]!==i||e[24]!==c||e[25]!==a||e[26]!==y?(b=s.jsxs("li",{className:i,onClick:c,children:[a,y]}),e[23]=i,e[24]=c,e[25]=a,e[26]=y,e[27]=b):b=e[27],b};function ct({trades:t,viewHistory:e}){const{t:r}=A("trade-matches"),{toast:d}=oe(),{data:n}=U(),{data:x=new Map}=me(),f=Te();function m(a){return a.offering_friend_id===n?.friend_id&&!a.offerer_ended||a.receiving_friend_id===n?.friend_id&&!a.receiver_ended}const l=e?t.filter(a=>!m(a)):t.filter(m),[h,g]=F.useState(void 0),p=ke();if(!n)return null;const _=(a,u)=>{const o=Se(a);return{card_id:a,internal_id:o,amount_owned:(x.get(o)?.amount_owned??0)+u}},j=async a=>{if(a.offer_card_id!==a.receiver_card_id)if(a.offering_friend_id===n.friend_id){const u=[_(a.offer_card_id,-1),_(a.receiver_card_id,1)];f.mutate({updates:u}),d({title:r("collectionUpdated"),variant:"default"})}else if(a.receiving_friend_id===n.friend_id){const u=[_(a.offer_card_id,1),_(a.receiver_card_id,-1)];f.mutate({updates:u}),d({title:r("collectionUpdated"),variant:"default"})}else console.log(a,"can't match friend id")},i=a=>{const u=async b=>{p.mutate({id:a.id,trade:{status:b}}),g(a.id),q(`Updated trade: ${b}`)},o=async()=>{const b=a.offering_friend_id===n.friend_id?{offerer_ended:!0}:a.receiving_friend_id===n.friend_id?{receiver_ended:!0}:null;if(b===null){console.log(a," doesn't match your friend_id");return}p.mutate({id:a.id,trade:b}),g(void 0),q("Updated trade: ended")},y=a.offering_friend_id===n.friend_id&&a.offerer_ended||a.receiving_friend_id===n.friend_id&&a.receiver_ended;switch(a.status){case"offered":return s.jsxs(s.Fragment,{children:[a.receiving_friend_id===n.friend_id&&s.jsx(I,{type:"button",onClick:async()=>u("accepted"),children:r("actionAccept")}),s.jsx(I,{type:"button",onClick:async()=>u("declined"),children:a.receiving_friend_id===n.friend_id?r("actionDecline"):r("actionCancel")})]});case"accepted":return s.jsxs(s.Fragment,{children:[s.jsx(I,{type:"button",onClick:async()=>u("finished"),children:r("actionComplete")}),s.jsx(I,{type:"button",onClick:async()=>u("declined"),children:r("actionCancel")})]});case"declined":return y?null:s.jsx(I,{type:"button",onClick:o,children:r("actionHide")});case"finished":return y?null:s.jsxs(s.Fragment,{children:[s.jsx(I,{type:"button",onClick:async()=>{await j(a),await o()},children:r("actionUpdate")}),s.jsx(I,{type:"button",onClick:o,children:r("actionHide")})]});default:return console.log(`Unknown trade status ${a.status}`),null}},c=l.find(a=>a.id===h);return l.length===0?null:s.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-1 md:p-2",children:[s.jsxs("div",{className:"hidden md:flex pr-1",children:[s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:r("youGive")}),s.jsx("h4",{className:"text-lg font-medium w-1/2 ml-8",children:r("youReceive")})]}),s.jsx("ul",{className:"flex flex-col gap-2 md:gap-0",children:l.toSorted((a,u)=>a.created_at>u.created_at?-1:1).map(a=>s.jsx(dt,{row:a,selectedTradeId:h,setSelectedTradeId:g},a.id))}),c&&s.jsx("div",{className:"flex gap-4 text-center items-center mt-2",children:i(c)})]})}function ot(t){const e=z.c(52),{friendId:r}=t;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=["trade-matches","common"],e[0]=d):d=e[0];const{t:n}=A(d),{data:x,isLoading:f}=xe(),{data:m,isLoading:l}=fe(r),[h,g]=F.useState(!1);if(f||l)return null;if(!x){let L;e[1]!==n?(L=n("common:error"),e[1]=n,e[2]=L):L=e[2];let M;return e[3]!==L?(M=s.jsx("p",{className:"text-xl text-center py-8",children:L}),e[3]=L,e[4]=M):M=e[4],M}let p;if(e[5]!==r||e[6]!==x){let L;e[8]!==r?(L=M=>M.offering_friend_id===r||M.receiving_friend_id===r,e[8]=r,e[9]=L):L=e[9],p=x.filter(L),e[5]=r,e[6]=x,e[7]=p}else p=e[7];const _=p;let j;e[10]!==n?(j=n("tradingWith"),e[10]=n,e[11]=j):j=e[11];let i;e[12]!==j?(i=s.jsx("span",{className:"text-md",children:j}),e[12]=j,e[13]=i):i=e[13];const c=m?.username||"unknown";let a;e[14]!==c?(a=s.jsxs("span",{className:"text-md font-bold",children:[" ",c," "]}),e[14]=c,e[15]=a):a=e[15];let u;e[16]!==m?(u=m&&s.jsx(he,{friendId:m.friend_id,showFriendId:!1,className:"ml-1"}),e[16]=m,e[17]=u):u=e[17];let o;e[18]!==i||e[19]!==a||e[20]!==u?(o=s.jsxs("p",{children:[i,a,u]}),e[18]=i,e[19]=a,e[20]=u,e[21]=o):o=e[21];const y=`history-${r}`;let b;e[22]!==n?(b=n("viewHistory"),e[22]=n,e[23]=b):b=e[23];const N=`history-${r}`;let v;e[24]!==N||e[25]!==h?(v=s.jsx(pe,{id:N,className:"ml-2 my-auto",checked:h,onCheckedChange:g}),e[24]=N,e[25]=h,e[26]=v):v=e[26];let k;e[27]!==b||e[28]!==v||e[29]!==y?(k=s.jsxs("label",{htmlFor:y,className:"my-auto flex items-center",children:[b,v]}),e[27]=b,e[28]=v,e[29]=y,e[30]=k):k=e[30];const S=`/trade/${r}`;let C;e[31]!==n?(C=n("openTradeWith"),e[31]=n,e[32]=C):C=e[32];let w;e[33]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(Z,{}),e[33]=w):w=e[33];let T;e[34]!==C?(T=s.jsxs(I,{variant:"outline",className:"my-auto",children:[C,w]}),e[34]=C,e[35]=T):T=e[35];let $;e[36]!==S||e[37]!==T?($=s.jsx(J,{to:S,children:T}),e[36]=S,e[37]=T,e[38]=$):$=e[38];let E;e[39]!==k||e[40]!==$?(E=s.jsxs("span",{className:"flex gap-4",children:[k,$]}),e[39]=k,e[40]=$,e[41]=E):E=e[41];let P;e[42]!==E||e[43]!==o?(P=s.jsxs("div",{className:"flex justify-between items-center mb-1 mx-1",children:[o,E]}),e[42]=E,e[43]=o,e[44]=P):P=e[44];let O;e[45]!==m||e[46]!==_||e[47]!==h?(O=m!==null&&s.jsx(ct,{trades:_,viewHistory:h}),e[45]=m,e[46]=_,e[47]=h,e[48]=O):O=e[48];let B;return e[49]!==P||e[50]!==O?(B=s.jsxs("div",{className:"w-full",children:[P,O]}),e[49]=P,e[50]=O,e[51]=B):B=e[51],B}function ft(){const t=z.c(26);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["trade-matches","common"],t[0]=e):e=t[0];const{t:r}=A(e),{data:d,isLoading:n}=U(),{data:x,isLoading:f}=xe();if(n||f){let i;return t[1]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(ue,{size:"lg",overlay:!0}),t[1]=i):i=t[1],i}if(!x||!d){let i;t[2]!==r?(i=r("common:error"),t[2]=r,t[3]=i):i=t[3];let c;return t[4]!==i?(c=s.jsx("p",{className:"text-xl text-center py-8",children:i}),t[4]=i,t[5]=c):c=t[5],c}if(x.length===0){let i;t[6]!==r?(i=r("noTradeOffers"),t[6]=r,t[7]=i):i=t[7];let c;return t[8]!==i?(c=s.jsx("p",{children:i}),t[8]=i,t[9]=c):c=t[9],c}let m,l,h;t[10]!==d.friend_id||t[11]!==x?(m=pt(x,d.friend_id),l=Object.fromEntries(Object.entries(m).map(i=>{const[c,a]=i;return[c,+(ht(a,d.friend_id).length===0)]})),h=Object.fromEntries(Object.entries(m).map(ut)),t[10]=d.friend_id,t[11]=x,t[12]=m,t[13]=l,t[14]=h):(m=t[12],l=t[13],h=t[14]);const g=h;let p,_;if(t[15]!==m||t[16]!==l||t[17]!==g){let i;t[20]!==l||t[21]!==g?(i=(a,u)=>l[a]!==l[u]?l[a]-l[u]:g[u]-g[a],t[20]=l,t[21]=g,t[22]=i):i=t[22];const c=Object.keys(m).toSorted(i);p="flex flex-col items-center mx-auto gap-6 sm:px-4 mb-12 w-full",_=c.map(mt),t[15]=m,t[16]=l,t[17]=g,t[18]=p,t[19]=_}else p=t[18],_=t[19];let j;return t[23]!==p||t[24]!==_?(j=s.jsx("div",{className:p,children:_}),t[23]=p,t[24]=_,t[25]=j):j=t[25],j}function mt(t){return s.jsx(ot,{friendId:t},t)}function ut(t){const[e,r]=t;return[e,Math.max(...r.map(xt))]}function xt(t){return new Date(t.updated_at).getTime()}function ht(t,e){return t.filter(r=>r.offering_friend_id===e?!r.offerer_ended:!r.receiver_ended)}function pt(t,e){return Object.groupBy(t,r=>r.offering_friend_id===e?r.receiving_friend_id:r.receiving_friend_id===e?r.offering_friend_id:(console.log("Fetched row does not match user friend_id",r),"undefined"))}function gt(){const{t}=A("trade-matches"),{data:e}=U(),r=we(),d=se({is_active_trading:$e(),trade_rarity_settings:Ie(se({rarity:Le(Fe),to_collect:ie().min(0).max(100),to_keep:ie().min(0).max(100)}))}),n=Ge({resolver:Ke(d),values:{is_active_trading:e?.is_active_trading||!1,trade_rarity_settings:e?.trade_rarity_settings||[]}}),x=async f=>{r.mutate({username:e?.username,is_active_trading:f.is_active_trading,trade_rarity_settings:f.trade_rarity_settings},{onSuccess:()=>ae({title:t("accountSaved"),variant:"default"}),onError:m=>{console.error("error saving account",m),ae({title:t("errorSavingAccount"),variant:"destructive"})}})};return!e||!e.username?s.jsx(Ae,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:t("noAccount")}):s.jsxs("div",{children:[s.jsx(qe,{...n,children:s.jsxs("form",{onSubmit:n.handleSubmit(x),className:"rounded-md border-1 border-neutral-700 space-y-2 p-4 mx-auto max-w-xl",children:[s.jsx("h2",{className:"text-xl text-center mb-6",children:t("settingsTitle")}),s.jsx(Y,{control:n.control,name:"is_active_trading",render:({field:f})=>s.jsx(G,{className:"flex flex-col items-start",children:s.jsx(K,{children:s.jsxs(Qe,{className:"flex",children:[t("isActiveTrading"),s.jsx(pe,{className:"ml-2",checked:f.value,onCheckedChange:f.onChange})]})})})}),s.jsxs("div",{className:"grid grid-cols-3 gap-y-2 gap-x-8 w-fit mt-6",children:[s.jsx("span",{children:t("rarity")}),s.jsxs("span",{className:"flex items-center",children:[t("toCollect"),s.jsx(Q,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toCollectTooltip")})]}),s.jsxs("span",{className:"flex items-center",children:[t("toKeep"),s.jsx(Q,{id:"to-collect"}),s.jsx(ne,{className:"size-4 ml-1","data-tooltip-id":"to-collect","data-tooltip-content":t("toKeepTooltip")})]}),n.watch("trade_rarity_settings").map((f,m)=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex-1",children:f.rarity},`label-${f.rarity}`),s.jsx(Y,{control:n.control,name:`trade_rarity_settings.${m}.to_collect`,render:({field:l})=>s.jsx(G,{className:"flex-1",children:s.jsx(K,{children:s.jsx(re,{className:"w-24",type:"number",...l})})})},`to-collect-${f.rarity}`),s.jsx(Y,{control:n.control,name:`trade_rarity_settings.${m}.to_keep`,render:({field:l})=>s.jsx(G,{className:"flex-1",children:s.jsx(K,{children:s.jsx(re,{className:"w-24",type:"number",...l})})})},`to-keep-${f.rarity}`)]}))]}),s.jsx(I,{type:"submit",className:"block ml-auto flex gap-2",disabled:r.isPending,isPending:r.isPending,children:t("save")})]})}),s.jsx(We,{className:"mt-4 mx-auto w-fit"})]})}function Pt(){const t=z.c(45),{t:e}=A("trade-matches"),r=Me(),d=Oe();let n;t[0]!==r.pathname?(n=r.pathname.split("/").pop()||"offers",t[0]=r.pathname,t[1]=n):n=t[1];const x=n;let f,m;t[2]!==r.pathname||t[3]!==d?(f=()=>{r.pathname==="/trade"&&d("/trade/offers")},m=[r.pathname,d],t[2]=r.pathname,t[3]=d,t[4]=f,t[5]=m):(f=t[4],m=t[5]),F.useEffect(f,m);let l;t[6]!==d?(l=T=>d(`/trade/${T}`),t[6]=d,t[7]=l):l=t[7];let h;t[8]!==e?(h=e("tabCards"),t[8]=e,t[9]=h):h=t[9];let g;t[10]!==h?(g=s.jsx(V,{className:"text-md",value:"cards",children:h}),t[10]=h,t[11]=g):g=t[11];let p;t[12]!==e?(p=e("tabOffers"),t[12]=e,t[13]=p):p=t[13];let _;t[14]!==p?(_=s.jsx(V,{className:"text-md",value:"offers",children:p}),t[14]=p,t[15]=_):_=t[15];let j;t[16]!==e?(j=e("tabMatches"),t[16]=e,t[17]=j):j=t[17];let i;t[18]!==j?(i=s.jsx(V,{className:"text-md",value:"matches",children:j}),t[18]=j,t[19]=i):i=t[19];let c;t[20]!==e?(c=e("tabSettings"),t[20]=e,t[21]=c):c=t[21];let a;t[22]!==c?(a=s.jsx(V,{className:"text-md",value:"settings",children:c}),t[22]=c,t[23]=a):a=t[23];let u;t[24]!==a||t[25]!==g||t[26]!==_||t[27]!==i?(u=s.jsxs(He,{className:"gap-4 mb-6 rounded-lg border-b-1 border-neutral-700 border-solid dark:bg-transparent pb-2",children:[g,_,i,a]}),t[24]=a,t[25]=g,t[26]=_,t[27]=i,t[28]=u):u=t[28];let o;t[29]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(R,{path:"/",element:s.jsx(Re,{to:"/trade/offers",replace:!0})}),t[29]=o):o=t[29];let y;t[30]!==e?(y=e("movedToCollectionPage"),t[30]=e,t[31]=y):y=t[31];let b;t[32]!==y?(b=s.jsx(R,{path:"cards",element:s.jsx("p",{children:y})}),t[32]=y,t[33]=b):b=t[33];let N;t[34]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx(R,{path:"offers",element:s.jsx(ft,{})}),t[34]=N):N=t[34];let v;t[35]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(R,{path:"matches",element:s.jsx(lt,{})}),t[35]=v):v=t[35];let k;t[36]===Symbol.for("react.memo_cache_sentinel")?(k=s.jsx(R,{path:"settings",element:s.jsx(gt,{})}),t[36]=k):k=t[36];let S;t[37]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsx(R,{path:":friendId",element:s.jsx(it,{})}),t[37]=S):S=t[37];let C;t[38]!==b?(C=s.jsxs(ze,{children:[o,b,N,v,k,S]}),t[38]=b,t[39]=C):C=t[39];let w;return t[40]!==x||t[41]!==u||t[42]!==C||t[43]!==l?(w=s.jsxs(Ue,{className:"flex flex-col mx-auto max-w-[900px]",value:x,onValueChange:l,children:[u,C]}),t[40]=x,t[41]=u,t[42]=C,t[43]=l,t[44]=w):w=t[44],w}export{Pt as default};
