import{y as ie,z as ce,v as le,t as O,A as de,B as ue,u as N,j as o,r as u,C as D,D as pe,E as xe,m as me,F as fe,G as $,n as z,H as j,J as U,K as G,L as he,M as ge,N as ve,O as we,Q as Ce,S as ye,T as be,U as Pe,V as je,f as Ne,W as ke,X as S,Y as Te,x as F,Z as y,_ as Ae,$ as _e,a0 as Re,a1 as Se,a2 as Me,a3 as Oe,a4 as Fe,a5 as H,a6 as Ee,a7 as Le,o as Ie}from"./index-DM66uHuQ.js";import{A as Be,a as De,b as $e}from"./alert-DbsuPiPY.js";import{R as E,D as ze,u as Ue}from"./index-DWecfz4-.js";import{C as Ge}from"./CardsTable-iPL2HSwO.js";import{S as L}from"./SearchInput-Bd5VMz1q.js";import{e as He,c as Ve,D as P,T,a as Ke,r as Qe}from"./useWindowDimensionsHook-DeK-NN5u.js";import{M as We,C as qe}from"./react-tooltip.min-Dif00vlJ.js";import{S as Ze}from"./siren-D04hOA67.js";import"./utils-CgIIUNO6.js";import"./Card-BqnD2iqk.js";import"./FancyCard-g6fvBT2B.js";import"./index-B1TIJj_J.js";function Je(e,s){if(e.length===0)return s.length;if(s.length===0)return e.length;let n=Array(e.length+1).fill(0).map((a,r)=>r),t=Array(e.length+1);for(let a=1;a<=s.length;a++){t[0]=a;for(let r=1;r<=e.length;r++){const i=e[r-1]===s[a-1]?0:1;t[r]=Math.min(n[r]+1,t[r-1]+1,n[r-1]+i)}[n,t]=[t,n]}return n[e.length]}const _=["all","missing","owned"],R=["all",...He],V=["default","recent","expansion-newest"],K=Ve;function Xe(e,s){let n=ie;if(e.deckbuildingMode&&(n=n.filter(t=>ce.includes(t.rarity)||t.rarity==="P")),e.expansion!=="all"&&(n=n.filter(t=>t.expansion===e.expansion)),e.pack!=="all"&&(n=n.filter(t=>t.pack===e.pack||t.pack==="everypack")),e.owned!=="all"&&(e.owned==="owned"?n=n.filter(t=>t.collected):e.owned==="missing"&&(n=n.filter(t=>!t.collected))),e.sortBy==="recent")n=[...n].sort((t,a)=>{const r=s.get(t.internal_id)?.updated_at,i=s.get(a.internal_id)?.updated_at;return r&&i?new Date(i).getTime()-new Date(r).getTime():r&&!i?-1:1});else if(e.sortBy==="expansion-newest"){const t=[...le].reverse();n=[...n].sort((a,r)=>{const i=t.findIndex(c=>c.id===a.expansion),l=t.findIndex(c=>c.id===r.expansion);return i!==l?i-l:a.card_id.localeCompare(r.card_id,O.language||"en",{numeric:!0})})}n=n.filter(t=>e.rarity.length===0?!0:e.rarity.includes(t.rarity)),n=n.filter(t=>e.cardType.length===0?!0:t.card_type.toLowerCase()==="trainer"?e.cardType.includes("trainer"):e.cardType.includes(t.energy.toLowerCase())),e.search&&(n=n.filter(a=>{const r=de(a,O.language).toLowerCase(),i=e.search.toLowerCase();let l=!1;e.allTextSearch&&(l=a.ability&&(a.ability.name.toLowerCase().includes(i)||a.ability.effect.toLowerCase().includes(i))||a.attacks.some(p=>p.name?.toLowerCase().includes(i)||p.effect?.toLowerCase()!=="no effect"&&p.effect?.toLowerCase()?.includes(i)));const c=r.includes(i),g=Je(r,i)<=2,v=a.card_id.toLowerCase().includes(i);return l||c||g||v}));for(const t of n)e.deckbuildingMode?t.amount_owned=t.alternate_versions.reduce((a,r)=>{const i=ue(r);return a+(s.get(i?.internal_id||0)?.amount_owned??0)},0):t.amount_owned=s.get(t.internal_id)?.amount_owned??0,t.collected=s.get(t.internal_id)?.collection.includes(t.card_id)??!1;return n=n.filter(t=>(t.amount_owned??0)>=e.minNumber),e.maxNumber!==100&&(n=n.filter(t=>(t.amount_owned??0)<=e.maxNumber)),n}const Ye=({allTextSearch:e,setAllTextSearch:s})=>{const{t:n}=N("search-input");return o.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[o.jsx("input",{type:"checkbox",id:"checkbox",checked:e,onChange:()=>s(!e),className:"w-4 h-4"}),o.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:n("allTextLabel")}),o.jsx(We,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),o.jsx(qe,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":n("allTextTooltip")})]})};var A="Popover",[Q]=me(A,[D]),k=D(),[et,C]=Q(A),W=e=>{const{__scopePopover:s,children:n,open:t,defaultOpen:a,onOpenChange:r,modal:i=!1}=e,l=k(s),c=u.useRef(null),[g,v]=u.useState(!1),[p,x]=pe({prop:t,defaultProp:a??!1,onChange:r,caller:A});return o.jsx(xe,{...l,children:o.jsx(et,{scope:s,contentId:fe(),triggerRef:c,open:p,onOpenChange:x,onOpenToggle:u.useCallback(()=>x(m=>!m),[x]),hasCustomAnchor:g,onCustomAnchorAdd:u.useCallback(()=>v(!0),[]),onCustomAnchorRemove:u.useCallback(()=>v(!1),[]),modal:i,children:n})})};W.displayName=A;var q="PopoverAnchor",tt=u.forwardRef((e,s)=>{const{__scopePopover:n,...t}=e,a=C(q,n),r=k(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:l}=a;return u.useEffect(()=>(i(),()=>l()),[i,l]),o.jsx(U,{...r,...t,ref:s})});tt.displayName=q;var Z="PopoverTrigger",J=u.forwardRef((e,s)=>{const{__scopePopover:n,...t}=e,a=C(Z,n),r=k(n),i=$(s,a.triggerRef),l=o.jsx(z.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":oe(a.open),...t,ref:i,onClick:j(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:o.jsx(U,{asChild:!0,...r,children:l})});J.displayName=Z;var M="PopoverPortal",[ot,nt]=Q(M,{forceMount:void 0}),X=e=>{const{__scopePopover:s,forceMount:n,children:t,container:a}=e,r=C(M,s);return o.jsx(ot,{scope:s,forceMount:n,children:o.jsx(G,{present:n||r.open,children:o.jsx(he,{asChild:!0,container:a,children:t})})})};X.displayName=M;var b="PopoverContent",Y=u.forwardRef((e,s)=>{const n=nt(b,e.__scopePopover),{forceMount:t=n.forceMount,...a}=e,r=C(b,e.__scopePopover);return o.jsx(G,{present:t||r.open,children:r.modal?o.jsx(rt,{...a,ref:s}):o.jsx(st,{...a,ref:s})})});Y.displayName=b;var at=we("PopoverContent.RemoveScroll"),rt=u.forwardRef((e,s)=>{const n=C(b,e.__scopePopover),t=u.useRef(null),a=$(s,t),r=u.useRef(!1);return u.useEffect(()=>{const i=t.current;if(i)return ge(i)},[]),o.jsx(ve,{as:at,allowPinchZoom:!0,children:o.jsx(ee,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:j(e.onCloseAutoFocus,i=>{i.preventDefault(),r.current||n.triggerRef.current?.focus()}),onPointerDownOutside:j(e.onPointerDownOutside,i=>{const l=i.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,g=l.button===2||c;r.current=g},{checkForDefaultPrevented:!1}),onFocusOutside:j(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),st=u.forwardRef((e,s)=>{const n=C(b,e.__scopePopover),t=u.useRef(!1),a=u.useRef(!1);return o.jsx(ee,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{e.onCloseAutoFocus?.(r),r.defaultPrevented||(t.current||n.triggerRef.current?.focus(),r.preventDefault()),t.current=!1,a.current=!1},onInteractOutside:r=>{e.onInteractOutside?.(r),r.defaultPrevented||(t.current=!0,r.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=r.target;n.triggerRef.current?.contains(i)&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&a.current&&r.preventDefault()}})}),ee=u.forwardRef((e,s)=>{const{__scopePopover:n,trapFocus:t,onOpenAutoFocus:a,onCloseAutoFocus:r,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:g,onInteractOutside:v,...p}=e,x=C(b,n),m=k(n);return Ce(),o.jsx(ye,{asChild:!0,loop:!0,trapped:t,onMountAutoFocus:a,onUnmountAutoFocus:r,children:o.jsx(be,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:v,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:g,onDismiss:()=>x.onOpenChange(!1),children:o.jsx(Pe,{"data-state":oe(x.open),role:"dialog",id:x.contentId,...m,...p,ref:s,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),te="PopoverClose",it=u.forwardRef((e,s)=>{const{__scopePopover:n,...t}=e,a=C(te,n);return o.jsx(z.button,{type:"button",...t,ref:s,onClick:j(e.onClick,()=>a.onOpenChange(!1))})});it.displayName=te;var ct="PopoverArrow",lt=u.forwardRef((e,s)=>{const{__scopePopover:n,...t}=e,a=k(n);return o.jsx(je,{...a,...t,ref:s})});lt.displayName=ct;function oe(e){return e?"open":"closed"}var dt=W,ut=J,pt=X,ne=Y;const xt=dt,mt=ut,ae=u.forwardRef(({className:e,align:s="center",sideOffset:n=4,...t},a)=>o.jsx(pt,{children:o.jsx(ne,{ref:a,align:s,sideOffset:n,className:Ne("z-50 w-72 rounded-md border border-neutral-200 bg-white p-4 text-neutral-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-50",e),...t})}));ae.displayName=ne.displayName;const ft=({filters:e,setFilters:s,clearFilters:n,visibleFilters:t,filtersDialog:a,share:r,missionsButton:i})=>{const{toast:l}=ke(),{t:c}=N(["pages/collection","common/sets","common/packs","filters"]),g=S(),{setIsProfileDialogOpen:v}=Te(),p=d=>se=>s({[d]:se}),x=u.useMemo(()=>{if(e.expansion!=="all")return["all",...F(e.expansion).packs.map(d=>d.name).filter(d=>d!=="everypack")]},[e.expansion]);function m(d){s({expansion:d,pack:"all"})}function w(d){return c(d==="all"?"all":F(d).name,{ns:"common/sets"})}function h(d){return d==="trainer"?"T":o.jsx("img",{src:`/images/energy/${d}.webp`,alt:d,className:"h-4"})}async function f(){r?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),l({title:"Copied to clipboard",variant:"default"})):v(!0)}return o.jsxs("div",{id:"filterbar",className:"flex flex-col gap-x-2 flex-wrap",children:[t?.expansions&&o.jsxs("div",{className:"flex gap-x-2 px-4 mb-2",children:[o.jsx(P,{label:c("expansion",{ns:"common/sets"}),options:R,value:e.expansion,onChange:m,show:w}),x&&o.jsx(T,{options:x,value:e.pack,onChange:p("pack"),show:d=>c(d,{ns:"common/packs"})})]}),o.jsxs("div",{className:"gap-2 flex-row gap-y-1 px-4 flex",children:[t?.search&&o.jsx(L,{className:"w-full sm:w-32",setSearchValue:p("search")}),t?.owned&&o.jsx(T,{options:_,value:e.owned,onChange:p("owned"),show:d=>c(d,{ns:"filters",keyPrefix:"f-owned"})}),t?.rarity&&o.jsxs(xt,{children:[o.jsx(mt,{asChild:!0,children:o.jsxs(y,{variant:"outline",children:[c("rarity",{ns:"filters"})," (",e.rarity.length,")"]})}),o.jsx(ae,{className:"w-28",children:o.jsx(E,{className:"flex-col bg-transparent",rarityFilter:e.rarity,setRarityFilter:p("rarity"),deckbuildingMode:e.deckbuildingMode})})]}),a&&o.jsxs(Ae,{children:[o.jsx(_e,{asChild:!0,children:o.jsx(y,{variant:"outline",children:c("filters.allFilters")})}),o.jsxs(Re,{className:"border-1 border-neutral-700 shadow-none max-h-[90vh] overflow-y-auto content-start",children:[o.jsx(Se,{children:o.jsx(Me,{children:c("filters.filtersCount")})}),o.jsxs("div",{className:"flex flex-col gap-3",children:[a.search&&o.jsx(L,{className:"w-full bg-neutral-900",setSearchValue:p("search")}),a.allTextSearch&&o.jsx(Ye,{allTextSearch:e.allTextSearch,setAllTextSearch:p("allTextSearch")}),a.expansions&&o.jsx(P,{className:"bg-neutral-900",label:c("expansion",{ns:"common/sets"}),options:R,value:e.expansion,onChange:m,show:w}),a.pack&&x&&o.jsx(T,{className:"w-full bg-neutral-900",options:x,value:e.pack,onChange:p("pack"),show:d=>c(d,{ns:"common/packs"})}),a.rarity&&o.jsx(E,{className:"bg-neutral-900",rarityFilter:e.rarity,setRarityFilter:p("rarity"),deckbuildingMode:e.deckbuildingMode}),a.cardType&&o.jsx(Ke,{className:"bg-neutral-900",options:K,value:e.cardType,onChange:p("cardType"),show:h}),a.owned&&o.jsx(T,{className:"w-full bg-neutral-900",options:_,value:e.owned,onChange:p("owned"),show:d=>c(d,{ns:"filters",keyPrefix:"f-owned"})}),a.sortBy&&o.jsx(P,{className:"bg-neutral-900",label:c("f-sortBy.sortBy",{ns:"filters"}),options:V,value:e.sortBy,onChange:p("sortBy"),show:d=>c(`f-sortBy.${d}`,{ns:"filters"})}),a.amount&&o.jsxs(o.Fragment,{children:[o.jsx(P,{className:"bg-neutral-900",label:c("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.minNumber,onChange:p("minNumber")}),o.jsx(P,{className:"bg-neutral-900",label:c("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.maxNumber,onChange:p("maxNumber")})]}),a.deckBuildingMode&&o.jsx(ze,{deckbuildingMode:e.deckbuildingMode,setDeckbuildingMode:p("deckbuildingMode")}),o.jsx(y,{variant:"outline",className:"!text-red-700",onClick:n,children:c("filters.clear")}),i&&o.jsx(y,{className:"mt-2",variant:"outline",onClick:()=>g("/collection/missions"),children:c("goToMissions")})]})]})]}),r!==void 0&&o.jsx(y,{variant:"outline",onClick:f,children:c("filters.share")})]})]})},I=e=>{const s=Number(e);return Number.isNaN(s)?void 0:s},B=e=>e==="true"?!0:e==="false"?!1:void 0,ht={search:e=>e,expansion:e=>R.includes(e)?e:void 0,pack:e=>e,cardType:e=>e.split(",").filter(s=>K.includes(s)),rarity:e=>e.split(",").filter(s=>Qe.includes(s)),owned:e=>_.includes(e)?e:void 0,sortBy:e=>V.includes(e)?e:void 0,minNumber:I,maxNumber:I,deckbuildingMode:B,allTextSearch:B};function re({cards:e,isPublic:s,extraOffset:n,share:t}){const a=Ue({query:"(max-width: 767px)"}),[r,i]=Oe(),l=u.useMemo(()=>{const m={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1},w=(h,f)=>{const d=ht[h](f);d!==void 0&&(m[h]=d)};for(const h in m){const f=r.get(h);f!=null&&w(h,f)}return m},[r]),c=m=>{const w=new URLSearchParams(r);for(const h in m){const f=m[h];f==null||f==="all"||Array.isArray(f)&&f.length===0||f===""?w.delete(h):Array.isArray(f)?w.set(h,f.join(",")):w.set(h,String(f)),i(w)}},g=()=>i(new URLSearchParams),v=u.useMemo(()=>Xe(l,e),[l,e]),[p,x]=u.useState(!1);return u.useEffect(()=>{x(!0);const m=setTimeout(()=>x(!1),100);return()=>clearTimeout(m)},[l]),o.jsxs(o.Fragment,{children:[o.jsx(ft,{filters:l,setFilters:c,clearFilters:g,visibleFilters:{expansions:!a,allTextSearch:!a,search:!0,owned:!a,rarity:!a},filtersDialog:{expansions:!0,pack:!0,search:!0,owned:!0,sortBy:!0,rarity:!0,cardType:!0,amount:!0,deckBuildingMode:!0,allTextSearch:!0},missionsButton:!s,share:t}),v&&o.jsx(Ge,{cards:v,resetScrollTrigger:p,showStats:!l.deckbuildingMode,extraOffset:n,editable:!l.deckbuildingMode&&!s,groupExpansions:l.sortBy!=="recent"})]})}function gt(){const{t:e}=N("common"),{data:s,isLoading:n}=H(),{data:t=new Map,isLoading:a}=Ie();return n&&a?o.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")}):o.jsx("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:o.jsx(re,{cards:t,isPublic:!1,extraOffset:20,share:s!==void 0&&s.friend_id!==""&&s.is_public})})}function vt({friendId:e}){const s=S(),{t:n}=N(["pages/collection","common"]),{data:t,isLoading:a}=Ee(e),{data:r,isLoading:i}=Le(e);return a||i?o.jsx("p",{className:"text-xl text-center py-8",children:n("common:loading")}):t===void 0||r===void 0?o.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):t===null?o.jsx("p",{className:"text-xl text-center py-8",children:n("common:noAccount")}):r===null?o.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):o.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[o.jsxs(Be,{className:"mb-1 border-1 border-neutral-700 shadow-none",children:[o.jsx(Ze,{className:"h-4 w-4"}),o.jsx(De,{children:n("publicCollectionTitle",{username:t.username})}),o.jsx($e,{children:o.jsxs("div",{className:"flex items-center",children:[n("publicCollectionDescription"),o.jsx(y,{className:"mb-4",onClick:()=>s(`/trade/${e}`),children:n("showPossibleTrades")})]})})]}),o.jsx(re,{cards:r,isPublic:!0,extraOffset:124})]})}function St(){const{t:e}=N(["pages/collection","common"]),s=S(),{friendId:n}=Fe(),{data:t,isLoading:a}=H();if(u.useEffect(()=>{!n&&!a&&t?.friend_id&&s(`/collection/${t.friend_id}`,{replace:!0})},[a,n,t?.friend_id,s]),a)return o.jsx("p",{className:"text-xl text-center py-8",children:e("common:loading")});const r=n??t?.friend_id;return r&&r!==t?.friend_id?o.jsx(vt,{friendId:r}):o.jsx(gt,{})}export{St as default};
