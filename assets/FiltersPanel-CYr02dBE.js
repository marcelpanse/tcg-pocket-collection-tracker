import{f,r as l,_ as T,x as S,z as k,j as s,h as O,v as C,D as B}from"./index-DQ6Z05XJ.js";import{u as F,e as R,c as H,o as z,t as E,s as D}from"./filters-CYZriFdC.js";import{R as P,s as V,D as _}from"./index-AsDphT6l.js";import{S as I}from"./SearchInput-quhRiXWW.js";import{D as u,T as j,a as W}from"./Filters-CPgNlX_b.js";import{M as A,C as L}from"./react-tooltip.min-DRPPlOII.js";function X({className:d,children:e,cards:c,groupExpansions:g,render:i}){const{t:r}=f(["common/sets","pages/collection"]),p=l.useRef(null),[h,b]=l.useState(900),[t,y]=l.useState("auto");l.useEffect(()=>{const a=p.current;if(!a)return;const n=new ResizeObserver(o=>{b(o[0].contentRect.width);const x=document.querySelector("#header")?.offsetHeight||0,w=window.innerHeight-x;y(`${w}px`)});return n.observe(a),()=>n.disconnect()},[]);const{cardsPerRow:v,cardHeight:M,basis:$}=l.useMemo(()=>{const o=Math.max(Math.min(Math.floor(h/170),5),3),x=Math.round(1.4*(h/o))+40,w={3:"basis-1/3",4:"basis-1/4",5:"basis-1/5"}[o];return{cardsPerRow:o,cardHeight:x,basis:w}},[h]),m=l.useMemo(()=>g?Object.entries(Object.groupBy(c,a=>a.expansion)).toSorted(([a,n],[o,x])=>S.indexOf(a)-S.indexOf(o)).flatMap(([a,n])=>[{id:`header-${a}`,type:"header",expansion:k(a)},...T(n,v).map((o,x)=>({id:`row-${a}-${x}`,type:"row",cards:o}))]):T(c,v).map((a,n)=>({id:`row-${n}`,type:"row",cards:a})),[c,v]),N=F({getScrollElement:()=>p.current,count:m.length,getItemKey:a=>m[a].id,estimateSize:a=>m[a].type==="header"?52:M+8,overscan:5});return s.jsxs("div",{ref:p,className:O("overflow-y-auto",d),style:{scrollbarWidth:"thin"},children:[e,c.length===0&&s.jsx("p",{className:"text-xl text-center py-8",children:"No cards to show"}),s.jsx("div",{style:{height:t},children:s.jsx("div",{style:{height:`${N.getTotalSize()}px`},className:"relative w-full",children:N.getVirtualItems().map(a=>{const n=m[a.index];return s.jsx("div",{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},className:"absolute top-0 left-0 w-full",children:n.type==="header"?s.jsxs("div",{className:"flex items-center gap-2 scroll-m-20 border-b-2 border-slate-600 pb-2 tracking-tight transition-colors",children:[s.jsx("img",{src:`/images/sets/${C.language}/${n.expansion.id}.webp`,alt:n.expansion.name,className:"max-w-[60px]",onError:o=>{C.language!=="en-US"&&(o.target.src=`/images/sets/en-US/${n.expansion.id}.webp`)}}),s.jsx("h2",{className:"text-center font-semibold sm:text-lg md:text-2xl",children:r(n.expansion.name)})]}):s.jsx("div",{className:"w-full flex justify-start",children:n.cards.map(o=>s.jsx("div",{className:`${$} min-w-0 px-2`,children:i(o)},`${o.expansion}-${o.internal_id}`))})},a.key)})})})]})}const U=({allTextSearch:d,setAllTextSearch:e})=>{const{t:c}=f("search-input");return s.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[s.jsx("input",{type:"checkbox",id:"checkbox",checked:d,onChange:()=>e(!d),className:"w-4 h-4"}),s.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:c("allTextLabel")}),s.jsx(A,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),s.jsx(L,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":c("allTextTooltip")})]})},Z=({className:d,filters:e,setFilters:c,clearFilters:g})=>{const{t:i}=f(["pages/collection","common/sets","common/packs","filters"]),r=t=>y=>c({[t]:y}),p=l.useMemo(()=>{if(!(e.expansion===void 0||e.expansion==="all"))return["all",...k(e.expansion).packs.map(t=>t.name).filter(t=>t!=="everypack")]},[e.expansion]);function h(t){e.pack===void 0?c({expansion:t}):c({expansion:t,pack:"all"})}function b(t){return i(t==="all"?"all":k(t).name,{ns:"common/sets"})}return s.jsxs("div",{className:d,children:[e.search!==void 0&&s.jsx(I,{value:e.search,setValue:r("search")}),e.allTextSearch!==void 0&&s.jsx(U,{allTextSearch:e.allTextSearch,setAllTextSearch:r("allTextSearch")}),e.expansion!==void 0&&s.jsx(u,{label:i("expansion",{ns:"common/sets"}),options:R,value:e.expansion,onChange:h,show:b}),e.pack!==void 0&&p&&s.jsx(j,{className:"block",options:p,value:e.pack,onChange:r("pack"),show:t=>i(t,{ns:"common/packs"})}),e.rarity!==void 0&&s.jsx(P,{rarityFilter:e.rarity,setRarityFilter:r("rarity"),deckbuildingMode:e.deckbuildingMode}),e.cardType!==void 0&&s.jsx(W,{options:H,value:e.cardType,onChange:r("cardType"),show:V}),e.ownership!==void 0&&s.jsx(j,{className:"block",options:z,value:e.ownership,onChange:r("ownership"),label:i("carddex",{ns:"filters"}),show:t=>i(t,{ns:"filters",keyPrefix:"f-ownership"})}),e.trading!==void 0&&s.jsx(j,{className:"block",options:E,value:e.trading,onChange:r("trading"),label:i("trading",{ns:"filters"}),show:t=>i(t,{ns:"filters",keyPrefix:"f-trading"})}),e.sortBy!==void 0&&s.jsx(u,{label:i("f-sortBy.sortBy",{ns:"filters"}),options:D,value:e.sortBy,onChange:r("sortBy"),show:t=>i(`f-sortBy.${t}`,{ns:"filters"})}),e.minNumber!==void 0&&s.jsx(u,{label:i("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.minNumber,onChange:r("minNumber")}),e.maxNumber!==void 0&&s.jsx(u,{label:i("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.maxNumber,onChange:r("maxNumber")}),e.deckbuildingMode!==void 0&&s.jsx(_,{deckbuildingMode:e.deckbuildingMode,setDeckbuildingMode:r("deckbuildingMode")}),s.jsx(B,{variant:"outline",className:"!text-red-700",onClick:g,children:i("filters.clear")})]})};export{X as C,Z as F};
