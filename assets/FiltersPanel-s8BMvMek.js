import{f as k,r as l,_ as N,x as T,z as w,j as s,h as $,v as O,D as B}from"./index-BwFQZhe2.js";import{u as F,e as R,c as H,t as z,s as E}from"./filters-BqVOjB1d.js";import{R as D,s as P,D as V}from"./index-DTOVFrzJ.js";import{S as _}from"./SearchInput-DTiGHpAi.js";import{D as u,T as S,a as I}from"./Filters-BkXyatXf.js";import{M as W,C as A}from"./react-tooltip.min-p097bOWX.js";function J({className:d,children:e,cards:r,groupExpansions:g,render:c}){const{t:i}=k(["common/sets","pages/collection"]),x=l.useRef(null),[m,b]=l.useState(900),[t,y]=l.useState("auto");l.useEffect(()=>{const a=x.current;if(!a)return;const n=new ResizeObserver(o=>{b(o[0].contentRect.width);const p=document.querySelector("#header")?.offsetHeight||0,j=window.innerHeight-p;y(`${j}px`)});return n.observe(a),()=>n.disconnect()},[]);const{cardsPerRow:v,cardHeight:C,basis:M}=l.useMemo(()=>{const o=Math.max(Math.min(Math.floor(m/170),5),3),p=Math.round(1.4*(m/o))+40,j={3:"basis-1/3",4:"basis-1/4",5:"basis-1/5"}[o];return{cardsPerRow:o,cardHeight:p,basis:j}},[m]),h=l.useMemo(()=>g?Object.entries(Object.groupBy(r,a=>a.expansion)).toSorted(([a,n],[o,p])=>T.indexOf(a)-T.indexOf(o)).flatMap(([a,n])=>[{id:`header-${a}`,type:"header",expansion:w(a)},...N(n,v).map((o,p)=>({id:`row-${a}-${p}`,type:"row",cards:o}))]):N(r,v).map((a,n)=>({id:`row-${n}`,type:"row",cards:a})),[r,v]),f=F({getScrollElement:()=>x.current,count:h.length,getItemKey:a=>h[a].id,estimateSize:a=>h[a].type==="header"?52:C+8,overscan:5});return s.jsxs("div",{ref:x,className:$("overflow-y-auto",d),style:{scrollbarWidth:"thin"},children:[e,r.length===0&&s.jsx("p",{className:"text-xl text-center py-8",children:"No cards to show"}),s.jsx("div",{style:{height:t},children:s.jsx("div",{style:{height:`${f.getTotalSize()}px`},className:"relative w-full",children:f.getVirtualItems().map(a=>{const n=h[a.index];return s.jsx("div",{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},className:"absolute top-0 left-0 w-full",children:n.type==="header"?s.jsxs("div",{className:"flex items-center gap-2 scroll-m-20 border-b-2 border-slate-600 pb-2 tracking-tight transition-colors",children:[s.jsx("img",{src:`/images/sets/${O.language}/${n.expansion.id}.webp`,alt:n.expansion.name,className:"max-w-[60px]",onError:o=>{o.target.src=`/images/sets/en-US/${n.expansion.id}.webp`}}),s.jsx("h2",{className:"text-center font-semibold sm:text-lg md:text-2xl",children:i(n.expansion.name)})]}):s.jsx("div",{className:"w-full flex justify-start",children:n.cards.map(o=>s.jsx("div",{className:`${M} min-w-0 px-2`,children:c(o)},`${o.expansion}-${o.internal_id}`))})},a.key)})})})]})}const L=({allTextSearch:d,setAllTextSearch:e})=>{const{t:r}=k("search-input");return s.jsxs("div",{className:"flex items-center space-x-2 text-white/50",children:[s.jsx("input",{type:"checkbox",id:"checkbox",checked:d,onChange:()=>e(!d),className:"w-4 h-4"}),s.jsx("label",{htmlFor:"checkbox",className:"text-xs",children:r("allTextLabel")}),s.jsx(W,{id:"allTextSearch",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),s.jsx(A,{className:"h-4 w-4","data-tooltip-id":"allTextSearch","data-tooltip-content":r("allTextTooltip")})]})},X=({className:d,filters:e,setFilters:r,clearFilters:g})=>{const{t:c}=k(["pages/collection","common/sets","common/packs","filters"]),i=t=>y=>r({[t]:y}),x=l.useMemo(()=>{if(!(e.expansion===void 0||e.expansion==="all"))return["all",...w(e.expansion).packs.map(t=>t.name).filter(t=>t!=="everypack")]},[e.expansion]);function m(t){e.pack===void 0?r({expansion:t}):r({expansion:t,pack:"all"})}function b(t){return c(t==="all"?"all":w(t).name,{ns:"common/sets"})}return s.jsxs("div",{className:d,children:[e.search!==void 0&&s.jsx(_,{value:e.search,setValue:i("search")}),e.allTextSearch!==void 0&&s.jsx(L,{allTextSearch:e.allTextSearch,setAllTextSearch:i("allTextSearch")}),e.expansion!==void 0&&s.jsx(u,{label:c("expansion",{ns:"common/sets"}),options:R,value:e.expansion,onChange:m,show:b}),e.pack!==void 0&&x&&s.jsx(S,{className:"block",options:x,value:e.pack,onChange:i("pack"),show:t=>c(t,{ns:"common/packs"})}),e.rarity!==void 0&&s.jsx(D,{rarityFilter:e.rarity,setRarityFilter:i("rarity"),deckbuildingMode:e.deckbuildingMode}),e.cardType!==void 0&&s.jsx(I,{options:H,value:e.cardType,onChange:i("cardType"),show:P}),e.trading!==void 0&&s.jsx(S,{className:"block",options:z,value:e.trading,onChange:i("trading"),show:t=>c(t,{ns:"filters",keyPrefix:"f-trading"})}),e.sortBy!==void 0&&s.jsx(u,{label:c("f-sortBy.sortBy",{ns:"filters"}),options:E,value:e.sortBy,onChange:i("sortBy"),show:t=>c(`f-sortBy.${t}`,{ns:"filters"})}),e.minNumber!==void 0&&s.jsx(u,{label:c("f-number.minNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.minNumber,onChange:i("minNumber")}),e.maxNumber!==void 0&&s.jsx(u,{label:c("f-number.maxNum",{ns:"filters"}),options:[0,1,2,3,4,5,6,7,8,9,10,100],value:e.maxNumber,onChange:i("maxNumber")}),e.deckbuildingMode!==void 0&&s.jsx(V,{deckbuildingMode:e.deckbuildingMode,setDeckbuildingMode:i("deckbuildingMode")}),s.jsx(B,{variant:"outline",className:"!text-red-700",onClick:g,children:c("filters.clear")})]})};export{J as C,X as F};
