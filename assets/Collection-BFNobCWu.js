import{e as q,f as S,A as R,r as m,B as z,C as b,j as e,D as h,E as _,L as M,S as G,F as H,G as U,H as J,J as K,v as Q,K as V,M as W,N as X,O as Y,P as Z,p as ee}from"./index-Bc24pGrs.js";import{F as te}from"./friend-id-display-fVW2a3q_.js";import{u as se}from"./index-Eqa1wgmp.js";import{M as ae}from"./react-tooltip.min-CQGoW9lO.js";import{C as ne}from"./Card-uGHOER08.js";import{F as re,C as ie}from"./FiltersPanel-CwggZ5AU.js";import{g as j,s as oe,t as le,c as ce,e as de}from"./filters-C397vk_h.js";import{T as ue}from"./trash-2-DSPUOmhV.js";import{C as me}from"./chevron-right-KwNIJk11.js";import"./Filters-C-GWe_Uz.js";import"./tabs-DIOk7zit.js";import"./index-NkasiXIK.js";import"./FancyCard-DxyFTK_h.js";import"./plus-BWXPi6nO.js";import"./SearchInput-l0pk8ZMx.js";const xe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],fe=q("circle-alert",xe),P=t=>{const n=Number(t);return Number.isNaN(n)?void 0:n},T=t=>t==="true"?!0:t==="false"?!1:void 0,pe={search:t=>t,expansion:t=>de.includes(t)?t:void 0,pack:t=>t,cardType:t=>t.split(",").filter(n=>ce.includes(n)),rarity:t=>t.split(",").filter(n=>V.includes(n)),trading:t=>le.includes(t)?t:void 0,sortBy:t=>oe.includes(t)?t:void 0,minNumber:P,maxNumber:P,deckbuildingMode:T,allTextSearch:T},F={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],trading:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1};function O({children:t,cards:n,isPublic:o,share:u}){const{t:i}=S("pages/collection"),f=se({query:"(max-width: 767px)"}),{setIsProfileDialogOpen:L}=R(),[A,y]=m.useState(!1),[g,v]=z(),{data:c}=b(),d=m.useMemo(()=>{const r={...F},l=(s,a)=>{const x=pe[s](a);x!==void 0&&(r[s]=x)};for(const s in r){const a=g.get(s);a!=null&&l(s,a)}return r},[g]),$=r=>{const l=new URLSearchParams(g);for(const s in r){const a=r[s];a==null||a==="all"||Array.isArray(a)&&a.length===0||a===""?l.delete(s):Array.isArray(a)?l.set(s,a.join(",")):l.set(s,String(a)),v(l)}},C=()=>v(new URLSearchParams),w=m.useMemo(()=>{let r=0;for(const l in d){const s=l;d[s]!==F[s]&&r++}return r},[d]),p=m.useMemo(()=>j(d,n,c?.trade_rarity_settings),[d,n,c]),B=m.useCallback(()=>{if(!c)throw new Error("Cannot copy trade message without account");let r="";c.is_public&&(r+=`${i("trade.publicTradePage")}: https://tcgpocketcollectiontracker.com/#/trade/${c?.friend_id}
`),c.username&&(r+=`${i("trade.friendID")}: ${c.friend_id} (${c.username})

`);const l=s=>{s.sort((a,x)=>{const k=a.expansion.localeCompare(x.expansion);return k!==0?k:a.rarity.localeCompare(x.rarity)});for(let a=0;a<s.length;a++)(a>0?s[a-1].expansion:"")!==s[a].expansion&&(r+=`
${s[a].expansion}:
`),r+=`${s[a].rarity} ${s[a].card_id} - ${K(s[a],Q.language)}
`};return r+=`${i("trade.lookingForCards")}:
`,l(j({...d,trading:"wanted"},n,c.trade_rarity_settings)),r+=`

${i("trade.forTradeCards")}:
`,l(j({...d,trading:"extra"},n,c.trade_rarity_settings)),r},[n,d,c]);async function I(){u?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),_({title:"Copied to clipboard",variant:"default"})):L(!0)}const E=m.useMemo(()=>{let r=0;const l=new Set;for(const s of p)s.collected&&!l.has(s.internal_id)&&(r+=s.amount_owned||0,l.add(s.internal_id));return r},[n]),D=m.useMemo(()=>(n?.get(83654)?.amount_owned??0)>0,[n]),N=e.jsxs("div",{className:"flex flex-col h-fit gap-2",children:[e.jsxs("small",{className:"flex gap-2",children:[i("stats.summary",{selected:p.length,uniquesOwned:p.filter(r=>!!r.collected).length,totalOwned:E}),D&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{id:"mewCardOwned",className:"text-start max-w-72",clickable:!0}),e.jsx(fe,{className:"h-5 w-5","data-tooltip-id":"mewCardOwned","data-tooltip-content":i("stats.mewCardOwned")})]})]}),e.jsx(re,{className:"flex flex-col gap-y-3",filters:d,setFilters:$,clearFilters:C}),e.jsxs("div",{className:"flex flex-col mt-4 gap-2",children:[u!==void 0&&e.jsx(h,{variant:"outline",onClick:I,children:i("filters.share")}),!o&&e.jsx(h,{className:"w-full",variant:"outline",disabled:!c,onClick:()=>navigator.clipboard.writeText(B()).then(()=>_({title:i("trade.copiedInClipboard"),variant:"default",duration:3e3})),children:i("trade.button")}),!o&&e.jsx(M,{className:"w-full",to:"/collection/missions",children:e.jsx(h,{className:"w-full",variant:"outline",children:i("goToMissions")})})]})]});return e.jsxs("div",{className:"flex justify-center gap-2 xl:gap-8 px-1",children:[f?e.jsx(G,{open:A,onOpenChange:y,children:e.jsxs(H,{side:"left",className:"w-full",children:[e.jsx(U,{children:e.jsx(J,{children:"Filters"})}),N]})}):e.jsx("div",{className:"w-80",children:N}),e.jsxs("div",{className:"w-full max-w-[900px]",children:[f&&e.jsxs("div",{className:"h-9 flex overflow-hidden text-center rounded-md text-sm font-medium border shadow-sm border-neutral-700 divide-x divide-neutral-700 [&>*]:cursor-pointer [&>*]:hover:bg-neutral-600 [&>*]:hover:text-neutral-50",children:[e.jsxs("button",{type:"button",className:"flex-1",onClick:()=>y(!0),children:["Filters",w>0&&` (${w})`]}),w>0&&e.jsx("button",{type:"button",className:"group px-2",onClick:C,children:e.jsx(ue,{className:"stroke-neutral-200 group-hover:stroke-neutral-50"})})]}),t,e.jsx(ie,{cards:p,groupExpansions:d.sortBy!=="recent",render:r=>e.jsx(ne,{card:r,editable:!d.deckbuildingMode&&!o})})]})]})}function he(){const{data:t,isLoading:n}=b(),{data:o=new Map,isLoading:u}=ee();return n||u?e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"}):e.jsx(O,{cards:o,isPublic:!1,share:t!==void 0&&t.friend_id!==""&&t.is_public})}function ge({friendId:t}){const{t:n}=S(["pages/collection","common"]),{data:o,isLoading:u}=Y(t),{data:i,isLoading:f}=Z(t);return u||f?e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"}):o===void 0||i===void 0?e.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):o===null?e.jsx("p",{className:"text-xl text-center py-8",children:n("common:noAccount")}):i===null?e.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsx("title",{children:`${o.username} collection â€“ TCG Pocket Collection Tracker`}),e.jsx(O,{cards:i,isPublic:!0,children:e.jsxs("div",{className:"flex justify-between my-2",children:[e.jsxs("h1",{children:[e.jsx("span",{className:"text-2xl font-light",children:n("collectionOf")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",o.username," "]}),e.jsx("span",{className:"block sm:inline text-sm",children:e.jsx(te,{friendId:o.friend_id})})]}),e.jsx(M,{to:`/trade/${t}`,children:e.jsxs(h,{children:[n("showPossibleTrades"),e.jsx(me,{})]})})]})})]})}function Le(){const t=W(),{friendId:n}=X(),{data:o,isLoading:u}=b();if(m.useEffect(()=>{!n&&!u&&o?.friend_id&&t(`/collection/${o.friend_id}`,{replace:!0})},[u,n,o?.friend_id,t]),u)return e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"});const i=n??o?.friend_id;return i&&i!==o?.friend_id?e.jsx(ge,{friendId:i}):e.jsx(he,{})}export{Le as default};
