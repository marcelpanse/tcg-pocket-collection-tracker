import{e as O,C as Y,o as Z,P as A,r as n,X as G,Y as F,T as x,j as e,Z as J,S as M,D,E as T,F as z,B as K}from"./index-D5vBG6H6.js";import{u as E}from"./index-K3wNskcY.js";import{C as V}from"./CardLine-nGZh4aKy.js";import{C as ee}from"./CardsTable-DoL_mER-.js";import{F as se}from"./FancyCard-JRSv5CBm.js";import{a as te}from"./Filters-44DLXjUF.js";import{g as re,F as I}from"./FiltersPanel-B3_2V4iW.js";import{s as ae}from"./utils-DpthgE2O.js";import{s as ne}from"./utils-CRnu-1y-.js";import{T as le}from"./trash-2-DKTE5ow7.js";import"./react-tooltip.min-DPO7fAhC.js";import"./index-D-q7cQfh.js";import"./SearchInput-BoGf9SMQ.js";const oe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}]],q=O("square-minus",oe);const ce=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],B=O("square-plus",ce),u={search:"",expansion:"all",cardType:[],rarity:[],sortBy:"expansion-newest",allTextSearch:!1};function ye(){const k=E({query:"(max-width: 1024px)"}),N=E({query:"(max-width: 767px)"}),[h,P]=Y(),{data:l}=Z(),{setSelectedCardId:$}=A(),[L,b]=n.useState(!1),[o,d]=n.useState(u),H=n.useMemo(()=>re({...o,deckbuildingMode:!0},l??new Map),[G,l,o]),p=n.useMemo(()=>{let s=0;for(const t in o){const r=t;o[r]!==u[r]&&s++}return s},[o]),[Q,y]=n.useState(!1),[f,R]=n.useState(()=>h.get("title")??"New deck"),[j,U]=n.useState(()=>{const s=h.get("energy");return s?s.split(",").filter(t=>F.includes(t)):[]}),[c,m]=n.useState(()=>{const s=h.get("cards");if(s){const t=s.split(",").map(r=>{const a=r.split(":");if(a.length===2)return[Number(a[0]),Math.min(Number(a[1]),2)]}).filter(r=>!!r).filter(([r,a])=>!!x(r)&&a>0);return new Map(t)}else return new Map}),g=n.useMemo(()=>[...c].toSorted(([s,t],[r,a])=>s-r),[c]),C=n.useMemo(()=>{let s=0;return c.forEach(t=>{s+=t}),s},[c]),w=n.useMemo(()=>l?g.reduce((s,[t,r])=>s+Math.max(0,r-(x(t)?.alternate_versions?.reduce((a,i)=>a+(l.get(i)?.amount_owned??0),0)??0)),0):0,[g,l]);n.useEffect(()=>{P({title:f,energy:j.join(","),cards:ne(c)},{replace:!0})},[c,f,j]);const v=n.useCallback(s=>{m(t=>{const r=t.get(s)??0;if(r>=2)return t;const a=new Map(t);return a.set(s,r+1),a})},[m]),S=n.useCallback(s=>{m(t=>{const r=t.get(s);if(r===void 0)return t;const a=new Map(t);return r<=1?a.delete(s):a.set(s,r-1),a})},[m]),_=e.jsxs("div",{className:"flex flex-col [&>h2]:text-lg [&>h2:not(:first-child)]:mt-2",children:[e.jsx("h2",{children:"Title"}),e.jsx(J,{className:"bg-neutral-800",type:"text",value:f,onChange:s=>R(s.target.value)}),e.jsx("h2",{children:"Energy"}),e.jsx(te,{options:F,value:j,onChange:U,show:ae}),e.jsx("h2",{children:"Cards"}),e.jsx("ul",{className:"overflow-y-auto space-y-1",children:g.map(([s,t])=>{const r=x(s);if(!r)return null;const a=l&&r.alternate_versions.reduce((W,X)=>W+(l.get(X)?.amount_owned??0),0),i=a!==void 0&&a<t;return e.jsxs("li",{className:"flex gap-1 rounded",children:[e.jsx("button",{type:"button",className:"enabled:cursor-pointer",onClick:()=>S(s),children:e.jsx(q,{className:"size-5"})}),e.jsx("button",{type:"button",className:"enabled:cursor-pointer disabled:opacity-50",onClick:()=>v(s),disabled:t>=2,children:e.jsx(B,{className:"size-5"})}),e.jsxs("b",{className:"mx-2",children:[t,"Ã—"]}),e.jsx(V,{className:`w-full ${i?"bg-red-950":""}`,card_id:x(s)?.card_id,id:"hidden",amount:i?"text-red-300":"",amount_owned:a})]},s)})}),e.jsxs("p",{className:"text-neutral-400 mt-2",children:[e.jsx("span",{className:`${C>20?"text-red-300":""}`,children:C}),e.jsx("span",{className:"text-sm",children:"/20 cards"}),w>0&&e.jsxs("span",{className:"text-sm",children:[" (",w," missing)"]})]}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Want to save your deck? Bookmark this page!"})]});return e.jsxs("div",{className:"w-full mx-auto flex px-2 gap-4 justify-center",children:[k?e.jsx(M,{open:L,onOpenChange:b,children:e.jsxs(D,{side:"left",className:"w-full",children:[e.jsx(T,{children:e.jsx(z,{children:"Filters"})}),e.jsx(I,{className:"flex flex-col w-80 h-fit gap-2",filters:o,setFilters:s=>d(t=>({...t,...s})),clearFilters:()=>d(u)})]})}):e.jsx(I,{className:"flex flex-col w-80 h-fit gap-2",filters:o,setFilters:s=>d(t=>({...t,...s})),clearFilters:()=>d(u)}),e.jsx(ee,{className:"w-full lg:w-152 px-2",cards:H,render:s=>{const t=c.get(s.internal_id)??0,r=l?Math.min(2,s.alternate_versions.reduce((a,i)=>a+(l.get(i)?.amount_owned??0),0)):2;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"cursor-pointer",onClick:()=>$(s.internal_id),children:e.jsx(se,{card:s,selected:!0})},s.card_id),e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{type:"button",className:"enabled:cursor-pointer disabled:opacity-50",onClick:()=>S(s.internal_id),disabled:t<=0,children:e.jsx(q,{className:"size-6"})}),e.jsxs("span",{className:t>r?"text-red-300":"",children:[t,"/",r??2]}),e.jsx("button",{type:"button",className:"enabled:cursor-pointer disabled:opacity-50",onClick:()=>v(s.internal_id),disabled:t>=2,children:e.jsx(B,{className:"size-6"})})]})]})},children:e.jsxs("div",{className:"flex flex-col sticky top-0 z-10 bg-neutral-900 mb-2",children:[k&&e.jsxs("div",{className:"h-9 mb-2 z-10 flex overflow-hidden text-center rounded-md text-sm font-medium border shadow-sm border-neutral-700 divide-x divide-neutral-700 [&>*]:cursor-pointer [&>*]:hover:bg-neutral-600 [&>*]:hover:text-neutral-50",children:[e.jsxs("button",{type:"button",className:"flex-1",onClick:()=>b(!0),children:["Filters",p>0&&` (${p})`]}),p>0&&e.jsx("button",{type:"button",className:"group px-2",onClick:()=>d(u),children:e.jsx(le,{className:"stroke-neutral-200 group-hover:stroke-neutral-50"})})]}),N&&e.jsx(K,{variant:"outline",onClick:()=>y(!0),children:"Deck"})]})}),N?e.jsx(M,{open:Q,onOpenChange:y,children:e.jsxs(D,{side:"right",className:"w-full",children:[e.jsx(T,{children:e.jsx(z,{children:"Deck"})}),_]})}):e.jsx("div",{className:"min-w-80 md:w-108 h-fit p-2 rounded-lg border-1 border-neutral-700",children:_})]})}export{ye as default};
