import{e as A,u as F,z as L,o as P,r as x,j as e,B as b,L as S,A as T,C as _,S as B,D as I,E as D,F as E,G as q,H as z,J as R,K as M,M as $,N as G,O as H}from"./index-BC4e_IOi.js";import{F as U}from"./friend-id-display-Jx1QYbUL.js";import{u as J}from"./index-w4qodEA-.js";import{C as K}from"./Card-DdykXFO-.js";import{C as Q}from"./CardsTable-CduGIIt6.js";import{F as V,g as W,s as X,o as Y,c as Z,e as ee}from"./FiltersPanel-yPFrm5eC.js";import{M as se}from"./react-tooltip.min-D9yRlHdi.js";import{T as te}from"./trash-2-BdEsq-Bp.js";import"./Filters-R7VyAfv4.js";import"./utils-BTouiBj-.js";import"./FancyCard-ItcsBftH.js";import"./SearchInput-BoGCLrzf.js";import"./index-VmvPa3qA.js";const ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ne=A("circle-alert",ae);function v({cards:s,filters:t,setFilters:a,clearFilters:l,share:r,missions:p}){const{t:m}=F("pages/collection"),{setIsProfileDialogOpen:h}=L(),{data:j=new Map}=P();async function c(){r?navigator.share&&(navigator.userAgentData?.mobile||/Mobi|Android/i.test(navigator.userAgent))?await navigator.share({title:"My Pokemon TCG Pocket collection",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),T({title:"Copied to clipboard",variant:"default"})):h(!0)}const w=x.useMemo(()=>{let d=0;const f=new Set;for(const n of s)n.collected&&!f.has(n.internal_id)&&(d+=n.amount_owned||0,f.add(n.internal_id));return d},[s]),g=x.useMemo(()=>(j?.get(83654)?.amount_owned??0)>0,[s]);return e.jsxs("div",{className:"flex flex-col h-fit gap-2",children:[e.jsxs("small",{className:"flex gap-2",children:[m("stats.summary",{selected:s.length,uniquesOwned:s.filter(d=>!!d.collected).length,totalOwned:w}),g&&e.jsxs(e.Fragment,{children:[e.jsx(se,{id:"mewCardOwned",className:"text-start max-w-72",clickable:!0}),e.jsx(ne,{className:"h-5 w-5","data-tooltip-id":"mewCardOwned","data-tooltip-content":m("stats.mewCardOwned")})]})]}),e.jsx(V,{className:"flex flex-col gap-y-3",filters:t,setFilters:a,clearFilters:l}),e.jsxs("div",{className:"flex flex-col mt-4 gap-2",children:[r!==void 0&&e.jsx(b,{variant:"outline",onClick:c,children:m("filters.share")}),p&&e.jsx(S,{className:"w-full",to:"/collection/missions",children:e.jsx(b,{className:"w-full",variant:"outline",children:m("goToMissions")})})]})]})}const N=s=>{const t=Number(s);return Number.isNaN(t)?void 0:t},C=s=>s==="true"?!0:s==="false"?!1:void 0,re={search:s=>s,expansion:s=>ee.includes(s)?s:void 0,pack:s=>s,cardType:s=>s.split(",").filter(t=>Z.includes(t)),rarity:s=>s.split(",").filter(t=>q.includes(t)),owned:s=>Y.includes(s)?s:void 0,sortBy:s=>X.includes(s)?s:void 0,minNumber:N,maxNumber:N,deckbuildingMode:C,allTextSearch:C},k={search:"",expansion:"all",pack:"all",cardType:[],rarity:[],owned:"all",sortBy:"expansion-newest",minNumber:0,maxNumber:100,deckbuildingMode:!1,allTextSearch:!1};function O({children:s,cards:t,isPublic:a,share:l}){const r=J({query:"(max-width: 767px)"}),[p,m]=x.useState(!1),[h,j]=_(),c=x.useMemo(()=>{const n={...k},u=(i,o)=>{const y=re[i](o);y!==void 0&&(n[i]=y)};for(const i in n){const o=h.get(i);o!=null&&u(i,o)}return n},[h]),w=n=>{const u=new URLSearchParams(h);for(const i in n){const o=n[i];o==null||o==="all"||Array.isArray(o)&&o.length===0||o===""?u.delete(i):Array.isArray(o)?u.set(i,o.join(",")):u.set(i,String(o)),j(u)}},g=()=>j(new URLSearchParams),d=x.useMemo(()=>{let n=0;for(const u in c){const i=u;c[i]!==k[i]&&n++}return n},[c]),f=x.useMemo(()=>W(c,t),[c,t]);return e.jsxs("div",{className:"flex justify-center gap-2 xl:gap-8 px-1",children:[r?e.jsx(B,{open:p,onOpenChange:m,children:e.jsxs(I,{side:"left",className:"w-full",children:[e.jsx(D,{children:e.jsx(E,{children:"Filters"})}),e.jsx(v,{cards:f,filters:c,setFilters:w,clearFilters:g,share:l,missions:!a})]})}):e.jsx("div",{className:"w-80",children:e.jsx(v,{cards:f,filters:c,setFilters:w,clearFilters:g,share:l,missions:!a})}),e.jsxs("div",{className:"w-full max-w-[900px]",children:[r&&e.jsxs("div",{className:"h-9 flex overflow-hidden text-center rounded-md text-sm font-medium border shadow-sm border-neutral-700 divide-x divide-neutral-700 [&>*]:cursor-pointer [&>*]:hover:bg-neutral-600 [&>*]:hover:text-neutral-50",children:[e.jsxs("button",{type:"button",className:"flex-1",onClick:()=>m(!0),children:["Filters",d>0&&` (${d})`]}),d>0&&e.jsx("button",{type:"button",className:"group px-2",onClick:g,children:e.jsx(te,{className:"stroke-neutral-200 group-hover:stroke-neutral-50"})})]}),s,e.jsx(Q,{cards:f,groupExpansions:c.sortBy!=="recent",render:n=>e.jsx(K,{card:n,editable:!c.deckbuildingMode&&!a})})]})]})}function ie(){const{data:s,isLoading:t}=M(),{data:a=new Map,isLoading:l}=P();return t&&l?e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"}):e.jsx(O,{cards:a,isPublic:!1,share:s!==void 0&&s.friend_id!==""&&s.is_public})}function oe({friendId:s}){const{t}=F(["pages/collection","common"]),{data:a,isLoading:l}=$(s),{data:r,isLoading:p}=G(s);return l||p?e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"}):a===void 0||r===void 0?e.jsx("p",{className:"text-xl text-center py-8",children:"Something went wrong"}):a===null?e.jsx("p",{className:"text-xl text-center py-8",children:t("common:noAccount")}):r===null?e.jsx("p",{className:"text-xl text-center py-8",children:"Not a public account"}):e.jsx("div",{className:"flex flex-col gap-y-1",children:e.jsx(O,{cards:r,isPublic:!0,children:e.jsxs("div",{className:"flex justify-between my-2",children:[e.jsxs("h1",{children:[e.jsx("span",{className:"text-2xl font-light",children:t("collectionOf")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",a.username," "]}),e.jsx("span",{className:"block sm:inline text-sm",children:e.jsx(U,{friendId:a.friend_id})})]}),e.jsx(S,{to:`/trade/${s}`,children:e.jsxs(b,{children:[t("showPossibleTrades"),e.jsx(H,{})]})})]})})})}function ye(){const s=z(),{friendId:t}=R(),{data:a,isLoading:l}=M();if(x.useEffect(()=>{!t&&!l&&a?.friend_id&&s(`/collection/${a.friend_id}`,{replace:!0})},[l,t,a?.friend_id,s]),l)return e.jsx("div",{className:"mx-auto mt-12 animate-spin rounded-full size-12 border-4 border-white border-t-transparent"});const r=t??a?.friend_id;return r&&r!==a?.friend_id?e.jsx(oe,{friendId:r}):e.jsx(ie,{})}export{ye as default};
