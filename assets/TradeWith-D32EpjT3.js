import{j as e,u as U,$ as B,I as K,r as i,U as O,C as z,K as D,L as H,l as L,z as S,B as Y,Y as $}from"./index-LlXw60fV.js";import{N as T,M,C as k}from"./NumberFilter-CTgtEhxk.js";import"./index-bBXBrrsw.js";const E=({cards:a,ownedCards:_,selected:c,setSelected:o})=>{function l(n){function C(){c?.card_id===n.card_id?o(null):o(n)}return e.jsxs("li",{className:`flex rounded px-2 ${c?.card_id===n.card_id&&"bg-green-900"} hover:bg-gray-500`,onClick:C,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[n.card_id," "]}),e.jsx("span",{children:n.name}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",_.find(d=>d.card_id===n.card_id)?.amount_owned||0]})})]},n.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:a.map(l)})})},w=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],J=()=>{const{t:a}=U("trade-matches"),{toast:_}=B(),{friendId:c}=K(),{account:o}=i.useContext(O),{ownedCards:l}=i.useContext(z),[n,C]=i.useState(null),[d,I]=i.useState(null),[b,P]=i.useState((o?.max_number_of_cards_wanted||1)-1),[N,A]=i.useState((o?.min_number_of_cards_to_keep||1)+1),[m,g]=i.useState(null),[u,v]=i.useState(null);i.useEffect(()=>{!n&&c&&D(c).then(C),d||H(void 0,c).then(I)});const y=i.useMemo(()=>L.filter(t=>t.tradeable).map(t=>t.id),[]),x=i.useMemo(()=>{if(!d)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},j=d.filter(s=>s.amount_owned>(n?.min_number_of_cards_to_keep||1)),h=new Set(l.filter(s=>s.amount_owned>b).map(s=>s.card_id)),p=j.filter(s=>!h.has(s.card_id));for(const s of p){const r=S(s.card_id);r&&w.includes(r.rarity)&&y.includes(r.expansion)&&t[r.rarity].push({...r,amount_owned:s.amount_owned})}return t},[l,d,b,N]),f=i.useMemo(()=>{if(!d)return null;const t={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},j=l.filter(s=>s.amount_owned>=N),h=new Set(d.filter(s=>s.amount_owned>=(n?.max_number_of_cards_wanted||1)).map(s=>s.card_id)),p=j.filter(s=>!h.has(s.card_id));for(const s of p){const r=S(s.card_id);r&&w.includes(r.rarity)&&y.includes(r.expansion)&&t[r.rarity].push({...r,amount_owned:s.amount_owned})}return t},[l,d,b,N]),W=i.useMemo(()=>w.some(t=>x&&x[t].length>0&&f&&f[t].length>0),[x,f]);if(!c)return"Wrong friend id";function R({yourId:t,friendId:j}){function h(r){return r?e.jsxs("span",{className:"flex w-1/2",children:[e.jsxs("span",{className:"min-w-10",children:[r.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[r.card_id," "]}),e.jsx("span",{children:r.name})]}):e.jsx("span",{className:"w-1/2 text-center",children:"–"})}const p=m&&u&&m.rarity===u.rarity;async function s(){if(!p)return;const r={offering_friend_id:t,receiving_friend_id:j,offer_card_id:m.card_id,receiver_card_id:u.card_id,status:"offered"},{error:F}=await $.from("trades").insert(r);F?(console.log(F),_({title:a("tradeFailed"),variant:"default"})):(g(null),v(null),_({title:a("tradeOffered"),variant:"default"}))}return e.jsxs("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 text-center",children:[e.jsxs("div",{className:"flex justify-between mx-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:a("youGive")}),e.jsx("h4",{className:"text-lg font-medium",children:a("youReceive")})]}),e.jsx("div",{className:"flex justify-between rounded bg-zinc-800 px-1 mt-2",children:m||u?e.jsxs(e.Fragment,{children:[h(m),h(u)]}):e.jsx("span",{className:"w-full text-center",children:"Select cards to trade below"})}),e.jsx(Y,{className:"text-center mt-4",type:"button",variant:"outline",onClick:s,disabled:!p,children:a("offerTrades")})]})}return!o||!n||x===null||f===null?null:n.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-likht",children:a("tradingWith")}),e.jsxs("span",{className:"text-4xl font-bold",children:[" ",n.username," "]}),e.jsx("span",{children:e.jsxs("span",{className:"text-md",children:["(",n.friend_id,")"]})})]}),e.jsxs("div",{className:"flex gap-4 mb-2 mt-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{numberFilter:b,setNumberFilter:P,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(M,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(k,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":a("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(k,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":a("maxFilterTooltip")}),e.jsx(T,{numberFilter:N,setNumberFilter:A,options:[2,3,4,5],labelKey:"minNum"})]})]}),e.jsx(R,{yourId:o.friend_id,friendId:n.friend_id}),!W&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("noPossibleTradesDescription")})]}),w.map(t=>x[t].length>0&&f[t].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-6",children:t}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("youHave")}),e.jsx(E,{cards:f[t],ownedCards:l,selected:m,setSelected:g})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("friendHas")}),e.jsx(E,{cards:x[t],ownedCards:l,selected:u,setSelected:v})]})]})]},t))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("inActiveTradePage",{username:n?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("inActiveTradeDescription")})]})};export{J as default};
