import{u as Q,L as V,K as X,r as i,U as Y,k as A,z as D,au as G,aB as M,av as J,j as e,D as Z,n as $,o as ee,q as se,s as ae,I as E,B as te,ax as ne,X as O}from"./index-CUiPyv1p.js";import{u as re,a as ie,h as le,F as ce,b as y,c as F,e as C,d as S,S as oe,f as de}from"./SocialShareButtons-Cml5kTqi.js";import{M as x,C as u}from"./index-DB0X-vGo.js";import{N as P}from"./useWindowDimensionsHook-EpDM3WkF.js";import"./index-BF0vnTL-.js";const N=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],_e=({ownedCards:c,friendCards:p,ownAccount:w,friendAccount:l})=>{const{t:a}=Q("trade-matches"),h=V(),W=X(),{user:B,account:o,setAccount:K}=i.useContext(Y),v=w?.friend_id===l?.friend_id,[T,k]=i.useState(!1),[_,U]=i.useState((w?.max_number_of_cards_wanted||1)-1),[f,H]=i.useState((w?.min_number_of_cards_to_keep||1)+1);i.useEffect(()=>{h.pathname.includes("/collection")&&h.pathname.includes("/trade")?T||k(!0):k(!1)},[h]);const I=i.useMemo(()=>A.filter(s=>s.tradeable).map(s=>s.id),[]),j=i.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},n=p.filter(t=>t.amount_owned>(l?.min_number_of_cards_to_keep||1)),m=new Set(c.filter(t=>t.amount_owned>_).map(t=>t.card_id)),g=n.filter(t=>!m.has(t.card_id));for(const t of g){const r=D(t.card_id);r&&N.includes(r.rarity)&&I.includes(r.expansion)&&s[r.rarity].push({...r,amount_owned:t.amount_owned})}return s},[c,p,_,f]),b=i.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},n=c.filter(t=>t.amount_owned>=f),m=new Set(p.filter(t=>t.amount_owned>=(l?.max_number_of_cards_wanted||1)).map(t=>t.card_id)),g=n.filter(t=>!m.has(t.card_id));for(const t of g){const r=D(t.card_id);r&&N.includes(r.rarity)&&I.includes(r.expansion)&&s[r.rarity].push({...r,amount_owned:t.amount_owned})}return s},[c,p,_,f]),L=i.useMemo(()=>N.some(s=>j[s].length>0&&b[s].length>0),[j,b]),R=G({is_active_trading:J(),min_number_of_cards_to_keep:M().min(1).max(10),max_number_of_cards_wanted:M().min(1).max(10)}),d=re({resolver:ie(R),defaultValues:{is_active_trading:o?.is_active_trading||!1,min_number_of_cards_to_keep:o?.min_number_of_cards_to_keep||1,max_number_of_cards_wanted:o?.max_number_of_cards_wanted||1}}),q=async s=>{try{const n=await ne.from("accounts").upsert({email:B?.user.email,username:o?.username,is_active_trading:s.is_active_trading,min_number_of_cards_to_keep:s.min_number_of_cards_to_keep,max_number_of_cards_wanted:s.max_number_of_cards_wanted}).select().single();if(!n.data)throw console.error("Could not save account",o),new Error("Could not save account");K(n.data),O({title:a("accountSaved"),variant:"default"})}catch(n){console.error("error saving account",n),O({title:a("errorSavingAccount"),variant:"destructive"})}},z=()=>v?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("ownCollection")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("ownCollectionDescription")}),e.jsx(ce,{...d,children:e.jsx("form",{onSubmit:d.handleSubmit(q),className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"border-1 border-neutral-700 p-4 space-y-2",children:[e.jsx(y,{control:d.control,name:"is_active_trading",render:({field:s})=>e.jsx(F,{className:"flex flex-col items-start",children:e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(S,{className:"flex sm:w-72",children:a("isActiveTrading")}),e.jsx("div",{className:"grow-1",children:e.jsx(oe,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(de,{className:"grow",children:s.value?"active":"disabled"}),e.jsx(x,{id:"activeInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"activeInput","data-tooltip-content":a("activeTradingInputTooltip")})]})})})}),e.jsx(y,{control:d.control,name:"min_number_of_cards_to_keep",render:({field:s})=>e.jsx(F,{className:"flex flex-col items-start",children:e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(S,{className:"flex sm:w-72",children:a("minNumberOfCardsToKeep")}),e.jsx("div",{className:"grow-1",children:e.jsx(E,{type:"number",...s})}),e.jsx(x,{id:"minInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"minInput","data-tooltip-content":a("minInputTooltip")})]})})})}),e.jsx(y,{control:d.control,name:"max_number_of_cards_wanted",render:({field:s})=>e.jsx(F,{className:"flex flex-col items-start",children:e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(S,{className:"flex sm:w-72",children:a("maxNumberOfCardsWanted")}),e.jsx("div",{className:"grow-1",children:e.jsx(E,{type:"number",...s})}),e.jsx(x,{id:"maxInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"maxInput","data-tooltip-content":a("maxInputTooltip")})]})})})}),e.jsx("div",{className:"w-full flex justify-end mt-8",children:e.jsx(te,{type:"submit",children:a("save")})})]})})})]}):l?.is_active_trading?L?N.map(s=>j[s].length>0&&b[s].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("friendHas")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:j[s].map(n=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[n.card_id," "]}),e.jsx("span",{children:n.name})]}),e.jsx("span",{title:a("amountYouOwn"),className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",c.find(m=>m.card_id===n.card_id)?.amount_owned||0]})})]},n.card_id))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("youHave")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:b[s].map(n=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[n.card_id," "]}),e.jsx("span",{children:n.name})]}),e.jsx("span",{title:a("amountFriendOwns"),className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",n.amount_owned]})})]},n.card_id))})})]})]})]},s)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("noPossibleTradesDescription")})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("inActiveTradePage",{username:l?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("inActiveTradeDescription")})]});return e.jsx(Z,{open:T,onOpenChange:s=>{s||W(h.pathname.replace("/trade",""))},children:e.jsxs($,{className:"border-1 border-neutral-700 shadow-none max-w-4xl h-[90vh] content-start flex flex-col",children:[e.jsx(ee,{children:e.jsx(se,{children:a("title")})}),e.jsxs("div",{className:"flex flex-col gap-4 grow",children:[e.jsx("p",{className:"pb-2",children:a("featureDescription")}),e.jsx("p",{className:"pb-2",children:a("friendAccountDetails",{...l})}),!v&&e.jsxs("div",{className:"flex flex-row gap-4 mb-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{numberFilter:_,setNumberFilter:U,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(x,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":a("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":a("maxFilterTooltip")}),e.jsx(P,{numberFilter:f,setNumberFilter:H,options:[2,3,4,5],labelKey:"minNum"})]})]}),z()]}),v&&e.jsx(ae,{children:e.jsx(le,{})})]})})};export{_e as default};
