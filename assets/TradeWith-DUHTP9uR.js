import{e as B,a4 as P,j as e,f as O,ax as R,B as E,u as F,v as D,ay as W,X as L,Y as z,Z as H,a2 as K,n as U,r as x,t as Y,N as T}from"./index-BxFWimv5.js";import{M as k,N as I,C as M}from"./NumberFilter-CWqw5e0b.js";import"./index-BNZWzldq.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Q=B("copy",G),V=({friendId:i,className:m="",showCopyButton:s=!0})=>{const{toast:r}=P(),c=async()=>{try{await navigator.clipboard.writeText(i),r({title:"Friend ID copied to clipboard!",variant:"default",duration:2e3})}catch(l){console.error("Failed to copy friend ID:",l),r({title:"Failed to copy friend ID",variant:"destructive",duration:3e3})}};return i?e.jsxs("span",{className:O("inline-flex items-center gap-1",m),children:[e.jsx("span",{className:"font-mono",children:R(i)}),s&&e.jsx(E,{variant:"ghost",size:"icon",onClick:c,className:"h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200","aria-label":"Copy friend ID",children:e.jsx(Q,{className:"h-2.5 w-2.5"})})]}):null},S=({cards:i,ownedCards:m,selected:s,setSelected:r})=>{const{i18n:c}=F();function l(n){function _(){s?.card_id===n.card_id?r(null):r(n)}return e.jsxs("li",{className:`flex rounded px-2 cursor-pointer ${s?.card_id===n.card_id&&"bg-green-900"} hover:bg-neutral-600`,onClick:_,children:[e.jsxs("span",{className:"min-w-14 me-4",children:[n.card_id," "]}),e.jsx("span",{children:D(n,c.language)}),e.jsx("span",{title:"Amount you own",className:"text-gray-400 ml-auto",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",m.find(u=>u.card_id===n.card_id)?.amount_owned||0]})})]},n.card_id)}return e.jsx("div",{className:"rounded-lg border-1 border-neutral-700 border-solid p-2 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:i.map(l)})})},X=({yourId:i,friendId:m,yourCard:s,friendCard:r,setYourCard:c,setFriendCard:l})=>{const{t:n,i18n:_}=F("trade-matches"),{toast:u}=P(),g=W();function j(o){return o?e.jsxs("span",{className:"flex",children:[e.jsxs("span",{className:"min-w-10",children:[o.rarity," "]}),e.jsxs("span",{className:"min-w-14 me-4",children:[o.card_id," "]}),e.jsx("span",{children:D(o,_.language)})]}):"—"}const N=s&&r&&s.rarity===r.rarity;async function b(){if(!N)return;const o={offering_friend_id:i,receiving_friend_id:m,offer_card_id:s.card_id,receiver_card_id:r.card_id,status:"offered"};try{g.mutate(o)}catch(f){console.log("TradeOffer: Error inserting trade",f),u({title:n("tradeFailed"),variant:"default"})}c(null),l(null),u({title:n("tradeOffered"),variant:"default"})}return!s&&!r?e.jsx("div",{className:"flex rounded-lg border-1 border-neutral-700 border-solid p-2 w-full items-center justify-around text-center h-[206px] sm:h-[138px]",children:e.jsx("h4",{className:"text-lg font-medium",children:n("selectCardsToTrade")})}):e.jsxs("div",{className:"bg-neutral-900 rounded-lg border-1 border-neutral-700 border-solid p-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:n("youGive")}),j(s)]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-lg font-medium",children:n("youReceive")}),j(r)]})]}),e.jsx(E,{className:"block w-full sm:w-1/2 mx-auto text-center",type:"button",variant:"outline",onClick:b,disabled:!N,children:n("offerTrades")})]})},w=["◊","◊◊","◊◊◊","◊◊◊◊","☆"];function J(){const{t:i}=F("trade-matches"),{friendId:m}=L(),{data:s}=z(m),{data:r}=H(m),{data:c}=K(),{data:l=[]}=U(),[n,_]=x.useState((c?.max_number_of_cards_wanted||1)-1),[u,g]=x.useState((c?.min_number_of_cards_to_keep||1)+1),[j,N]=x.useState(null),[b,o]=x.useState(null),f=x.useMemo(()=>Y.filter(a=>a.tradeable).map(a=>a.id),[]),h=x.useMemo(()=>{if(!r)return null;const a={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},y=r.filter(t=>t.amount_owned>(s?.min_number_of_cards_to_keep||1)),v=new Set(l.filter(t=>t.amount_owned>n).map(t=>t.card_id)),C=y.filter(t=>!v.has(t.card_id));for(const t of C){const d=T(t.card_id);d&&w.includes(d.rarity)&&f.includes(d.expansion)&&a[d.rarity].push({...d,amount_owned:t.amount_owned})}return a},[l,r,n,s?.min_number_of_cards_to_keep,f]),p=x.useMemo(()=>{if(!r)return null;const a={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},y=l.filter(t=>t.amount_owned>=u),v=new Set(r.filter(t=>t.amount_owned>=(s?.max_number_of_cards_wanted||1)).map(t=>t.card_id)),C=y.filter(t=>!v.has(t.card_id));for(const t of C){const d=T(t.card_id);d&&w.includes(d.rarity)&&f.includes(d.expansion)&&a[d.rarity].push({...d,amount_owned:t.amount_owned})}return a},[l,r,u,s?.max_number_of_cards_wanted,f]),A=x.useMemo(()=>w.some(a=>h&&h[a].length>0&&p&&p[a].length>0),[h,p]);return!c||!s||h===null||p===null?null:s.is_active_trading?e.jsxs("div",{className:"kap-4 justify-center max-w-2xl m-auto px-2",children:[e.jsxs("h1",{className:"mb-4",children:[e.jsx("span",{className:"text-2xl font-light",children:i("tradingWith")}),e.jsxs("span",{className:"text-2xl font-bold",children:[" ",s.username," "]}),e.jsx("span",{className:"block sm:inline text-sm",children:e.jsx(V,{friendId:s.friend_id})})]}),e.jsx(X,{yourId:c.friend_id,friendId:s.friend_id,yourCard:j,friendCard:b,setYourCard:N,setFriendCard:o}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-2 mb-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(I,{className:"w-full sm:w-[260px]",numberFilter:u,setNumberFilter:g,options:[2,3,4,5],labelKey:"minNum"}),e.jsx(M,{className:"h-4 w-4 mx-1","data-tooltip-id":"maxFilter","data-tooltip-content":i("maxFilterTooltip")})]}),e.jsxs("div",{className:"flex sm:flex-row-reverse items-center gap-2",children:[e.jsx(k,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(I,{className:"w-full sm:w-[260px]",numberFilter:n,setNumberFilter:_,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(M,{className:"h-4 w-4 mx-1","data-tooltip-id":"minFilter","data-tooltip-content":i("minFilterTooltip")})]})]}),!A&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:i("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:i("noPossibleTradesDescription")})]}),w.map(a=>h[a].length>0&&p[a].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-1 text-center",children:["[ ",a," ]"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:i("youHave")}),e.jsx(S,{cards:p[a],ownedCards:l,selected:j,setSelected:N})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("h4",{className:"text-md font-medium mb-1 ml-2",children:i("friendHas")}),e.jsx(S,{cards:h[a],ownedCards:l,selected:b,setSelected:o})]})]})]},a))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:i("inActiveTradePage",{username:s?.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:i("inActiveTradeDescription")})]})}export{J as default};
