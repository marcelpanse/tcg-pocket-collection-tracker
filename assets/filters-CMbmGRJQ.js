import{hg as h,z as _,I as w,e as l,y as x,h9 as f,ha as C}from"./index-Fs0_tzZR.js";import{i as p}from"./i18n-vendor-DDmeScd6.js";function v(e,o){if(e.length===0)return o.length;if(o.length===0)return e.length;let r=Array(e.length+1).fill(0).map((n,a)=>a),t=Array(e.length+1);for(let n=1;n<=o.length;n++){t[0]=n;for(let a=1;a<=e.length;a++){const i=e[a-1]===o[n-1]?0:1;t[a]=Math.min(r[a]+1,t[a-1]+1,r[a-1]+i)}[r,t]=[t,r]}return r[e.length]}const O=["all",...l],k=["expansion-newest","rarity","type","recent"],u=x,b=["all","missing","registered"],M=["all","wanted","extra"],L={"expansion-newest":(e,o)=>e.expansion!==o.expansion?l.indexOf(e.expansion)-l.indexOf(o.expansion):e.card_id.localeCompare(o.card_id,p.language||"en",{numeric:!0}),rarity:(e,o)=>(e.internal_id&63)-(o.internal_id&63),type:(e,o)=>u.indexOf(e.energy)-u.indexOf(o.energy),recent:(e,o)=>e.updated_at&&o.updated_at?o.updated_at.getTime()-e.updated_at.getTime():e.updated_at&&!o.updated_at?-1:1};function B(e,o,r){let t=h;if(e.deckbuildingMode&&(t=t.filter(n=>n.internal_id===n.alternate_versions[0])),e.expansion!==void 0&&e.expansion!=="all"&&(t=t.filter(n=>n.expansion===e.expansion)),e.expansion!==void 0&&e.pack!==void 0&&e.pack!=="all"&&(t=t.filter(n=>n.pack===e.pack||n.pack==="everypack")),e.ownership!==void 0&&e.ownership!=="all"&&(t=t.filter(n=>e.ownership==="missing"?!n.collected:n.collected)),e.trading!==void 0&&e.trading!=="all"){if(!r)throw new Error("Cannot filter by trading status without trading settings");const n=new Set(e.trading==="wanted"?f(o,r):C(o,r));t=t.filter(a=>n.has(a.internal_id))}if(e.rarity!==void 0&&e.rarity.length>0){const n=e.rarity;t=t.filter(a=>n.includes(a.rarity))}if(e.cardType!==void 0&&e.cardType.length>0){const n=e.cardType;t=t.filter(a=>a.card_type.toLowerCase()==="trainer"?n.includes("trainer"):n.includes(a.energy))}if(e.search){const n=e.search.toLowerCase(),a=2;t=t.filter(i=>{const d=_(i,p.language).toLowerCase();let s=!1;e.allTextSearch&&(s=i.ability&&(i.ability.name.toLowerCase().includes(n)||i.ability.effect.toLowerCase().includes(n))||i.attacks.some(c=>c.name?.toLowerCase().includes(n)||c.effect?.toLowerCase()!=="no effect"&&c.effect?.toLowerCase()?.includes(n)));const g=d.includes(n),m=v(d,n)<=a,y=i.card_id.toLowerCase().includes(n);return s||g||m||y})}for(const n of t){e.deckbuildingMode?n.amount_owned=n.alternate_versions.reduce((i,d)=>{const s=w(d);return i+(o.get(s?.internal_id||0)?.amount_owned??0)},0):n.amount_owned=o.get(n.internal_id)?.amount_owned??0;const a=o.get(n.internal_id);n.collected=a?.collection.includes(n.card_id)??!1,n.updated_at=a?.updated_at}if(e.minNumber!==void 0){const n=e.minNumber;t=t.filter(a=>(a.amount_owned??0)>=n)}if(e.maxNumber!==void 0&&e.maxNumber!=="âˆž"){const n=e.maxNumber;t=t.filter(a=>(a.amount_owned??0)<=n)}return e.sortBy!==void 0&&t.sort(L[e.sortBy]),e.sortDesc&&t.reverse(),t}export{u as c,O as e,B as g,b as o,k as s,M as t};
