import{Y as v,h as G,w as O}from"./index-UqmPvg5N.js";const w=Object.groupBy(v,t=>t.expansion),n=t=>({"◊":0,"◊◊":0,"◊◊◊":0,"◊◊◊◊":0,"☆":0,"☆☆":0,"☆☆☆":0,"✵":0,"✵✵":0,"Crown Rare":0,P:0,...t}),d={positions1to3:n({"◊":100}),position4:n({"◊◊":90,"◊◊◊":5,"◊◊◊◊":1.666,"☆":2.572,"☆☆":.5,"☆☆☆":.222,"Crown Rare":.04}),position5:n({"◊◊":60,"◊◊◊":20,"◊◊◊◊":6.664,"☆":10.288,"☆☆":2,"☆☆☆":.888,"Crown Rare":.16}),position4Shiny:n({"◊◊":89,"◊◊◊":4.9525,"◊◊◊◊":1.666,"☆":2.572,"☆☆":.5,"☆☆☆":.222,"✵":.71425,"✵✵":.33325,"Crown Rare":.04}),position5Shiny:n({"◊◊":56,"◊◊◊":19.81,"◊◊◊◊":6.664,"☆":10.288,"☆☆":2,"☆☆☆":.888,"✵":2.857,"✵✵":1.333,"Crown Rare":.16})},E={position1:n({"◊":100}),position2:n({"◊":17.73,"◊◊":82.27}),position3:n({"◊":23.021,"◊◊":17.985,"◊◊◊":40.659,"☆":12.858,"☆☆":2.5,"☆☆☆":1.111,"✵✵":1.667,"Crown Rare":.198}),position4:n({"◊◊◊◊":100})},B=n({"☆":1,"☆☆":1,"☆☆☆":1,"✵":1,"✵✵":1,"Crown Rare":1}),_=n({"◊◊◊":87.1,"☆":12.9});function F(t,a){if(t?.cardsPerPack===4){const i=`position${a}`;return E[i]||d.positions1to3}if(a<=3)return d.positions1to3;if(a===4)return t.containsShinies?d.position4Shiny:d.position4;if(a===5)return t.containsShinies?d.position5Shiny:d.position5;throw new Error("Invalid within pack pull position")}function N(t,a,i,s){if(!a.packStructure)throw new Error(`${a.id}: can't calculate probability without 'packStructure' field`);const l=w[a.id].filter(r=>r.pack===i.name||r.pack==="everypack");return u(t.filter(r=>r.expansion===a.id),l,a.packStructure,s)}const A=(t,a,i)=>{if(!t.packStructure)throw new Error(`${t.id}: can't calculate probability without 'packStructure' field`);const s=a==="everypack"?t?.packs[0].name:a,l=w[t.id].filter(r=>r.pack===s||r.pack==="everypack");return u([i],l,t.packStructure,!1)*100},M=(t,a)=>{const i=G(t.expansionId),s=i.packStructure;if(!s)throw new Error(`${i.id}: can't calculate probability without 'packStructure' field`);const l=[...new Set(a.flat().filter(r=>!r.owned).flatMap(r=>r.missionCardOptions).map(O).filter(r=>r!==void 0))];return i?.packs.map(r=>[r.name,u(l,w[i.id].filter(f=>f.pack===r.name||f.pack==="everypack"),s,!1)*100])||[]},u=(t,a,i,s)=>{const l=a.filter(o=>B[o.rarity]===1),r=new Set(t.map(o=>o.internal_id)),f=a.filter(s?o=>o.alternate_versions.some(p=>r.has(p)):o=>r.has(o.internal_id)),C=Array(i.cardsPerPack).fill(0);let b=0,R=0;for(const o of f){const p=[o.rarity];if(p[0]==="P")continue;const m=Array(i.cardsPerPack).fill(0);let T=0,g=0;for(const e of p)if(o.baby&&e!=="Crown Rare"&&i.containsBabies){const h=a.filter(c=>c.rarity===e&&c.baby).length;g+=_[e]/100/h}else{const h=a.filter(c=>c.rarity===e&&(e==="Crown Rare"||!c.baby)).length;for(let c=1;c<=i.cardsPerPack;c++){const I=F(i,c);m[c-1]+=I[e]/100/h}i.cardsPerPack===5&&(T+=B[e]/l.length)}for(let e=0;e<i.cardsPerPack;e++)C[e]+=m[e];b+=T,R+=g}const y=C.reduce((o,p)=>o*(1-p),1);if(i.cardsPerPack===4)return 1-y;let P=0,k=0,S=0;return i.containsBabies?(P=.9162*(1-y),k=5e-4*(1-(1-b)**5),S=.0833*(1-y*(1-R))):(P=.9995*(1-y),k=5e-4*(1-(1-b)**5)),P+k+S};export{M as a,A as b,N as p};
